/*! Copyright Â© Apple Inc. All rights reserved. See LICENSE for additional license information. */
(()=>{"use strict";const e={version:"5.78.291",build:"25.15-2",cdnBase:"//cdn.apple-mapkit.com",cdnVersion:"5.78.291"},t=27,i=32,s=37,o=38,n=39,a=40,r=()=>{},l=(e,t)=>e-t*Math.floor(e/t),h=e=>Math.log2(e),c=(e,t,i)=>Math.max(t,Math.min(e,i)),d=(e,t)=>Object.keys(t).some((i=>t[i]===e)),u=(e,t,i)=>{if(void 0===e||(i?.checkNull??!0)&&null===e)throw new Error(t||"Missing parameter")},p=(e,t,i)=>{if(typeof e!==t)throw new TypeError(i||`Expected \`${t}\` but got \`${typeof e}\``);if("number"===t&&isNaN(e))throw new TypeError(i||`Expected \`${t}\` but got \`NaN\``);if("object"===t&&e instanceof Array)throw new TypeError(i||"Expected a non-array object but got an array")},m=(e,t,i)=>{if(!(e instanceof t))throw new Error(i||"Unexpected object instance")},g=(e,t)=>{if(!Array.isArray(e))throw new Error(t||"Expected an array")},_=(e,t)=>null==e?{}:(p(e,"object",t||"[MapKit] The `options` parameter is not a valid object."),e),f=(e,t,i)=>e.replace(/{{(.*?)}}/g,((e,s)=>{const o=t[s];if(i&&null==o)throw new Error("fillTemplate: Missing value for parameter: "+s);return o??""})),y=()=>Math.floor(1e15*(9*Math.random()+1));class v{constructor(e,t,i){var s;this.language=e.toLowerCase(),this.region=t?t.toUpperCase():null,this.script=i?(s=i)?s[0].toUpperCase()+s.substr(1).toLowerCase():s:null}get tag(){return this.region?`${this.language}-${this.region}`:this.script?`${this.language}-${this.script}`:this.language}toString(){return`{ ${`language: ${this.language}`}${this.region?`, region: ${this.region}`:""}${this.script?`, script: ${this.script}`:""} }`}static parse(e){let t,i;if(e&&"string"==typeof e){if(-1!==e.indexOf("_"))return console.warn("Invalid character: '_'"),null;const s=e.split("-"),o=s[0];if(o.length<2||o.length>4)return console.warn("Invalid language:",e),null;if(!(s.length<4))return console.warn("Don't know how to parse language tags with more than 3 parts:",e),null;for(let o=1;o<s.length;o+=1){const n=s[o];if(4===n.length)i=n;else{if(!(n.length>1&&n.length<4))return console.warn("Don't know how to parse:",e),null;t=n}}return new v(o,t,i)}return null}}const b=(e,t)=>{if(!e)return;const{language:i,region:s,script:o}=e;t[i]=t[i]||{regions:[],scripts:[]},s&&t[i].regions.push(s),o&&t[i].scripts.push(o)};const w={zh:{CN:"Hans",HK:"Hant",TW:"Hant"}},C={"en-AU":"en-GB","en-IE":"en-GB","en-IN":"en-GB","en-NZ":"en-GB","en-SG":"en-GB","en-ZA":"en-GB","es-LA":"es-MX","es-XL":"es-MX","nn-NO":"nb-NO","no-NO":"nb-NO","vi-VI":"vi-VN",iw:"he-IL"},k=["bn-BD","gu-IN","kn-IN","ml-IN","mr-IN","or-IN","pa-IN","ta-IN","te-IN","ur-PK"],M=k.map((e=>e.split("-")[0]));function S(e,t,i,s){for(const o of e){const e=t.indexOf(o);if(-1===e)throw new Error;t.splice(e,1);const n=o.split("-")[0];s[n]=i[n],delete i[n]}}function L(e,t,i,s){t.splice(0,0,...e),t.sort();for(const[e,t]of Object.entries(s))i[e]=t}const x=new class{constructor(e){this.supportMap={},this.delegate=e;for(const e of this.delegate.supportedLocales)b(v.parse(e),this.supportMap)}bestMatch(e,t){let i=v.parse(e),s=null;if(i&&this.delegate.localesMap){const e=this.delegate.localesMap;e[i.tag]?i=v.parse(e[i.tag]):e[i.language]&&(i=v.parse(e[i.language]))}return t=t||null,i&&(s=((e,t,i)=>{const{language:s,region:o,script:n}=e;let a=n;const r=i[s];if(!r)return null;if(o){const i=r.regions.find((t=>t.toUpperCase()===e.region?.toUpperCase()));if(i)return new v(s,i);const n=t[s];n&&n[o.toUpperCase()]&&(e.script=a=n[o.toUpperCase()])}if(a){const t=r.scripts.find((t=>t.toUpperCase()===e.script?.toUpperCase()));return new v(s,null,t)}return new v(s)})(i,this.delegate.regionToScriptMap,this.supportMap)),s?s.tag:t}}({supportedLocales:["ar","bn","ca","cs","da","de","el","en-AU","en-GB","en","es-MX","es-US","es","fi","fr-CA","fr","gu","he","hi","hr","hu","id","it","ja","kn","ko","ml","mr","ms","nb","nl","or","pa","pl","pt-PT","pt","ro","ru","sk","sl","sv","ta","te","th","tr","uk","ur","vi","zh-Hans","zh-Hant","zh-HK"],regionToScriptMap:w,localesMap:C}),A=Object.create(null);S(M,x.delegate.supportedLocales,x.supportMap,A);const E=function(){L(M,x.delegate.supportedLocales,x.supportMap,A)},T=x;class I{addEventListener(e,t,i){i=i??null,this._listeners||(this._listeners={});const s=this._listeners[e]??[];this._listeners[e]=s;for(const{listener:e,thisObject:o}of s)if(e===t&&o===i)return!1;return s.push({thisObject:i,listener:t}),!0}removeEventListener(e,t,i){if(i=i??null,!this._listeners)return!1;if("string"!=typeof e){for(const e in this._listeners)this.removeEventListener(e,t,i);return!1}const s=this._listeners[e];if(!s)return!1;const o=s.findIndex((({listener:e,thisObject:s})=>t===e&&i===s||!t&&i&&i===s));return o>-1&&s.splice(o,1),0===s.length&&delete this._listeners[e],o>-1}dispatchEvent(e){if(e.target=this,!this._listeners)return!0;const t=this._listeners[e.type];if(!t||e._stoppedPropagation)return!0;const i=t.slice(0);for(const{listener:t,thisObject:s}of i)if("function"==typeof t?t.call(s,e):s||t.handleEvent.call(t,e),e._stoppedPropagation)break;return!e.defaultPrevented}}I.prototype._listeners=void 0;class O{constructor(e){this.target=null,this.type=e,this.defaultPrevented=!1,this._stoppedPropagation=!1}stopPropagation(){this._stoppedPropagation=!0}preventDefault(){this.defaultPrevented=!0}}const R=I,P=O,D={EventTarget:I,Event:O},z=e=>e;function N(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const F=Object.freeze({LOAD:"load",LOADEND:"loadend",LOAD_ERROR:"load-error"});class U extends O{constructor(e){super(B.Events.LOAD),this.jsModules=e}}class G extends O{constructor(e){super(B.Events.LOADEND),this.libraryNames=e}}const B=new class extends I{constructor(...e){super(...e),N(this,"Libraries",[]),N(this,"loadedLibraries",[]),N(this,"IS_CHUNKED",!1),N(this,"Events",F),N(this,"jsModules",{mapkit:{}}),N(this,"load",void 0),N(this,"loadAll",void 0)}_chunkLoaded(e,t){Object.keys(e).forEach((t=>{if("mapkit"!==t)this.jsModules[t]=e[t];else{Object.keys(e.mapkit).forEach((t=>{Object.defineProperty(this.jsModules.mapkit,t,z(Object.getOwnPropertyDescriptor(e.mapkit,t)))}))}}));const i=new U(e);this.dispatchEvent(i),t&&t()}_dispatchLoadEndEvent(e){const t=new G(e);this.dispatchEvent(t)}},W=B;class Z{constructor(){this.loggers=[]}appendLogger(e){this.loggers.push(e)}_invoke(e,t){if(this.loggers.length)for(const i of this.loggers)i[e]&&i[e].apply(i,t);else"error"!==e&&"warn"!==e||console[e].apply(console,t)}error(){this._invoke("error",Array.from(arguments))}warn(){this._invoke("warn",Array.from(arguments))}log(){this._invoke("log",Array.from(arguments))}info(){this._invoke("info",Array.from(arguments))}debug(){this._invoke("debug",Array.from(arguments))}}const K=new Z;Z.sharedLogger=K;const j=function(e){return String.fromCharCode.apply(String,e.split("").map((e=>(e.codePointAt(0)+242)%255)))},H=Symbol(),V=Object.freeze({Highest:0,High:1,Medium:2,Low:3}),q={[V.Highest]:12,[V.High]:12,[V.Medium]:4,[V.Low]:1},Y={[V.Highest]:[],[V.High]:[],[V.Medium]:[],[V.Low]:[]},X={[V.Highest]:0,[V.High]:0,[V.Medium]:0,[V.Low]:0},$=()=>{for(const e of Object.values(V)){if(Y[e].length>0){const t=q[e];return X[e]===t?null:Y[e][0]}if(X[e]>0)return null}return null},J=()=>{for(const e of Object.values(V))if(Y[e].length>0)return Y[e].shift(),!0;return!1},Q=e=>{for(const t of Object.values(V)){const i=Y[t].indexOf(e);if(-1!==i)return Y[t].splice(i,1),!0}return!1},ee=()=>{let e=$();for(;e;)X[e.priority]+=1,J(),e._loaderWillStart.call(e),e=$()},te=e=>{Y[e.priority].push(e),ee()},ie=e=>Q(e),se=e=>{X[e.priority]-=1,ee()},oe=((()=>{if(/iP(hone|od|ad)/.test(navigator.platform)){const e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e?.[1]??"0",10),parseInt(e?.[2]??"0",10),parseInt(e?.[3]??"0",10)]}})(),(e,t)=>{if(!ne(e))throw new Error(t||"Expected an Element")}),ne=e=>e instanceof window.Node&&e.nodeType===window.Node.ELEMENT_NODE,ae=(window.XMLHttpRequest,e=>{const t=new window.XMLHttpRequest;return t.addEventListener("load",e),t.addEventListener("error",e),t.addEventListener("timeout",e),t}),re=()=>document.createElement("canvas"),le=Object.freeze({Unscheduled:0,Waiting:1,Loading:2,Canceled:3,Succeeded:4,Failed:5});Object.freeze(Object.values(le));const he=class{constructor(e,t){this._state=le.Unscheduled,this._retries=0,this._unscheduled=!1,this._delay=null,this._timeoutId=void 0,this.priority=e,this._delegate=t,this._init(e,t)}_getDelegate(){return this._delegate}_isUnscheduled(){return this._unscheduled}get state(){return this._state}schedule(){this._state===le.Unscheduled&&(this._state=le.Waiting,te(this))}unschedule(){let e=!1;if(this._state===le.Waiting)e=ie(this);else{if(this._state!==le.Loading)return!1;se(this),e=!0}return this._unscheduled=e,this._state=le.Canceled,"function"==typeof this._delegate.loaderDidCancel&&this._delegate.loaderDidCancel(this),this._reset(),e}_loaderWillStart(){this._state=le.Loading,"function"==typeof this._delegate.loaderWillStart&&this._delegate.loaderWillStart(this)}_loaderDidSucceed(e){this._state=le.Succeeded,se(this),"function"==typeof this._delegate.loaderDidSucceed&&this._delegate.loaderDidSucceed(this,e),this._reset()}_loaderDidFail(e){this._state=le.Failed,se(this),"function"==typeof this._delegate.loaderDidFail&&this._delegate.loaderDidFail(this,e),this._reset()}_init(e,t){this.priority=e,this._state=le.Unscheduled,this._delegate=t,this._retries=0,this._timeoutId=void 0,this._delay=null,this._unscheduled=!1}_reload(e){if(this._retries++,this._retries<3){const e=this._delay??1e4;this._timeoutId=setTimeout((()=>this._loaderWillStart()),e)}else this._loaderDidFail(e)}_reset(){clearTimeout(this._timeoutId)}};const ce=class extends he{constructor(e,t,i){super(i?.priority??V.Highest,t),this._origin=null,this._headers=i?.headers??null,this._xhr=null,this._xhrData=void 0,this._method=i?.method??"GET",this._retry=i?.retry??!1,this._timeout=i?.timeout??0,this._withCredentials=i?.withCredentials??!1,this._url=e,this._delay=i?.delay??null}get xhr(){return this._xhr}get url(){return this._url}get xhrData(){return this._xhrData}unschedule(){return this._xhr?.abort(),super.unschedule()}_loaderWillStart(){if(super._loaderWillStart(),this._xhr=ae(this),this._xhr.open(this._method,this.url,!0),this._xhr.timeout=this._timeout,this._xhr.withCredentials=this._withCredentials,this._origin&&(this._xhr.setDisableHeaderCheck(!0),this._xhr.setRequestHeader("Origin",this._origin)),this._headers)for(const[e,t]of Object.entries(this._headers))this._xhr.setRequestHeader(e,t);if("POST"===this._method&&!this._xhrData){const e=this._getDelegate(),t=e.getDataToSend?.(this._xhr);if(!t)return;this._xhrData=t}this._xhr.send(this._xhrData)}handleEvent(e){const t=e.target,i=e.type;if("error"===i||"timeout"===i||200!==t.status)this._retry?this._reload(t):this._loaderDidFail(t);else if("load"===i)this._loaderDidSucceed(t);else{const e=t.status??-1;console.log(`Unhandled XHR event type: ${i} status: ${e}`)}}},de="function"==typeof ErrorEvent;function ue(e,t,i,s){if(!de)return i?e.apply(t,i):e.call(t);try{return i?e.apply(t,i):e.call(t)}catch(e){console.error(e);const t=new ErrorEvent("error",{message:e instanceof Error?e.message:e instanceof Object?e.toString():"(Unknown error)",filename:e instanceof Error?e.fileName||e.stack:"(Unknown filename)",lineno:e instanceof Error?e.lineNumber:void 0,colno:e instanceof Error?e.columnNumber:void 0,error:e});return window.dispatchEvent(t),z(s)}}const pe=e=>Promise.all(e.map((e=>fetch(e,{mode:"no-cors",credentials:"include"})))).then((()=>{}));function me(e,t,i){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,i)}function ge(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _e(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,fe(e,t,"set"),i),i}function fe(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}q[V.Highest]*=10,q[V.High]*=10,q[V.Medium]*=10,q[V.Low]*=10;const ye="https:",ve={url:ye+"//cdn.apple-mapkit.com/ma/bootstrap",apiVersion:"2",accessKeyExpirationBiasMS:3e4},be={OK:200,MULTIPLE_CHOICES:300,BAD_REQUEST:400,UNAUTHORIZED:401,TOO_MANY_REQUESTS:429},we=["language","countryCode","madabaBaseUrl","authorizationCallback","libraries","logger","_showMapsLogo","_showLegalLink","bootstrapTimeout","_shadowDOMMode","_showsTileInfo","_distUrl","_syrupUrl","_uiBaseUrl","_teamId","_previewLoCSR","_forcedRenderingMode","_proxyPrefixes","_shouldLogin","_disableWebGLCheck","_enableExperimentalLanguages"],Ce="R`ha\\aHe_";we.push(Ce);const ke=Object.freeze({READY:0,PENDING:1,ERROR:2,UNINITIALIZED:3}),Me=Object.freeze({Initialized:"Initialized",Refreshed:"Refreshed"}),Se=Object.freeze({Initialized:"configuration-init",Changed:"configuration-change",Error:"error"}),Le=Object.freeze({BadRequest:"Bad Request",Unauthorized:"Unauthorized",TooManyRequests:"Too Many Requests",MalformedResponse:"Malformed Response",Timeout:"Timeout",NetworkError:"Network Error",Unknown:"Unknown"}),xe="Bearer {{token}}",Ae=Object.freeze({Apple:"Apple",AutoNavi:"AutoNavi"});let Ee=!1;const Te=new WeakMap,Ie=window.location.hostname,Oe=window.location.href;class Re{constructor(e){this.bootstrap=e,this.countryCode=null}setForcedCountryCode(e){return!e||Ie.endsWith(".apple.com")||Ie.endsWith(".autonavi.com")||console.error("[MapKit] Not allowed."),this.setForcedCountryCodeUnrestricted(e)}setForcedCountryCodeUnrestricted(e){e!==this.countryCode&&(e&&(p(e,"string","[MapKit] `countryCode` must be a string or `null`."),e=e.toUpperCase()),this.countryCode=e,e&&this.bootstrap._setLocaleWithCountryCode&&(delete this.bootstrap._setLocaleWithCountryCode,this.bootstrap.language="zh-"+this.countryCode),this.bootstrap.ready&&this.bootstrap._loadFromServer())}}class Pe extends O{constructor(e,t){super(Se.Changed),this.status=e,this.responseIdentifier=t}}class De extends O{constructor(e,t,i){super(Se.Error),this.status=e,this.message=t,this.responseIdentifier=i}}var ze=new WeakMap;class Ne extends I{constructor(){super(),ge(this,"HTTP",be),ge(this,"ErrorStatus",Le),ge(this,"TileProviders",Ae),ge(this,"Events",Se),ge(this,"States",ke),ge(this,"state",ke.UNINITIALIZED),ge(this,"enableSourceMap",!1),ge(this,"authorizationCallback",null),ge(this,"tileProvider",null),ge(this,"_showMapsLogo",!0),ge(this,"_showLegalLink",!0),ge(this,"shadowDOMMode",void 0),ge(this,"_madabaBaseUrl",null),ge(this,"customMadabaUrl",!1),ge(this,"_madabaDomains",null),ge(this,"_disableCsr",!1),ge(this,"_accessKey",null),ge(this,"_accessToken",null),ge(this,"_distUrl",null),ge(this,"_syrupUrl",null),ge(this,"apiBaseUrl",null),ge(this,"apiBaseUrlOverride",null),ge(this,"_showsTileInfo",!1),ge(this,"_messagePrefix","[MapKit] "),ge(this,"nonce",""),ge(this,"scriptBaseUrl",void 0),ge(this,"expiresInSeconds",void 0),ge(this,"expiresAt",void 0),ge(this,"expiresIn",void 0),ge(this,"_forcedRenderingMode",void 0),me(this,ze,{writable:!0,value:!1}),ge(this,"_language",null),ge(this,"_syrupRequestedFallback",!1),ge(this,"_syrupRequestedFallbackType",void 0),ge(this,"tileGroup",void 0),ge(this,"types",{}),ge(this,"rasterTilesForSyrup",void 0),this._jwtTokensToCheck=[],this.componentVersions=new Map,this.performanceMarkers={},this.language=null,Te.set(this,new Re(this))}_c(e){if(e!==H)throw new Error("Invalid key.");return Te.get(this)}get showMapsLogo(){return this._showMapsLogo}get showLegalLink(){return this._showLegalLink}get showsTileInfo(){return this._showsTileInfo}get forcedRenderingMode(){return this._forcedRenderingMode}get distUrl(){return this._distUrl}isDistUrlTrusted(){if(!this._distUrl)return!1;const e=new URL(this._distUrl,Oe);if(window.location.origin&&e.origin===window.location.origin)return!0;if(this.scriptBaseUrl){const t=new URL(this.scriptBaseUrl,Oe);if(t.origin&&e.origin===t.origin)return!0}return!1}get buildTags(){let e="";return[...this.componentVersions.entries()].forEach((([t,i])=>e+=" ("+t+": "+i+")")),e}get _initMessagePrefix(){return this._messagePrefix+"mapkit.init(): "}get proxyPrefixes(){return this._proxyPrefixes}isProxyPrefixTrusted(){if(!this._proxyPrefixes)return!1;const e=new URL(this._proxyPrefixes[0],Oe);if(window.location.origin&&e.origin===window.location.origin)return!0;if(this.scriptBaseUrl){const t=new URL(this.scriptBaseUrl,Oe);if(t.origin&&e.origin===t.origin)return!0}return!1}get withCredentials(){return!!this.proxyPrefixes&&this.urlWithCredentials(this.proxyPrefixes[0])}get distUrlWithCredentials(){return this._distUrl?this.urlWithCredentials(this._distUrl):!e.useLocalResources&&this.withCredentials}urlWithCredentials(e){return/\bproxy\b.*\.geo\.apple\.com\b/.test(e)}get loginPromise(){return this._loginPromise||(this.proxyPrefixes&&this.withCredentials&&this._shouldLogin?this._loginPromise=pe(this.proxyPrefixes):this._loginPromise=Promise.resolve()),this._loginPromise}init(e,t=!1){Ee&&performance.mark("mapkit-init-start"),u(e,this._initMessagePrefix+"`options` object is required.",{checkNull:!0}),p(e,"object",this._initMessagePrefix+"`options` object is invalid.");const i={};if(e.logger&&K.appendLogger(e.logger),Object.keys(e).forEach((e=>{const t=-1!==we.indexOf(j(e));t||-1!==we.indexOf(e)||console.warn(this._initMessagePrefix+"ignoring invalid option: `"+e+"`."),t&&(i[j(e)]=e)})),t||this.authorizationCallback&&void 0===e.authorizationCallback||(u(e.authorizationCallback,this._initMessagePrefix+"`options` is missing `authorizationCallback`.",{checkNull:!0}),p(e.authorizationCallback,"function",this._initMessagePrefix+"`authorizationCallback` in `options` must be a function.")),e.language&&p(e.language,"string",this._initMessagePrefix+"`language` in `options` must be a string."),this._userInitializedInit)return void console.warn(this._initMessagePrefix+"already initialized; ignoring.");t||(this._userInitializedInit=!0),void 0!==e._previewLoCSR&&e._previewLoCSR&&(this._forcedRenderingMode="HYBRID"),void 0!==e._forcedRenderingMode&&(this._forcedRenderingMode=e._forcedRenderingMode),void 0!==e._proxyPrefixes&&Array.isArray(e._proxyPrefixes)&&(this._proxyPrefixes=e._proxyPrefixes),void 0!==e._distUrl&&(this._distUrl=e._distUrl??null),void 0!==e._syrupUrl&&(this._syrupUrl=e._syrupUrl),this._shouldLogin=this.withCredentials,void 0===e._shouldLogin||e._shouldLogin||(this._shouldLogin=!!e._shouldLogin),i[Ce]&&void 0!==e[i[Ce]]&&(this[Ce]=e[i[Ce]]);const s=(this.state===ke.UNINITIALIZED||this.state===ke.ERROR)&&e.authorizationCallback;s&&(this.state=ke.PENDING),e.authorizationCallback&&(this.authorizationCallback=e.authorizationCallback);const o=Te.get(this);if(!o)throw new TypeError("");void 0!==e.countryCode&&null===o.countryCode&&o.setForcedCountryCodeUnrestricted(e.countryCode),e._enableExperimentalLanguages&&(_e(this,ze,!0),E(),this._language=null,this.language=null,this._l10nEnableExperimentalLocales?.()),void 0!==e.language?this.language=e.language:this._l10n&&(this._l10n.localeId=this.language),void 0!==e._showMapsLogo&&(this._showMapsLogo=!!e._showMapsLogo),void 0!==e._showLegalLink&&(this._showLegalLink=!!e._showLegalLink),void 0!==e._shadowDOMMode&&(this.shadowDOMMode=e._shadowDOMMode),e.bootstrapTimeout&&(this._bootstrapTimeout=e.bootstrapTimeout),e.madabaBaseUrl&&(this._madabaBaseUrl=e.madabaBaseUrl,this.customMadabaUrl=!0),e._uiBaseUrl&&(this.uiBaseUrl=e._uiBaseUrl,this.customUiBaseUrl=!0),e._showsTileInfo&&(this._showsTileInfo=e._showsTileInfo),e._teamId&&(this.analyticsTeamId=e._teamId),void 0!==e._disableWebGLCheck&&(this._disableWebGLCheck=e._disableWebGLCheck),s&&(this.withCredentials&&this._shouldLogin?this.loginPromise.then((()=>{this._loadFromServer()}),(()=>{this._loadFailed(Le.NetworkError,"Initialization failed because of network error connecting to proxy.")})):this._loadFromServer()),e.libraries;const n=new O(this.Events.Initialized);this.dispatchEvent(n)}login(){this.withCredentials&&this.proxyPrefixes&&(e=>{if(0===e.length)return Promise.resolve();const t=window.open(e[0].replace(/\/proxy\?$/,"/login"),"_blank","popup=yes,width=700,height=700");return new Promise(((e,i)=>{t||i();const s=o=>{o.source===t&&(window.removeEventListener("message",s),o.data&&o.data.login?e(void 0):i())};window.addEventListener("message",s)})).then((()=>{if(1===e.length)return;const t=[].concat(e);return t.shift(),pe(t)}))})(this.proxyPrefixes).then((()=>{this.reloadFromServer()}),(()=>console.error("[MapKit] There is a problem triggering login popup.")))}reloadFromServer(){this._loadFromServer()}get accessKey(){return this._accessKey}get accessToken(){return this._accessToken}accessKeyMayBeExpired(){(!this.expiresAt||Date.now()>this.expiresAt)&&this.accessKeyHasExpired()}accessKeyHasExpired(){this._loadFromServer(V.Highest)}get ready(){return this.state===ke.READY}get error(){return this.state===ke.ERROR}get language(){return z(this._language)}set language(e){e===this._language&&null!==this._language||(delete this._setLocaleWithCountryCode,e?(p(e,"string","[MapKit] `language` must be a string or `null`."),e.startsWith("x-")&&(e=e.substring(2),_e(this,ze,!0),E(),this._l10nEnableExperimentalLocales?.()),"zh"===e.toLowerCase()&&(console.warn("[MapKit] `zh` is an ambiguous language ID. Please specify a script or reginal variant: `zh-Hans`, `zh-Hant`, or `zh-HK`."),Te.get(this)?.countryCode?e="zh-"+Te.get(this)?.countryCode:this._setLocaleWithCountryCode=!0)):e=this._getClientLanguage(),this._language=T.bestMatch(e,"en"),this.state!==ke.UNINITIALIZED&&this._l10n&&(this._l10n.localeId=e))}get countryCode(){return Te.get(this)?.countryCode}get isAutoNavi(){return this.tileProvider===Ae.AutoNavi||this.state===ke.PENDING&&"CN"===Te.get(this)?.countryCode}appendAuthOptions(e,t){const i=t||(this.accessToken&&!this.isAutoNavi?this.accessToken:null);return i&&(e.headers=e.headers||{},e.headers.Authorization=f(xe,{token:i})),e}setL10n(e,t){var i;this._l10n=e,this._l10nEnableExperimentalLocales=t,function(e,t){return t.get?t.get.call(e):t.value}(i=this,fe(i,ze,"get"))&&t(),this.state!==ke.UNINITIALIZED&&(this._l10n.localeId=this.language)}setPerformanceMarkers(e){if(!e)return;const t=e.split(",").map((e=>e.trim()));for(const e of t)this.performanceMarkers[e]=!0;Ee=this.performanceMarkers.loading}handleEvent(e){switch(e.type){case"visibilitychange":"visible"===document.visibilityState&&this.ready&&this.accessKeyMayBeExpired();break;case"online":this.ready?this.accessKeyMayBeExpired():this.error&&this.reloadFromServer()}}loaderWillStart(e){this._xhrLoader===e&&(this.state=ke.PENDING)}loaderDidSucceed(e,t){this._xhrLoader===e&&(this._requestDidLoad(t),Ee&&this.state===ke.PENDING&&performance.measure("mapkit-init","mapkit-init-start"),this._xhrLoader=void 0)}loaderDidFail(e,t){this._xhrLoader===e&&(this._parseError(e.xhr),this._xhrLoader=void 0)}_loadFromServer(t){let i=new URL(ve.url,Oe);i.searchParams.append("apiVersion",ve.apiVersion);const s=Te.get(this)?.countryCode;s&&i.searchParams.append("countryCode",s),i.searchParams.append("mkjsVersion",e.version),i.searchParams.append("poi","1"),this.proxyPrefixes&&(i=new URL(this.proxyPrefixes[0]+i.toString(),Oe));const o={retry:!0,delay:0,priority:t,timeout:this._bootstrapTimeout,withCredentials:this.withCredentials};this.proxyPrefixes&&this.withCredentials&&/\bapple\.com\b/.test(this.proxyPrefixes[0])&&!/\bapple\.com$/.test(window.location.hostname)&&console.warn("[MapKit] Request with credentials may fail if the page is not hosted on the same domain as the proxy."),ue(z(this.authorizationCallback),null,[e=>{e&&(this._checkJwtToken?this._checkJwtToken(e):this._jwtTokensToCheck.push(e)),this.appendAuthOptions(o,e),this.accessToken&&(o.headers=o.headers??{},o.headers["X-Maps-Access-Token"]=f(xe,{token:this.accessToken}));const t=new ce(i.toString(),this,o);this._xhrLoader&&this._xhrLoader.unschedule(),t.schedule(),this._xhrLoader=t}])}_requestDidLoad(e){const t=e.getResponseHeader("x-rid")??void 0;if(!this._parseError(e,t))if(e.responseText)try{const i=JSON.parse(e.responseText);this._processLoadedData(i,t)}catch(e){if(!(e instanceof SyntaxError))throw e;this._loadFailed(Le.MalformedResponse,"Initialization failed because of incorrect server response.")}else this._loadFailed(Le.MalformedResponse,"Initialization failed because of incorrect server response.")}_resetReloadTimer(e){clearTimeout(this._reloadTimerId),this._reloadTimerId=setTimeout((()=>{delete this._reloadTimerId,this.accessKeyHasExpired()}),e)}_loadSucceeded(e,t){setTimeout((()=>{this.state=ke.READY;const i=new Pe(e?Me.Refreshed:Me.Initialized,t);this.dispatchEvent(i)}),0)}_loadFailed(e,t,i){console.error(this._messagePrefix+t),setTimeout((()=>{this.state=ke.ERROR,clearTimeout(this._reloadTimerId),delete this._reloadTimerId,this.expiresInSeconds=void 0,this.expiresAt=void 0,this.expiresIn=void 0;const s=new De(e,this._messagePrefix+t,i);this.dispatchEvent(s)}),0)}_processLoadedData(e,t){const i=!!this._accessToken;this._parseData(e),this.expiresIn&&this._resetReloadTimer(this.expiresIn),Te.get(this)?.countryCode&&this._setLocaleWithCountryCode&&(delete this._setLocaleWithCountryCode,this.language="zh-"+Te.get(this)?.countryCode),document.addEventListener("visibilitychange",this),window.addEventListener("online",this),this._loadSucceeded(i,t)}_parseData(e){e.apiBaseUrl;const t=Te.get(this);if(!t)throw new TypeError("");let i;if(t.countryCode=e.countryCode&&"unknown"!==e.countryCode?e.countryCode:null,t.countryCode&&"zh"===this.language&&(this.language="zh-"+t.countryCode),this.environment=e.environment,this.apiBaseUrl=this.apiBaseUrlOverride||(e.apiBaseUrl??null),this.proxyPrefixes&&(i=this.proxyPrefixes[this.proxyPrefixes.length-1],this.apiBaseUrl=i+this.apiBaseUrl),e.analytics){const t=e.analytics;this.proxyPrefixes&&(t.analyticsUrl=i+t.analyticsUrl,t.errorUrl=i+t.errorUrl),this.analytics=t}e.authInfo&&e.authInfo.team_id&&(this.teamId=e.authInfo.team_id),e.locationShiftUrl&&(this.proxyPrefixes?this.locationShiftUrl=i+e.locationShiftUrl:this.locationShiftUrl=e.locationShiftUrl),this.expiresInSeconds=e.expiresInSeconds,this.expiresIn=1e3*this.expiresInSeconds-ve.accessKeyExpirationBiasMS,this.expiresAt=Date.now()+this.expiresIn;const s=e.tileSources.some((e=>e.needsLocationShift));e.accessKey&&(this._accessKey=e.accessKey),e.authInfo&&e.authInfo.access_token&&(this._accessToken=e.authInfo.access_token),this.tileProvider=s?Ne.TileProviders.AutoNavi:Ne.TileProviders.Apple,this._data=e,this.customUiBaseUrl||(this.uiBaseUrl=e.uiBaseUrl),this._parseMapData&&this._parseMapData()}_parseError(e,t){const i=e.status;let s,o;if(i>=be.OK&&i<be.MULTIPLE_CHOICES)return!1;if(this._userInitializedInit=!1,e.readyState!==e.DONE)o=Le.Timeout,s="Initialization failed because the request timed out after "+this._bootstrapTimeout+" ms.";else if(i===be.UNAUTHORIZED){o=Le.Unauthorized,s="Initialization failed because the authorization token is invalid.";try{const t=e.responseText?JSON.parse(e.responseText):void 0;t&&t.error&&t.error.details&&Array.isArray(t.error.details)&&t.error.details.forEach((e=>{e&&"ORIGIN_CHECK_FAILURE"===e.errorType&&e.message&&(s+=" "+e.message)}))}catch(e){if(!(e instanceof SyntaxError))throw e}}else i===be.TOO_MANY_REQUESTS?(o=Le.TooManyRequests,s="Initialization failed because the daily usage limit has exceeded."):0===i?(o=Le.NetworkError,s="Initialization failed because of network error."):(o=Le.Unknown,s="Initialization failed because the server returned error "+i+" ("+e.statusText+").");return this._loadFailed(o,s,t),!0}_getClientLanguage(){return window.navigator.languages?window.navigator.languages[0]:window.navigator.language}_restore(){this._syrupUrl&&console.warn("[MapKit] mapkit.restore() cannot unset _syrupUrl."),this[Ce]&&console.warn("[MapKit] mapkit.restore() cannot unset "+Ce),delete this._proxyPrefixes,delete this._forcedRenderingMode,delete this._userInitializedInit,delete this._loginPromise,this._distUrl=null,this.authorizationCallback=null,this.apiBaseUrl=null,this.apiBaseUrlOverride=null,this.state=ke.UNINITIALIZED,this._listeners={},clearTimeout(this._reloadTimerId),delete this._reloadTimerId,document.removeEventListener("visibilitychange",this),window.removeEventListener("online",this)}_debugInfo(){return{ready:this.ready,state:this.state,_countryCode:this.countryCode,tileProvider:this.tileProvider,apiBaseUrl:this.apiBaseUrl,language:this.language,_getClientLanguage:this._getClientLanguage(),types:this.types}}get didFallback(){return this._syrupRequestedFallback}get fallbackType(){return this._syrupRequestedFallbackType}}ge(Ne,"ChangeStatus",Me),ge(Ne,"PROTOCOL",ye),ge(Ne,"TileProviders",Ae);const Fe=Ne;const Ue=new class extends Fe{};class Ge extends I{dispatchEvent(e){return ue(super.dispatchEvent,this,[e],!0)}}const Be={EventTarget:Ge,Event:O},We={Airport:"Airport",AirportGate:"AirportGate",AirportTerminal:"AirportTerminal",AmusementPark:"AmusementPark",AnimalService:"AnimalService",Aquarium:"Aquarium",ATM:"ATM",AutomotiveRepair:"AutomotiveRepair",Bakery:"Bakery",Bank:"Bank",Baseball:"Baseball",Basketball:"Basketball",Beach:"Beach",Beauty:"Beauty",Bowling:"Bowling",Brewery:"Brewery",Cafe:"Cafe",Campground:"Campground",CarRental:"CarRental",Castle:"Castle",ConventionCenter:"ConventionCenter",Distillery:"Distillery",EVCharger:"EVCharger",Fairground:"Fairground",FireStation:"FireStation",Fishing:"Fishing",FitnessCenter:"FitnessCenter",FoodMarket:"FoodMarket",Fortress:"Fortress",GasStation:"GasStation",GoKart:"GoKart",Golf:"Golf",Hiking:"Hiking",Hospital:"Hospital",Hotel:"Hotel",Kayaking:"Kayaking",Landmark:"Landmark",Laundry:"Laundry",Library:"Library",Mailbox:"Mailbox",Marina:"Marina",MiniGolf:"MiniGolf",MovieTheater:"MovieTheater",Museum:"Museum",MusicVenue:"MusicVenue",NationalMonument:"NationalMonument",NationalPark:"NationalPark",Nightlife:"Nightlife",Park:"Park",Parking:"Parking",Pharmacy:"Pharmacy",Planetarium:"Planetarium",Playground:"Playground",Police:"Police",PostOffice:"PostOffice",PublicTransport:"PublicTransport",ReligiousSite:"ReligiousSite",Restaurant:"Restaurant",Restroom:"Restroom",RockClimbing:"RockClimbing",RVPark:"RVPark",School:"School",SkatePark:"SkatePark",Skating:"Skating",Skiing:"Skiing",Soccer:"Soccer",Spa:"Spa",Stadium:"Stadium",Store:"Store",Surfing:"Surfing",Swimming:"Swimming",Tennis:"Tennis",Theater:"Theater",University:"University",Volleyball:"Volleyball",Winery:"Winery",Zoo:"Zoo"};function Ze(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Ke(e){return e.map((e=>{if(!d(e,We))throw new Error("[MapKit] Unknown category `"+e+"`. Choose from mapkit.PointOfInterestCategory.");return e}))}class je{constructor(e){if(Ze(this,"_includes",null),Ze(this,"_excludes",null),void 0!==(e=_(e)).includes&&void 0!==e.excludes)throw new Error("[MapKit] `includes` and `excludes` may not be specified at the same time.");if(void 0===e.includes&&void 0===e.excludes)throw new Error("[MapKit] Either `includes` or `excludes` should be specified.");void 0!==e.includes&&(this._includes=Ke(e.includes)),void 0!==e.excludes&&(this._excludes=Ke(e.excludes))}includesCategory(e){if(!d(e,We))throw new Error("[MapKit] Unknown category `"+e+"`. Choose from mapkit.PointOfInterestCategory.");return this._includes?-1!==this._includes.indexOf(e):this._excludes?-1===this._excludes.indexOf(e):void 0}excludesCategory(e){if(!d(e,We))throw new Error("[MapKit] Unknown category `"+e+"`. Choose from mapkit.PointOfInterestCategory.");return this._includes?-1===this._includes.indexOf(e):this._excludes?-1!==this._excludes.indexOf(e):void 0}static including(e){return g(e,"[MapKit] PointOfInterestFilter.including expected an array of categories."),new je({includes:e})}static excluding(e){return g(e,"[MapKit] PointOfInterestFilter.excluding expected an array of categories."),new je({excludes:e})}}const He=function(){throw new Error("[MapKit] `PointOfInterestFilter` may not be constructed directly. Use the mapkit.PointOfInterestFilter.including or the mapkit.PointOfInterestFilter.excluding methods.")};je.prototype.constructor=He,He.prototype=je.prototype,je.exposedConstructor=He,Object.defineProperties(je,{filterIncludingAllCategories:{get:function(){const e=this.excluding([]);return Object.defineProperty(this,"filterIncludingAllCategories",{value:e,configurable:!0}),e},configurable:!0},filterExcludingAllCategories:{get:function(){const e=this.including([]);return Object.defineProperty(this,"filterExcludingAllCategories",{value:e,configurable:!0}),e},configurable:!0}}),Object.defineProperties(He,{including:{get:function(){return je.including},configurable:!0},excluding:{get:function(){return je.excluding},configurable:!0},includingAllCategories:{get:()=>je.filterIncludingAllCategories},excludingAllCategories:{get:()=>je.filterExcludingAllCategories}});const Ve=je;const qe=Object.freeze({Dark:"dark",Light:"light",Adaptive:"adaptive"});class Ye extends I{}const Xe=new class{constructor(){this._queryList=window.matchMedia("(prefers-color-scheme: dark)"),this._handles=new Set,this._boundQueryListDidChange=()=>this._queryListDidChange()}addHandle(){const e=new Ye;return this._handles.add(e),1===this._handles.size&&this._addListener(),e}removeHandle(e){this._handles.delete(e),0===this._handles.size&&this._removeListener()}get currentColorScheme(){return this._queryList.matches?qe.Dark:qe.Light}get isDarkMode(){return this._queryList.matches}_addListener(){this._queryList.addListener(this._boundQueryListDidChange)}_removeListener(){this._queryList.removeListener(this._boundQueryListDidChange)}_queryListDidChange(){for(const e of this._handles.values()){const t=new O("change");e.dispatchEvent(t)}}};const $e={SCREEN_SIZE:function(e){const t={device_pixel_ratio:window.devicePixelRatio};return e._isInternalClient?(t.width=screen.width,t.height=screen.height,t):t},DEVICE_IDENTIFIER:function(e,t){const i={device_platform:z(t.uaParserInfo).deviceInfo.platform,device_os_version:z(t.uaParserInfo).deviceInfo.os};return void 0!==e._isInternalServer&&(i.is_internal_server=e._isInternalServer),i},BROWSER_INFO:function(e,t){let i;return i={browser_language:navigator.language,prefers_color_scheme:Xe.isDarkMode?"DARK":"LIGHT",browser_name:z(t.uaParserInfo).browserInfo.name,browser_version:z(t.uaParserInfo).browserInfo.version},e._isInternalClient?i.browser_origin=location.protocol+"//"+location.host:i.browser_origin=e.getReduceHostPlaceholder("ProtocolPlusHost"),e._isInternalClient&&(i.browser_referer=e.getReduceHostPlaceholder("ReferrerHost")),t.browserDefaultFontSize&&(i.browser_default_font_size=t.browserDefaultFontSize),t.browserInfoValues&&Object.assign(i,t.browserInfoValues),i},APPLICATION_IDENTIFIER:function(t){const i={mkjs_version:e.version};return t._isInternalClient&&window.placecard&&window.placecard.version&&(i.placecard_version=window.placecard.version),i.team_id=t._teamId,t._isInternalClient?i.host=location.host:i.host=t.getReduceHostPlaceholder("Host"),i.tile_provider=t.tileProvider,null!==t._serverEnvironment&&(i.server_environment=t._serverEnvironment),i},BROWSER_WINDOW_SIZE:function(e){if(!e._isInternalClient)return;return{width:window.innerWidth,height:window.innerHeight}},URL:function(e){const t={};return e._isInternalClient&&(t.path=location.pathname),t},MAP_VIEW:function(e,t){const i=z(t.map).region.toBoundingRegion(),s=z(t.map).ensureRenderingFrame().size;return{display_map_region:{eastLng:Math.round(i.eastLongitude),northLat:Math.round(i.northLatitude),southLat:Math.round(i.southLatitude),westLng:Math.round(i.westLongitude)},zoom_level:z(t.map).zoomLevel,map_type:`MAP_TYPE_${z(t.map).mapType.toUpperCase()}`,size:{width:s.width,height:s.height},color_scheme:z(t.map).colorScheme.toUpperCase()}},USER_SESSION:function(e){return{session_id:z(e._sessionId),sequence_number:z(e._sequenceNumber),relative_timestamp:z(e._relativeTimestamp)}},TILES:function(e,t){return{rendering:z(t.map)._mapNodeController&&z(t.map)._mapNodeController.renderingMode}}},Je="other";function Qe(e){e=e.toLowerCase();const t={name:Je,version:Je};try{if(e.includes("sogou"))t.name="Sogou",t.version=z(/SogouMSE\/(\d+(\.?\d)*)/i.exec(e))[1];else if(e.includes("ucbrowser"))t.name="UCBrowser",t.version=z(/UCBrowser\/(\d+(\.?\d)*)/i.exec(e))[1];else if(e.includes("qqbrowser"))t.name="QQBrowser",t.version=z(/QQBrowser\/(\d+(\.?\d)*)/i.exec(e))[1];else if(e.includes("metasr"))t.name="Sogou",t.version=z(/MetaSr\s(\d+(\.?\d)*)/i.exec(e))[1];else if(e.includes("edg")&&!e.includes("edgios")){t.name="Edge";const i=/edg(?:e|ios|a|i)?\/(\d+\.?\d*)/gi;t.version=z(i.exec(e))[1]}else!e.includes("safari")||e.includes("chrome")||e.includes("crios")||e.includes("gsa")||e.includes("fxios")||e.includes("duckduckgo")||e.includes("edg")?!e.includes("chrome")&&!e.includes("crios")||e.includes("chromium")||e.includes("edg")||e.includes("samsungbrowser")?!e.includes("firefox")&&!e.includes("fxios")||e.includes("seamonkey")?e.includes("msie")||e.includes("trident")&&e.includes("rv")?(t.name="Internet Explorer",t.version=e.includes("msie")?z(/msie\s(\d+\.?\d*)/gi.exec(e))[1]:z(/rv:(\d+\.?\d*)/gi.exec(e))[1]):e.includes("gsa")&&(t.name="Google Search App",t.version=z(/gsa\/(\d+\.?\d*)/i.exec(e))[1]):(t.name="Firefox",t.version=e.includes("firefox")?z(/firefox\/(\d+\.?\d*)/gi.exec(e))[1]:z(/fxios\/(\d+\.?\d*)/gi.exec(e))[1]):(t.name="Chrome",t.version=e.includes("chrome")?z(/chrome\/([\d.]+)/gi.exec(e))[1]:z(/crios\/([\d.]+)/gi.exec(e))[1]):(t.name="Safari",t.version=z(/version\/(\d+(\.\d+)*)/i.exec(e))[1]);return t}catch(e){return t}}function et(e){let t,i;e=e.toLowerCase();try{return e.includes("ipad")?(t="iPad",i="iOS "+z(/os\s+(.*?)[^_.\d]/i.exec(e))[1]):e.includes("iphone")&&!e.includes("ipad")?(t="iPhone",i="iOS "+z(/os\s+(.*?)[^_.\d]+/i.exec(e))[1]):e.includes("macintosh")?(t="Macintosh",i="Mac OS X "+z(/mac os x (.*?)[^_.\d]/.exec(e))[1]):e.includes("windows")?(t="Windows",i="Windows NT "+z(/windows nt (.*?)[^._\d]/.exec(e))[1]):e.includes("android")?(t="Android",i="Android "+z(/android (.*?)[^._\d]/.exec(e))[1]):e.includes("linux")&&!e.includes("android")?(t="Linux",i="Linux"):e.includes("cros")?(t="Chrome OS",i="Chrome OS"):(t=Je,i=Je),{platform:t,os:i}}catch(e){return{platform:Je,os:Je}}}function tt(){this._startTime=Date.now()}tt.prototype={_budget:10,didTimeout:!1,timeRemaining:function(){return Math.max(0,this._budget-(Date.now()-this._startTime))}};const it=function(e,t){return"undefined"!=typeof requestIdleCallback?requestIdleCallback(e,t):function(e){return setTimeout((function(){const t=new tt;e(t)}))}(e)},st=function(e){return"undefined"!=typeof cancelIdleCallback?cancelIdleCallback(e):clearTimeout(e)},ot=Object.freeze({Highest:0,High:1,Medium:2,Low:3}),nt=Object.freeze([{timeout:600},{timeout:1e3},{timeout:3e3},{}]),at=[function(e){ht(e,ot.Highest)},function(e){ht(e,ot.High)},function(e){ht(e,ot.Medium)},function(e){ht(e,ot.Low)}],rt=[-1,-1,-1,-1],lt=[];for(const e of Object.values(ot))lt[e]=[];function ht(e,t){for(;(e.timeRemaining()>0||e.didTimeout)&&lt[t].length;){const e=lt[t].shift();"function"==typeof e?e():e&&"object"==typeof e&&"function"==typeof e.performScheduledTask&&e.performScheduledTask()}lt[t].length?rt[t]=it(at[t],nt[t]):-1!==rt[t]&&(st(rt[t]),rt[t]=-1)}const ct={schedule:function(e,t){lt[t].push(e),-1===rt[t]&&(rt[t]=it(at[t],nt[t]))}};let dt=-1,ut=[],pt=[],mt=[];const gt=Object.freeze({Idle:0,Updating:1,Drawing:2,Flushing:3});let _t=gt.Idle;function ft(e){-1!==dt&&(_t===gt.Flushing&&("undefined"!=typeof cancelAnimationFrame?cancelAnimationFrame(dt):clearTimeout(dt)),dt=-1),function(e){_t=gt.Updating;for(;ut.length>0;){const t=ut;ut=[];for(let i=0,s=t.length;i<s;++i){const s=t[i];"function"==typeof s?s():s&&"object"==typeof s&&"function"==typeof s.performScheduledUpdate&&s.performScheduledUpdate(e)}}ut=pt,pt=[]}(e),function(e){_t=gt.Drawing;const t=mt;mt=[];for(let i=0,s=t.length;i<s;++i){const s=t[i];"function"==typeof s?s():s&&"object"==typeof s&&"function"==typeof s.performScheduledDraw&&s.performScheduledDraw(e)}}(e),_t=gt.Idle}function yt(e,t){return-1===e.indexOf(t)&&(e.push(t),!0)}function vt(){dt="undefined"!=typeof requestAnimationFrame?requestAnimationFrame(ft):setTimeout(ft)}const bt={scheduleASAP:function(e){yt(ut,e)&&-1===dt&&_t!==gt.Updating&&vt()},scheduleOnNextFrame:function(e){yt(_t===gt.Updating?pt:ut,e)&&-1===dt&&vt()},scheduleDraw:function(e){yt(mt,e)&&-1===dt&&vt()},flush:function(){_t>gt.Idle||(_t=gt.Flushing,ft())},Priority:ot,scheduleInBackground:function(e,t){ct.schedule(e,t||ot.Low)}};const wt=function(e,t,i){let s;return function(...o){const n=o;s&&clearTimeout(s),s=setTimeout((function(){s=null,e.apply(i,n)}),t||0)}},Ct=/^.*(?=\/mapkit([.a-z-]*)\.js)/;function kt(e){const t=Ct.exec(e.src);return t?t[0]:null}const Mt={_baseUrl:void 0,_versionSuffix:"",scriptBaseUrl:void 0,createUrl:function(t,i){if(void 0===this._baseUrl){if(Ue.state===Ue.States.UNINITIALIZED&&!i)return"";Ue.distUrl?(this._baseUrl=Ue.distUrl,this._versionSuffix="?mkjsVersion="+e.cdnVersion):e.useLocalResources?(void 0===this.scriptBaseUrl&&this.findScriptAndSetBasePath(),this._baseUrl=this.scriptBaseUrl,this._versionSuffix="?mkjsVersion="+e.cdnVersion):Ue.proxyPrefixes?this._baseUrl=Ue.proxyPrefixes[0]+[e.cdnBase,"mk",e.cdnVersion].join("/"):this._baseUrl=["https:"+e.cdnBase,"mk",e.cdnVersion].join("/")}t=t&&t.replace(/^\//,"")||"";let s=this._versionSuffix;return("__mapkitSourceMap"in window||Ue.enableSourceMap)&&(s+=(s?"&":"?")+"sourcemap=1"),[this._baseUrl,t].join("/")+s},isUrlTrusted:()=>Ue.distUrl?Ue.isDistUrlTrusted():!!e.useLocalResources||(!Ue.proxyPrefixes||Ue.isProxyPrefixTrusted()),createImageUrl:function(e){return this.createUrl("images/"+e)},findScriptAndSetBasePath:function(){if(document.currentScript){const e=kt(document.currentScript);if(e)return Mt.scriptBaseUrl=e,document.currentScript}for(let e=document.scripts,t=0,i=e.length;t<i;++t){const i=kt(e[t]);if(null!==i)return this.scriptBaseUrl=i,e[t]}return null},createSyrupUrl(){if(Ue.state===Ue.States.UNINITIALIZED)return"";let t;const i="/ti/csr/1.x.x";return t=Ue._syrupUrl?Ue._syrupUrl:Ue.proxyPrefixes?Ue.proxyPrefixes[0]+e.cdnBase+i:"https:"+e.cdnBase+i,[t,"mk-csr.js?mapkitVersion="+e.version+(Ue.enableSourceMap?"&sourcemap=1":"")].join("/")},isSyrupUrlTrusted:()=>!Ue._syrupUrl&&(!Ue.proxyPrefixes||Ue.isProxyPrefixTrusted())};e.useLocalResources&&"undefined"!=typeof window&&void 0!==window.document&&Mt.findScriptAndSetBasePath(),Ue.addEventListener(Ue.Events.Initialized,(()=>{Mt._baseUrl=void 0,Mt._versionSuffix=""}));const St=Mt,Lt=["ac.com","aws.sagemaker","biz.orx","cloud.jele","com.amazonaws","com.amazoncognito","com.est-a-la-masion","com.onthewifi","dev.curv","host.freesite","it.barletta-trani-andria","it.trento","jp.chiba","jp.fukushima","jp.hokkaido","jp.hyogo","jp.kanagawa","jp.miyazaki","jp.niigata","jp.saga","jp.tochigi","jp.xn--7t0a264c","lv.mil","net.homeunix","no.fuossko","no.smola","no.xn--sandy-yua","pa.ac","py.org","tj.ac","us.mi","zm.edu"],xt=ce,At=V,Et=["alt","arpa","example","invalid","local","localhost","onion","test"],Tt=[];function It(e,t){const i=t.length,s=e.length;if(i>s)return!1;for(let o=0;o<i;o++)if("*"!==t[i-1-o]&&t[i-1-o]!==e[s-1-o])return!1;return!0}function Ot(e){let t=e[0];for(let i=1;i<e.length;i++){const s=e[i];s.length>t.length&&(t=s)}return t}const Rt={getRegisterableDomain:async function(e){if(!e||e.includes(":")||/^[\d.]+$/.test(e))return null;const t=e.endsWith(".")?".":"";t&&(e=e.substring(0,e.length-1));const i=e.split("."),s=i.slice(-1)[0],o=1===i.length?null:i.slice(-2)[0];if(!o||Et.includes(s))return null;const n=[].concat(Lt),a=`${s}.${o}`;n.push(a),n.sort();const r=n.lastIndexOf(a);if(0===r)return`${o}.${s}${t}`;const l=await(h=r-1,Tt[h]||(Tt[h]=new Promise((e=>{const t=new xt(z(St.createUrl("psl/"+h+".txt")),{loaderDidSucceed(t,i){if(i.status<200||i.status>=300)return void e(null);const s=z(i.responseText).split("\n").map((e=>e.trim())).filter((e=>!!e));e(s)},loaderDidFail(){e(null)}},{priority:At.Low,withCredentials:Ue.distUrlWithCredentials});t.schedule()}))),Tt[h]);var h;return l?function(e,t){let i="";const s=[],o=[];for(const i of t)if(i.startsWith("!")){const t=i.substring(1).split(".");It(e,t)&&o.push(t)}else{const t=i.split(".");It(e,t)&&s.push(t)}let n=["*"];0!==o.length?(n=Ot(o),n=n.slice(1)):0!==s.length&&(n=Ot(s));return i=e.slice(-n.length-1).join("."),i}(i,l)+t:`${o}.${s}${t}`}},Pt=Rt;function Dt(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function zt(e,t,i){return function(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}(e,t),function(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}(i,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}const Nt=ce,Ft=V,Ut=Object.freeze({ScreenSize:"SCREEN_SIZE",DeviceIdentifier:"DEVICE_IDENTIFIER",BrowserInfo:"BROWSER_INFO",ApplicationIdentifier:"APPLICATION_IDENTIFIER",BrowserWindowSize:"BROWSER_WINDOW_SIZE",Url:"URL",MapView:"MAP_VIEW",UserSession:"USER_SESSION",Tiles:"TILES"}),Gt={MapUserActionStates:[Ut.ScreenSize,Ut.DeviceIdentifier,Ut.BrowserInfo,Ut.ApplicationIdentifier,Ut.BrowserWindowSize,Ut.Url,Ut.MapView,Ut.UserSession,Ut.Tiles],SessionLessMapUserActionStates:[Ut.ScreenSize,Ut.DeviceIdentifier,Ut.BrowserInfo,Ut.ApplicationIdentifier,Ut.BrowserWindowSize,Ut.Url,Ut.MapView,Ut.Tiles],GeneralUserActionStates:[Ut.ScreenSize,Ut.DeviceIdentifier,Ut.BrowserInfo,Ut.ApplicationIdentifier,Ut.BrowserWindowSize,Ut.Url,Ut.UserSession],SessionLessGeneralUserActionStates:[Ut.ScreenSize,Ut.DeviceIdentifier,Ut.BrowserInfo,Ut.ApplicationIdentifier,Ut.BrowserWindowSize,Ut.Url],NetworkStates:[Ut.DeviceIdentifier,Ut.BrowserInfo,Ut.ApplicationIdentifier,Ut.UserSession]},Bt=Object.freeze({UserAction:"USER_ACTION",Network:"NETWORK"}),Wt=["OPEN_APPLE_MAPS"],Zt={Zoom:{name:"ZOOM",states:Gt.MapUserActionStates,type:Bt.UserAction},MapsLoad:{name:"MAPS_LOAD",states:Gt.MapUserActionStates,type:Bt.UserAction},AnnotationClick:{name:"ANNOTATION_CLICK",states:Gt.MapUserActionStates,type:Bt.UserAction},MapFeatureSelect:{name:"TAP_POI",states:Gt.MapUserActionStates,type:Bt.UserAction,valueMap:{Poi:"POINT_OF_INTEREST",Territory:"TERRITORY",PhysicalFeature:"PHYSICAL_FEATURE"}},MapTypeChange:{name:"MAP_TYPE_CHANGE",states:Gt.MapUserActionStates,type:Bt.UserAction},MapNodeReady:{name:"MAP_NODE_READY",states:Gt.MapUserActionStates,type:Bt.UserAction},Pan:{name:"PAN",states:Gt.MapUserActionStates,type:Bt.UserAction},PlaceAccessoryReveal:{name:"REVEAL",states:Gt.MapUserActionStates,type:Bt.UserAction},PlaceAccessoryOpenAppleMaps:{name:"OPEN_APPLE_MAPS",states:Gt.SessionLessMapUserActionStates,type:Bt.UserAction},PlaceDetailReveal:{name:"REVEAL",states:Gt.GeneralUserActionStates,type:Bt.UserAction},PlaceDetailOpenAppleMaps:{name:"OPEN_APPLE_MAPS",states:Gt.SessionLessGeneralUserActionStates,type:Bt.UserAction},Search:{name:"SEARCH",states:Gt.NetworkStates,type:Bt.Network},SearchAC:{name:"SEARCH_AC",states:Gt.NetworkStates,type:Bt.Network},PlaceLookup:{name:"PLACE_LOOKUP",states:Gt.NetworkStates,type:Bt.Network},ForwardGeocoder:{name:"FORWARD_GEOCODER",states:Gt.NetworkStates,type:Bt.Network},ReverseGeocoder:{name:"REVERSE_GEOCODER",states:Gt.NetworkStates,type:Bt.Network},Directions:{name:"DIRECTIONS",states:Gt.NetworkStates,type:Bt.Network},PointsOfInterestSearch:{name:"POINTS_OF_INTEREST_SEARCH",states:Gt.NetworkStates,type:Bt.Network}};class Kt{constructor(){var e;Dt(this,"_queuedMessages",[]),Dt(this,"_queuedSessionLessMessages",[]),Dt(this,"_shortSessionLoader",null),Dt(this,"_sessionLessLoader",null),Dt(this,"_analyticsUrl",null),Dt(this,"_errorUrl",null),Dt(this,"_sessionId",null),Dt(this,"_sessionTimerStart",null),Dt(this,"_sessionTimeToExpire",null),Dt(this,"_sequenceNumber",null),Dt(this,"_relativeTimestamp",null),Dt(this,"_isCustomSession",!1),Dt(this,"_refreshCustomSession",null),Dt(this,"_enableServerAnalytics",!1),Dt(this,"_serverEnvironment",null),Dt(this,"_isInternalServer",void 0),Dt(this,"_trackPanEvent",!1),Dt(this,"_handleAnalyticsTrackingResponse",null),Dt(this,"_registerableHostDomain",""),Dt(this,"_registerableReferrerDomain",""),Dt(this,"_reducedHostPlaceholders",{ProtocolPlusHost:null,Host:null,ReferrerHost:null}),Dt(this,"States",Ut),Dt(this,"Events",Zt),Dt(this,"EventTarget","UI_TARGET_UNKNOWN"),Dt(this,"tileProvider",zt(Kt,Kt,jt)),Dt(this,"_teamId",zt(Kt,Kt,Ht)),this._isInternalClient=/\.apple\.com$/.test(window.origin)||/\.icloud\.com$/.test(window.origin)||/\.filemaker\.com$/.test(window.origin)||/\.apple-mapkit\.com$/.test(window.origin)||/\.tryrating\.com$/.test(window.origin),Ue.addEventListener(Ue.Events.Changed,this),Ue.ready&&this._configurationBecameAvailable(),this.uaParserInfo={browserInfo:Qe(e=navigator.userAgent),deviceInfo:et(e)},this._debouncedQueueAsBackgroundTask=wt(this._queueAsBackgroundTask,5e3,this),window.addEventListener("pagehide",this),document.addEventListener("visibilitychange",this)}log(e,t={}){this._enableServerAnalytics;const i=(new Date).getTime();(!this._sessionId||!this._sessionTimeToExpire||i>this._sessionTimeToExpire)&&(this._isCustomSession&&this._refreshCustomSession?this._refreshCustomSession():this._initSession()),this._relativeTimestamp=((new Date).getTime()-z(this._sessionTimerStart))/1e3,this._sequenceNumber=Math.ceil(1e4*this._relativeTimestamp),this.uaParserInfo&&(t.uaParserInfo=this.uaParserInfo),Wt.includes(e.name)||t?.isEventSessionLess?this._queuedSessionLessMessages.push(this._createMessage(e,t)):this._queuedMessages.push(this._createMessage(e,t)),Ue.analytics&&z(this._debouncedQueueAsBackgroundTask)()}initCustomSession(e){this._isCustomSession=!0,this._sessionId=e.sessionId,this._sessionTimerStart=e.sessionStartTime,this._sessionTimeToExpire=this._sessionTimerStart+e.sessionDurationMs}manageAnalyticsTrackingResponse(e,t,i=!1){if(!this._handleAnalyticsTrackingResponse)return;let s;if(i)s={eventCount:t,sentViaSendBeacon:i};else{const t=z(e).xhr?.status,o=(z(e).xhrData?JSON.parse(z(z(e).xhrData)):{}).analytics_event;s={eventCount:o&&Array.isArray(o)?o.length:0,responseCode:t,sentViaSendBeacon:i}}this._handleAnalyticsTrackingResponse(s),i&&(0!==this._queuedMessages.length&&this._queuedMessages.forEach((e=>{e.sent_via_send_beacon=!0})),0!==this._queuedSessionLessMessages.length&&this._queuedSessionLessMessages.forEach((e=>{e.sent_via_send_beacon=!0})))}setEventTarget(e){this.EventTarget=e}getDataToSend(e){return 0===this._queuedMessages.length?(z(this._shortSessionLoader).unschedule(),!1):(e.setRequestHeader("Content-Type","text/plain"),this._createShortSessionJson())}loaderDidSucceed(e){this.manageAnalyticsTrackingResponse(e),this._shortSessionLoader=null}loaderDidFail(e){this._queuedMessages=this._queuedMessages.concat(JSON.parse(z(e.xhrData)).analytics_event),this.manageAnalyticsTrackingResponse(e),this._shortSessionLoader=null}getSessionLessDataToSend(e){return 0===this._queuedSessionLessMessages.length?(z(this._sessionLessLoader).unschedule(),!1):(e.setRequestHeader("Content-Type","text/plain"),this._createSessionLessJson())}sessionLessLoaderDidSucceed(e){this.manageAnalyticsTrackingResponse(e),this._sessionLessLoader=null}sessionLessLoaderDidFail(e){this._queuedSessionLessMessages=this._queuedSessionLessMessages.concat(JSON.parse(z(e.xhrData)).analytics_event),this.manageAnalyticsTrackingResponse(e),this._sessionLessLoader=null}handleEvent(e){switch(e.type){case Ue.Events.Changed:this._configurationBecameAvailable();break;case"pagehide":this._sendPendingData();break;case"visibilitychange":"hidden"===document.visibilityState&&this._sendPendingData()}}getReduceHostPlaceholder(e){return this._reducedHostPlaceholders[e]||(this._reducedHostPlaceholders[e]=Symbol()),z(this._reducedHostPlaceholders[e])}_createMessage(e,t){let i;switch(e.type){case Bt.UserAction:i=this._createUserActionMessage(e,t);break;case Bt.Network:i=this._createNetworkMessage(e,t);break;default:throw new Error("")}const s=[].concat(e.states?e.states:[],t.states?Object.keys(t.states):[]);return i.analytic_tag={high:y(),low:y()},i.analytics_state=this._createStateMessages(s,t),i.sent_via_send_beacon=!1,i}_createUserActionMessage(e,t){const i={event_type:Bt.UserAction,user_action_event:{user_action_event_key:e.name}};return(t.eventValue||0===t.eventValue)&&(i.user_action_event.user_action_event_value=e.valueMap?e.valueMap[t.eventValue]:t.eventValue),t.eventTarget&&(i.user_action_event.user_action_event_target=t.eventTarget),t.eventModule&&(i.user_action_event.user_action_event_module=t.eventModule),i}_createNetworkMessage(e,t){const i={event_type:Bt.Network,network_event:{network_service:e.name}},s="number"==typeof t.responseCode?t.responseCode:parseInt(z(t.responseCode));return t.responseCode&&!isNaN(s)&&(i.network_event.http_response_code=s),i}_initSession(){this._isCustomSession=!1,this._sessionId={high:y(),low:y()},this._sessionTimerStart=(new Date).getTime(),this._sessionTimeToExpire=this._sessionTimerStart+9e5}_createStateMessages(e,t){return e.map((e=>{const i={state_type:e};return $e[e]?i[e.toLowerCase()]=$e[e](this,t):z(t.states)[e]&&(i[e.toLowerCase()]=z(t.states)[e](t)),i}))}_createShortSessionJson(){const e=this._createJson({analytics_message_type:"SHORT_SESSION_USAGE",analytics_event:this._queuedMessages});return this._queuedMessages=[],e}_createSessionLessJson(){const e=this._createJson({analytics_message_type:"SESSIONLESS_USAGE",analytics_event:this._queuedSessionLessMessages});return this._queuedSessionLessMessages=[],e}_createJson(e){return JSON.stringify(e,((e,t)=>{switch(t){case zt(Kt,Kt,jt):return this.tileProvider;case zt(Kt,Kt,Ht):return this._teamId;case this._reducedHostPlaceholders.Host:return this._registerableHostDomain;case this._reducedHostPlaceholders.ProtocolPlusHost:return this._registerableHostDomain?window.location.protocol+"//"+this._registerableHostDomain:"";case this._reducedHostPlaceholders.ReferrerHost:return this._registerableReferrerDomain;default:return t}}))}_configurationBecameAvailable(){Ue.analytics&&(this._analyticsUrl=Ue.analytics.analyticsUrl,this._withCredentials=Ue.withCredentials),this._teamId=Ue.analyticsTeamId??Ue.teamId??void 0,Ue.tileProvider===Ue.TileProviders.Apple?this.tileProvider=0:Ue.tileProvider===Ue.TileProviders.AutoNavi?this.tileProvider=1:this.tileProvider=void 0}_scheduleLoaderRequest(){this._shortSessionLoader||0===this._queuedMessages.length||(this._shortSessionLoader=new Nt(z(this._analyticsUrl),this,{method:"POST",priority:Ft.Low,retry:!0,withCredentials:this._withCredentials}),this._shortSessionLoader.schedule()),this._sessionLessLoader||0===this._queuedSessionLessMessages.length||(this._sessionLessLoader=new Nt(z(this._analyticsUrl),{getDataToSend:e=>this.getSessionLessDataToSend(e),loaderDidSucceed:e=>{this.sessionLessLoaderDidSucceed(e)},loaderDidFail:e=>{this.sessionLessLoaderDidFail(e)}},{method:"POST",priority:Ft.Low,retry:!0,withCredentials:this._withCredentials}),this._sessionLessLoader.schedule())}_scheduleLoader(){this._resolveRegisterableDomains().then((()=>{this._scheduleLoaderRequest()}))}_queueAsBackgroundTask(){bt.scheduleInBackground((()=>this._scheduleLoader()),bt.Priority.Medium)}_resolveRegisterableDomains(){const e=!!this._reducedHostPlaceholders.ProtocolPlusHost||!!this._reducedHostPlaceholders.Host,t=!!this._reducedHostPlaceholders.ReferrerHost&&document.referrer?new URL(document.referrer):null,i=t?t.hostname:null;return Promise.all([e?Pt.getRegisterableDomain(window.location.hostname):"",Pt.getRegisterableDomain(i)]).then((([e,i])=>{this._registerableHostDomain=e?window.location.port?`${e}:${window.location.port}`:e:"",this._registerableReferrerDomain=i?t&&t.port?`${i}:${t.port}`:i:""}))}_sendPendingData(){if(0!==this._queuedMessages.length){const e=this._queuedMessages.length;if(this.manageAnalyticsTrackingResponse(null,e,!0),"function"==typeof navigator.sendBeacon)navigator.sendBeacon(z(this._analyticsUrl),this._createShortSessionJson());else{const e=new XMLHttpRequest;e.open("POST",z(this._analyticsUrl),!1),e.send(this._createShortSessionJson())}}if(0!==this._queuedSessionLessMessages.length){const e=this._queuedSessionLessMessages.length;if(this.manageAnalyticsTrackingResponse(null,e,!0),"function"==typeof navigator.sendBeacon)navigator.sendBeacon(z(this._analyticsUrl),this._createSessionLessJson());else{const e=new XMLHttpRequest;e.open("POST",z(this._analyticsUrl),!1),e.send(this._createSessionLessJson())}}}}var jt={writable:!0,value:Symbol()},Ht={writable:!0,value:Symbol()};const Vt=new Kt,qt=Math.PI/180,Yt=Math.PI/4,Xt=2*Math.PI,$t=12,Jt=256,Qt=Math.PI/3,ei=Math.tan(Qt/2);function ti(e){const t=c(e,1e-8-90,90-1e-8)*qt;return.5+Math.log(Math.tan(Yt-t/2))/Xt}function ii(e){const t=Math.pow(Math.E,2*Math.PI*(e-.5));return-2*(Math.atan(t)-Math.PI/4)/Math.PI*180}function si(e){return l(e/360+.5,1)}function oi(e){return 360*(l(e,1)-.5)}function ni(e){return l(180+e,360)-180}function ai(e){const t=e*qt,i=111132.92+-559.82*Math.cos(2*t)+1.175*Math.cos(4*t)+-.0023*Math.cos(6*t),s=ti(e-.5),o=ti(e+.5);return Math.abs(s-o)/i}const ri=1e-8,li=ii(0),hi=ii(1);function ci(e,t){const i=e.toCoordinate(),s=t.toCoordinate();return o=i.latitude,n=i.longitude,a=s.latitude,r=s.longitude,function(e,t,i,s,o){const n=(i-e)*qt,a=(s-t)*qt,r=Math.pow(Math.sin(n/2),2)+Math.cos(e*qt)*Math.cos(i*qt)*Math.pow(Math.sin(a/2),2),l=2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r));return o*l}(o,n,a,r,6378160-21e3*Math.sin(o*qt));var o,n,a,r}class di{constructor(e,t){if(void 0===e&&(e=new pi),void 0===t&&(t=new ui),!(e instanceof pi))throw Error("[MapKit] `center` is not a Coordinate.");if(!(t instanceof ui))throw Error("[MapKit] `span` is not a CoordinateSpan.");this.center=new pi(e.latitude,e.longitude),this.span=new ui(t.latitudeDelta,t.longitudeDelta)}copy(){return new di(this.center.copy(),this.span.copy())}toString(){return["CoordinateRegion(","\tlatitude: "+this.center.latitude,"\tlongitude: "+this.center.longitude,"\tlatitudeDelta: "+this.span.latitudeDelta,"\tlongitudeDelta: "+this.span.longitudeDelta,")"].join("\n")}equals(e){return this.center.equals(e.center)&&this.span.equals(e.span)}toBoundingRegion(){const e=this.span.latitudeDelta/2,t=this.span.longitudeDelta/2;return new mi(this.center.latitude+e,ni(this.center.longitude+t),this.center.latitude-e,ni(this.center.longitude-t))}toMapRect(){if(this.span.latitudeDelta<0)this.span.latitudeDelta=0;else{const e=ti(Math.abs(this.center.latitude)),t=li-ii(2*e);this.span.latitudeDelta>t&&(this.span.latitudeDelta=t)}const e=ni(this.center.longitude),t=this.span.longitudeDelta/2;let i=e-t,s=e+t,o=!1;i<-180&&(i+=360,o=!0);let n=!1;s>180&&(s-=360,n=!0);const a=new pi(this.center.latitude,i),r=new pi(this.center.latitude,s),l=a.toMapPoint(),h=r.toMapPoint();o&&(l.x-=1),n&&(h.x+=1);const c=new fi;let d,u;if(0===this.center.latitude)return d=new pi(this.center.latitude+this.span.latitudeDelta/2,this.center.longitude),u=new pi(this.center.latitude-this.span.latitudeDelta/2,this.center.longitude),c.origin.x=l.x,c.size.width=h.x-c.origin.x,c.origin.y=d.toMapPoint().y,c.size.height=u.toMapPoint().y-c.origin.y,c;const p=this.copy();p.center.latitude=hi+this.span.latitudeDelta/2;let m=10,g=new pi;const _=new gi;d=new pi,u=new pi,d.longitude=this.center.longitude,u.longitude=this.center.longitude;let f=0;do{if(p.center.latitude>li&&p.center.latitude>this.center.latitude||p.center.latitude<hi&&p.center.latitude<this.center.latitude)p.center.latitude-=m,m*=.1;else if(p.center.latitude>li||p.center.latitude<hi)return new fi(0,0,1,1);if(f>500)return new fi(0,0,1,1);d.latitude=p.center.latitude+p.span.latitudeDelta/2,u.latitude=p.center.latitude-p.span.latitudeDelta/2,c.origin.x=l.x,c.size.width=h.x-c.origin.x,c.origin.y=d.toMapPoint().y,c.size.height=u.toMapPoint().y-c.origin.y,_.x=c.midX(),_.y=c.midY(),g=_.toCoordinate(),(m>0&&g.latitude>this.center.latitude||m<0&&g.latitude<this.center.latitude)&&(m*=-.1),p.center.latitude+=m,f++}while(Math.abs(g.latitude-this.center.latitude)>=ri);return c}get radius(){const e=this.toMapRect();let t,i;return e.size.width>e.size.height?(t=new gi(e.minX(),e.midY()),i=new gi(e.maxX(),e.midY())):(t=new gi(e.midX(),e.minY()),i=new gi(e.midX(),e.maxY())),ci(t,i)/2}}class ui{constructor(e,t){if(void 0===e&&(e=0),void 0===t&&(t=0),"number"!=typeof e||isNaN(e))throw new TypeError("[MapKit] `latitudeDelta` is not a number.");if("number"!=typeof t||isNaN(t))throw new TypeError("[MapKit] `longitudeDelta` is not a number.");this.latitudeDelta=Math.max(e,0),this.longitudeDelta=Math.max(t,0)}copy(){return new ui(this.latitudeDelta,this.longitudeDelta)}equals(e){return Math.abs(this.latitudeDelta-e.latitudeDelta)<ri&&Math.abs(this.longitudeDelta-e.longitudeDelta)<ri}toString(){return["CoordinateSpan(","\tlatitudeDelta: "+this.latitudeDelta,"\tlongitudeDelta: "+this.longitudeDelta,")"].join("\n")}}class pi{constructor(e,t){if(void 0===e&&(e=0),void 0===t&&(t=0),"number"!=typeof e||isNaN(e))throw new TypeError("[MapKit] `latitude` is not a number.");if("number"!=typeof t||isNaN(t))throw new TypeError("[MapKit] `longitude` is not a number.");this.latitude=e,this.longitude=t}copy(){return new pi(this.latitude,this.longitude)}equals(e){return Math.abs(this.latitude-e.latitude)<ri&&Math.abs(this.longitude-e.longitude)<ri}toMapPoint(){return new gi(si(this.longitude),ti(this.latitude))}toUnwrappedMapPoint(){return new gi(this.longitude/360+.5,ti(this.latitude))}toString(){return["Coordinate(","latitude:"+this.latitude.toFixed($t),",longitude:"+this.longitude.toFixed($t),")"].join("")}}class mi{constructor(e,t,i,s){if(arguments.length<4&&(s=0,arguments.length<3&&(i=0,arguments.length<2&&(t=0,arguments.length<1&&(e=0)))),"number"!=typeof e||isNaN(e))throw new TypeError("[MapKit] Expected a number for `northLatitude` in BoundingRegion constructor but got `"+e+"` instead.");if("number"!=typeof t||isNaN(t))throw new TypeError("[MapKit] Expected a number for `eastLongitude` in BoundingRegion constructor but got `"+t+"` instead.");if("number"!=typeof i||isNaN(i))throw new TypeError("[MapKit] Expected a number for `southLatitude` in BoundingRegion constructor but got `"+i+"` instead.");if("number"!=typeof s||isNaN(s))throw new TypeError("[MapKit] Expected a number for `westLongitude` in BoundingRegion constructor but got `"+s+"` instead.");this.northLatitude=e,this.eastLongitude=t,this.southLatitude=i,this.westLongitude=s}copy(){return new mi(this.northLatitude,this.eastLongitude,this.southLatitude,this.westLongitude)}toString(){return["BoundingRegion(","\tnorthLatitude: "+this.northLatitude,"\teastLongitude: "+this.eastLongitude,"\tsouthLatitude: "+this.southLatitude,"\twestLongitude: "+this.westLongitude,")"].join("\n")}toCoordinateRegion(){let e=ni(this.eastLongitude);const t=ni(this.westLongitude);e<t&&(e+=360);const i=this.northLatitude-this.southLatitude,s=e-t;return new di(new pi(this.southLatitude+i/2,ni(t+s/2)),new ui(i,s))}}class gi{constructor(e,t){if(arguments.length<2&&(t=0,arguments.length<1&&(e=0)),"number"!=typeof e||isNaN(e))throw new TypeError("[MapKit] Expected a number for `x` in MapPoint constructor but got `"+e+"` instead.");if("number"!=typeof t||isNaN(t))throw new TypeError("[MapKit] Expected a number for `y` in MapPoint constructor but got `"+t+"` instead.");this.x=e,this.y=t,this.z=0,this.w=1}toString(){return"MapPoint("+this.x+", "+this.y+")"}copy(){return new gi(this.x,this.y)}equals(e){return this.x===e.x&&this.y===e.y}toCoordinate(){return new pi(ii(this.y),ni(oi(this.x)))}}class _i{constructor(e,t){if(arguments.length<2&&(t=0,arguments.length<1&&(e=0)),"number"!=typeof e||isNaN(e))throw new TypeError("[MapKit] Expected a number for `width` in MapSize constructor but got `"+e+"` instead.");if("number"!=typeof t||isNaN(t))throw new TypeError("[MapKit] Expected a number for `height` in MapSize constructor but got `"+t+"` instead.");this.width=e,this.height=t}toString(){return"MapSize("+this.width+", "+this.height+")"}copy(){return new _i(this.width,this.height)}equals(e){return this.width===e.width&&this.height===e.height}}class fi{constructor(e,t,i,s){if(arguments.length<4&&(s=0,arguments.length<3&&(i=0,arguments.length<2&&(t=0,arguments.length<1&&(e=0)))),"number"!=typeof e||isNaN(e))throw new TypeError("[MapKit] Expected a number for `x` in MapRect constructor but got `"+e+"` instead.");if("number"!=typeof t||isNaN(t))throw new TypeError("[MapKit] Expected a number for `y` in MapRect constructor but got `"+t+"` instead.");if("number"!=typeof i||isNaN(i))throw new TypeError("[MapKit] Expected a number for `width` in MapRect constructor but got `"+i+"` instead.");if("number"!=typeof s||isNaN(s))throw new TypeError("[MapKit] Expected a number for `height` in MapRect constructor but got `"+s+"` instead.");this.origin=new gi(e,t),this.size=new _i(i,s)}toString(){return"MapRect("+[this.origin.x.toFixed($t),this.origin.y.toFixed($t),this.size.width.toFixed($t),this.size.height.toFixed($t)].join(", ")+")"}copy(){return new fi(this.origin.x,this.origin.y,this.size.width,this.size.height)}equals(e){return this.origin.equals(e.origin)&&this.size.equals(e.size)}minX(){return this.origin.x}minY(){return this.origin.y}midX(){return this.origin.x+this.size.width/2}midY(){return this.origin.y+this.size.height/2}maxX(){return this.origin.x+this.size.width}maxY(){return this.origin.y+this.size.height}scale(e,t){if("number"!=typeof e||isNaN(e))throw new TypeError("[MapKit] The `scaleFactor` parameter passed to `MapRect.scale()` is not a number.");const i=this.size.width*e,s=this.size.height*e;if(!t)return new fi(this.midX()-i/2,this.midY()-s/2,i,s);if(!(t instanceof gi))throw Error("[MapKit] The `scaleCenter` parameter passed to `MapRect.scale()` is not a MapPoint.");return new fi(t.x-e*(t.x-this.origin.x),t.y-e*(t.y-this.origin.y),i,s)}toCoordinateRegion(){const e=this.origin.toCoordinate(),t=new gi(this.maxX(),this.maxY()).toCoordinate(),i=Math.abs(t.latitude-e.latitude);let s=t.longitude-e.longitude;return t.longitude<e.longitude&&(s+=360),new di(new gi(this.midX(),this.midY()).toCoordinate(),new ui(i,s))}}class yi{constructor(e,t){if(null==t)if("number"==typeof e)t=1/0;else{const i=null==e?{}:e;e="minCameraDistance"in i?i.minCameraDistance:0,t="maxCameraDistance"in i?i.maxCameraDistance:1/0}if("number"!=typeof e||e<0)throw new Error("[MapKit] The `minCameraDistance` property of CameraZoomRange must be a number >= 0");if("number"!=typeof t||t<0)throw new Error("[MapKit] The `maxCameraDistance` property of CameraZoomRange must be a number >= 0");if(t<e)throw new Error("[MapKit] The `maxCameraDistance` property of CameraZoomRange must be greater than the `minCameraDistance` property.");this._minCameraDistance=e,this._maxCameraDistance=t}get minCameraDistance(){return this._minCameraDistance}get maxCameraDistance(){return this._maxCameraDistance}copy(){return new yi(this._minCameraDistance,this._maxCameraDistance)}}const vi={tileSize:Jt,convertLatitudeToY:ti,convertYToLatitude:ii,convertLongitudeToX:si,convertXToLongitude:oi,wrapLongitude:ni,wrapX:function(e,t){let i=1.5,s=e;for(let o=-1;o<=1;++o){const n=Math.abs(e+o-t);n<i&&(i=n,s=e+o)}return s},zoomLevelForMapRectInViewport:function(e,t,i){const s=t.width/(i*e.size.width),o=t.height/(i*e.size.height);return Math.log2(Math.min(s,o))},mapUnitsPerMeterAtLatitude:ai,pointsPerAxis:function(e){return Math.pow(2,e)*Jt},zoomLevelForCameraDistanceAtLatitudeAndViewportWidth:function(e,t,i){const s=2*(ei*e)*ai(t);return Math.log2(i/s/Jt)},CameraZoomRange:yi,CoordinateRegion:di,CoordinateSpan:ui,Coordinate:pi,BoundingRegion:mi,MapPoint:gi,MapRect:fi,MapSize:_i};function bi(e,t,i){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,i)}function wi(e,t){var i=function(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}(e,t,"get");return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}var Ci=new WeakMap;class ki{_(e,t){if(e!==H)throw new Error("");return wi(this,Ci)}constructor(e){let t,i;bi(this,Ci,{writable:!0,value:{resultProviderId:void 0,formattedAddressLines:void 0}}),e.id&&(this.id=e.id,this.alternateIds=e.alternateIds||[]),e.muid&&(this.muid=e.muid),e.mapsId?.resultProviderId&&(wi(this,Ci).resultProviderId=e.mapsId.resultProviderId),e.placecardUrl&&(this._wpURL=e.placecardUrl),e.style&&e.style.attributes&&(this._styleAttributes=e.style.attributes.map((e=>e.key+":"+e.value)).join(","),e.poiCategory&&-1!==Object.keys(We).indexOf(e.poiCategory)&&(this.pointOfInterestCategory=We[e.poiCategory])),e.name&&(this.name=e.name),e.attribution&&(this._providerId=e.attribution.vendorId,this._providerItemId=e.attribution.externalItemId),e.displayMapRegion&&(t=e.displayMapRegion,i=new mi(t.northLat,t.eastLng,t.southLat,t.westLng),this.region=i.toCoordinateRegion(),this.coordinate=this.region.center),e.formattedAddressLines&&(this.formattedAddress=e.formattedAddressLines.join(", "),wi(this,Ci).formattedAddressLines=[...e.formattedAddressLines]),e.center&&(this.coordinate=new pi(e.center.lat,e.center.lng)),e.countryCode&&(this.countryCode=e.countryCode),this.telephone=e.telephone,this.urls=e.urls||[],this.country=e.country,this.administrativeArea=e.administrativeArea,this.administrativeAreaCode=e.administrativeAreaCode,this.locality=e.locality,this.postCode=e.postCode,this.subLocality=e.subLocality,this.thoroughfare=e.thoroughfare,this.subThoroughfare=e.subThoroughfare,this.fullThoroughfare=e.fullThoroughfare,this.areasOfInterest=e.areasOfInterest,this.dependentLocalities=e.dependentLocalities,this.timezone=e.timezone,this.timezoneSecondsFromGmt=e.timezoneSecondsFromGmt}}ki.isConstructable=!1;const Mi=function(e){if(ki.isConstructable)return new ki(e);throw new TypeError("[MapKit] Place may not be constructed.")};ki.prototype.constructor=Mi,Mi.prototype=ki.prototype;const Si=ki;class Li{constructor(e,t,i,s){this.localeId=e,this._dict=t||{},this.ready=!!t,this.delegate=i,this.rtl=i.rtlLocales.indexOf(e)>-1,this.dow=s}get(e,t){const i=this._dict[e];return i?f(i,t??{},!0):`[${e}]`}load(e){const t=this.localeId,i=this.delegate.localeUrl.replace(/{{(.*?)}}/,t),s=new ce(i,{loaderDidSucceed:(i,s)=>{if(s.status<200||s.status>=300){const i=new Error(`HTTP error ${s.status} loading strings for locale: ${t}`);e(i,this)}else{try{this._dict=JSON.parse(s.responseText??"")}catch(i){const s=new Error(`Failed to parse response for locale: ${t}`);return void e(s,this)}this.ready=!0,e(null,this)}},loaderDidFail:(i,s)=>{const o=new Error(`Network error loading strings for locale: ${t}`);e(o,this)}},{withCredentials:this.delegate.withCredentials});s.schedule()}}const xi=Object.freeze({"ar-SA":6,"ca-ES":1,"cs-CZ":1,"da-DK":1,"de-DE":1,"el-GR":1,"en-AU":1,"en-GB":1,"en-US":0,"en-ZA":0,"es-ES":1,"es-MX":1,"fi-FI":1,"fr-CA":0,"fr-FR":1,"he-IL":0,"hi-IN":0,"hr-HR":1,"hu-HU":1,"id-ID":1,"it-IT":1,"ja-JP":0,"ko-KR":0,"ms-MY":1,"nb-NO":1,"nl-NL":1,"pl-PL":1,"pt-BR":0,"pt-PT":1,"ro-RO":1,"ru-RU":1,"sk-SK":1,"sv-SE":1,"th-TH":0,"tr-TR":1,"uk-UA":1,"vi-VN":1,"zh-CN":1,"zh-HK":0,"zh-TW":0}),Ai=["0","1","2","3","4","5","6","7","8","9"],Ei={"ar-SA":["Ù ","Ù¡","Ù¢","Ù£","Ù¤","Ù¥","Ù¦","Ù§","Ù¨","Ù©"],"hi-IN":["à¥¦","à¥§","à¥¨","à¥©","à¥ª","à¥«","à¥¬","à¥­","à¥®","à¥¯"]},Ti=",",Ii={"ca-ES":Ti,"ca-CZ":Ti,"da-DK":Ti,"da-DE":Ti,"el-GR":Ti,"en-ZA":Ti,"es-ES":Ti,"fi-FI":Ti,"fr-CA":Ti,"fr-FR":Ti,"hr-HR":Ti,"hu-HU":Ti,"it-IT":Ti,"nb-NO":Ti,"nl-NL":Ti,"pl-PL":Ti,"pt-BR":Ti,"pt-PT":Ti,"ro-RO":Ti,"ru-RU":Ti,"sk-SK":Ti,"sv-SE":Ti,"tr-TR":Ti,"uk-UA":Ti};const Oi="en-US",Ri=new WeakSet,Pi=new WeakSet,Di=(e,t)=>{const{language:i,region:s}=t;e.supportMap[i]=e.supportMap[i]||[],s&&-1!==e.delegate.primaryLocales.indexOf(t.tag)?e.supportMap[i].splice(0,0,s):s&&e.supportMap[i].push(s)},zi=(e,t,i)=>new Li(t,i??null,e.delegate,e.dowForBestMatch(t)),Ni=(e,t)=>{e.locales[t.localeId]||(e.locales[t.localeId]=t),e.activeLocale=t,e.dispatchEvent(new Ui(t))},Fi=(e,t)=>-1!==e.delegate.supportedLocales.indexOf(t);class Ui extends P{constructor(e){super(Gi.Events.LocaleChanged),this.locale=e}}class Gi extends R{constructor(e){super(),this.delegate=e,this._requestedLocaleId="",this.locales=e.localesCache||Object.create(null),this.supportMap=e.supportCache||Object.create(null),this.scriptMap=e.scriptCache||Object.create(null),this.Events=Gi.Events,(e=>{if(!Ri.has(e.supportMap)){Ri.add(e.supportMap);for(const t of e.delegate.supportedLocales){const i=v.parse(t);i&&Di(e,i)}}})(this);const t=this.locales[Oi]||zi(this,Oi,this.delegate.enUSDictionary);this.locales[t.localeId]||(this.locales[t.localeId]=t),this.activeLocale=t,(e=>{if(Pi.has(e.scriptMap))return;Pi.add(e.scriptMap);const t=e.delegate.regionToScriptMap;for(const[i,s]of Object.entries(t)){e.scriptMap[i]={};for(const[t,o]of Object.entries(s))e.scriptMap[i][o.toLowerCase()]=t}})(this)}get(e,t){return this.activeLocale.get(e,t)??`[${e}]`}get localeId(){return this.activeLocale.localeId??""}set localeId(e){this._requestedLocaleId!==e&&((e,t)=>{e._requestedLocaleId=t;let i=t;if(Fi(e,t)||(i=e.bestMatch(t,Oi)),e.activeLocale.localeId===i)return;let s=i?e.locales[i]:null;s||!i||(s=zi(e,i),s.ready)?s&&Ni(e,s):s.load(((i,s)=>{if(e._requestedLocaleId===t)return i?(e._requestedLocaleId=Oi,void Ni(e,e.locales[Oi])):void Ni(e,s)}))})(this,e)}get loaded(){return!!this._requestedLocaleId&&this.bestMatch(this._requestedLocaleId,Oi)===this.localeId}get requestedLocaleId(){return this._requestedLocaleId}set requestedLocaleId(e){console.warn("l10n: requestedLocaleId can't be set, use localeId.")}get localeIds(){return Object.keys(this.locales)}get supportedLocaleIds(){return this.delegate.supportedLocales}bestMatch(e,t){let i="string"==typeof e?v.parse(e):null,s=null;if(i&&this.delegate.localesMap){const e=this.delegate.localesMap;e[i.tag]?i=v.parse(e[i.tag]):e[i.language]&&(i=v.parse(e[i.language]))}return t=t||null,i&&(s=((e,t)=>{const{language:i,region:s,script:o}=t;let n;const a=e.supportMap[i];if(!a)return null;if(s&&(n=a.find((e=>e.toUpperCase()===t.region?.toUpperCase()))),!n&&o){const t=e.scriptMap[i]?.[o.toLowerCase()];n=t??n}return n||(n=a[0]),new v(i,n)})(this,i)),s?s.tag:t}dowForBestMatch(e,t){const i=this.bestMatch(e,t);return i&&i in xi?xi[i]:0}digits(e){return function(e,t){const i=Ei[t]||Ai,s=Ii[t]||".";let o="";const n=e.toString();for(let e=0,t=n.length;e<t;++e){const t=n.charAt(e);o+="."===t?s:i[parseInt(t,10)]||t}return o}(e,this.localeId)}}Gi.Events=Object.freeze({LocaleChanged:"locale-changed"}),Gi.Days=Object.freeze({Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Friday:5,Saturday:6}),Gi.LocaleChangedEvent=Ui;const Bi=["AS","BS","BZ","DM","FK","GB","GD","GU","KN","KY","LC","LR","MM","MP","SH","TC","US","VC","VG","VI","WS"],Wi=e=>{const t=e.region;return t?Bi.indexOf(t)<0:"en"!==e.language&&"my"!==e.language},Zi={supportedLocales:["ar-SA","bn-BD","ca-ES","cs-CZ","da-DK","de-DE","el-GR","en-GB","en-US","es-ES","es-MX","fi-FI","fr-CA","fr-FR","gu-IN","he-IL","hi-IN","hr-HR","hu-HU","id-ID","it-IT","ja-JP","kn-IN","ko-KR","ml-IN","mr-IN","ms-MY","nb-NO","nl-NL","or-IN","pa-IN","pl-PL","pt-BR","pt-PT","ro-RO","ru-RU","sk-SK","sl-SI","sv-SE","ta-IN","te-IN","th-TH","tr-TR","uk-UA","ur-PK","vi-VN","zh-CN","zh-HK","zh-TW"],primaryLocales:["en-US","fr-FR","pt-BR","zh-CN"],localesMap:C,regionToScriptMap:w,rtlLocales:["ar-SA","he-IL","ur-PK"],enUSDictionary:{"Annotation.Clustering.AccessibilityLabel":"{{n}} locations, {{title}}, {{subtitle}}","Annotation.Clustering.More":"+{{n}} more","Annotation.Clustering.More.Plural":"+{{n}} more","Annotation.Clustering.NoTitle.AccessibilityLabel":"{{n}} locations, {{subtitle}}","Annotation.Generic.AccessibilityLabel":"{{title}}, {{subtitle}}","Annotation.Marker.AccessibilityLabel":"Marker","Annotation.Pin.AccessibilityLabel":"Pin","Annotation.Pin.Green.AccessibilityLabel":"Green Pin","Annotation.Pin.Purple.AccessibilityLabel":"Purple Pin","Annotation.Pin.Red.AccessibilityLabel":"Red Pin",Compass:"Compass","Compass.Degrees.Plural":"{{n}} degrees","Compass.Degrees.Single":"{{n}} degree","Compass.EastIndicator":"E","Compass.Heading":"Heading: {{heading}}","Compass.NorthIndicator":"N","Compass.SouthIndicator":"S","Compass.Tooltip":"Rotate the map","Compass.Tooltip.Reset":"Reset heading","Compass.WestIndicator":"W",Done:"Done","Legal.Apple.URL":"https://www.apple.com/legal/internet-services/maps/legal-en.html","Legal.Label":"Legal","Location.Error.Message":"Your location can only be shown when location services are enabled and you are connected to the Internet.","Location.Error.Support.Label":"Learn more","Location.Subtitle":"Unknown Address","Location.Title":"Current Location","Logo.Apple.Tooltip":"Apple Maps","Logo.AutoNavi.Tooltip":"AutoNavi Maps","MapType.Tooltip":"Change the map type","Mode.Hybrid":"Hybrid","Mode.Satellite":"Satellite","Mode.Standard":"Standard","OpenDialog.Enter":"Enter Fullscreen Mode","OpenDialog.Exit":"Exit Fullscreen Mode","OpenInAppleMaps.Label":"Open in Apple Maps","Place.Error.Message":"Could not load place details.","Place.Error.Title":"Place Unavailable","Scale.Feet.Short":"ft","Scale.Kilometer.Short":"km","Scale.Meter.Short":"m","Scale.Mile.Short":"mi","Track.User.Location.Tooltip":"Show your current location","Zoom.In.Tooltip":"Zoom In","Zoom.Out.Tooltip":"Zoom Out"},get localeUrl(){return St.createUrl("locales/{{locale}}/strings.json")},get withCredentials(){return Ue.distUrlWithCredentials}},Ki=new Gi(Zi),ji=Object.create(null);S(k,Zi.supportedLocales,Ki.supportMap,ji);let Hi=!1;Ki.addEventListener(Gi.Events.LocaleChanged,(()=>{const e=v.parse(Ki.requestedLocaleId);Hi=Wi(e)}));Ue.setL10n(Ki,(function(){L(k,Zi.supportedLocales,Ki.supportMap,ji)}));const Vi=Ki,qi=(e,t)=>{const i=new Uint8Array(atob(e).split("").map((e=>e.charCodeAt(0)))),s=new Uint8Array(atob(t).split("").map((e=>e.charCodeAt(0))));return btoa(String.fromCharCode(...i.map(((e,t)=>e^s[t%s.length]))))},Yi=btoa("Copyright (c) Apple Inc. All rights reserved."),Xi=new WeakMap;class $i{constructor(e,t){this._delegate=t,this._handleConfigChangedListener=()=>this._handleConfigChanged(),Ue.addEventListener(Ue.Events.Changed,this._handleConfigChangedListener),this._handleLocaleChangedListener=e=>this._handleLocaleChanged(e),Vi.addEventListener(Vi.Events.LocaleChanged,this._handleLocaleChangedListener),this._container=e}update(){this._delegate.place&&Ue.ready?this._renderPlaceIframe():this._removeIframeElement()}destroy(){this._removeIframeElement(),Ue.removeEventListener(Ue.Events.Changed,this._handleConfigChangedListener),Vi.removeEventListener(Vi.Events.LocaleChanged,this._handleLocaleChangedListener)}_handleLocaleChanged(){this.update()}_handleConfigChanged(){this.update()}_getPlaceAsUrlParams(){const t=this._delegate.place,i=new URLSearchParams;return i.append("uiStyle",this._delegate.uiStyle),t.muid&&i.append("auid",t.muid),t.formattedAddress&&i.append("address",t.formattedAddress),t.coordinate&&i.append("ll",`${t.coordinate.latitude},${t.coordinate.longitude}`),t.name&&i.append("q",t.name),i.append("countryCode",Ue.countryCode||""),i.append("lang",Vi.localeId),i.append("mapkitVersion",e.version),Ue.enableSourceMap&&i.append("sourcemap","1"),`${Ue.uiBaseUrl}/v1/place?${i.toString()}`}_renderPlaceIframe(){this._iframeElement||(this._iframeElement=document.createElement("iframe"),this._container.appendChild(this._iframeElement),this._handleMessageEventListener=e=>this._handleMessageEvent(e),window.addEventListener("message",this._handleMessageEventListener),this._iframeElement.style.display="block",this._iframeElement.style.width="100%",this._iframeElement.style.height="0",this._iframeElement.style.border="none","standalone"===this._delegate.uiStyle&&(this._iframeElement.style.maxWidth="380px",this._iframeElement.style.minWidth="240px",this._iframeElement.style.margin="0 auto",this._iframeElement.style.borderRadius="18px"),this._iframeContentWindowReady=!1);const t=this._getPlaceAsUrlParams();t!==this._iframeElement.src?(this._iframeElement.src=t,this._iframeLoadingTimeout=window.setTimeout((()=>this._frameLoadingDidFail()),3e4)):this._postMessage({action:"set-options",placeKey:Xi.get(this),mapkitVersion:e.version,colorScheme:this._delegate.colorScheme,displaysMap:this._delegate.displaysMap})}_postMessage(e){if(!this._iframeContentWindowReady)return;const t=this._iframeElement.contentWindow;t&&t.postMessage(e,new URL(this._iframeElement.src).origin)}_handleMessageEvent(t){if(t.source===this._iframeElement.contentWindow)switch(t.data.action&&(clearTimeout(this._iframeLoadingTimeout),this._iframeContentWindowReady=!0),t.data.action){case"ready":{const i=qi(Yi,t.data.key);Xi.set(this,i);const s={action:"render-place",placeKey:i,accessToken:Ue.accessToken,mapkitVersion:e.version,colorScheme:this._delegate.colorScheme,displaysMap:this._delegate.displaysMap};Ue._showMapsLogo||(s.showMapsLogo=!1),this._postMessage(s);break}case"update-size":{const e=t.data.width,i=t.data.height;this._iframeElement.style.height=`${i}px`,this._delegate.placeCardSizeDidChange&&this._delegate.placeCardSizeDidChange(e,i);break}case"place-card-did-reveal":this._delegate.placeCardDidReveal&&this._delegate.placeCardDidReveal(t.data.analyticsState);break;case"open-in-maps-clicked":this._delegate.placeCardOpenInMapsClicked&&this._delegate.placeCardOpenInMapsClicked(t.data.analyticsState)}}_frameLoadingDidFail(){this._delegate.loadingDidFail&&this._delegate.loadingDidFail()}_removeIframeElement(){this._iframeElement&&(this._container.removeChild(this._iframeElement),window.removeEventListener("message",this._handleMessageEventListener),clearTimeout(this._iframeLoadingTimeout),this._iframeElement=void 0)}}const Ji=[];class Qi{constructor(e,t=null,i={}){if(!e||!ne(e))throw new Error("[MapKit] `parent` must be a DOM element.");const s=this;this._impl={controllerDelegate:{get colorScheme(){return s._impl.colorScheme},get displaysMap(){return s._impl.displaysMap},get place(){return s._impl.place},uiStyle:"standalone",placeCardDidReveal(e){Vt.log(Vt.Events.PlaceDetailReveal,{eventValue:"LARGE",eventTarget:"PLACECARD_TRAY",states:{PLACE_CARD:()=>e}})},placeCardOpenInMapsClicked(e){Vt.log(Vt.Events.PlaceDetailOpenAppleMaps,{eventTarget:"PLACECARD_TRAY",states:{PLACE_CARD:()=>e}})}},element:e,shadowRoot:e.attachShadow({mode:Ue.shadowDOMMode||"closed"}),controller:void 0,colorScheme:void 0,displaysMap:void 0,place:null,destroyed:!1},this._impl.controller=new $i(this._impl.shadowRoot,this._impl.controllerDelegate),void 0!==i.colorScheme?this.colorScheme=i.colorScheme:this.colorScheme=qe.Light,void 0!==i.displaysMap?this.displaysMap=i.displaysMap:this.displaysMap=!0,this.place=t,Ji.push(this)}get element(){return this._impl.element}get place(){return this._impl.place}set place(e){this._impl.destroyed||e!==this._impl.place&&(null!==e&&m(e,Si,"[MapKit] The `place` parameter must be a Place."),this._impl.place=e,this._impl.controller.update())}get colorScheme(){return this._impl.colorScheme}set colorScheme(e){if(!this._impl.destroyed&&e!==this._impl.colorScheme){if(!d(e,qe))throw new Error("[MapKit] Unknown value for `colorScheme`. Choose from `PlaceDetail.ColorSchemes`.");this._impl.colorScheme=e,this._impl.controller.update()}}get displaysMap(){return this._impl.displaysMap}set displaysMap(e){this._impl.destroyed||e!==this._impl.displaysMap&&(this._impl.displaysMap=!!e,this._impl.controller.update())}destroy(){this._impl.destroyed||(this._impl.destroyed=!0,this._impl.controller.destroy(),Ji.splice(Ji.indexOf(this),1))}}Qi.ColorSchemes=qe;class es{constructor(e,t){this.width=e??0,this.height=t??0}toString(){return`Size[${this.width}, ${this.height}]`}copy(){return new es(this.width,this.height)}equals(e){return this.width===e.width&&this.height===e.height}}es.Zero=new es;class ts{constructor(e,t,i){this.x=e??0,this.y=t??0,this.z=i??0}toString(){return`Point[${this.x}, ${this.y}, ${this.z}]`}copy(){return new ts(this.x,this.y,this.z)}equals(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}distanceToPoint(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)+Math.pow(this.z-e.z,2))}}ts.Zero=new ts;class is{constructor(e,t,i,s){this.origin=new ts(e,t),this.size=new es(i,s)}static rectFromClientRect(e){const{left:t,top:i,width:s,height:o}=e;return new is(t,i,s,o)}static unionOfRects(e){return e.reduce(((e,t)=>e._updateToUnion(t)),e[0].copy())}_update(e,t,i,s){return this.origin.x=e,this.origin.y=t,this.size.width=i,this.size.height=s,this}_updateToIntersect(e){const t=Math.max(this.minX(),e.minX()),i=Math.min(this.maxX(),e.maxX());if(t>i)return this._update(0,0,0,0);const s=Math.max(this.minY(),e.minY()),o=Math.min(this.maxY(),e.maxY());return s>o?this._update(0,0,0,0):this._update(t,s,i-t,o-s)}_updateToUnion(e){const t=Math.min(this.minX(),e.minX()),i=Math.min(this.minY(),e.minY()),s=Math.max(this.maxX(),e.maxX())-t,o=Math.max(this.maxY(),e.maxY())-i;return this._update(t,i,s,o)}toString(){const{x:e,y:t}=this.origin,{width:i,height:s}=this.size;return`Rect[${e}, ${t}, ${i}, ${s}]`}copy(){return new is(this.origin.x,this.origin.y,this.size.width,this.size.height)}equals(e){return this.origin.equals(e.origin)&&this.size.equals(e.size)}inset(e,t,i,s){return new is(this.origin.x+e,this.origin.y+t,this.size.width-e-i,this.size.height-t-s)}pad(e){return new is(this.origin.x-e,this.origin.y-e,this.size.width+2*e,this.size.height+2*e)}minX(){return this.origin.x}minY(){return this.origin.y}midX(){return this.origin.x+this.size.width/2}midY(){return this.origin.y+this.size.height/2}maxX(){return this.origin.x+this.size.width}maxY(){return this.origin.y+this.size.height}intersectionWithRect(e){return this.copy()._updateToIntersect(e)}unionWithRect(e){return this.copy()._updateToUnion(e)}round(){return new is(Math.floor(this.origin.x),Math.floor(this.origin.y),Math.ceil(this.size.width),Math.ceil(this.size.height))}}is.Zero=new is;class ss{constructor(e,t,i,s,o,n,a,r,l,h,c,d,u,p,m,g){this._data=os();const _="string"==typeof e,f=Array.isArray(e);if(_||f){const t="none"===e?[]:f?e:(e.match(/\bmatrix(?:3d)?\(([^)]+)\)/)?.[1]??"").split(",").map((e=>parseFloat(e)));16===t.length?(this.m11=t[0],this.m12=t[1],this.m13=t[2],this.m14=t[3],this.m21=t[4],this.m22=t[5],this.m23=t[6],this.m24=t[7],this.m31=t[8],this.m32=t[9],this.m33=t[10],this.m34=t[11],this.m41=t[12],this.m42=t[13],this.m43=t[14],this.m44=t[15]):6===t.length&&(this.a=t[0],this.b=t[1],this.c=t[2],this.d=t[3],this.e=t[4],this.f=t[5])}else{const _=void 0!==o&&void 0!==n,f=void 0!==e&&void 0!==t&&void 0!==i&&void 0!==s;f&&(_&&void 0!==a&&void 0!==r)&&(void 0!==l&&void 0!==h&&void 0!==c&&void 0!==d)&&(void 0!==u&&void 0!==p&&void 0!==m&&void 0!==g)?(this.m11=e,this.m12=t,this.m13=i,this.m14=s,this.m21=o,this.m22=n,this.m23=a,this.m24=r,this.m31=l,this.m32=h,this.m33=c,this.m34=d,this.m41=u,this.m42=p,this.m43=m,this.m44=g):f&&_&&(this.a=e,this.b=t,this.c=i,this.d=s,this.e=o,this.f=n)}}get a(){return this._data[0][0]}get b(){return this._data[0][1]}get c(){return this._data[1][0]}get d(){return this._data[1][1]}get e(){return this._data[3][0]}get f(){return this._data[3][1]}get m11(){return this._data[0][0]}get m12(){return this._data[0][1]}get m13(){return this._data[0][2]}get m14(){return this._data[0][3]}get m21(){return this._data[1][0]}get m22(){return this._data[1][1]}get m23(){return this._data[1][2]}get m24(){return this._data[1][3]}get m31(){return this._data[2][0]}get m32(){return this._data[2][1]}get m33(){return this._data[2][2]}get m34(){return this._data[2][3]}get m41(){return this._data[3][0]}get m42(){return this._data[3][1]}get m43(){return this._data[3][2]}get m44(){return this._data[3][3]}set a(e){this._data[0][0]=e}set b(e){this._data[0][1]=e}set c(e){this._data[1][0]=e}set d(e){this._data[1][1]=e}set e(e){this._data[3][0]=e}set f(e){this._data[3][1]=e}set m11(e){this._data[0][0]=e}set m12(e){this._data[0][1]=e}set m13(e){this._data[0][2]=e}set m14(e){this._data[0][3]=e}set m21(e){this._data[1][0]=e}set m22(e){this._data[1][1]=e}set m23(e){this._data[1][2]=e}set m24(e){this._data[1][3]=e}set m31(e){this._data[2][0]=e}set m32(e){this._data[2][1]=e}set m33(e){this._data[2][2]=e}set m34(e){this._data[2][3]=e}set m41(e){this._data[3][0]=e}set m42(e){this._data[3][1]=e}set m43(e){this._data[3][2]=e}set m44(e){this._data[3][3]=e}translate(e,t,i){e=e||0,t=t||0,i=i||0;const[s,o,n,a]=this._data[0],[r,l,h,c]=this._data[1],[d,u,p,m]=this._data[2];return this._data[3][0]+=e*s+t*r+i*d,this._data[3][1]+=e*o+t*l+i*u,this._data[3][2]+=e*n+t*h+i*p,this._data[3][3]+=e*a+t*c+i*m,this}scale(e,t,i){return e=e||1,t=t||e,i=i||1,this._data[0][0]*=e,this._data[0][1]*=e,this._data[0][2]*=e,this._data[0][3]*=e,this._data[1][0]*=t,this._data[1][1]*=t,this._data[1][2]*=t,this._data[1][3]*=t,this._data[2][0]*=i,this._data[2][1]*=i,this._data[2][2]*=i,this._data[2][3]*=i,this}rotate(e){return this.rotateAxisAngle(0,0,1,e)}rotateAxisAngle(e,t,i,s){0===e&&0===t&&0===i&&(i=1);const o=Math.sqrt(e*e+t*t+i*i);1!==o&&(e/=o,t/=o,i/=o),s=ns(s);const n=Math.sin(s),a=Math.cos(s),r=new ss;if(1===e&&0===t&&0===i)r._data[0][0]=1,r._data[0][1]=0,r._data[0][2]=0,r._data[1][0]=0,r._data[1][1]=a,r._data[1][2]=n,r._data[2][0]=0,r._data[2][1]=-n,r._data[2][2]=a,r._data[0][3]=r._data[1][3]=r._data[2][3]=0,r._data[3][0]=r._data[3][1]=r._data[3][2]=0,r._data[3][3]=1;else if(0===e&&1===t&&0===i)r._data[0][0]=a,r._data[0][1]=0,r._data[0][2]=-n,r._data[1][0]=0,r._data[1][1]=1,r._data[1][2]=0,r._data[2][0]=n,r._data[2][1]=0,r._data[2][2]=a,r._data[0][3]=r._data[1][3]=r._data[2][3]=0,r._data[3][0]=r._data[3][1]=r._data[3][2]=0,r._data[3][3]=1;else if(0===e&&0===t&&1===i)r._data[0][0]=a,r._data[0][1]=n,r._data[0][2]=0,r._data[1][0]=-n,r._data[1][1]=a,r._data[1][2]=0,r._data[2][0]=0,r._data[2][1]=0,r._data[2][2]=1,r._data[0][3]=r._data[1][3]=r._data[2][3]=0,r._data[3][0]=r._data[3][1]=r._data[3][2]=0,r._data[3][3]=1;else{const s=1-a;r._data[0][0]=a+e*e*s,r._data[0][1]=t*e*s+i*n,r._data[0][2]=i*e*s-t*n,r._data[1][0]=e*t*s-i*n,r._data[1][1]=a+t*t*s,r._data[1][2]=i*t*s+e*n,r._data[2][0]=e*i*s+t*n,r._data[2][1]=t*i*s-e*n,r._data[2][2]=a+i*i*s,r._data[0][3]=r._data[1][3]=r._data[2][3]=0,r._data[3][0]=r._data[3][1]=r._data[3][2]=0,r._data[3][3]=1}return this.multiply(r)}multiply(e){const[t,i,s,o]=e._data[0],[n,a,r,l]=e._data[1],[h,c,d,u]=e._data[2],[p,m,g,_]=e._data[3],[f,y,v,b]=this._data[0],[w,C,k,M]=this._data[1],[S,L,x,A]=this._data[2],[E,T,I,O]=this._data[3];return this._data[0][0]=t*f+i*w+s*S+o*E,this._data[0][1]=t*y+i*C+s*L+o*T,this._data[0][2]=t*v+i*k+s*x+o*I,this._data[0][3]=t*b+i*M+s*A+o*O,this._data[1][0]=n*f+a*w+r*S+l*E,this._data[1][1]=n*y+a*C+r*L+l*T,this._data[1][2]=n*v+a*k+r*x+l*I,this._data[1][3]=n*b+a*M+r*A+l*O,this._data[2][0]=h*f+c*w+d*S+u*E,this._data[2][1]=h*y+c*C+d*L+u*T,this._data[2][2]=h*v+c*k+d*x+u*I,this._data[2][3]=h*b+c*M+d*A+u*O,this._data[3][0]=p*f+m*w+g*S+_*E,this._data[3][1]=p*y+m*C+g*L+_*T,this._data[3][2]=p*v+m*k+g*x+_*I,this._data[3][3]=p*b+m*M+g*A+_*O,this}skewX(e){return this._skew(e,0)}skewY(e){return this._skew(0,e)}isAffine(){return 0===this._data[0][2]&&0===this._data[0][3]&&0===this._data[1][2]&&0===this._data[1][3]&&0===this._data[2][0]&&0===this._data[2][1]&&1===this._data[2][2]&&0===this._data[2][3]&&0===this._data[3][2]&&1===this._data[3][3]}inverse(){if(this._isIdentityOrTranslation())return 0===this._data[3][0]&&0===this._data[3][1]&&0===this._data[3][2]||(this._data[3][0]*=-1,this._data[3][1]*=-1,this._data[3][2]*=-1),this;const e=new ss;return ss._inverse(this,e)?e:new ss}transformPoint(e){const[t,i,s]=this._data[0],[o,n,a]=this._data[1],[r,l,h]=this._data[2],[c,d,u]=this._data[3],{x:p,y:m,z:g}=e;return new ts(t*p+o*m+r*g+c,i*p+n*m+l*g+d,s*p+a*m+h*g+u)}toString(){if(this.isAffine()){const[e,t]=this._data[0],[i,s]=this._data[1],[o,n]=this._data[3];return`matrix(${e}, ${t}, ${i}, ${s}, ${o}, ${n})`}return`matrix3d(${this._data.map((e=>e.join(", "))).join(", ")})`}_isIdentityOrTranslation(){return 1===this._data[0][0]&&0===this._data[0][1]&&0===this._data[0][2]&&0===this._data[0][3]&&0===this._data[1][0]&&1===this._data[1][1]&&0===this._data[1][2]&&0===this._data[1][3]&&0===this._data[2][0]&&0===this._data[2][1]&&1===this._data[2][2]&&0===this._data[2][3]&&1===this._data[3][3]}_skew(e,t){const i=new ss;return i._data[0][1]=Math.tan(ns(t)),i._data[1][0]=Math.tan(ns(e)),this.multiply(i)}_determinant(){const[e,t,i,s]=this._data[0],[o,n,a,r]=this._data[1],[l,h,c,d]=this._data[2],[u,p,m,g]=this._data[3];return e*rs(n,h,p,a,c,m,r,d,g)-t*rs(o,l,u,a,c,m,r,d,g)+i*rs(o,l,u,n,h,p,r,d,g)-s*rs(o,l,u,n,h,p,a,c,m)}static _inverse(e,t){ss._adjoint(e,t);const i=e._determinant();if(Math.abs(i)<1e-8)return!1;for(let e=0;e<4;e+=1)for(let s=0;s<4;s+=1)t._data[e][s]=t._data[e][s]/i;return!0}static _adjoint(e,t){const[i,s,o,n]=e._data[0],[a,r,l,h]=e._data[1],[c,d,u,p]=e._data[2],[m,g,_,f]=e._data[3];t._data[0][0]=+rs(r,d,g,l,u,_,h,p,f),t._data[1][0]=-rs(a,c,m,l,u,_,h,p,f),t._data[2][0]=+rs(a,c,m,r,d,g,h,p,f),t._data[3][0]=-rs(a,c,m,r,d,g,l,u,_),t._data[0][1]=-rs(s,d,g,o,u,_,n,p,f),t._data[1][1]=+rs(i,c,m,o,u,_,n,p,f),t._data[2][1]=-rs(i,c,m,s,d,g,n,p,f),t._data[3][1]=+rs(i,c,m,s,d,g,o,u,_),t._data[0][2]=+rs(s,r,g,o,l,_,n,h,f),t._data[1][2]=-rs(i,a,m,o,l,_,n,h,f),t._data[2][2]=+rs(i,a,m,s,r,g,n,h,f),t._data[3][2]=-rs(i,a,m,s,r,g,o,l,_),t._data[0][3]=-rs(s,r,d,o,l,u,n,h,p),t._data[1][3]=+rs(i,a,c,o,l,u,n,h,p),t._data[2][3]=-rs(i,a,c,s,r,d,n,h,p),t._data[3][3]=+rs(i,a,c,s,r,d,o,l,u)}}const os=()=>[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],ns=e=>e/180*Math.PI,as=(e,t,i,s)=>e*s-t*i,rs=(e,t,i,s,o,n,a,r,l)=>e*as(o,n,r,l)-s*as(t,i,r,l)+a*as(t,i,o,n);function ls(e){const t=e.getBoundingClientRect(),i=e.offsetWidth,s=e.offsetHeight,o=[new ts(0,0),new ts(i,0),new ts(i,s),new ts(0,s)];let n=new ss;const a=e.ownerDocument.defaultView;let r,l=e;for(;l.nodeType===Node.ELEMENT_NODE&&(r=a.getComputedStyle(e),n=new ss(r.transform).multiply(n),l.parentNode);)l=l.parentNode;let h=1/0,c=1/0;o.forEach((function(e){const t=n.transformPoint(e);h=Math.min(h,t.x),c=Math.min(c,t.y)}));const d=window.pageXOffset+t.left-h,u=window.pageYOffset+t.top-c;return(new ss).translate(d,u).multiply(n)}const hs=function(e,t){return ls(e).inverse().transformPoint(t)},cs=function(e,t){return ls(e).transformPoint(t)},ds=hs;let us=[],ps=!1;function ms(){const e=us;us=[];const t=[];for(let i=0,s=e.length;i<s;++i){const s=e[i].scene;if(s&&gs(t,s)){const e=s.performanceMeasureName?performance.now():void 0;s.renderer.update(),s.performanceMeasureName&&performance.measure(s.performanceMeasureName,{start:e}),s.sceneDidUpdate&&s.sceneDidUpdate(s,ps)}}}function gs(e,t){return-1===e.indexOf(t)&&(e.push(t),!0)}const _s={scheduleNode(e){gs(us,e)&&1===us.length&&bt.scheduleDraw(ms)},flush(e){ps=!0;const t=us;us=[];const i=[];for(let s=0,o=t.length;s<o;++s)t[s].scene===e?us.push(t[s]):i.push(t[s]);ms(),ps=!1,us=i}};function fs(e,t){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.add(e)}function ys(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function vs(e,t,i){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return i}const bs=(new ss).toString();var ws=new WeakSet;class Cs{constructor(){fs(this,ws),ys(this,"_parent",null),ys(this,"_children",[]),ys(this,"_renderer",null),ys(this,"_opacity",1),ys(this,"_size",new es),ys(this,"_position",new ts),ys(this,"_transform",new ss),ys(this,"_frozen",!1),ys(this,"_keyForFrozenLayer",""),ys(this,"_wantsLayerBacking",!1),ys(this,"animators",void 0),ys(this,"repeatOffset",void 0),ys(this,"isScene",!1),ys(this,"_element",void 0)}get element(){return this._element}set element(e){this._element=e}stringInfo(){return"BaseNode"}extraInfo(){return[]}get scene(){let e;for(e=this;e;e=e._parent)if(e.isScene)return e}get renderer(){return this._renderer}get wantsLayerBacking(){return!!this.keyForFrozenLayer||this._frozen||this._wantsLayerBacking||this._needsLayerBacking()}set wantsLayerBacking(e){e!==this._wantsLayerBacking&&(this._wantsLayerBacking=e,this.needsDisplay=!0)}get frozen(){return!!this.keyForFrozenLayer||this._frozen}set frozen(e){e!==this._frozen&&(this._frozen=e,this.needsDisplay=!0)}get keyForFrozenLayer(){return this._keyForFrozenLayer}set keyForFrozenLayer(e){e!==this._keyForFrozenLayer&&(this._keyForFrozenLayer=e,this.needsDisplay=!0)}get opacity(){return this._opacity}set opacity(e){(e=Math.min(Math.max(0,e),1))!==this._opacity&&(this._opacity=e,this.needsDisplay=!0)}get position(){return this._position}set position(e){e.equals(this._position)||(this._position=e.copy(),this.needsDisplay=!0)}get transform(){return this._transform}set transform(e){this._transform=e,this.needsDisplay=!0}get size(){return this._size}set size(e){this._size=e||new es,this.needsDisplay=!0}get bounds(){return new is(this._position.x,this._position.y,this.size.width,this.size.height)}get layerBounds(){let e=new is(0,0,this.size.width,this.size.height);const t=this._children;for(let i=0,s=t.length;i<s;++i){const s=t[i],o=s.layerBounds;o.origin.x+=s._position.x,o.origin.y+=s._position.y;const n=s.transform,a=[n.transformPoint(new ts(o.minX(),o.minY())),n.transformPoint(new ts(o.maxX(),o.minY())),n.transformPoint(new ts(o.maxX(),o.maxY())),n.transformPoint(new ts(o.minX(),o.maxY()))];let r=a[0].x,l=a[0].y,h=a[0].x,c=a[0].y;for(let e=1;e<a.length;++e){const t=a[e];t.x<r&&(r=t.x),t.x>h&&(h=t.x),t.y<l&&(l=t.y),t.y>c&&(c=t.y)}e=e.unionWithRect(new is(r,l,h-r,c-l))}return e}set needsDisplay(e){e&&_s.scheduleNode(this)}get parent(){return this._parent}get children(){return this._children}set children(e){let t=0,i=0;const s=[...this._children];for(;t<e.length;)s[i]!==e[t]?s[i]&&-1===e.indexOf(s[i])?(this.removeChild(s[i]),i++):(e[t]._parent===this&&s.splice(s.indexOf(e[t]),1),this.addChild(e[t],t),t++):(t++,i++);for(;i<s.length;)this.removeChild(s[i]),i++}get childCount(){return this._children.length}get firstChild(){return this._children[0]||null}get lastChild(){return this._children[this._children.length-1]||null}get previousSibling(){if(!this._parent)return null;const e=this._parent._children,t=e.indexOf(this);return t>0?e[t-1]:null}get nextSibling(){if(!this._parent)return null;const e=this._parent._children,t=e.indexOf(this);return-1!==t&&t<e.length-1?e[t+1]:null}isTainted(){return this._children.some((e=>e.isTainted()))}toString(){let e="";return this.element&&(e+="ð· "),this.wantsLayerBacking&&(e+="ð "),this.frozen&&(e+="âï¸ ",this.keyForFrozenLayer&&(e+="<"+this.keyForFrozenLayer+">")),this.stringInfo&&"function"==typeof this.stringInfo?e+=this.stringInfo():e+="UnknownNode",0===this.position.x&&0===this.position.y||(e+=" ("+this.position.x+", "+this.position.y+")"),"number"==typeof this.repeatOffset&&(e+=(this.repeatOffset>0?"+":"")+this.repeatOffset+" "),0===this.size.width&&0===this.size.height||(e+=" "+this.size.width+"x"+this.size.height),1!==this.opacity&&(e+=" [opacity:"+this.opacity+"]"),this.transform.toString()!==bs&&(e+=" ["+this.transform.toString()+"]"),this.animators&&this.animators.forEach((t=>{e+=" "+t.stringInfo()})),e}dump(e,t){return void 0===e&&(e=1/0),Ss(this,"",-1,e,!!t)}addChild(e,t){return e.remove(),(void 0===t||t<0||t>this._children.length)&&(t=this._children.length),this._children.splice(t,0,e),e._parent=this,this.needsDisplay=!0,e}insertBefore(e,t){return this.addChild(e,this._children.indexOf(t))}insertAfter(e,t){return this.addChild(e,this._children.indexOf(t)+1)}removeChild(e){if(e._parent!==this)return;const t=this._children.indexOf(e);return-1!==t?(this._children.splice(t,1),vs(this,ws,ks).call(this,e),this.needsDisplay=!0,e):void 0}replaceChild(e,t){if(!t||t._parent!==this)return;const i=this._children.indexOf(t);return e.remove(),this._children.splice(i,1,e),vs(this,ws,ks).call(this,t),e._parent=this,this.needsDisplay=!0,t}remove(){if(this._parent instanceof Cs)return this._parent.removeChild(this)}wasRemoved(){}convertPointFromPage(e){if(this.element)return hs(this.element,e);const t=Ms(this),i=hs(t.element,e);return new ts(i.x+t.offsetX,i.y+t.offsetY)}convertPointToPage(e){if(this.element)return cs(this.element,e);const t=Ms(this),i=cs(t.element,e);return new ts(i.x-t.offsetX,i.y-t.offsetY)}_needsLayerBacking(){return this.opacity<1&&(this._children.length>1||1===this._children.length&&this._children[0]._children.length>0)}}function ks(e){e._parent=null;const t=[e];for(;t.length>0;){const e=t.pop();e&&(e.wasRemoved(),e._renderer&&"function"==typeof e._renderer.nodeWasRemoved&&e._renderer.nodeWasRemoved(),t.push(...e.children))}}function Ms(e){let t,i=0,s=0,o=e;for(;o&&!t;){const e=o.transform.transformPoint(o.position);i-=e.x,s-=e.y,o=o.parent,t=o?.element}if(!t)throw new Error("Couldn't find nodes element. Expected that at least scene will have one.");return{element:t,offsetX:i,offsetY:s}}function Ss(e,t,i,s,o){let n="";if(n+=t,o&&(n+=function(e){return e<0?"":e+":"}(i)),n+=e.toString(),n+=function(e){return e.childCount<1?"":" â¤µï¸ "+e.childCount}(e),e.extraInfo&&"function"==typeof e.extraInfo&&e.extraInfo().forEach((e=>{n+="\n"+t+"| "+e})),0===s)return n;const a=e.children;for(let i=0,r=a.length;i<r;++i){const r=e.childCount<1?-1:i;n+="\n",n+=Ss(a[i],t+"    ",r,s-1,o)}return n}const Ls=Cs,xs=Object.freeze({Dark:"dark",Light:"light"}),As=Object.freeze({NETWORK_ERROR:"NETWORK_ERROR",BROWSER_SUPPORT_ERROR:"BROWSER_SUPPORT_ERROR",FEATURE_ERROR:"FEATURE_ERROR",UNKNOWN_ERROR:"UNKNOWN_ERROR",CONFIG_CHANGE:"CONFIGURATION_CHANGE_FALLBACK",CONFIG_MISSING:"CONFIGURATION_MISSING_FALLBACK"}),Es=Object.freeze({blue:[0,122,255],green:[52,199,89],indigo:[88,86,214],orange:[255,149,0],pink:[255,45,85],purple:[175,82,222],red:[255,59,48],teal:[90,200,250],yellow:[255,204,0],gray:[142,142,147],gray2:[174,174,178],gray3:[199,199,204],gray4:[209,209,214],gray5:[229,229,234],gray6:[242,242,247]}),Ts=Object.freeze({blue:[10,132,255],green:[48,209,88],indigo:[94,92,230],orange:[255,159,10],pink:[255,55,95],purple:[191,90,242],red:[255,69,58],teal:[100,210,255],yellow:[255,214,10],gray:[142,142,147],gray2:[99,99,102],gray3:[72,72,74],gray4:[58,58,60],gray5:[44,44,46],gray6:[28,28,30]}),Is=Object.freeze({Satellite:"satellite",Hybrid:"hybrid",MutedStandard:"mutedStandard",Standard:"standard"}),Os=Object.freeze({Hybrid:"46",Standard:"1"}),Rs=(Object.freeze({WebGL:"webgl",WebGL2:"webgl2"}),Object.freeze({Adaptive:"adaptive",Metric:"metric",Imperial:"imperial"})),Ps=Object.freeze({BaseMap:"basemap",Roads:"roads",Borders:"borders",Buildings:"buildings",Icons:"icons",Labels:"labels"}),Ds=Object.freeze({Normal:"normal",Multiply:"multiply",HardLight:"hard-light",SoftLight:"soft-light"}),zs=Object.freeze({Normal:"normal",Grayscale:"grayscale"}),Ns=Object.freeze({LandCover:"LandCover",PointsOfInterest:"PointsOfInterest",None:null}),Fs=Object.freeze({Muted:"muted",Standard:"standard"}),Us=Object.freeze({Adaptive:"adaptive",Hidden:"hidden",Visible:"visible"}),Gs=Object.freeze({default:Es,light:Es,dark:Ts}),Bs='"SFProRegular", "-apple-system", "BlinkMacSystemFont", "Helvetica Neue", Helvetica, Arial, sans-serif',Ws=Object.freeze({Button:"BUTTON",Scroll:"SCROLL",DoubleTap:"DOUBLE_TAP",Pinch:"PINCH"}),Zs={minimumSizeToShowControls:new es(306,220),minimumSizeToShowLogo:new es(200,100),minimumSizeToShowLogoWithReducedMargin:new es(100,100),maximumSizeControlsNormal:new es(1024,0)};class Ks{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}toString(){const{x:e,y:t,z:i}=this;return!e||t||i?!t||e||i?!i||e||t?i?`translate3d(${e}px, ${t}px, ${i}px)`:`translate(${e}px, ${t}px)`:`translateZ(${i}px)`:`translateY(${t}px)`:`translateX(${e}px)`}}class js{constructor(e=1,t=e,i=1){this.x=e,this.y=t,this.z=i}toString(){const{x:e,y:t,z:i}=this;return 1!==e&&1===t&&1===i?`scaleX(${e})`:1!==t&&1===e&&1===i?`scaleY(${t})`:1!==i&&1===e&&1===t?`scaleZ(${i})`:1===i&&e===t?`scale(${e})`:1===i?`scale(${e}, ${t})`:`scale3d(${e}, ${t}, ${i})`}}class Hs{constructor(e=0){this.angle=e}toString(){return`rotate(${this.angle}deg)`}}class Vs{constructor(e=0,t=0){this.x=e,this.y=t}toString(){const{x:e,y:t}=this;return 0!==e&&0===t?`skewX(${e}deg)`:0!==t&&0===e?`skewY(${t}deg)`:`skew(${e}deg, ${t}deg)`}}class qs{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.angle=s}toString(){return`rotate3d(${this.x}, ${this.y}, ${this.z}, ${this.angle}deg)`}}const Ys=class{constructor(){this._operations=[]}translate(e=0,t=0,i=0){return this._operations.push(new Ks(e,t,i)),this}scale(e=1,t=e,i=1){return this._operations.push(new js(e,t,i)),this}rotate(e=0){return this._operations.push(new Hs(e)),this}rotate3d(e=0,t=0,i=0,s=0){return this._operations.push(new qs(e,t,i,s)),this}skew(e=0,t=0){return this._operations.push(new Vs(e,t)),this}transform(e){return Array.isArray(e)?this._operations.push(...e):this._operations.push(e),this}toString(){return this._operations.map((e=>e.toString())).join(" ")}};let Xs=[],$s=[];const Js=Object.freeze({None:0,Removal:1,Addition:2,AttachAsShadowRoot:3});let Qs;class eo{constructor(){this._parent=null,this._children=[],this._dirtyAttributes={},this._dirtyProperties=[],this._doNotNotifyParentChange=!1,this.domNode=null,this.nodeIsShadowRoot=!1}get parent(){return this._parent}get children(){return this._children}set children(e){const t=this._children;for(;t.length;)this.removeChild(t[0]);e.forEach((e=>{this.addChild(e)}))}get childCount(){return this._children.length}get firstChild(){return this._children[0]||null}get lastChild(){return this._children[this._children.length-1]||null}get previousSibling(){if(!this._parent)return null;const e=this._parent._children,t=e.indexOf(this);return t>0?e[t-1]:null}get nextSibling(){if(!this._parent)return null;const e=this._parent._children,t=e.indexOf(this);return-1!==t&&t<e.length-1?e[t+1]:null}addChild(e,t){if(0===t&&this._children[0]&&this._children[0].nodeIsShadowRoot)throw new TypeError("RenderTree.RenderNode.addChild: Node cannot insert before shadow root node.");return e.willMoveToParent(this),e._doNotNotifyParentChange=!0,e.remove(),delete e._doNotNotifyParentChange,(void 0===t||t<0||t>this._children.length)&&(t=this._children.length),this._children.splice(t,0,e),e._parent=this,e.didMoveToParent(this),this.didAddChild(e),e._markNodeManipulation(Js.Addition),e}insertBefore(e,t){return this.addChild(e,t?this._children.indexOf(t):-1)}insertAfter(e,t){const i=t?this._children.indexOf(t):-1;return this.addChild(e,-1!==i?i+1:0)}removeChild(e){if(e._parent!==this)return;const t=this._children.indexOf(e);if(-1!==t){if(e.nodeIsShadowRoot)throw new TypeError("RenderTree.RenderNode: Not supported in ShadowRoot-backed RenderNode.");return this.willRemoveChild(e),e._doNotNotifyParentChange||e.willMoveToParent(null),this._children.splice(t,1),e._parent=null,e._doNotNotifyParentChange||e.didMoveToParent(null),e._markNodeManipulation(Js.Removal),e}}remove(){if(this._parent instanceof eo)return this._parent.removeChild(this)}dump(e){return ho(this,"",-1,e)}willRemoveChild(e){}didAddChild(e){}willMoveToParent(e){}didMoveToParent(e){}_markDirtyProperty(e,t){let i;i=void 0===t||t?ro(this._dirtyProperties,e):lo(this._dirtyProperties,e),i&&this._updateNodeDirtiness()}_markNodeManipulation(e){this._pendingDOMManipulation=e,this._updateNodeDirtiness()}_updateNodeDirtiness(){var e;e=this,this._pendingDOMManipulation!==Js.None||this._dirtyProperties.length>0||Object.getOwnPropertyNames(this._dirtyAttributes).length>0?(ro(Xs,e),bt.scheduleDraw(so)):lo(Xs,e)}}class to extends eo{constructor(e){super(),this.shadowRootMode=e,this.nodeIsShadowRoot=!0}toString(){return this.stringInfo()+" ["+this.shadowRootMode+"]"}stringInfo(){return"#shadow-root"}}class io extends eo{constructor(e){let t;if(super(),e instanceof HTMLElement||e instanceof SVGElement)t=e;else{if(void 0!==e)throw new Error;t=document.createElement("div")}this.domNode=t,this._opacity=1,this._color="",this._size=new es,this._position=new ts,this._transform=new Ys,this._backgroundImages=[],this._classList=new co(this),this._wantsHardwareCompositing=!1,this._pendingDOMManipulation=Js.None}get element(){return this.domNode}set element(e){this.domNode=e}get classList(){return this._classList}get wantsHardwareCompositing(){return this._wantsHardwareCompositing}set wantsHardwareCompositing(e){e!==this._wantsHardwareCompositing&&(this._wantsHardwareCompositing=e,this._markDirtyProperty("will-change"))}get opacity(){return this._opacity}set opacity(e){(e=Math.min(Math.max(0,e),1))!==this._opacity&&(this._opacity=e,this._markDirtyProperty("opacity"))}get color(){return this._color}set color(e){e!==this._color&&(this._color=e,this._markDirtyProperty("color"))}get position(){return this._position}set position(e){this._position=e,this._markDirtyProperty("position")}get transform(){return this._transform}set transform(e){this._transform=e,this._markDirtyProperty("transform")}get backgroundImages(){return this._backgroundImages}set backgroundImages(e){this._backgroundImages=e||[],this._markDirtyProperty("backgroundImages")}get size(){return this._size}set size(e){this._size=e||new es,this._markDirtyProperty("size")}setAttribute(e,t){if(this.domNode instanceof Text)throw new Error("");this._dirtyAttributes[e]=t,this._updateNodeDirtiness()}removeAttribute(e){if(this.domNode instanceof Text)throw new Error("");this._dirtyAttributes[e]=null,this._updateNodeDirtiness()}createAndAddShadowRootChild(e){if(this.domNode instanceof Text||this.domNode instanceof SVGElement)throw new Error("");if(this._children[0]&&this._children[0].nodeIsShadowRoot)throw new Error("RenderTree.RenderNode.createAndAddShadowRootChild: Cannot add more than one shadow root.");const t=new to(e||"closed");return this._children.unshift(t),t._parent=this,this.didAddChild(t),t._markNodeManipulation(Js.AttachAsShadowRoot),t}convertPointFromPage(e){if(!(this.domNode instanceof HTMLElement))throw new Error("");return hs(this.domNode,e)}convertPointToPage(e){if(!(this.domNode instanceof HTMLElement))throw new Error("");return cs(this.domNode,e)}toString(){let e="";return this._wantsHardwareCompositing&&(e+="ð "),e+=this.stringInfo(),this.classList.toString()&&(e+=this.classList._classes().map((e=>"."+e)).join(", ")),0===this.position.x&&0===this.position.y||(e+=" ("+this.position.x+", "+this.position.y+")"),0===this.size.width&&0===this.size.height||(e+=" "+this.size.width+"x"+this.size.height),1!==this.opacity&&(e+=" [opacity:"+this.opacity+"]"),this.transform.toString()&&(e+=" ["+this.transform.toString()+"]"),e}stringInfo(){return"<"+this.domNode.tagName.toLowerCase()+">"}}function so(){const e=Qs?performance.now():void 0;Xs.forEach(oo),Xs=[],$s.forEach(no),$s=[],io.updates++,uo.dispatchEvent(new O("update")),Qs&&performance.measure(Qs,{start:e})}function oo(e){if(e._pendingDOMManipulation===Js.Removal){const t=e.domNode?.parentNode;t&&e.domNode&&t.removeChild(e.domNode)}if(e._dirtyProperties){const t=e;t._dirtyProperties.forEach((e=>{!function(e,t){const i=e.domNode;if(!(i instanceof HTMLElement||i instanceof SVGElement))return;const s=i.style;switch(t){case"opacity":s.opacity=e._opacity.toString();break;case"color":s.color=e._color;break;case"size":s.width=e._size.width+"px",s.height=e._size.height+"px";break;case"will-change":s.willChange=e._wantsHardwareCompositing?"transform":"";break;case"position":case"transform":{const t=(new Ys).translate(ao(e._position.x),ao(e._position.y)).transform(e._transform.toString());s.transform=t.toString();break}case"backgroundImages":!function(e){if(!(e.domNode instanceof HTMLElement||e.domNode instanceof SVGElement))return;const t=e.domNode.style;if(!e._backgroundImages.length)return t.removeProperty("background-image"),t.removeProperty("background-position"),void t.removeProperty("background-size");const i=[],s=[],o=[],n=e._backgroundImages;for(let e=n.length-1;e>=0;--e){const t=n[e];i.push("url("+t.url+")"),s.push(t.position.x+"px "+t.position.y+"px"),o.push(t.size.width+"px "+t.size.height+"px")}t.backgroundImage=i.join(","),t.backgroundPosition=s.join(","),t.backgroundSize=o.join(",")}(e);break;case"classList":i.setAttribute("class",e._classList.toString()),e._classList.reset();break;default:;}}(t,e)})),t._dirtyProperties=[]}if(e._dirtyAttributes){const t=e.domNode;Object.getOwnPropertyNames(e._dirtyAttributes).forEach((i=>{const s=e._dirtyAttributes[i];null===s?t.removeAttribute(i):t.setAttribute(i,s)})),e._dirtyAttributes={}}e._pendingDOMManipulation!==Js.Addition&&e._pendingDOMManipulation!==Js.AttachAsShadowRoot||ro($s,e.parent)}function no(e){let t=null;const i=e.domNode;for(let s=e.children.length-1;s>=0;--s){const o=e.children[s],n=o.domNode;switch(o._pendingDOMManipulation){case Js.Addition:i.insertBefore(n,t),o._pendingDOMManipulation=Js.None;break;case Js.AttachAsShadowRoot:{const e=i.attachShadow({mode:o.shadowRootMode});o.domNode=e,o._pendingDOMManipulation=Js.None;break}}t=n}}function ao(e){const t=Math.max(Math.round(window.devicePixelRatio),1);return Math.round(e*t)/t}function ro(e,t){return-1===e.indexOf(t)&&(e.push(t),!0)}function lo(e,t){const i=e.indexOf(t);return-1!==i&&(e.splice(i,1),!0)}function ho(e,t,i,s){let o="";o+=t,s&&(o+=function(e){return e<0?"":e+":"}(i)),o+=e.toString(),o+=function(e){return e.childCount<1?"":" â¤µï¸ "+e.childCount}(e);const n=e.children;for(let i=0,a=n.length;i<a;++i){const a=e.childCount<1?-1:i;o+="\n",o+=ho(n[i],t+"    ",a,s)}return o}io.updates=0;class co{constructor(e){this._node=e,this._additions=[],this._removals=[],this.__classes=[],this._populateClasses=!0}add(e){this._add(e)}remove(e){this._remove(e)}contains(e){return-1!==this._classes().indexOf(e)}toggle(e,t){if(arguments.length>1)return t?this._add(e):this._remove(e),!!t;this._add(e)||this._remove(e)}toString(){return this._classes().join(" ")}_classes(){if(this._populateClasses){let e=this._node.domNode instanceof HTMLElement||this._node.domNode instanceof SVGElement?this._node.domNode.className:"";"string"==typeof e.baseVal&&(e=e.baseVal),this.__classes=e.split(/[ ]+/).filter(Boolean),delete this._populateClasses}return this.__classes}reset(){this._additions=[],this._removals=[],this.__classes=[],this._populateClasses=!0}_add(e){if(!e)return!1;const t=ro(this._classes(),e);return t&&(lo(this._removals,e)||ro(this._additions,e),this._updateNodeDirtiness()),t}_remove(e){if(!e)return!1;const t=lo(this._classes(),e);return t&&(lo(this._additions,e)||ro(this._removals,e),this._updateNodeDirtiness()),t}_updateNodeDirtiness(){this._node._markDirtyProperty("classList",this._additions.length>0||this._removals.length>0)}}const uo=new class extends I{constructor(){super(),this.Node=io,this.Point=ts,this.Transform=Ys}setPerformanceMeasureName(e){Qs=e}},po=uo;class mo extends R{constructor(){super(),this.modifierKeys={alt:!1,ctrl:!1,meta:!1,shift:!1},this.useGestures=!1,this._targetTouches=[],this._lastKnownEventLocation=null,this._shouldHandleTrackingEvents=!1,this._domEvents=[],this.events=void 0,this._mode=void 0,this.mode=mo.Modes.Adaptive,this._enabled=!0,this._target=null,this.state=mo.States.Possible,this.delegate=null}get mode(){return this._mode}set mode(e){if(this._mode!==e){if(this._targetTouches.length)throw new Error("");switch(this._removeBaseListeners(),e){case mo.Modes.Adaptive:mo.SupportsPointerEvents?this.events=wo.Pointer:mo.SupportsTouches?this.events=wo.Touch:this.events=wo.Mouse;break;case mo.Modes.Pointer:this.events=wo.Pointer;break;case mo.Modes.Touch:this.events=wo.Touch;break;case mo.Modes.Mouse:this.events=wo.Mouse}this._mode=e,this._updateBaseListeners()}}get currentMode(){if(this._mode===mo.Modes.Adaptive)switch(this.events){case wo.Pointer:return mo.Modes.Pointer;case wo.Touch:return mo.Modes.Touch;case wo.Mouse:return mo.Modes.Mouse}return this._mode}get target(){return this._target}set target(e){this._target!==e&&(this._removeBaseListeners(),e&&(this._target=e,this._initRecognizer()))}get numberOfTouches(){return this._targetTouches.length}get enabled(){return this._enabled}set enabled(e){this._enabled!==e&&(this._enabled=e,e||(0===this.numberOfTouches?(this._removeTrackingListeners(),this.reset()):this.enterCancelledState()),this._updateBaseListeners())}get domEvents(){return this._domEvents}reset(){}preventDefault(e){"touchmove"!==e.type&&"pointer"!==e.type.substr(0,7)&&e.preventDefault()}locationInElement(e){const t=new ts,i=this._targetTouches;if(this._lastKnownEventLocation)t.x=this._lastKnownEventLocation.pageX,t.y=this._lastKnownEventLocation.pageY;else{const e=i.length;for(let s=0;s<e;++s){const e=i[s];t.x+=e.pageX,t.y+=e.pageY}t.x/=e,t.y/=e}return e?ds(e,t):t}locationInClient(){const e=new ts,t=this._targetTouches;if(this._lastKnownEventLocation)e.x=this._lastKnownEventLocation.clientX,e.y=this._lastKnownEventLocation.clientY;else{const i=t.length;for(let s=0;s<i;++s){const i=t[s];e.x+=i.clientX,e.y+=i.clientY}e.x/=i,e.y/=i}return e}locationOfTouchInElement(e,t){const i=this._targetTouches[e];if(!i)return new ts;const s=new ts(i.pageX,i.pageY);return t?ds(t,s):s}touchesBegan(e){e.currentTarget===this._target&&(this._shouldHandleTrackingEvents=!0,window.addEventListener(this.events.Move,this,!0),window.addEventListener(this.events.End,this,!0),this.events.Cancel&&window.addEventListener(this.events.Cancel,this,!0),this.enterPossibleState())}touchesMoved(e){}touchesEnded(e){}touchesCancelled(e){}gestureBegan(e){e.currentTarget===this._target&&(window.addEventListener(this.events.GestureChange,this,!0),window.addEventListener(this.events.GestureEnd,this,!0),this.enterPossibleState())}gestureChanged(e){}gestureEnded(e){}enterPossibleState(){this._setStateAndNotifyOfChange(mo.States.Possible)}enterBeganState(){!this.delegate||"function"!=typeof this.delegate.gestureRecognizerShouldBegin||this.delegate.gestureRecognizerShouldBegin(this)?this._setStateAndNotifyOfChange(mo.States.Began):this.enterFailedState()}enterEndedState(){this._setStateAndNotifyOfChange(mo.States.Ended),this._removeTrackingListeners(),this.reset()}enterCancelledState(){this._setStateAndNotifyOfChange(mo.States.Cancelled),this._removeTrackingListeners(),this.reset()}enterFailedState(){this._setStateAndNotifyOfChange(mo.States.Failed),this._removeTrackingListeners(),this.reset()}enterChangedState(){this._setStateAndNotifyOfChange(mo.States.Changed)}enterRecognizedState(){this._setStateAndNotifyOfChange(mo.States.Recognized)}handleEvent(e){this._shouldCountAndHandleTouch(e)&&(this.lastEventTimeStamp=e.timeStamp,this._updateTargetTouches(e),this._updateKeyboardModifiers(e),this._handleTouches(e))}_handleTouches(e){if(this._shouldHandleTouch(e))switch(e.type){case this.events.Start:this.touchesBegan(e);break;case this.events.Move:this.touchesMoved(e);break;case this.events.End:this.touchesEnded(e);break;case this.events.Cancel:this.touchesCancelled(e);break;case this.events.GestureStart:this.gestureBegan(e);break;case this.events.GestureChange:this.gestureChanged(e);break;case this.events.GestureEnd:this.gestureEnded(e)}}_shouldCountAndHandleTouch(e){if(this.events!==wo.Pointer)return!0;if(!(e instanceof PointerEvent))return!0;const t=this._targetTouches[0];return!(t&&t instanceof PointerEvent&&e.pointerType!==t.pointerType&&t.pointerId!==e.pointerId)}_shouldHandleTouch(e){return this.events!==wo.Pointer||(e.type===this.events.Start||e.type===this.events.GestureStart||e.type===this.events.GestureChange||e.type===this.events.GestureEnd||this._shouldHandleTrackingEvents)}_initRecognizer(){this.reset(),this.state=mo.States.Possible,this._updateBaseListeners()}_removeBaseListeners(){this._target&&(this._target.removeEventListener(this.events.Start,this),this.useGestures&&this._target.removeEventListener(this.events.GestureStart,this),this.events===wo.Pointer&&(this._targetTouches=[],window.removeEventListener(this.events.End,this,!0),window.removeEventListener(this.events.Cancel,this,!0)))}_updateBaseListeners(){this._target&&(this._enabled?(this._target.addEventListener(this.events.Start,this),this.useGestures&&this._target.addEventListener(this.events.GestureStart,this),this.events===wo.Pointer&&(window.addEventListener(this.events.End,this,!0),window.addEventListener(this.events.Cancel,this,!0))):this._removeBaseListeners())}_removeTrackingListeners(){this._shouldHandleTrackingEvents=!1,window.removeEventListener(this.events.Move,this,!0),this.events!==wo.Pointer&&(window.removeEventListener(this.events.End,this,!0),this.events.Cancel&&window.removeEventListener(this.events.Cancel,this,!0)),window.removeEventListener(this.events.GestureChange,this,!0),window.removeEventListener(this.events.GestureEnd,this,!0)}_setStateAndNotifyOfChange(e){this.state=e,this.dispatchEvent(new P(this.events.StateChange))}_setLastKnownSinglePointLocation(e){this._lastKnownEventLocation={clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY}}_updateTargetTouches(e){if(e.type===this.events.GestureStart||e.type===this.events.GestureChange||e.type===this.events.GestureEnd){const t=e;return void this._setLastKnownSinglePointLocation(t)}if(this.events===wo.Mouse){const t=e;return void(e.type===this.events.End?(this._targetTouches=[],this._setLastKnownSinglePointLocation(t)):(this._targetTouches=[t],this._lastKnownEventLocation=null))}let t,i,s;if(this.events===wo.Touch){const o=e,n=this._targetTouches;if(o.type===this.events.Start){for(this._targetTouches=[],t=o.targetTouches,i=0,s=t.length;i<s;++i)this._targetTouches.push(t[i]);return void(this._lastKnownEventLocation=null)}if(o.type===this.events.Move){const e=n.map((e=>e.identifier));for(this._targetTouches=[],t=o.touches,i=0,s=t.length;i<s;++i){const s=t[i];-1!==e.indexOf(s.identifier)&&this._targetTouches.push(s)}return void(this._lastKnownEventLocation=null)}const a=o.touches,r=[];for(i=0,s=a.length;i<s;++i)r.push(a[i].identifier);return this._targetTouches=n.filter((e=>-1!==r.indexOf(e.identifier))),void(0===this._targetTouches.length?this._setLastKnownSinglePointLocation(a[0]):this._lastKnownEventLocation=null)}if(this.events===wo.Pointer){const t=e,i=this._targetTouches;return e.type===this.events.Start?(this._targetTouches.push(t),void(this._lastKnownEventLocation=null)):e.type===this.events.Move?(this._targetTouches=i.map((e=>e.pointerId!==t.pointerId?e:t)),void(this._lastKnownEventLocation=null)):(this._targetTouches=i.filter((e=>e.pointerId!==t.pointerId)),void(0===this._targetTouches.length?this._setLastKnownSinglePointLocation(t):this._lastKnownEventLocation=null))}throw new Error("")}_updateKeyboardModifiers(e){this.modifierKeys.alt=e.altKey,this.modifierKeys.ctrl=e.ctrlKey,this.modifierKeys.meta=e.metaKey,this.modifierKeys.shift=e.shiftKey}_distance(){if(2!==this.numberOfTouches)return 0;const e=this._targetTouches[0],t=new ts(e.pageX,e.pageY),i=this._targetTouches[1],s=new ts(i.pageX,i.pageY);return t.distanceToPoint(s)}}mo.Modes=Object.freeze({Adaptive:"adaptive",Pointer:"pointer",Touch:"touch",Mouse:"mouse"});const go="PointerEvent"in window;mo.SupportsPointerEvents=go;const _o="ontouchmove"in document;mo.SupportsTouches=_o;const fo=!!window.GestureEvent;let yo,vo;mo.SupportsGestures=fo,mo.SupportsGestures?mo.SupportsPointerEvents?yo=vo=!mo.SupportsTouches:(yo=!mo.SupportsTouches,vo=!0):(yo=!1,vo=!1),mo.UseGesturesForRotation=yo,mo.UseGesturesForPinch=vo;const bo=Object.freeze({Possible:"possible",Began:"began",Changed:"changed",Ended:"ended",Cancelled:"cancelled",Failed:"failed",Recognized:"ended"});mo.States=bo;const wo=Object.freeze({Pointer:{Start:"pointerdown",Move:"pointermove",End:"pointerup",Cancel:"pointercancel",GestureStart:"gesturestart",GestureChange:"gesturechange",GestureEnd:"gestureend",StateChange:"statechange"},Touch:{Start:"touchstart",Move:"touchmove",End:"touchend",Cancel:"touchcancel",GestureStart:"gesturestart",GestureChange:"gesturechange",GestureEnd:"gestureend",StateChange:"statechange"},Mouse:{Start:"mousedown",Move:"mousemove",End:"mouseup",Cancel:void 0,GestureStart:"gesturestart",GestureChange:"gesturechange",GestureEnd:"gestureend",StateChange:"statechange"}}),Co=mo,ko=Co.SupportsTouches,Mo=Co.SupportsPointerEvents,So=Co.SupportsGestures,Lo="ShadowRoot"in window;function xo(e,t,...i){const s=window.document.createElementNS(e,t);let o=0;if("object"==typeof i[0]&&null!=i[0]&&!(i[0]instanceof window.Node)){++o;for(const e in i[0])s.setAttribute(e,i[0][e])}for(let e=o,t=i.length;e<t;++e){const t=i[e];t instanceof window.Node?s.appendChild(t):"string"==typeof t&&s.appendChild(document.createTextNode(t))}return s}const Ao={focusColor:"rgb(0, 122, 255)",get devicePixelRatio(){return window.devicePixelRatio||1},get imagePixelRatio(){return Math.max(Math.round(window.devicePixelRatio),1)||1},roundToDevicePixel:function(e,t){const i=t||this.devicePixelRatio;return Math.round(e*i)/i},supportsTouches:ko,supportsPointerEvents:Mo,supportsGestureEvents:So,startEventType:Mo?"pointerdown":ko?"touchstart":"mousedown",moveEventType:Mo?"pointermove":ko?"touchmove":"mousemove",endEventType:Mo?"pointerup":ko?"touchend":"mouseup",cancelEventType:Mo?"pointercancel":ko?"touchcancel":void 0,supportsForceTouch:!ko&&"webkitForce"in MouseEvent.prototype,htmlElement:(e,...t)=>xo("http://www.w3.org/1999/xhtml",e,...t),svgElement:(e,...t)=>xo("http://www.w3.org/2000/svg",e,...t),supportsShadowDOM:Lo,insideIframe:window.top!==window,getShadowDOMTargetFromEvent:function(e,t){const i=this.containingDocumentOrShadowRoot(e);if(i===document)return t.target;const s="changedTouches"in t?t.changedTouches[0]:t,o=i.elementFromPoint(s.clientX,s.clientY);return o||document.body},containingDocumentOrShadowRoot:function(e){return this.supportsShadowDOM?e.getRootNode():document},addShadowRootChild:function(e,t,i,s){let o;this.supportsShadowDOM?o=e.createAndAddShadowRootChild(t):(o=e.addChild(new io),i=function(e){let t,i="";for(;t=e.match(/:host\(/);){i+=e.substr(0,t.index),e=e.substr(t.index+t[0].length);let s=1;for(;t=e.match(/^([^()]*)([()])?/);){if(e=e.substr(t[0].length),"("===t[2])s+=1;else if(")"===t[2]&&(s-=1,0===s)){i+=t[1];break}if(i+=t[0],!t[2])break}}return i+e}(i));const n=this.htmlElement("style",i);return s&&(n.nonce=s),o.addChild(new io(n)),o},parentNodeForSvgTarget:function(e){return e.tagName&&"div"!==e.tagName.toLowerCase()?this.parentNodeForSvgTarget(e.parentNode):e},imagePathForDevice:function(e,t,i){const s=Math.floor(this.devicePixelRatio);let o;return o=-1!==e.indexOf(s)?s:s>e[e.length-1]?e[e.length-1]:e[0],t+(o>1?"_"+o+"x":"")+(i=i||".png")},parseQueryString:function(e){const t={};let i;const s=/\+/g,o=/([^&=]+)=?([^&]*)/g,n=function(e){return decodeURIComponent(e.replace(s," "))};if("string"==typeof e)for(;null!==(i=o.exec(e));)t[n(i[1])]=n(i[2]);return t},createSVGIcon:function(e,t){let i="mk-icon";t.class&&(i+=" "+t.class,delete t.class);const s=this.svgElement("svg",t);return s.setAttribute("class",i),s.setAttribute("focusable","false"),s.appendChild(this.svgElement("g")).appendChild(e),s},convertColorToRGB:function(e){const t=document.createElement("div");return t.style.setProperty("color",e),t.style.color},isValidCSSColor:function(e){return""!==this.convertColorToRGB(e)},updateLabel:function(e,t){e.setAttribute("title",t),e.setAttribute("aria-label",t)},easeInOut:function(e){const t=Math.pow(e,2);return t/(t+Math.pow(1-e,2))},lerp:function(e,t,i){return(1-e)*t+e*i},darkColorScheme:function(e){return e===xs.Dark},restrictRotation:function(e){return e<180?Math.min(e,30):Math.max(e,330)},getIntegralZoom:function(e){return Math.floor(e+1e-6)}},Eo=Ao;var To;function Io(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Oo(e,t,i,s){return Do(e,t),Po(i,"set"),function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,i,s),s}function Ro(e,t,i){return Do(e,t),Po(i,"get"),function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}function Po(e,t){if(void 0===e)throw new TypeError("attempted to "+t+" private static field before its declaration")}function Do(e,t){if(e!==t)throw new TypeError("Private static access of wrong provenance")}let zo={};class No{constructor(e){Io(this,"_node",void 0),Io(this,"_layer",void 0),Io(this,"_frozenLayer",void 0),Io(this,"_sharedLayer",void 0),this._node=e}get node(){return this._node}get shouldDraw(){const e=this._node.keyForFrozenLayer;return!(this._frozenLayer&&(!this._sharedLayer||this._sharedLayer.key===e)||e&&zo[e])}get layer(){const e=this._node,t=e.frozen,i=e.keyForFrozenLayer;if(t){if(this._frozenLayer){if(!i||!this._sharedLayer||this._sharedLayer.key===i)return this._frozenLayer;this.releaseLayer()}if(i){const e=zo[i];if(e&&e.key===i)return this._sharedLayer=e,this._layer=this._frozenLayer=e.canvas,++e.count,e.canvas}}delete this._frozenLayer,this._layer||(this._layer=this.createCanvas(),this._layer.hidden=!0,i&&(this._sharedLayer=zo[i]={canvas:this._layer,count:1,key:i}));const s=Eo.devicePixelRatio,o=e.layerBounds;this._layer.width=Math.ceil(o.size.width*s),this._layer.height=Math.ceil(o.size.height*s);const n=this._layer.getContext("2d");return n&&(n.scale(s,s),n.translate(-o.origin.x,-o.origin.y)),t&&(this._frozenLayer=this._layer),this._layer}releaseLayer(e){this._layer&&(this._sharedLayer?e||(--this._sharedLayer.count,0===this._sharedLayer.count&&(delete zo[this._sharedLayer.key],this._layer.width=0,this._layer.parentNode&&this._layer.parentNode.removeChild(this._layer))):(this._layer.width=0,this._layer.parentNode&&this._layer.parentNode.removeChild(this._layer)),delete this._sharedLayer,delete this._frozenLayer,delete this._layer)}nodeWasRemoved(){var e,t,i;this._layer&&(e=No,t=No,i=Fo,Do(e,t),i).call(No,this)}createCanvas(){return re()}draw(e){}static releaseSharedLayers(){Object.keys(zo).forEach((e=>{const t=zo[e];t&&(t.canvas.width=0,delete t.key,delete t.canvas)})),zo={}}}function Fo(e){0===Ro(To,To,Uo).length&&setTimeout((()=>{Ro(To,To,Uo).forEach((e=>{e._node.scene||e.releaseLayer()})),Oo(To,To,Uo,[])}),0),Ro(To,To,Uo).push(e)}To=No;var Uo={writable:!0,value:[]};const Go=No;function Bo(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Wo(e,t,i,s,o,n){if(!t||0===e.opacity)return;const a=z(e.renderer);o&&a.releaseLayer(!0);const r=a.shouldDraw,l=e.wantsLayerBacking?a.layer:null;if(l||e.frozen||a.releaseLayer(),e.wantsLayerBacking&&!l)return;const h=function(h){if(t.save(),t.translate(h,d),t.transform(u.a,u.b,u.c,u.d,u.e,u.f),t.globalAlpha=n,r||!e.frozen){const r=l?z(l.getContext("2d")):t;l&&t.canvas&&"appendChild"in t.canvas&&t.canvas.appendChild(l),a.draw(r);const h=e.children;for(let e=0,t=h.length;e<t;++e)Wo(h[e],r,i,s,o,l?1:n)}l&&0!==l.width&&0!==l.height&&t.drawImage(l,e.layerBounds.origin.x,e.layerBounds.origin.y,l.width/s,l.height/s),t.restore()},c=e.position.x,d=e.position.y,u=e.transform;n*=e.opacity,h(c),e.repeatOffset&&h(c+e.repeatOffset)}const Zo=class extends Go{constructor(e){super(e),Bo(this,"_canvas",void 0),Bo(this,"_ctx",void 0),Bo(this,"_previousSize",void 0),Bo(this,"_previousScale",void 0),this._canvas=this.createCanvas();const t=this._canvas.getContext("2d");if(!t)throw new Error("Failed to obtain 2D context from canvas");this._ctx=t}get ctx(){return this._ctx}get element(){return this._canvas}set element(e){this._canvas=e}update(){if(!this._ctx)return;const e=this._node,t=e.size,i=Eo.devicePixelRatio,s=!this._previousScale||this._previousScale!==i;s&&Go.releaseSharedLayers(),!s&&this._previousSize&&this._previousSize.equals(t)?this._ctx.clearRect(0,0,t.width*i,t.height*i):(this._canvas.style.width=t.width+"px",this._canvas.style.height=t.height+"px",this._canvas.width=Math.round(t.width*i),this._canvas.height=Math.round(t.height*i),this._previousSize=t.copy(),this._previousScale=i),this._ctx.scale(i,i),Wo(this.node,this._ctx,new is(-e.position.x,-e.position.y,t.width,t.height),i,s,1),this._ctx.scale(1/i,1/i)}destroy(){this._ctx=null,this._canvas.width=this._canvas.height=0}};function Ko(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const jo=class extends Ls{constructor(){super(),Ko(this,"_renderer",void 0),Ko(this,"sceneDidUpdate",void 0),Ko(this,"isScene",!0),Ko(this,"performanceMeasureName",void 0),Ko(this,"_isTainted",!1),this._renderer=new Zo(this)}get element(){return this._renderer.element}set element(e){this._renderer.element=e}get contextForMeasurement(){return this._renderer.ctx}get renderer(){return this._renderer}isTainted(){if(this._isTainted)return this._isTainted;const e=super.isTainted();return e&&(this._isTainted=!0),e}destroy(){this.children=[],this._renderer.destroy()}flush(){_s.flush(this)}stringInfo(){return"Scene"}};const Ho=class extends Ls{constructor(){super();const e=new Go(this);this._renderer=e}stringInfo(){return"GroupNode"}};const Vo=class extends Go{constructor(...e){var t,i,s;super(...e),s=null,(i="_lastDrawnImage")in(t=this)?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s}draw(e){this._node.image&&(this._node.image.complete&&this._node.image.naturalWidth?(this._lastDrawnImage=this._node.image,e.drawImage(this._node.image,0,0,this._node.size.width,this._node.size.height)):this._node.image===this._lastDrawnImage&&(this._node.needsDisplay=!0))}};const qo=class extends Ls{constructor(){var e,t,i;super(),i=void 0,(t="_image")in(e=this)?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,this._image=null,this._renderer=new Vo(this)}get image(){return this._image}set image(e){this._image!==e&&(this._image&&this._image.removeEventListener("load",this),this._image=e,this._imageDidLoad(),!e||e.src&&e.complete||e.addEventListener("load",this))}isTainted(){return!!this._image&&null===this._image.crossOrigin}stringInfo(){let e=this._image?this._image.src:null;return"ImageNode"+(e?"<src:"+e+">":"")}handleEvent(e){e.target===this._image&&this._image?.complete&&(this._image.removeEventListener("load",this),this._imageDidLoad(),this.needsDisplay=!0)}_imageDidLoad(){this.size.equals(es.Zero)&&(this.size=new es(z(this._image).width,z(this._image).height)),this.needsDisplay=!0}};var Yo;function Xo(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class $o{constructor(e){Xo(this,"node",void 0),Xo(this,"duration",void 0),Xo(this,"from",void 0),Xo(this,"to",void 0),Xo(this,"done",void 0),Xo(this,"startTime",null),Xo(this,"_p",void 0),this.node=e.node,this.node.animators||(this.node.animators=[]),this.node.animators.push(this),this.duration=e.duration,this.from=e.from??0,this.to=e.to??1,this.done=e.done??r}begin(){return this.startTime=null,this._p=0,bt.scheduleASAP(this),this}end(){if(this.ended=!0,this.node.animators){const e=this.node.animators.indexOf(this);e>=0&&(this.node.animators.splice(e,1),0===this.node.animators.length&&delete this.node.animators)}this.done(this)}performScheduledUpdate(e){this.ended||(null!=e&&(this.beginDate||(this.beginDate=e),this._p=Math.min((e-this.beginDate)/this.duration,1),this.update(this._p)),"number"==typeof this._p&&this._p<1?bt.scheduleOnNextFrame(this):this.end())}update(e){}valueAt(e){const t=this.from;return t+e*(this.to-t)}stringInfo(e,t){let i="ð"+e+"<"+this.duration+"ms; "+this.from+"â"+this.to;return"number"==typeof this._p&&this._p>=0&&(i+="/"+Math.round(100*this._p)+"%"),this.done!==r&&(i+="*"),i+(t||"")+">"}}class Jo extends $o{update(e){this.node.opacity=this.valueAt(e)}stringInfo(){return super.stringInfo("opacity")}}class Qo extends $o{constructor(e){super({...e,from:e.from??new ts(0,0),to:e.to??new ts(0,0)}),e.pop&&(this.springSolver=new tn(1,Qo.STIFFNESS,Qo.DAMPING,0))}update(e){this.springSolver&&(e=this.springSolver.solve(e)),this.node.transform=(new ss).translate(this.from.x+e*(this.to.x-this.from.x),this.from.y+e*(this.to.y-this.from.y))}end(){this.node.transform=(new ss).translate(this.to.x,this.to.y),super.end()}stringInfo(){return super.stringInfo("translation")}}Xo(Qo,"STIFFNESS",100),Xo(Qo,"DAMPING",10);class en extends $o{constructor(e){const t=e.done||r;e.duration*=en.FLOAT_DURATION_SCALE,delete e.done,super(e),Xo(this,"center",void 0),Xo(this,"floatCenter",void 0),Xo(this,"swayAmplitude",0),this.popAnimationDone=t,this.center=e.center??new ts(0,0),e.floatCenter&&(this.floatCenter=e.floatCenter),this.popSpringSolver=new tn(1,en.SCALE_STIFFNESS,en.SCALE_DAMPING,0),e.to>e.from&&(this.swayAmplitude=(Math.random()<.5?-1:1)*(3+3*Math.random()),this.rotateSpringSolver=new tn(1,en.ROTATE_STIFFNESS,en.ROTATE_DAMPING,0))}scaleAndRotate(e,t){const i=this.center.x,s=this.center.y;this.floatCenter?this.node.transform=(new ss).translate(this.floatCenter.x,this.floatCenter.y).rotate(t).translate(-this.floatCenter.x,-this.floatCenter.y).translate(i,s).scale(e).translate(-i,-s):this.node.transform=(new ss).translate(i,s).scale(e).rotate(t).translate(-i,-s)}update(e){const t=e*en.FLOAT_DURATION_SCALE,i=this.valueAt(this.popSpringSolver.solve(t));let s=0;this.rotateSpringSolver&&(s=(this.rotateSpringSolver.solve(e)-1)*this.swayAmplitude),this.scaleAndRotate(i,s),t>1&&!this.popAnimationDoneCalled&&(this.popAnimationDoneCalled=!0,this.popAnimationDone(this))}end(){this.scaleAndRotate(this.to,0),super.end(),this.popAnimationDoneCalled||this.popAnimationDone(this)}stringInfo(){let e="";0===this.center.x&&0===this.center.y||(e+=" ("+this.center.x+", "+this.center.y+")");let t="float";return this.popAnimationDoneCalled&&(t+=" (swing)"),super.stringInfo(t,e)}}Yo=en,Xo(en,"SCALE_STIFFNESS",100),Xo(en,"SCALE_DAMPING",10),Xo(en,"FLOAT_DURATION_SCALE",4.2),Xo(en,"ROTATE_DAMPING",5),Xo(en,"ROTATE_STIFFNESS",.25*(Yo.ROTATE_DAMPING*Yo.ROTATE_DAMPING+483.611));class tn{constructor(e,t,i,s){this.w0=Math.sqrt(t/e),this.zeta=i/(2*Math.sqrt(t*e)),this.zeta<1?(this.wd=this.w0*Math.sqrt(1-this.zeta*this.zeta),this.A=1,this.B=(this.zeta*this.w0-s)/this.wd):(this.wd=0,this.A=1,this.B=-s+this.w0)}solve(e){return 1-(e=this.zeta<1?Math.exp(-e*this.zeta*this.w0)*(this.A*Math.cos(this.wd*e)+this.B*Math.sin(this.wd*e)):(this.A+this.B*e)*Math.exp(-e*this.w0))}}const sn={Basic:$o,Opacity:Jo,Translation:Qo,Scale:class extends $o{constructor(e){super(e),Xo(this,"center",void 0),this.center=e.center??new ts(0,0)}scale(e){const t=this.center.x,i=this.center.y;this.node.transform=(new ss).translate(t,i).scale(e).translate(-t,-i)}update(e){this.scale(this.valueAt(e))}stringInfo(){let e="";return 0===this.center.x&&0===this.center.y||(e+=" ("+this.center.x+", "+this.center.y+")"),super.stringInfo("scale",e)}},Float:en},on=sn,nn=(vi.Coordinate,vi.CoordinateRegion,vi.CoordinateSpan,vi.MapRect),an=function(e,t){p(t,"object","[MapKit] MapRect.pad expects a padding object with top, left, bottom, right but got `"+t+"` instead");const i=t.left||0,s=t.top||0;return new nn(e.origin.x-i,e.origin.y-s,e.size.width+i+(t.right||0),e.size.height+s+(t.bottom||0))},rn=function(e,t){const i=t.origin.x,s=t.origin.y,o=e.maxX(),n=e.maxY();return i>=e.origin.x&&i<=o&&s>=e.origin.y&&s<=n&&t.maxX()<=o&&t.maxY()<=n},ln=function(e){if(0===e.length)return new nn;if(1===e.length){const t=e[0].minX();return t>=0&&t<1?e[0]:new nn(l(t,1),e[0].minY(),e[0].size.width,e[0].size.height)}const t=[[e[0].minX(),e[0].maxX()]];let i=e[0].minY(),s=e[0].maxY();for(let o=1,n=e.length,a=0;o<n;++o){const n=t[a],r=e[o];i=Math.min(i,r.minY()),s=Math.max(s,r.maxY()),r.minX()<=n[1]?t[a]=[n[0],Math.max(n[1],r.maxX())]:(t.push([r.minX(),r.maxX()]),++a)}const o=t.length;if(1===o)return new nn(t[0][0],i,Math.min(t[0][1]-t[0][0],1),s-i);let n=1+t[0][0]-t[o-1][1],a=t[0][0];for(let e=1;e<o;++e){const i=t[e][0]-t[e-1][1];i>n&&(n=i,a=t[e][0])}return new nn(l(a,1),i,1-n,s-i)};function hn(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class cn{constructor(){hn(this,"top",0),hn(this,"right",0),hn(this,"bottom",0),hn(this,"left",0);const e=arguments.length;if(1===e&&"object"==typeof arguments[0]){this.top=0,this.right=0,this.bottom=0,this.left=0;const e=arguments[0];Object.keys(e).forEach((t=>{"top"===t||"right"===t||"bottom"===t||"left"===t?this[t]=e[t]:console.warn("[MapKit] Unknown property `"+t+"` for Padding constructor.")}))}else this.top=e>0?arguments[0]:0,this.right=e>1?arguments[1]:0,this.bottom=e>2?arguments[2]:0,this.left=e>3?arguments[3]:0;p(this.top,"number","[MapKit] Expected a number for `top` in Padding constructor but got `"+this.top+"` instead."),p(this.left,"number","[MapKit] Expected a number for `left` in Padding constructor but got `"+this.left+"` instead."),p(this.bottom,"number","[MapKit] Expected a number for `bottom` in Padding constructor but got `"+this.bottom+"` instead."),p(this.right,"number","[MapKit] Expected a number for `right` in Padding constructor but got `"+this.right+"` instead.")}toString(){return"Padding("+[this.top,this.right,this.bottom,this.left].join(", ")+")"}copy(){return new cn(this.top,this.right,this.bottom,this.left)}equals(e){return this.top===e.top&&this.right===e.right&&this.bottom===e.bottom&&this.left===e.left}}hn(cn,"Zero",new cn);const dn=cn;function un(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const pn=class{constructor(e,t){un(this,"_speed",.03),un(this,"_startTime",0),un(this,"_shouldStop",!1),un(this,"_animating",!1),this._delegate=t,this._snapsToIntegralZoomLevels=e}start(e,t){const i=Date.now();return this._gasPedalValue=0,this._startTime=i,this._shouldStop&&this._cleanUp(),this._shouldStop=!1,this.zoomsIn=!!t,Eo.supportsForceTouch&&window.addEventListener("webkitmouseforcechanged",this),!this._animating&&(this._animating=!0,this._zoomLevel=e,this._timeAtLastFrame=i,bt.scheduleOnNextFrame(this),!0)}stop(){this._shouldStop=!0,Eo.supportsForceTouch&&(window.removeEventListener("webkitmouseforcechanged",this),this._speed=.03)}set snapsToIntegralZoomLevels(e){this._snapsToIntegralZoomLevels=!!e}performScheduledUpdate(){let e=!0;const t=Date.now(),i=t-this._timeAtLastFrame,s=this._speed*(this.zoomsIn?1:-1);this._zoomLevel+=60*i*h(1+s)/1e3,this._timeAtLastFrame=t,this._shouldStop&&t-this._startTime>=250&&(this._zoomLevelAtWhichToStop?(e=this.zoomsIn&&this._zoomLevel<this._zoomLevelAtWhichToStop||!this.zoomsIn&&this._zoomLevel>this._zoomLevelAtWhichToStop,e||(this._zoomLevel=this._zoomLevelAtWhichToStop)):this._snapsToIntegralZoomLevels?this._zoomLevelAtWhichToStop=this.zoomsIn?Math.ceil(this._zoomLevel):Math.floor(this._zoomLevel):e=!1),this._delegate&&this._delegate.linearZoomControllerDidZoom(this._zoomLevel),e?bt.scheduleOnNextFrame(this):this._cleanUp()}handleEvent(e){this._handleForceChangedEvent(e)}_handleForceChangedEvent(e){const t=c(e.webkitForce,MouseEvent.WEBKIT_FORCE_AT_MOUSE_DOWN,MouseEvent.WEBKIT_FORCE_AT_FORCE_MOUSE_DOWN)-MouseEvent.WEBKIT_FORCE_AT_MOUSE_DOWN;Math.abs(t-this._gasPedalValue)>.01&&(this._gasPedalValue=t),this._speed=.01+this._gasPedalValue*(.06-.01)}_cleanUp(){this._animating=!1,this._shouldStop=!1,delete this._zoomLevelAtWhichToStop,this._delegate&&this._delegate.linearZoomControllerDidStop()}mapWasDestroyed(){this._delegate=null}};class mn extends mo{constructor(){super(),this.numberOfTapsRequired=1,this.numberOfTouchesRequired=1,this.allowsRightMouseButton=!1,this._taps=0}touchesBegan(e){e.currentTarget===this.target&&("button"in e&&2===e.button&&!this.allowsRightMouseButton||(super.touchesBegan(e),this.numberOfTouches===this.numberOfTouchesRequired?(this._domEvents.push(e),this._startPoint=super.locationInElement(),this._startClientPoint=super.locationInClient(),this._rewindTimer(750)):this.enterFailedState()))}touchesMoved(e){let t;switch(this.preventDefault(e),this.currentMode){case mo.Modes.Pointer:t="touch"===e.pointerType?40:2;break;case mo.Modes.Touch:t=40;break;case mo.Modes.Mouse:t=2}void 0!==t&&(!this._startPoint||this._startPoint.distanceToPoint(super.locationInElement())>t)&&this.enterFailedState()}touchesEnded(e){this._taps++,this._domEvents.push(e),this._taps===this.numberOfTapsRequired&&(this.preventDefault(e),this.enterRecognizedState(),this.reset()),this._rewindTimer(350)}reset(){this._taps=0,this._clearTimer(),this._domEvents=[]}locationInElement(e){const t=this._startPoint||new ts;return e?ds(e,t):t}locationInClient(){return this._startClientPoint||new ts}_clearTimer(){window.clearTimeout(this._timerId),delete this._timerId}_rewindTimer(e){this._clearTimer(),this._timerId=window.setTimeout(this._timerFired.bind(this),e)}_timerFired(){this.enterFailedState()}}class gn extends mo{constructor(){super(),this.allowableMovement=10,this.minimumPressDuration=500,this.numberOfTouchesRequired=1,this.allowsRightMouseButton=!1,this._startPoint=void 0}touchesBegan(e){e.currentTarget===this.target&&("button"in e&&2===e.button&&!this.allowsRightMouseButton||(super.touchesBegan(e),this.numberOfTouches===this.numberOfTouchesRequired?(this._startPoint=this.locationInElement(),this._timerId=window.setTimeout(this.enterRecognizedState.bind(this),this.minimumPressDuration)):this.enterFailedState()))}touchesMoved(e){this.preventDefault(e),void 0!==this._startPoint&&this._startPoint.distanceToPoint(this.locationInElement())>this.allowableMovement&&this.enterFailedState()}touchesCancelled(e){this.touchesEnded(e)}touchesEnded(e){this.state===mo.States.Recognized?(this.preventDefault(e),this.numberOfTouches!==this.numberOfTouchesRequired&&this.enterFailedState()):this.enterFailedState()}reset(){window.clearTimeout(this._timerId),delete this._timerId}}const _n=.75;function fn(){return{start:new ts,end:new ts,dt:0}}function yn(e){return e.dt<1?new ts:new ts((e.end.x-e.start.x)/e.dt*1e3,(e.end.y-e.start.y)/e.dt*1e3)}class vn extends mo{constructor(){super(),this.minimumNumberOfTouches=1,this.maximumNumberOfTouches=1e5,this.translationThreshold=10,this._traveledMinimumDistance=!1,this._previousVelocitySample=fn(),this._velocitySample=fn(),this.translation=new ts}get velocity(){if(void 0===this._lastTouchTime)return new ts;if(performance.now()-this._lastTouchTime>100)return new ts;const e=yn(this._velocitySample);if(mo.SupportsTouches&&this._previousVelocitySample.dt>0){const t=yn(this._previousVelocitySample);e.x=.25*e.x+_n*t.x,e.y=.25*e.y+_n*t.y}return e}touchesBegan(e){e.currentTarget===this.target&&(e instanceof MouseEvent&&0!==e.button||(super.touchesBegan(e),this._numberOfTouchesIsAllowed()?(this._lastTouchTime=e.timeStamp,this._resetTrackedLocations(),1===this.numberOfTouches&&(this._traveledMinimumDistance=!1)):this.enterFailedState()))}touchesMoved(e){this.preventDefault(e);const t=e.timeStamp,i=this.locationInElement();if(void 0===this._lastTouchTime||void 0===this._lastTouchLocation||void 0===this._translationOrigin)return;const s=t-this._lastTouchTime;s>8&&(this._previousVelocitySample.start=this._velocitySample.start.copy(),this._previousVelocitySample.end=this._velocitySample.end.copy(),this._previousVelocitySample.dt=this._velocitySample.dt,this._velocitySample.start=this._lastTouchLocation.copy(),this._velocitySample.end=i,this._velocitySample.dt=s),this._traveledMinimumDistance?(this.translation.x+=i.x-this._lastTouchLocation.x,this.translation.y+=i.y-this._lastTouchLocation.y,this.enterChangedState()):this._canBeginWithTraveledDistance(new ts(i.x-this._translationOrigin.x,i.y-this._translationOrigin.y))&&(this._traveledMinimumDistance=!0,this.enterBeganState()),this._lastTouchTime=t,this._lastTouchLocation=i}touchesEnded(e){this._numberOfTouchesIsAllowed()?this._resetTrackedLocations():this._traveledMinimumDistance?this.enterEndedState():this.enterFailedState()}reset(){this._velocitySample=fn(),this._previousVelocitySample=fn(),this.translation=new ts,this._traveledMinimumDistance=!1}_canBeginWithTraveledDistance(e){return Math.abs(e.x)>=this.translationThreshold||Math.abs(e.y)>=this.translationThreshold}_numberOfTouchesIsAllowed(){return this.numberOfTouches>=this.minimumNumberOfTouches&&this.numberOfTouches<=this.maximumNumberOfTouches}_resetTrackedLocations(){const e=this.locationInElement();this._lastTouchLocation=e,this._translationOrigin=e}}class bn extends mo{constructor(){super(),this.scaleThreshold=0,this.useGestures=mo.UseGesturesForPinch,this._scaledMinimumAmount=!1,this.scale=1,this._velocity=0,this._gestures=[],this._startDistance=0}get velocity(){const e=this._gestures[this._gestures.length-1];if(!e)return this._velocity;const t=performance.now()-(e.timeStamp+100);if(t<=0)return this._velocity;const i=Math.max((500-t)/500,0);return this._velocity*i}touchesBegan(e){if(e.currentTarget===this.target){if(this.useGestures){if(2!==this.numberOfTouches)return}else{if(this.numberOfTouches>2)return void this.enterFailedState();if(2!==this.numberOfTouches)return;this._startDistance=this._distance(),this._recordGesture(e.timeStamp,1),this._scaledMinimumAmount=!1,this._updateStateWithEvent(e)}super.touchesBegan(e)}}touchesMoved(e){this.useGestures||2===this.numberOfTouches&&this._updateStateWithEvent(e)}touchesEnded(e){this.useGestures||this.numberOfTouches>=2||!this._startDistance||(this._scaledMinimumAmount?this.enterEndedState():this.enterFailedState())}gestureBegan(e){super.gestureBegan(e),this._recordGesture(e.timeStamp,e.scale),this._scaledMinimumAmount=!1,this._updateStateWithEvent(e),this.preventDefault(e)}gestureChanged(e){this.preventDefault(e),this._updateStateWithEvent(e)}gestureEnded(e){this._scaledMinimumAmount?this.enterEndedState():this.enterFailedState()}reset(){this.scale=1,this._velocity=0,this._gestures=[],this._startDistance=0}_recordGesture(e,t){const i=e,s=this._gestures.push({scale:t,timeStamp:i});if(s<=2)return;const o=this._gestures[s-1].scale>=this._gestures[s-2].scale;let n;for(n=s-3;n>=0;--n){const e=this._gestures[n];if(i-e.timeStamp>100||this._gestures[n+1].scale>=e.scale!==o)break}n>0&&(this._gestures=this._gestures.slice(n+1))}_updateStateWithEvent(e){const t=this.useGestures?e.scale:0!==this._startDistance?this._distance()/this._startDistance:1;if(!this._scaledMinimumAmount)return void(Math.abs(1-t)>=this.scaleThreshold&&(this._scaledMinimumAmount=!0,this.scale=1,this.enterBeganState()));this._recordGesture(e.timeStamp,t);const i=this._gestures[0],s=t-i.scale,o=e.timeStamp-i.timeStamp;this._velocity=0===o?0:s/o*1e3,this.scale*=t/this._gestures[this._gestures.length-2].scale,this.enterChangedState()}}class wn extends mo{constructor(){super(),this._rotation=0,this.rotation=0,this._velocity=0,this._lastEventData=null,this._startAngle=null,this.useGestures=mo.UseGesturesForRotation}get velocity(){return this._velocity}get rotation(){return this._rotation}set rotation(e){this._rotation=function(e){for(;e>180;)e-=360;for(;e<-180;)e+=360;return e}(e)}touchesBegan(e){this.useGestures||e.currentTarget===this.target&&2===this.numberOfTouches&&(super.touchesBegan(e),this.numberOfTouches>2?this.enterFailedState():(this._startAngle=this._angle(),this._startDistance=this._distance(),this.rotation=0,this._lastEventData={rotation:0,scale:1,timeStamp:e.timeStamp}))}touchesMoved(e){this.useGestures||2===this.numberOfTouches&&null!==this._startAngle&&void 0!==this._startDistance&&this._handleEvent(e,{rotation:this._angle()-this._startAngle,scale:0===this._startDistance?1:this._distance()/this._startDistance})}touchesEnded(e){this.useGestures||this.numberOfTouches>=2||null===this._startAngle||(this.state===mo.States.Changed?this.enterEndedState():this.enterFailedState())}gestureBegan(e){this.useGestures&&(super.gestureBegan(e),this.preventDefault(e),this.rotation=0,this._lastEventData={rotation:0,scale:1,timeStamp:e.timeStamp})}gestureChanged(e){this.useGestures&&(this.preventDefault(e),this._handleEvent(e))}gestureEnded(e){this.useGestures&&this.enterEndedState()}reset(){this.rotation=0,this._velocity=0,this._lastEventData=null,this._startAngle=null}_handleEvent(e,t){const i="rotation"in e?e.rotation:t?t.rotation:NaN,s="scale"in e?e.scale:t?t.scale:NaN,o=this._lastEventData;if(!o||isNaN(i)||isNaN(s))throw new Error("");const n=i-o.rotation,a=s-o.scale,r=e.timeStamp-o.timeStamp;if(this._lastEventData={rotation:i,scale:s,timeStamp:e.timeStamp},this.state!==mo.States.Possible)r>0&&(this._velocity=n/r*1e3),this.rotation+=n,this.enterChangedState();else{const e=Math.abs(i)<8,t=Math.abs(n/90)<Math.abs(a),s=Math.abs(n)>=135;if(e||t||s)return;this.enterBeganState()}}_angle(){if(2!==this.numberOfTouches)return 0;const e=this._targetTouches[0],t=new ts(e.pageX,e.pageY),i=this._targetTouches[1],s=new ts(i.pageX,i.pageY);return 180*Math.atan2(t.y-s.y,t.x-s.x)/Math.PI}}const Cn=100;class kn extends mo{constructor(){super(),this.numberOfTouchesRequired=1,this.direction=kn.Directions.Right}touchesBegan(e){e.currentTarget===this.target&&(this.numberOfTouchesRequired===this.numberOfTouches?(super.touchesBegan(e),this._translationOrigin=this.locationInElement()):this.enterFailedState())}touchesMoved(e){if(this.numberOfTouchesRequired!==this.numberOfTouches)return void this.enterFailedState();if(this.preventDefault(e),void 0===this._translationOrigin)return;const t=this.locationInElement(),i=new ts(t.x-this._translationOrigin.x,t.y-this._translationOrigin.y);this.state!==mo.States.Recognized&&this.direction===kn.Directions.Right&&i.x>Cn&&Math.abs(i.x)>Math.abs(i.y)&&this.enterRecognizedState(),this.state!==mo.States.Recognized&&this.direction===kn.Directions.Left&&i.x<-100&&Math.abs(i.x)>Math.abs(i.y)&&this.enterRecognizedState(),this.state!==mo.States.Recognized&&this.direction===kn.Directions.Up&&i.y<-100&&Math.abs(i.y)>Math.abs(i.x)&&this.enterRecognizedState(),this.state!==mo.States.Recognized&&this.direction===kn.Directions.Down&&i.y>Cn&&Math.abs(i.y)>Math.abs(i.x)&&this.enterRecognizedState()}touchesEnded(e){this.enterFailedState()}}kn.Directions=Object.freeze({Right:1,Left:2,Up:4,Down:8});mo.SupportsTouches,mo.SupportsPointerEvents;const Mn=mo.States;const Sn=class extends gn{constructor(){super(),this.minimumPressDuration=500}touchesBegan(e){super.touchesBegan(e),this._domEvents.push(e),this.translation=new ts,this._translationOrigin=this._lastTouchLocation=this.locationInElement()}enterRecognizedState(){super.enterBeganState()}touchesMoved(e){this.preventDefault(e);const t=this.locationInElement();if(this.state===Mn.Possible)super.touchesMoved(e);else if(this.state===Mn.Began||this.state===Mn.Changed){const e=z(this.translation);e.x+=t.x-z(this._lastTouchLocation).x,e.y+=t.y-z(this._lastTouchLocation).y,this.enterChangedState()}this._lastTouchLocation=t}touchesCanceled(e){this.interruptGesture()}touchesEnded(e){this.state===Mn.Changed?(this.preventDefault(e),this.enterEndedState()):this.enterFailedState()}interruptGesture(){this.state===Mn.Changed?this.enterEndedState():this.state===Mn.Began&&this.enterFailedState()}reset(){super.reset(),delete this._translationOrigin,delete this._lastTouchLocation,this._domEvents=[]}},Ln="mk-disable-all-gestures",xn="mk-disable-pan-gestures",An="mk-disable-pinch-gestures",En="mk-disable-zoom-gestures";const Tn=class{constructor(e,t){this._target=e,this._delegate=t,this._touchCount=0,this.initialEventTargetForCurrentInteraction=null,this._doubleTapWithOneFingerRecognizer=this._addGestureRecognizer(mn),z(this._doubleTapWithOneFingerRecognizer).numberOfTouchesRequired=1,z(this._doubleTapWithOneFingerRecognizer).numberOfTapsRequired=2,this._singleTapWithOneFingerRecognizer=this._addGestureRecognizer(mn),this._longPressAndPanRecognizer=this._addGestureRecognizer(Sn),z(this._longPressAndPanRecognizer).delegate=this,e.addEventListener(Eo.startEventType,this),e.addEventListener("dragstart",this),this.updateGestureEnableState()}handleEvent(e){const t=z(this._delegate);switch(e.type){case"pointerdown":this._installEndListeners(),this._touchCount++,this.initialEventTargetForCurrentInteraction=t.getEventTargetFromSubShadowDOM(e);break;case"pointerup":case"pointercancel":this._touchCount--,0===this._touchCount&&(this._removeEndListeners(),this.initialEventTargetForCurrentInteraction=null);break;case"dragstart":t.elementShouldPreventDragstart(e.target)&&e.preventDefault();break;case"mousedown":this._installEndListeners(),this.initialEventTargetForCurrentInteraction=t.getEventTargetFromSubShadowDOM(e);break;case"mouseup":this._removeEndListeners(),this.initialEventTargetForCurrentInteraction=null;break;case"touchstart":e.touches.length===e.changedTouches.length&&(this._installEndListeners(),this.initialEventTargetForCurrentInteraction=t.getEventTargetFromSubShadowDOM(e),t.elementWantsDefaultBrowserBehavior(this.initialEventTargetForCurrentInteraction,e,e.touches.length)||e.preventDefault());break;case"touchend":case"touchcancel":0===e.touches.length&&(this._removeEndListeners(),this.initialEventTargetForCurrentInteraction=null);break;case"statechange":this._handleStatechange(e)}}_handleStatechange(e){switch(e.target){case this._doubleTapWithOneFingerRecognizer:this._handleDoubleTapWithOneFingerChange(e);break;case this._singleTapWithOneFingerRecognizer:this._handleSingleTapWithOneFingerChange(e);break;case this._longPressAndPanRecognizer:this._handleLongPressAndPanChange(e)}}gestureRecognizerShouldBegin(e){return z(this._delegate).userDidLongPress(e)}updateGestureEnableState(){const e=z(this._delegate),t=(e.isScrollEnabled?1:0)|(e.isRotationEnabled?2:0)|(e.isZoomEnabled?4:0),i=[void 0,xn,An,Ln,En,Ln,An,Ln];e.rootNode.classList.remove(Ln),e.rootNode.classList.remove(xn),e.rootNode.classList.remove(An),e.rootNode.classList.remove(En),i[t]&&e.rootNode.classList.add(i[t])}mapWasDestroyed(){this._removeEndListeners(),z(this._target).removeEventListener(Eo.startEventType,this),z(this._target).removeEventListener("dragstart",this),z(this._doubleTapWithOneFingerRecognizer).removeEventListener("statechange",this),z(this._doubleTapWithOneFingerRecognizer).enabled=!1,this._doubleTapWithOneFingerRecognizer=null,z(this._singleTapWithOneFingerRecognizer).removeEventListener("statechange",this),z(this._singleTapWithOneFingerRecognizer).enabled=!1,this._singleTapWithOneFingerRecognizer=null,z(this._longPressAndPanRecognizer).removeEventListener("statechange",this),z(this._longPressAndPanRecognizer).enabled=!1,z(this._longPressAndPanRecognizer).delegate=null,this._longPressAndPanRecognizer=null,window.clearTimeout(this._delayedSingleTapRecognizerTimeoutID),this.initialEventTargetForCurrentInteraction=null,this._target=null,this._delegate=null}_addGestureRecognizer(e){const t=new e;return t.target=this._target,t.addEventListener("statechange",this),t}_handleDoubleTapWithOneFingerChange(e){const t=e.target,i=z(this._delegate);t.state===bo.Recognized&&(this._delayedSingleTapRecognizerTimeoutID&&(i.userCanceledTap(),window.clearTimeout(this._delayedSingleTapRecognizerTimeoutID),delete this._delayedSingleTapRecognizerTimeoutID),z(this._singleTapWithOneFingerRecognizer).enabled=!1,i.userDidDoubleTap(t))}_handleSingleTapWithOneFingerChange(e){const t=e.target,i=z(this._delegate);if(z(this._singleTapWithOneFingerRecognizer).enabled&&t.state===bo.Recognized){i.userWillTap(t);const e=i.shouldDelaySingleTap()?350:0;this._delayedSingleTapRecognizerTimeoutID=setTimeout((()=>{delete this._delayedSingleTapRecognizerTimeoutID,i.userDidTap()}),e)}}_handleLongPressAndPanChange(e){const t=e.target,i=z(this._delegate);switch(t.state){case bo.Possible:i.userMayStartPanningAfterLongPress();break;case bo.Began:z(this._singleTapWithOneFingerRecognizer).enabled=!1,z(this._doubleTapWithOneFingerRecognizer).enabled=!1,z(this._doubleTapWithOneFingerRecognizer).enabled=!0;break;case bo.Changed:i.userDidPanAfterLongPress(z(t.translation));break;case bo.Ended:case bo.Failed:z(this._singleTapWithOneFingerRecognizer).enabled=!0,i.userDidStopPanningAfterLongPress(t.state!==bo.Failed)}}_stopDraggingAnnotation(){z(this._longPressAndPanRecognizer).interruptGesture()}_installEndListeners(){window.addEventListener(Eo.endEventType,this),Eo.cancelEventType&&window.addEventListener(Eo.cancelEventType,this)}_removeEndListeners(){window.removeEventListener(Eo.endEventType,this),Eo.cancelEventType&&window.removeEventListener(Eo.cancelEventType,this)}},In=100,On=Math.log(10)/Math.log(2);function Rn(e,t,i,s,o,n){i=l(i,t),s=l(s,t),o=Math.ceil(o),n=Math.ceil(n);const a=Math.ceil(o/t),r=Math.ceil(n/t);for(let s=0;s<a;++s)e.fillRect(i+s*t,0,1,n);for(let i=0;i<r;++i)e.fillRect(0,s+i*t,o,1)}function Pn(e){return"rgb("+e.join(",")+")"}function Dn(e,t,i){return Math.round(t*i+e*(1-i))}const zn=class extends Go{draw(e,t){const i=this.node,s=i.zoom,o=Math.pow(2,s%On),n=In*o,a=n/10,r=Math.min(a,In),h=a<10?0:(r-10)/90,c=i.origin,d=vi.pointsPerAxis(s),u=new ts(-c.x*d,-c.y*d),p=l(u.x,n)-n,m=l(u.y,n)-n,g=this.node.theme;if(e.fillStyle=Pn(g.fillColor),e.fillRect(0,0,i.size.width,i.size.height),i.initialRendering)return;const _=1-Math.pow(1-h,2);_>0&&(e.fillStyle=Pn(function(e,t,i){if(0===i)return e;if(1===i)return t;return[Dn(e[0],t[0],i),Dn(e[1],t[1],i),Dn(e[2],t[2],i)]}(g.fillColor,g.lineColor,_)),Rn(e,a,p,m,i.size.width,i.size.height)),e.fillStyle=Pn(g.lineColor),Rn(e,n,p,m,i.size.width,i.size.height)}};const Nn={light:{fillColor:[248,245,236],lineColor:[149,148,144]},dark:{fillColor:[44,45,47],lineColor:[56,64,66]}};const Fn=class extends Ls{constructor(){var e,t,i;super(),i=!1,(t="initialRendering")in(e=this)?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,this._renderer=new zn(this),this._theme=Nn.light}get size(){return this.parent.size}get zoom(){return this.parent.zoomLevel}get origin(){return this.parent.visibleMapRect.origin}get theme(){return this._theme}updateThemeFromTint(e){const t=Nn[e];t!==this._theme&&(this._theme=t,this.needsDisplay=!0)}stringInfo(){return"BackgroundGridNode"+(this.initialRendering?"!":"")+(this._theme===Nn.light?"":"<dark>")}},Un=Symbol(),Gn=Symbol();function Bn(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Wn=class extends Ho{constructor(...e){super(...e),Bn(this,"delegate",null),Bn(this,"addEventListener",I.prototype.addEventListener),Bn(this,"removeEventListener",I.prototype.removeEventListener),Bn(this,"dispatchEvent",I.prototype.dispatchEvent)}deactivate(){this._impl.deactivate()}destroy(e){this._impl.destroy(e)}get element(){return this._impl.element}get camera(){return this._impl.camera}get minZoomLevel(){return this._impl.currentMinZoomLevel}get maxZoomLevel(){return this._impl.currentMaxZoomLevel}get usesInteractionCenter(){return this._impl.usesInteractionCenter}set usesInteractionCenter(e){this._impl.usesInteractionCenter=e}get currentGestureType(){return this._impl.currentGestureType}set currentGestureType(e){this._impl.currentGestureType=e}get configuration(){return this._impl.configuration}set configuration(e){this._impl.configuration=e}get tint(){return this._impl.tint}get tileTint(){return this._impl.tileTint}get emphasis(){return this._impl.emphasis}get language(){return this._impl.language}set language(e){this._impl.language=e}get allowWheelToZoom(){return this._impl.allowWheelToZoom}set allowWheelToZoom(e){this._impl.allowWheelToZoom=e}get allowWheelToZoom2(){return this._impl.allowWheelToZoom2}set allowWheelToZoom2(e){this._impl.allowWheelToZoom2=e}get pointOfInterestFilter(){return this._impl.pointOfInterestFilter}set pointOfInterestFilter(e){this._impl.pointOfInterestFilter=e}setPoiFiltered(e,t){this._impl.setPoiFiltered&&this._impl.setPoiFiltered(e,t)}get backgroundGridTheme(){return this._impl.backgroundGridTheme}set backgroundGridTheme(e){this._impl.backgroundGridTheme=e}get size(){return this._impl.size}set size(e){this._impl.size=e}get rotation(){return this._impl.rotation}set rotation(e){this._impl.rotation=e}getRotation(){return this._impl.rotation}get isRotationEnabled(){return this._impl.isRotationEnabled}set isRotationEnabled(e){this._impl.isRotationEnabled=e}get isRotationLocked(){return this._impl.isRotationLocked}get cameraIsPanning(){return this._impl.cameraIsPanning}get pannable(){return this._impl.pannable}set pannable(e){this._impl.pannable=e}get cameraIsZooming(){return this._impl.cameraIsZooming}get zoomable(){return this._impl.zoomable}set zoomable(e){this._impl.zoomable=e}get cameraIsRotating(){return this._impl.cameraIsRotating}get cameraIsAnimating(){return!!this._impl.cameraAnimation}get zoomLevel(){return this._impl.zoomLevel}set zoomLevel(e){this._impl.setZoomLevelAnimated(e)}set fontSizeRatio(e){this._impl.fontSizeRatio=e}setZoomLevelAnimated(e,t){this._impl.setZoomLevelAnimated(e,t)}setCameraDistanceAnimated(e,t){this._impl.setCameraDistanceAnimated(e,t)}getCurrentCameraDistance(){return this._impl.getCurrentCameraDistance()}get cameraZoomRange(){return this._impl.cameraZoomRange}setCameraZoomRangeAnimated(e,t){this._impl.setCameraZoomRangeAnimated(e,t)}setCameraZoomLevelLimitAnimated(e,t){this._impl.setCameraZoomLevelLimitAnimated(e,t)}zoomLevelForCameraDistanceAtY(e,t){return this._impl.zoomLevelForCameraDistanceAtY(e,t)}get visibleMapRect(){return this._impl.visibleMapRect}set visibleMapRect(e){this._impl.setVisibleMapRectAnimated(e)}setVisibleMapRectAnimated(e,t){this._impl.setVisibleMapRectAnimated(e,t)}setCenterAnimated(e,t){this._impl.setCenterAnimated(e,t)}setCameraBoundaryAnimated(e,t){this._impl.setCameraBoundaryAnimated(e,t)}isMapPointWithinBounds(e){return this._impl.isMapPointWithinBounds(e)}get showsDefaultTiles(){return this._impl.showsDefaultTiles}set showsDefaultTiles(e){this._impl.showsDefaultTiles=e}get tileOverlays(){return this._impl.tileOverlays}set tileOverlays(e){this._impl.tileOverlays=e}addTileOverlay(e){return this._impl.addTileOverlay(e)}addTileOverlays(e){return this._impl.addTileOverlays(e)}removeTileOverlay(e){return this._impl.removeTileOverlay(e)}removeTileOverlays(e){return this._impl.removeTileOverlays(e)}adjustMapItemPoint(e){return this._impl.adjustMapItemPoint(e)}cameraWillStartZooming(e,t,i){return this._impl.cameraWillStartZooming(e,t,i)}cameraDidStopZooming(){this._impl.cameraDidStopZooming()}get fullyRendered(){return this._impl.fullyRendered}devicePixelRatioDidChange(){return this._impl.devicePixelRatioDidChange()}stringInfo(){return this._impl.stringInfo()}get snapsToIntegralZoomLevels(){return this._impl.snapsToIntegralZoomLevels}set snapsToIntegralZoomLevels(e){this._impl.snapsToIntegralZoomLevels=e}migrateStateTo(e){return this._impl.migrateStateTo(e)}needsReplacing(e){return this._impl.needsReplacing(e)}createLabelRegion(){return this._impl.createLabelRegion()}updatedLabelRegion(){this._impl.updatedLabelRegion()}unregisterLabelRegion(e){this._impl.unregisterLabelRegion(e)}setCameraAnimated(e,t,i){this._impl.setCameraAnimated(e,t,i)}setTintAndEmphasis(e,t,i){this._impl.setTintAndEmphasis(e,t,i)}compassRotationWillStart(){return this._impl.compassRotationWillStart()}compassRotationDidEnd(){this._impl.compassRotationDidEnd()}forceRerender(){}forceDraw(){}requireRender(){}get[Un](){return this._impl[Un]}set[Un](e){this._impl[Un]=e}[Gn](e){return this._impl[Gn](e)}};class Zn{constructor(e,t,i,s){this.center=e||new gi(.5,.5),this._zoom=t||3,this._pointsPerAxis=vi.pointsPerAxis(this._zoom),this.zoom=t||3,this.viewportSize=i||new es,this._rotation=s||0}get zoom(){return this._zoom}set zoom(e){this._zoom!==e&&(this._zoom=e||3,this._pointsPerAxis=vi.pointsPerAxis(this._zoom))}get worldSize(){return this._pointsPerAxis}get rotation(){return this._rotation}set rotation(e){const t=l(e,360);this._rotation=t}minX(){if(0===this._pointsPerAxis)return 0;const e=this.viewportSize.width/this._pointsPerAxis;return this.center.x-e/2}minY(){if(0===this._pointsPerAxis)return 0;const e=this.viewportSize.height/this._pointsPerAxis;return this.center.y-e/2}maxX(){if(0===this._pointsPerAxis)return 0;const e=this.viewportSize.width/this._pointsPerAxis;return this.center.x+e/2}maxY(){if(0===this._pointsPerAxis)return 0;const e=this.viewportSize.height/this._pointsPerAxis;return this.center.y+e/2}equals(e){return this.zoom===e.zoom&&this.center.equals(e.center)&&this.viewportSize.equals(e.viewportSize)&&this.rotation===e.rotation}copy(){return new Zn(this.center,this.zoom,this.viewportSize,this.rotation)}toString(){return"Camera("+["center: ["+this.center.x+", "+this.center.y+"]","zoom: "+this.zoom,"viewportSize: "+this.viewportSize.toString(),"rotation: "+this.rotation].join(", ")+")"}toMapRect(){if(0===this._pointsPerAxis)return new fi(this.center.x,this.center.y,0,0);const e=this.viewportSize.width/this._pointsPerAxis,t=this.viewportSize.height/this._pointsPerAxis,i=Object.create(gi.prototype);i.x=this.center.x-e/2,i.y=this.center.y-t/2;const s=Object.create(_i.prototype);s.width=e,s.height=t;const o=Object.create(fi.prototype);return o.origin=i,o.size=s,o}toRenderingMapRect(){let e=[new ts(this.minX(),this.minY()),new ts(this.maxX(),this.minY()),new ts(this.maxX(),this.maxY()),new ts(this.minX(),this.maxY())];if(0!==this.rotation){const t=(new ss).rotate(this.rotation);e=e.map((e=>t.transformPoint(e)))}let t=e[0].x,i=e[0].y,s=e[0].x,o=e[0].y;for(let n=1;n<e.length;++n){const a=e[n];a.x<t&&(t=a.x),a.x>s&&(s=a.x),a.y<i&&(i=a.y),a.y>o&&(o=a.y)}const n=s-t,a=o-i;return new fi(this.center.x-n/2,this.center.y-a/2,n,a)}translate(e){if(0===this._pointsPerAxis)return this.copy();if(0!==this.rotation){e=(new ss).rotate(-this.rotation).transformPoint(e)}const t=Math.round(e.x)/this._pointsPerAxis,i=Math.round(e.y)/this._pointsPerAxis,s=Object.create(gi.prototype);s.x=l(this.center.x-t,1),s.y=l(this.center.y-i,1);const o=Object.create(Zn.prototype);return o.center=s,o._zoom=this._zoom,o._pointsPerAxis=this._pointsPerAxis,o.viewportSize=this.viewportSize,o._rotation=this._rotation,o}transformMapPoint(e){const t=this.viewportSize.width,i=this.viewportSize.height,s=this._pointsPerAxis,o=(new ss).translate(-this.minX()*s,-this.minY()*s).scale(s).transformPoint(new ts(e.x,e.y)),n=(new ss).translate(t/2,i/2).rotate(this.rotation).translate(t/-2,i/-2).transformPoint(o);return new gi(n.x,n.y)}transformGestureCenter(e){if(0===this.rotation)return e;const t=this.viewportSize.width,i=this.viewportSize.height;return(new ss).translate(t/2,i/2).rotate(-this.rotation).translate(-t/2,-i/2).transformPoint(e)}rotateAroundCenter(e,t){const i=(new ss).translate(e.x,e.y).rotate(-t).translate(-e.x,-e.y).transformPoint(new ts(this.center.x,this.center.y));this.center=new vi.MapPoint(i.x,i.y),this.rotation+=t}withNewMapRect(e,t,i){i=i||this.viewportSize;const s=vi.zoomLevelForMapRectInViewport(e,i,vi.tileSize);return new Zn(new vi.MapPoint(e.midX(),e.midY()),t?Math.floor(s):s,i,this.rotation)}}const Kn=Zn;function jn(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Hn=class{constructor(e,t,i,s){jn(this,"unconstrained",!1),jn(this,"_zoomIsAdditive",!1),this.map=e,this._startCamera=t,this._endCamera=i,this._duration=250,this._rotationCenter=s,e.snapsToIntegralZoomLevels&&(i.zoom=Math.round(i.zoom)),this._updateAnimationRects(),this._startTime=null,this._schedule()}cancel(){this._canceled=!0}get zooming(){return this._startCamera.zoom!==this._endCamera.zoom}set additiveZoom(e){this._zoomIsAdditive=!0,this._endCamera.zoom=e,this._updateAnimationRects()}get zoomIsAdditive(){return this._zoomIsAdditive}get rotating(){return this._startCamera.rotation!==this._endCamera.rotation}adjustRotation(e,t){this._startCamera.rotateAroundCenter(e,t),this._endCamera.rotateAroundCenter(e,t),this._updateAnimationRects()}updateViewportSize(e){this._startCamera=new Kn(this._startCamera.center,this._startCamera.zoom,e,this._startCamera.rotation),this._endCamera=new Kn(this._endCamera.center,this._endCamera.zoom,e,this._endCamera.rotation),this._updateAnimationRects()}performScheduledUpdate(e){this._canceled||(null==e?this._animationDidProgress(1):null==this._startTime?(this._startTime=e,this._schedule()):this._animationDidProgress(Math.min((e-this._startTime)/this._duration,1)))}_updateAnimationRects(){if(this._rotationDelta=this._endCamera.rotation-this._startCamera.rotation,Math.abs(this._rotationDelta)>180&&(this._rotationDelta=this._endCamera.rotation+360-this._startCamera.rotation),this._rotationCenter)return;this._startRect=this._startCamera.toMapRect(),this._animatedEndRect=this._endCamera.toMapRect();const e=this._startCamera.center.x-this._endCamera.center.x;Math.abs(e)>.5&&(e<0?this._startRect.origin.x+=1:this._animatedEndRect.origin.x+=1)}_schedule(){bt.scheduleOnNextFrame(this)}_animationDidProgress(e){if(1===e)return this.map.snapsToIntegralZoomLevels&&(this._endCamera.zoom=Math.round(this._endCamera.zoom)),this.map.cameraAnimationDidProgress(this._endCamera),void this.map.cameraAnimationDidEnd();this._rotationCenter?this._animateAroundCenter(e):this._animateRects(e),this._schedule()}_animateAroundCenter(e){const t=this._startCamera.copy();t.rotateAroundCenter(this._rotationCenter,e*this._rotationDelta),this.map.cameraAnimationDidProgress(t)}_animateRects(e){const t=this._startRect,i=this._animatedEndRect,s=t.origin.x,o=t.origin.y,n=t.size.width,a=t.size.height,r=i.origin.x-t.origin.x,l=i.origin.y-t.origin.y,h=i.size.width-t.size.width,c=i.size.height-t.size.height;let d=this._endCamera.rotation-this._startCamera.rotation;Math.abs(d)>180&&(d=this._endCamera.rotation+360-this._startCamera.rotation);const u=new vi.MapRect(s+r*e,o+l*e,n+h*e,a+c*e),p=this._startCamera.withNewMapRect(u);this.map.cameraAnimationDidProgress(p,this.unconstrained),this.map.rotation=this._startCamera.rotation+this._rotationDelta*e}};const Vn=class{constructor(e,t){this._map=e,this._startEventType=go?"pointerdown":_o?"touchstart":"mousedown",this._map.element.addEventListener(this._startEventType,this)}handleEvent(e){("mousedown"===e.type||"touchstart"===e.type&&e.touches.length===e.changedTouches.length||"pointerdown"===e.type&&e.isPrimary)&&this._map.interactionDidStart()}destroy(){this._map.element.removeEventListener(this._startEventType,this)}};const qn=class{constructor(e){this._map=e,this._recognizers=[]}get map(){return this._map}canTrustGestureCenter(e){return 1===e.numberOfTouchesRequired||!(Eo.supportsGestureEvents&&!Eo.supportsTouches&&Eo.insideIframe)}addRecognizer(e){return this._recognizers.push(e),e.target=this.map.node.element,e.addEventListener("statechange",this),e}interrupt(){this._recognizers.forEach((e=>{e.enabled=!1,e.enabled=!0}))}centerForGesture(e){const t=this.map;return t.usesInteractionCenter||!this.canTrustGestureCenter(e)?t.interactionCenter:this._centerWithRecognizer(e)}destroy(){for(;this._recognizers.length;){const e=this._recognizers.pop();e.enabled=!1,e.target=null,e.removeEventListener("statechange",this)}}};const Yn=Ue.performanceMarkers.interactions,Xn=Math.pow(1e-4,2.5);function $n(e){return e.state===bo.Began||e.state===bo.Changed}const Jn=class extends qn{constructor(e){var t,i,s;super(e),s=!1,(i="decelerating")in(t=this)?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,this._pinchRecognizer=this.addRecognizer(new bn),this._pinchRecognizer.scaleThreshold=.1,this._doubleTapWithOneFingerRecognizer=this.addRecognizer(new mn),this._doubleTapWithOneFingerRecognizer.numberOfTouchesRequired=1,this._doubleTapWithOneFingerRecognizer.numberOfTapsRequired=2,this._singleTapWithTwoFingersRecognizer=this.addRecognizer(new mn),this._singleTapWithTwoFingersRecognizer.numberOfTouchesRequired=2,this._singleTapWithTwoFingersRecognizer.numberOfTapsRequired=1}stopDecelerating(){this.decelerating&&this._decelerationEnded()}destroy(){super.destroy(),delete this._pinchRecognizer,delete this._doubleTapWithOneFingerRecognizer,delete this._singleTapWithTwoFingersRecognizer,this.stopDecelerating()}get active(){return $n(this._pinchRecognizer)||$n(this._doubleTapWithOneFingerRecognizer)||$n(this._singleTapWithTwoFingersRecognizer)}handleEvent(e){const t=e.target;switch(t){case this._pinchRecognizer:this._handlePinchChange(t);break;case this._doubleTapWithOneFingerRecognizer:this._handleDoubleTapWithOneFingerChange(t);break;case this._singleTapWithTwoFingersRecognizer:this._handleSingleTapWithTwoFingersChange(t)}Yn&&performance.measure("mapkit-map-zoom-interaction",{start:t.lastEventTimeStamp,detail:t.state})}performScheduledUpdate(e){const t=Yn?performance.now():void 0;if(!this.decelerating)return;if(null==e)return void this._decelerationEnded();const i=this.map,s=e-this._startTime;if(s>=this._decelerationDuration)return i.scaleCameraAroundMapPoint(this._adjustedScaleAtDecelerationEnd/this._scale,this._lastScaleCenter),this._decelerationEnded(),void(Yn&&performance.measure("mapkit-map-zoom-deceleration",{start:t}));let o=this._scaleAtTime(s);const n=(o-this._initialScale)/(this._scaleAtDecelerationEnd-this._initialScale);o+=this._scaleAdjustment*n,i.scaleCameraAroundMapPoint(o/this._scale,this._lastScaleCenter);const a=i.camera.zoom;a===i.currentMinZoomLevel||a===this.currentMaxZoomLevel?this.stopDecelerating():(this._scale=o,this._schedule()),Yn&&performance.measure("mapkit-map-zoom-deceleration",{start:t})}_centerWithRecognizer(e){const t=this.map,i=e.locationInElement();let s=t.node.convertPointFromPage(i);s=t.camera.transformGestureCenter(s);const o=t.visibleMapRect,n=t.camera.viewportSize;return new vi.MapPoint(o.minX()+s.x/n.width*o.size.width,o.minY()+s.y/n.height*o.size.height)}_handlePinchChange(e){const t=this.map,i=t.camera,s=i.zoom;if(e.state===bo.Began)this._singleTapWithTwoFingersRecognizer.enabled=!1,this.map.currentGestureType="pinch",t.cameraWillStartZooming(Ws.Pinch);else if(e.state===bo.Ended||e.state===bo.Changed){const i=e.scale;this._lastScaleCenter=this.centerForGesture(e),(i>1&&s!==t.currentMaxZoomLevel||i<1&&s!==t.currentMinZoomLevel)&&(t.scaleCameraAroundMapPoint(i,this._lastScaleCenter),e.scale=1)}if((e.state===bo.Ended||e.state===bo.Failed)&&(this._singleTapWithTwoFingersRecognizer.enabled=!0,this._startDeceleratingWithVelocity(e),!this.decelerating)){const e=t.snapsToIntegralZoomLevels?Math.round(s):s,o=c(e,t.currentMinZoomLevel,t.currentMaxZoomLevel);s===o?t.cameraDidStopZooming():this._lastScaleCenter?t.scaleCameraAroundMapPoint(Math.pow(2,o-s),this._lastScaleCenter,!0):t.setCameraAnimated(new Kn(i.center,o,i.viewportSize,i.rotation),!0)}}_handleDoubleTapWithOneFingerChange(e){e.state===bo.Recognized&&this._zoomWithTapRecognizer(e,e.modifierKeys.alt)}_handleSingleTapWithTwoFingersChange(e){e.state===bo.Recognized&&this._zoomWithTapRecognizer(e,!0)}_zoomWithTapRecognizer(e,t){const i=this.map,s=i.camera.zoom,o=t?-1:1,n=(t?Math.floor(s+.5):Math.ceil(s-.5))+o,a=s-c(n,i.currentMinZoomLevel,i.currentMaxZoomLevel);this.map.currentGestureType="double-tap",Math.abs(a)<.5||!i.cameraWillStartZooming(Ws.DoubleTap,!0,!0)||(i.setCameraAnimated(i.camera.withNewMapRect(i.visibleMapRect.scale(Math.pow(2,a),this.centerForGesture(e))),!0),Yn&&performance.measure("mapkit-map-zoom-interaction",{start:e.lastEventTimeStamp,detail:e.state}))}_startDeceleratingWithVelocity(e){let t=e.velocity;Math.abs(t)<1||(8<t&&(t=8),t<-8&&(t=-8),this.decelerating=!0,this._startTime=e.lastEventTimeStamp,this._initialScale=this._scale=1,this._initialVelocity=t/1e3,this._decelerationFactor=.98875,this._decelerationDuration=Math.log(Xn/Math.pow(this._initialVelocity,2))/(2*Math.log(this._decelerationFactor)),this._scaleAtDecelerationEnd=this._scaleAtTime(this._decelerationDuration),this._adjustedScaleAtDecelerationEnd=this._adjustScaleAtDecelerationEnd(this._scaleAtDecelerationEnd/this._scale),this._scaleAdjustment=this._adjustedScaleAtDecelerationEnd-this._scaleAtDecelerationEnd,this._schedule())}_adjustScaleAtDecelerationEnd(e){const t=this.map,i=t.camera.zoom;let s=i+h(e);if(t.snapsToIntegralZoomLevels){let e=Math.round(s);s>i&&e<=i?e=Math.ceil(s):s<i&&e>=i&&(e=Math.floor(s)),s=e}const o=c(s,t.currentMinZoomLevel,t.currentMaxZoomLevel);return Math.pow(2,o-i)}_schedule(){bt.scheduleOnNextFrame(this)}_scaleAtTime(e){return Math.max(this._initialScale+this._decelerationFactor*this._initialVelocity*(Math.pow(this._decelerationFactor,e)-1)/(this._decelerationFactor-1),0)}_decelerationEnded(){this.decelerating=!1;const e=this.map;if(e.snapsToIntegralZoomLevels){const t=e.camera,i=e.snapsToIntegralZoomLevels?Math.round(t.zoom):t.zoom;e.setCameraAnimated(new Kn(t.center,i,t.viewportSize,t.rotation))}e.cameraDidStopZooming()}};const Qn=1e8,ea=.995,ta=Ue.performanceMarkers.interactions;const ia=class extends qn{constructor(e){var t,i,s;super(e),s=!1,(i="decelerating")in(t=this)?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s;this.addRecognizer(new vn).maximumNumberOfTouches=2}stopDecelerating(){this.decelerating&&this._decelerationEnded()}destroy(){super.destroy(),this.stopDecelerating()}handleEvent(e){const t=e.target,i=this.map;i.usesInteractionCenter&&i.cameraIsZooming||(t.state===bo.Began?(this.map.currentGestureType="drag",i.cameraWillStartPanning()):t.state!==bo.Ended&&t.state!==bo.Changed||(this._panMapCameraBy(t.translation),t.translation=new ts),t.state===bo.Ended&&(this._startDeceleratingWithVelocity(t),this.decelerating||i.cameraDidStopPanning()),ta&&performance.measure("mapkit-map-pan-interaction",{start:t.lastEventTimeStamp,detail:t.state}))}performScheduledUpdate(e){const t=ta?performance.now():void 0;if(!this.decelerating)return;if(null==e)return void this._decelerationEnded();const i=e-this._timeAtPreviousFrame;if(i>300)return void this._decelerationEnded();const s=Math.exp(Math.log(ea)*i),o=ea*((1-s)/.0050000000000000044);if(this._panMapCameraBy(new ts(this._velocity.x/1e3*o,this._velocity.y/1e3*o)),this._velocity.x*=s,this._velocity.y*=s,Math.abs(this._velocity.x)<=10&&Math.abs(this._velocity.y)<=10)return this._decelerationEnded(),void(ta&&performance.measure("mapkit-map-pan-deceleration",{start:t}));this._timeAtPreviousFrame=e,this._schedule(),ta&&performance.measure("mapkit-map-pan-deceleration",{start:t})}_panMapCameraBy(e){const t=this.map;t.setCameraAnimated(t.camera.translate(e))}_startDeceleratingWithVelocity(e){const t=e.velocity;this._velocity=t,this.map.cameraWillStopPanning();const i=Math.pow(t.x,2)+Math.pow(t.y,2);if(!(i<62500)){if(i>Qn){const e=Math.sqrt(Qn/i);this._velocity={x:t.x*e,y:t.y*e}}this.decelerating=!0,this._timeAtPreviousFrame=e.lastEventTimeStamp,this._schedule()}}_schedule(){bt.scheduleOnNextFrame(this)}_decelerationEnded(){this.decelerating=!1,this.map.cameraDidStopPanning()}};const sa={getCorsAttribute:function(e){return e?"use-credentials":"anonymous"}};const oa=class extends he{constructor(e,t){super(e,t),this._image=null,this.crossOrigin=null}get image(){return this._image}get url(){return this._image?.src??null}reuse(e,t){this._init(e,t)}_loaderWillStart(){super._loaderWillStart(),this._image||(this._image=document.createElement("img"));const e=this._getDelegate().urlForImageLoader;this._image.crossOrigin=this.crossOrigin,this._image.src=e,this._image.addEventListener("load",this),this._image.addEventListener("error",this)}handleEvent(e){switch(e.type){case"error":this._loaderDidFail(this._image);break;case"load":this._loaderDidSucceed(null)}}_reset(){this._image&&(this._image.removeEventListener("load",this),this._image.removeEventListener("error",this)),super._reset()}},na={},aa=[];function ra(e,t){let i;return aa.length>0?(i=aa.shift(),i.reuse(e,t)):i=new oa(e,t),i}const la=class{constructor(e,t,i,s,o,n,a,r,l,h,c){this.x=e,this.y=t,this.z=i,this.tileSource=s,this.tint=o,this.emphasis=n,this.language=a,this.poi=r?1:0,this.labels=l?1:0,this.resolution=h,this._priority=c,this._loader=ra(c,this),this._setLoaderCrossOriginMode()}get preferredOpacity(){return"number"==typeof this.tileSource.opacity?this.tileSource.opacity:1}get loaderState(){return this._loader?this._loader.state:le.Unscheduled}schedule(){this._loader||(this._loader=ra(this._priority,this),this._setLoaderCrossOriginMode()),this._loader.state>le.Unscheduled||this._loader.schedule()}unschedule(){if(!this._loader)return;this._loader.unschedule()&&(aa.push(this._loader),this._loader=null)}whenDoneLoading(e){this._doneLoadingCallback=e}get urlForImageLoader(){const e=this.tileSource;if("function"==typeof e.urlForImageLoader)return e.urlForImageLoader(this.x,this.y,this.z,this.resolution);const t=e.domains,i=e.proxyPrefixes,s=e.protocol,o=e.supportedResolutions[0],n=e.supportedResolutions[e.supportedResolutions.length-1],a=c(this.resolution,o,n);let r=1;if("satellite"===e.name){const t=e.supportedSizes.length-1,i=e.supportedSizes[0],s=e.supportedSizes[t];r=c(this.resolution,i,s)}let l=f(e.path,{x:this.x,y:this.y,z:this.z,resolution:a,tileSizeIndex:r,lang:this.language,poi:this.poi});"satellite"!==e.name&&(0===this.labels?l+="&labels=0&tint="+this.tint+"&emphasis="+this.emphasis:l+="&emphasis="+this.emphasis+"&tint="+this.tint);let h=na[l];if(h)return h;const d=Math.floor(76731.36742*(this.x+this.y))%t.length;if(h=s+"//"+t[d]+l,i){h=i[d%i.length]+h}return na[l]=h,h}loaderDidSucceed(e){this._loaderDidComplete()}loaderDidFail(e){this._loaderDidComplete()}_setLoaderCrossOriginMode(){this.tileSource.crossOrigin&&(this._loader.crossOrigin=sa.getCorsAttribute(this.tileSource.withCredentials))}_loaderDidComplete(){this.image=this._loader.image,"function"==typeof this._doneLoadingCallback&&(this._doneLoadingCallback(this),delete this._doneLoadingCallback)}};function ha(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class ca extends I{constructor(e,t,i,s,o,n,a){super(),ha(this,"loading",!1),ha(this,"loaded",!1),this.key=e,this.x=t,this.y=i,this.z=s,this.settings=o,this.resolution=n,this.priority=a,this.tileImages=[]}get tileSources(){return(this.settings.showsDefaultTiles?this.settings.configuration.tileSources:[]).concat(this.settings.tileOverlays.map((e=>e._impl)).filter((function(e){return!!e.urlForImageLoader(this.x,this.y,this.z,this.resolution)}),this)).filter((function(e){return(this.z>=e.minZoomLevel||"number"!=typeof e.minZoomLevel)&&(this.z<=e.maxZoomLevel||"number"!=typeof e.maxZoomLevel)}),this)}schedule(){this.loaded||(this.tileImages.forEach((e=>{e.schedule()})),this.loading=!0)}unschedule(){this.tileImages.forEach((e=>{e.unschedule()})),this.loading=!1}_loadTileImages(){if(this.loading)return;if(this.loaded){if(!this._containsCanceledTileImages())return;this.tileImages=[],this.loaded=!1}this.loading=!0;const e=this.tileSources;0!==e.length?(this._pendingTileImageLoads=e.length,e.forEach(this._loadTileImage,this)):this._allTileImagesDoneLoading()}_loadTileImage(e){const t=this.settings,i=new la(this.x,this.y,this.z,e,t.tint,t.emphasis,t.language,t.showsPOI,t.showsLabels,this.resolution,this.priority);i.schedule(),this.tileImages.push(i),i.whenDoneLoading((()=>this._tileImageDoneLoading(e,i)))}_requestTileImageLoadStatus(e,t){const i=ae(t,e.image.src);i.open("GET",e.image.src,!0),i.send()}_tileImageDoneLoading(e,t){if(t._loader.state===le.Failed)if("function"==typeof e.dispatchErrorForURL)e.dispatchErrorForURL(t._loader.url);else{const e=new O(ca.Events.LoadFail);e.tileImage=t,this.dispatchEvent(e)}this._pendingTileImageLoads--,0===this._pendingTileImageLoads&&this._allTileImagesDoneLoading()}_allTileImagesDoneLoading(){delete this._pendingTileImageLoads,this.loading=!1,this.loaded=!0,this._containsCanceledTileImages()||this.dispatchEvent(new O(ca.Events.LoadSuccess))}_containsCanceledTileImages(){return this.tileImages.some((e=>e.loaderState===le.Canceled))}}ha(ca,"Events",{LoadSuccess:"tile-load-success",LoadFail:"tile-load-fail"});const da=ca,ua={},pa={tilesForTileData:function(e){const t=e.range,i=t.min.z,s=Math.pow(2,i),o=t.min,n=t.denormalize().max,a=new ts((o.x+n.x)/2,(o.y+n.y)/2),r=[],h=Math.min(n.x,o.x+s-1);for(let e=o.x;e<=h;++e)for(let t=o.y;t<=n.y;++t)r.push(new ts(e,t));return r.sort(((e,t)=>{const i=e.distanceToPoint(a)-t.distanceToPoint(a);return 0===i?e.x-t.x==0?e.y-t.y:e.x-t.x:i})),r.map((t=>function(e,t,i,s,o){const n=ma(e,t,i,s);let a=ua[n];a?a.schedule():(a=new da(n,e,t,i,s.settings,s.resolution,o),a.addEventListener(da.Events.LoadSuccess,ga),a.addEventListener(da.Events.LoadFail,_a),ua[n]=a,a._refCount=0,a._loadTileImages());return a._refCount++,a}(l(t.x,s),t.y,i,e,V.High)))},releaseTile:function(e,t){if(e._refCount--,0===e._refCount){e.unschedule();const i=ma(e.x,e.y,e.z,t);delete ua[i]}}};function ma(e,t,i,s){return s.settings.configuration.provider+s.settings.configuration.countryCode+s.settings.configuration.name+e+"-"+t+"-"+i+s.settings.tint+s.settings.emphasis+s.settings.language+s.settings.showsPOI+s.settings.showsLabels+s.settings.showsDefaultTiles+s.settings.showsTileInfo+s.resolution+s.settings.tileOverlays.map((s=>s._impl.keyForTile(e,t,i))).join("-")}function ga(e){const t=e.target;t.removeEventListener(da.Events.LoadSuccess,ga),t.removeEventListener(da.Events.LoadFail,_a)}function _a(e){const t=e.target;delete ua[t.key],t.removeEventListener(da.Events.LoadSuccess,ga),t.removeEventListener(da.Events.LoadFail,_a)}const fa=pa;class ya{constructor(e,t){this.min=e,this.max=t}denormalize(){const e=this.min.copy(),t=this.max.copy();return t.x<e.x&&(t.x+=Math.pow(2,e.z)),new ya(e,t)}toString(){return this.min.toString()+" -> "+this.max.toString()}equals(e){const t=this.denormalize(),i=e.denormalize();return i.min.x===t.min.x&&i.min.y===t.min.y&&i.max.x===t.max.x&&i.max.y===t.max.y&&i.min.z===t.min.z&&i.max.z===t.max.z}}const va=ya;const ba=class{constructor(e,t){const i=Eo.getIntegralZoom(e.zoom),s=Math.pow(2,i),o=Math.pow(2,e.zoom)*vi.tileSize,n=e.viewportSize.width/o/2,a=e.viewportSize.height/o/2,r=new vi.MapPoint(e.center.x-n,e.center.y-a),l=new vi.MapPoint(e.center.x+n,e.center.y+a),h=s-1,d=Math.floor(r.x*s),u=Math.floor(l.x*s),p=c(Math.floor(r.y*s),0,h),m=c(Math.floor(l.y*s),0,h);this.range=new va(new ts(d,p,i),new ts(u,m,i)),this.settings=t,this.resolution=Eo.imagePixelRatio,this.zoom=i,this.mapRect=new vi.MapRect(d/s,p/s,(u-d)/s,(m-p)/s),this.mapRect.size.width<0&&this.mapRect.size.width++}equals(e){return this.sameSettings(e)&&this.resolution===e.resolution&&this.range.equals(e.range)}sameSettings(e){const t=this.settings,i=e.settings;return t.configuration===i.configuration&&t.tint===i.tint&&t.emphasis===i.emphasis&&t.showsPOI===i.showsPOI&&t.showsLabels===i.showsLabels&&t.language===i.language&&t.showsDefaultTiles===i.showsDefaultTiles&&t.showsTileInfo===i.showsTileInfo&&this.sameTileOverlays(e)}sameTileOverlays(e){return this.settings.tileOverlays.length===e.settings.tileOverlays.length&&this.settings.tileOverlays.every(((t,i)=>t===e.settings.tileOverlays[i]&!t._impl.stale),this)}sharesTileSourcesWithTileData(e){if(this.settings.tint!==e.settings.tint||this.settings.emphasis!==e.settings.emphasis)return!1;const t=this.settings.configuration.tileSources,i=e.settings.configuration.tileSources;return!("AutoNavi"!==this.settings.configuration.provider||"AutoNavi"!==e.settings.configuration.provider||1!==t.length||1!==i.length||"satellite"!==t[0].name&&"hybrid"!==t[0].name||"satellite"!==i[0].name&&"hybrid"!==i[0].name)||i.some((e=>-1!==t.indexOf(e)))}load(){this._tiles||(this._tiles=fa.tilesForTileData(this))}cancel(){if(!this._canceled&&(this._canceled=!0,this._tiles))for(let e=0,t=this._tiles,i=t.length;e<i;++e)t[e].unschedule()}releaseTiles(){if(this._tiles)for(let e=0,t=this._tiles,i=t.length;e<i;++e)fa.releaseTile(t[e],this)}get tiles(){return this.load(),this._tiles}};function wa(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Ca=["minimumZ","maximumZ","opacity","data"];class ka{constructor(e,t,i){wa(this,"_minimumZ",null),wa(this,"_maximumZ",null),wa(this,"_data",{}),wa(this,"withCredentials",!1),wa(this,"crossOrigin",!1),this._public=e,i=_(i),Ca.forEach((function(e){void 0!==i[e]&&(this[e]=i[e])}),this),Object.keys(i).forEach((e=>{Ca.indexOf(e)<0&&console.warn("[MapKit] Unknown option: "+e+". Use the data property to store custom data.")})),this.urlTemplate=t,void 0===this.opacity&&(this.opacity=1),this.stale=!1}get urlTemplate(){return this._urlTemplate}set urlTemplate(e){const t=typeof e;if("function"!==t&&"string"!==t){throw new TypeError("[MapKit] TileOverlay.urlTemplate expected a function or a string, but got `"+e+"` instead.")}this._urlTemplate=e}keyForTile(e,t,i){return this._minimumZ+"-"+this._maximumZ+"-"+this.urlForImageLoader(e,t,i,1)}get minimumZ(){return this._minimumZ}get minZoomLevel(){return this._minimumZ}set minimumZ(e){p(e,"number","[MapKit] TileOverlay.minimumZ expected a number, but got `"+e+"` instead."),this._minimumZ=Math.floor(e)}get maximumZ(){return this._maximumZ}get maxZoomLevel(){return this._maximumZ}set maximumZ(e){p(e,"number","[MapKit] TileOverlay.maximumZ expected a number, but got `"+e+"` instead."),this._maximumZ=Math.ceil(e)}get opacity(){return this._opacity}set opacity(e){p(e,"number","[MapKit] TileOverlay.opacity expected a number, but got `"+e+"` instead."),this._opacity=c(e,0,1);const t=new Be.Event(ka.OPACITY_EVENT);t.tileOverlay=this,t.opacity=this._opacity,this._public.dispatchEvent(t)}get data(){return this._data}set data(e){p(e,"object","[MapKit] TileOverlay.data expected an Object, but got `"+e+"` instead."),this._data=e}reload(){this.stale=!0;const e=new Be.Event(ka.RELOAD_EVENT);e.tileOverlay=this,this._public.dispatchEvent(e)}reloadComplete(){this.stale=!1}urlForImageLoader(e,t,i,s){if(!this._urlTemplate)return;if("function"==typeof this._urlTemplate)return ue(this._urlTemplate,null,[e,t,i,s,this._data]);const o=this._urlTemplate.replace(/\{/g,"{{").replace(/\}/g,"}}");const n={};return this._data&&Object.keys(this._data).forEach((e=>{n[e]=this._data[e]})),n.x=e,n.y=t,n.z=i,n.scale=s,f(o,n)}dispatchErrorForURL(e){const t=new Be.Event(ka.ERROR_EVENT);t.tileOverlay=this._public,t.tileUrl=e,this._public.dispatchEvent(t)}}wa(ka,"RELOAD_EVENT","tile-overlay-reload"),wa(ka,"OPACITY_EVENT","tile-overlay-opacity-changed"),wa(ka,"ERROR_EVENT","tile-error");const Ma=ka;const Sa=class extends Ge{constructor(e,t){super(),Object.defineProperty(this,"_impl",{value:new Ma(this,e,t)})}get urlTemplate(){return this._impl.urlTemplate}set urlTemplate(e){this._impl.urlTemplate=e}get minimumZ(){return this._impl.minimumZ}set minimumZ(e){this._impl.minimumZ=e}get maximumZ(){return this._impl.maximumZ}set maximumZ(e){this._impl.maximumZ=e}get opacity(){return this._impl.opacity}set opacity(e){this._impl.opacity=e}get data(){return this._impl.data}set data(e){this._impl.data=e}reload(){this._impl.reload()}},La=(e,t)=>{let i=e;for(;i.parentNode!==document.body;){i=i.parentNode,window.ShadowRoot&&i instanceof window.ShadowRoot&&(i=i.host);const e=window.getComputedStyle(i);switch(t){case"x":if(["auto","scroll"].includes(e.overflowX)&&i.scrollWidth>i.clientWidth)return!0;break;case"y":if(["auto","scroll"].includes(e.overflowY)&&i.scrollHeight>i.clientHeight)return!0}if("fixed"===e.position)return!1}switch(t){case"x":{const e=window.getComputedStyle(document.body).overflowX,t=window.getComputedStyle(document.documentElement).overflowX;if(["auto","scroll","visible"].includes(e)&&["auto","scroll","visible"].includes(t)&&("CSS1Compat"===document.compatMode?document.documentElement.scrollWidth>document.documentElement.clientWidth:document.body.scrollWidth>document.body.clientWidth))return!0;break}case"y":{const e=window.getComputedStyle(document.body).overflowY,t=window.getComputedStyle(document.documentElement).overflowY;if(["auto","scroll","visible"].includes(e)&&["auto","scroll","visible"].includes(t)&&("CSS1Compat"===document.compatMode?document.documentElement.scrollHeight>document.documentElement.clientHeight:document.body.scrollHeight>document.body.clientHeight))return!0;break}}return!1};function xa(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Aa(e,t,i){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,i)}function Ea(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,Ia(e,t,"set"),i),i}function Ta(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,Ia(e,t,"get"))}function Ia(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}const Oa=.0075,Ra=100;function Pa(e,t){switch(t){case WheelEvent.DOM_DELTA_LINE:e*=100/3*window.devicePixelRatio;break;case WheelEvent.DOM_DELTA_PAGE:e*=100*window.devicePixelRatio;case WheelEvent.DOM_DELTA_PIXEL:}return e}var Da=new WeakMap,za=new WeakMap,Na=new WeakMap,Fa=new WeakMap;class Ua{constructor(){Aa(this,Da,{writable:!0,value:!1}),Aa(this,za,{writable:!0,value:!1}),xa(this,"allowWheelToZoom",!1),xa(this,"allowWheelToZoom2",!1),xa(this,"pannable",!1),xa(this,"zoomable",!1),xa(this,"element",void 0),Aa(this,Na,{writable:!0,value:void 0}),Aa(this,Fa,{writable:!0,value:void 0})}classifyWheelEvent(e){if(!Ta(this,Da)&&!Ta(this,za)&&!e.ctrlKey&&!e.shiftKey&&this.allowWheelToZoom2){const t=e.target;if(e.deltaX&&La(t,"x"))return;if(e.deltaY&&La(t,"y"))return}const t=function(e){return e.ctrlKey}(e),i=this.allowWheelToZoom||this.allowWheelToZoom2;if(!t&&!e.shiftKey&&!i)return;const s=function(e){const t=e.shiftKey&&!!e.deltaX&&!e.deltaY;let i=t?e.deltaX:e.deltaY;return i=Pa(i,e.deltaMode),(e.ctrlKey||!e.shiftKey||t)&&(i*=-1),e.ctrlKey&&e.deltaMode===e.DOM_DELTA_PIXEL&&(i*=10),1+(i>0?Math.sqrt(i):-Math.sqrt(-i))*Oa}(e),o=3*Math.abs(e.deltaX)>2*Math.abs(e.deltaY),n=this.allowWheelToZoom2&&!Ta(this,za)&&(Ta(this,Da)||1===s||!e.shiftKey&&o);if((!n||this.pannable)&&(n||this.zoomable)){if(n?(clearTimeout(Ta(this,Na)),Ea(this,Na,setTimeout((()=>{Ea(this,Da,!1)}),Ra)),Ea(this,Da,!0)):(clearTimeout(Ta(this,Fa)),Ea(this,Fa,setTimeout((()=>{Ea(this,za,!1)}),Ra)),Ea(this,za,!0)),e.preventDefault(),n){const t=-Pa(e.deltaX,e.deltaMode),i=-Pa(e.deltaY,e.deltaMode);if(0===t&&0===i)return;return{is:"pan",translation:new ts(t,i)}}return{is:"zoom",scale:s}}}resetGesture(){clearTimeout(Ta(this,Na)),clearTimeout(Ta(this,Fa)),Ea(this,Da,!1),Ea(this,za,!1)}destroy(){clearTimeout(Ta(this,Na)),clearTimeout(Ta(this,Fa))}}function Ga(e,t,i){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,i)}function Ba(e,t){var i=function(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}(e,t,"get");return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,i)}const Wa=Ue.performanceMarkers.interactions,Za=Math.log2(1.03)/(1e3/60),Ka=Math.log2(.97)/(1e3/60),ja=Math.log2(1.06)/(1e3/60),Ha=Math.log2(.94)/(1e3/60),Va=Math.log2(1.0075),qa=Math.log2(.9925);var Ya=new WeakMap;const Xa=class{constructor(e){var t,i,s;s=!1,(i="_animating")in(t=this)?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,Ga(this,Ya,{writable:!0,value:new Ua}),this.map=e,this.map.node.element.addEventListener("wheel",this),this._previousZoomLevelDelta=[],this.pannable=!1,this.zoomable=!1}destroy(){z(this.map).node.element.removeEventListener("wheel",this),clearTimeout(this._wheelEndTimeoutId),Ba(this,Ya).destroy(),this.map=null,this._animationEndingTimeoutId&&clearTimeout(this._animationEndingTimeoutId)}handleEvent(e){this._handleWheelZoom(e)}performScheduledUpdate(e=performance.now()){if(!this.map)return;const t=this.zoomsIn?Math.ceil(z(this._accumulatedDesiredZoomLevelDelta)):Math.floor(z(this._accumulatedDesiredZoomLevelDelta)),i=e-z(this._timeAtLastFrame),s=this._getEstimatedSpeedPerMS()*i;this._accumulatedZoomLevelDelta=z(this._accumulatedZoomLevelDelta)+s,this._timeAtLastFrame=e;if(!(this.zoomsIn&&this._accumulatedZoomLevelDelta<t||!this.zoomsIn&&this._accumulatedZoomLevelDelta>t)){const e=this.map.zoomLevel,t=Math.round(this.map.zoomLevel);return this.map.scaleCameraAroundMapPoint(Math.pow(2,t-e),z(this._lastScaleCenter)),this._animating=!1,this._previousEstimatedSpeedPerMS=void 0,void(this._animationEndingTimeoutId=setTimeout((()=>{this._animationEndingTimeoutId=void 0,z(this.map).cameraDidStopZooming()}),Ra))}this.map.scaleCameraAroundMapPoint(Math.pow(2,s),z(this._lastScaleCenter)),bt.scheduleOnNextFrame(this)}resetWheelEventGesture(){Ba(this,Ya).resetGesture()}_handleWheelZoom(e){Ba(this,Ya).pannable=this.pannable,Ba(this,Ya).zoomable=this.zoomable,Ba(this,Ya).allowWheelToZoom=z(this.map).allowWheelToZoom,Ba(this,Ya).allowWheelToZoom2=z(this.map).allowWheelToZoom2;const t=Ba(this,Ya).classifyWheelEvent(e);if(!t)return;if("pan"===t.is)return this._wheelPanning||(z(this.map).currentGestureType="wheel",z(this.map).cameraWillStartPanning(),this._wheelPanning=!0),z(this.map).setCameraAnimated(z(this.map).camera.translate(t.translation)),this._wheelEndTimeoutId&&(clearTimeout(this._wheelEndTimeoutId),this._wheelEndTimeoutId=null),void(this._wheelEndTimeoutId=setTimeout((()=>{this._wheelEndTimeoutId=null,this._wheelPanning=!1,z(this.map).cameraWillStopPanning(),z(this.map).cameraDidStopPanning()}),Ra));const i=t.scale,s=z(this.map);if(1===i||i>1&&s.camera.zoom===s.currentMaxZoomLevel||i<1&&s.camera.zoom===s.currentMinZoomLevel)return;const o=new ts(e.pageX,e.pageY);this._lastScaleCenter=s.usesInteractionCenter?s.interactionCenter:this._mapPointFromCentroid(o),s.snapsToIntegralZoomLevels?this._integralZoomToScale(i,this._lastScaleCenter,e.timeStamp):this._wheelZoomToScale(i),Wa&&performance.measure("mapkit-map-zoom-interaction",{start:e.timeStamp,detail:"changed"})}_mapPointFromCentroid(e){const t=z(this.map);let i=t.node.convertPointFromPage(e);i=t.camera.transformGestureCenter(i);const s=t.visibleMapRect,o=t.camera.viewportSize;return new gi(s.minX()+i.x/o.width*s.size.width,s.minY()+i.y/o.height*s.size.height)}_integralZoomToScale(e,t,i){this._lastUpdateTime=i;const s=Math.log2(e);this.zoomsIn=s>0,this._lastScaleCenter=t,this._previousZoomLevelDelta.push({delta:s,timestamp:i}),this._animating?this._accumulatedDesiredZoomLevelDelta=z(this._accumulatedDesiredZoomLevelDelta)+s:(this._cleanupPreviousZoomLevelDelta(),qa<=s&&s<=Va&&this._previousZoomLevelDelta.length<=1||(this._animating=!0,this._accumulatedZoomLevelDelta=0,this._accumulatedDesiredZoomLevelDelta=s,this._timeAtLastFrame=i,this._animationEndingTimeoutId?(clearTimeout(this._animationEndingTimeoutId),this._animationEndingTimeoutId=void 0):(z(this.map).currentGestureType="wheel",z(this.map).cameraWillStartZooming(Ws.Scroll)),bt.scheduleOnNextFrame(this)))}_cleanupPreviousZoomLevelDelta(){const e=performance.now()-100,t=this.zoomsIn?1:-1;for(let i=0;i<this._previousZoomLevelDelta.length;i++)(this._previousZoomLevelDelta[i].timestamp<e||this._previousZoomLevelDelta[i].delta*t<0)&&this._previousZoomLevelDelta.splice(i,1)}_getEstimatedSpeedPerMS(){if(this._cleanupPreviousZoomLevelDelta(),this._previousZoomLevelDelta.length<=1)return this._previousEstimatedSpeedPerMS?this._previousEstimatedSpeedPerMS:this.zoomsIn?ja:Ha;let e=this._previousZoomLevelDelta.reduce(((e,t)=>e+t.delta),0)/100;return Ka<e&&e<Za&&(e=this.zoomsIn?Za:Ka),this._previousEstimatedSpeedPerMS=e,e}_wheelZoomToScale(e){const t=z(this.map);this._wheelZooming||(t.currentGestureType="wheel",t.cameraWillStartZooming(Ws.Scroll),this._wheelZooming=!0),t.scaleCameraAroundMapPoint(e,z(this._lastScaleCenter)),this._wheelEndTimeoutId&&(clearTimeout(this._wheelEndTimeoutId),this._wheelEndTimeoutId=null),this._wheelEndTimeoutId=setTimeout((()=>{this._wheelEndTimeoutId=null,this._wheelZooming=!1,t.cameraDidStopZooming()}),Ra)}};function $a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Ja=1-Math.pow(2,-52),Qa=Math.PI/3,er=Math.tan(Qa/2);class tr{constructor(e){$a(this,"minZoomLevel",tr.DEFAULT_MIN_ZOOM_LEVEL),$a(this,"maxZoomLevel",tr.DEFAULT_MAX_ZOOM_LEVEL),$a(this,"usesInteractionCenter",!1),$a(this,"currentGestureType",!1),$a(this,"cameraAnimation",null),$a(this,"_isRotationEnabled",!1),$a(this,"isRotationLocked",!0),$a(this,"_snapsToIntegralZoomLevels",!1),$a(this,"restrictIncomingRotation",!1),this.node=e,this._configuration=null,this._debug=!1,this._language=null,this.allowWheelToZoom=!1,this.allowWheelToZoom2=!1,this._pointOfInterestFilter=null,this._showsDefaultTiles=!0,this._tileOverlays=[],this._filteredPois=new Set,this._={},this._[Un]=!1,this.camera=new Kn,this._element=document.createElement("div"),this.currentMinZoomLevel=this.minZoomLevel,this.currentMaxZoomLevel=this.maxZoomLevel}get element(){return this._element}deactivate(){this.pannable=!1,this.zoomable=!1,this.node.delegate=null}destroy(e){!e&&this.cameraAnimation&&this.cameraAnimation.cancel(),this._tileOverlays.forEach((e=>{e.removeEventListener(Ma.RELOAD_EVENT,this)})),this._initialInteractionController&&(this._initialInteractionController.destroy(),this._initialInteractionController=null),this._panController&&(this._panController.destroy(),this._panController=null),this._wheelEventHandler&&(this._wheelEventHandler.destroy(),delete this._wheelEventHandler),this._zoomController&&(this._zoomController.destroy(),this._zoomController=null),this._rotationController&&(this._rotationController.destroy(),this._rotationController=null),this.node.delegate=null}get isRotationEnabled(){return this._isRotationEnabled}set isRotationEnabled(e){this._isRotationEnabled=e}get snapsToIntegralZoomLevels(){return this._snapsToIntegralZoomLevels}set snapsToIntegralZoomLevels(e){this._snapsToIntegralZoomLevels=e}get configuration(){return this._configuration}set configuration(e){this._configuration!==e&&this.updateConfiguration(e)}get tint(){return this._tint}get tileTint(){return this._tileTint}get emphasis(){return this._emphasis}setTintAndEmphasis(e,t,i){e===this._tint&&t===this._tileTint&&i===this._emphasis||(this._tint=e,this._tileTint=t,this._emphasis=i,this.updateTintAndEmphasis(e,t,i))}get language(){return this._language}set language(e){this._language!==e&&(this._language=e,this.refresh())}get pointOfInterestFilter(){return this._pointOfInterestFilter}set pointOfInterestFilter(e){this._pointOfInterestFilter!==e&&(this._pointOfInterestFilter=e,this.updatePointOfInterestFilter())}get size(){return this.camera.viewportSize.copy()}set size(e){this.adjustForSize(e.copy()),e.width>0&&e.height>0&&this._updateZoom(!1)}adjustForSize(e){if(this._visibleMapRect&&this._visibleMapRect.size.width>0&&this._visibleMapRect.size.height>0&&e.width>0&&e.height>0){const t=this._visibleMapRect;delete this._visibleMapRect,this.setCameraAnimated(this.camera.withNewMapRect(t,this.snapsToIntegralZoomLevels,e))}else{let t=null;this._pendingCameraDistance&&(t=this._pendingCameraDistance);const i=this.camera;this.setCameraAnimated(new Kn(i.center,i.zoom,e,i.rotation)),null!==t&&this.setCameraDistanceAnimated(t,!1)}}get cameraIsPanning(){return!!this._panning}get pannable(){return!!this._panController}set pannable(e){if(!e&&this._panController?(this._panController.destroy(),delete this._panController):e&&!this._panController&&(this._initialInteractionController||(this._initialInteractionController=new Vn(this)),this._panController=new ia(this)),!e&&!this.zoomable&&this._wheelEventHandler)return this._wheelEventHandler.destroy(),void delete this._wheelEventHandler;this._wheelEventHandler||(this._wheelEventHandler=new Xa(this)),this._wheelEventHandler.zoomable=this.zoomable,this._wheelEventHandler.pannable=e}get cameraIsZooming(){return!!this._zooming||!!this._suspendedZoom}get zoomable(){return!!this._zoomController}set zoomable(e){if(!e&&this._zoomController?(this._zoomController.destroy(),delete this._zoomController):e&&!this._zoomController&&(this._initialInteractionController||(this._initialInteractionController=new Vn(this)),this._zoomController=new Jn(this)),!e&&!this.pannable&&this._wheelEventHandler)return this._wheelEventHandler.destroy(),void delete this._wheelEventHandler;this._wheelEventHandler||(this._wheelEventHandler=new Xa(this)),this._wheelEventHandler.zoomable=e,this._wheelEventHandler.pannable=this.pannable}get cameraIsRotating(){return!!this._rotating}get visibleMapRect(){return this._visibleMapRect||this.camera.toMapRect()}set visibleMapRect(e){this.setVisibleMapRectAnimated(e)}setVisibleMapRectAnimated(e,t){if(this.camera.viewportSize.equals(es.Zero))this._visibleMapRect=e.copy();else{const i=this.camera.withNewMapRect(e,this.snapsToIntegralZoomLevels);i.rotation=0,this.setCameraAnimated(i,!!t)}}setCenterAnimated(e,t){const i=e.toMapPoint();if(this._visibleMapRect)this._visibleMapRect=new fi(i.x-this._visibleMapRect.size.width/2,i.y-this._visibleMapRect.size.height/2,this._visibleMapRect.size.width,this._visibleMapRect.size.height);else{const e=this.camera.copy();e.center=i,this.setCameraAnimated(e,t)}}setCameraBoundaryAnimated(e,t){e?(this._cameraBeforeBoundaryChange=this.camera,this._cameraBoundaryRect=new fi(e.origin.x,e.origin.y,c(e.size.width,0,1),Math.max(e.size.height,0)),this.setCameraAnimated(this.camera.copy(),t),delete this._cameraBeforeBoundaryChange):delete this._cameraBoundaryRect}constrainCamera(e){this._cameraBoundaryRect&&(e.center=this._constrainCenterWithinBounds(e.center)),this._updateMinAndMaxZoomLevelsAtY(e.center.y),e.zoom=c(e.zoom,this.currentMinZoomLevel,this.currentMaxZoomLevel)}constrainCameraRotation(e){const t=this.isRotationLocked;if(this.isRotationLocked=e.zoom<7,0!==e.rotation&&this.isRotationLocked){const i=this.restrictIncomingRotation?Eo.restrictRotation(e.rotation):0,s=i!==e.rotation;return e.rotation=i,!t&&s}return!1}get transformCenter(){const e=this.node.delegate;return e&&"function"==typeof e.mapTransformCenter?e.mapTransformCenter(this.node):this.camera.center}get interactionCenter(){const e=this.node.delegate;return e&&"function"==typeof e.mapInteractionCenter?e.mapInteractionCenter(this.node):this.camera.center}get zoomLevel(){return this.camera.zoom}set zoomLevel(e){this.setZoomLevelAnimated(e)}setZoomLevelAnimated(e,t){if(delete this._cameraDistance,this._suspendedZoom)return this._suspendedZoom.animated=this._suspendedZoom.animated||this._suspendedZoom.level!==e,void(this._suspendedZoom.level=e);if(this.cameraAnimation&&!t)return void(this.cameraAnimation.additiveZoom=e);const i=this.zoomLevel,s=c(e,this.currentMinZoomLevel,this.currentMaxZoomLevel);if(i===s)return;const o=this.interactionCenter,n=this.camera;o.equals(n.center)?this.setCameraAnimated(new Kn(n.center,s,n.viewportSize,n.rotation),t):this.scaleCameraAroundMapPoint(Math.pow(2,s-i),this.interactionCenter,t)}setCameraDistanceAnimated(e,t){if(0===this.camera.viewportSize.width)return void(this._pendingCameraDistance=e);let i=this.zoomLevelForCameraDistanceAtY(e,this.camera.center.y);this.snapsToIntegralZoomLevels&&(i=Eo.getIntegralZoom(i)),this.setZoomLevelAnimated(i,t),this._cameraDistance=e}getCurrentCameraDistance(){return this.visibleMapRect.size.width/2/vi.mapUnitsPerMeterAtLatitude(this.camera.center.toCoordinate().latitude)/er}get cameraZoomRange(){return this._cameraZoomRange?this._cameraZoomRange.copy():new yi}setCameraZoomRangeAnimated(e,t){e?(this._cameraZoomRange=e.copy(),delete this._cameraZoomLevelLimit):delete this._cameraZoomRange,this._updateZoom(t)}setCameraZoomLevelLimitAnimated(e,t){e?(this._cameraZoomLevelLimit={minZoomLevel:e.minZoomLevel,maxZoomLevel:e.maxZoomLevel},delete this._cameraZoomRange):delete this._cameraZoomLevelLimit,this._updateZoom(t)}zoomLevelForCameraDistanceAtY(e,t){return this._zoomLevelForCameraDistanceAtLatitude(e,vi.convertYToLatitude(t))}adjustMapItemPoint(e){if(this.cameraIsZooming||this._pendingCameraDrawingReadiness)return e;if(!this._pointAdjustmentReference){const e=this.camera.zoom,t=this.visibleMapRect.origin,i=new ba(this.camera),s=i.zoom,o=i.mapRect.origin,n=Math.pow(2,e-s),a=vi.pointsPerAxis(s)*n;this._pointAdjustmentReference=new ts((o.x-t.x)*a,(o.y-t.y)*a)}return e.x=Eo.roundToDevicePixel(this._pointAdjustmentReference.x)+Eo.roundToDevicePixel(e.x-this._pointAdjustmentReference.x),e.y=Eo.roundToDevicePixel(this._pointAdjustmentReference.y)+Eo.roundToDevicePixel(e.y-this._pointAdjustmentReference.y),e}scaleCameraAroundMapPoint(e,t,i){const s=vi.pointsPerAxis(this.currentMinZoomLevel),o=this.camera.viewportSize,n=this.visibleMapRect,a=n.size,r=1/e,l=s>0?o.width/(a.width*s):r,h=s>0?o.height/(a.height*s):r,c=vi.pointsPerAxis(this.currentMaxZoomLevel),d=o.width/(a.width*c),u=o.height/(a.height*c),p=Math.max(Math.min(r,l,h),d,u),m=t.x+(t.x<1?1:-1);m>=n.origin.x&&m<=n.maxX()&&(t=new gi(m,t.y));const g=this.camera.withNewMapRect(n.scale(p,t),!1);this.setCameraAnimated(g,i)}setCameraAnimated(e,t,i,s){if(0===e.viewportSize.width||0===e.viewportSize.height)return this._pendingCameraDrawingReadiness=!0,void(this.camera=e);delete this._pendingCameraDistance;const o=this.camera;e.viewportSize.equals(o.viewportSize)||(this._updateMinAndMaxZoomLevels(e.viewportSize),!t&&this.cameraAnimation&&this.cameraAnimation.updateViewportSize(e.viewportSize)),s||this.constrainCamera(e);const n=this.constrainCameraRotation(e),a=e.toMapRect().size,r=a.width/2,h=a.height/2;if(e.center.x=l(e.center.x-r,1)+r,e.center.y=c(e.center.y,h,Ja-h),this._pendingCameraDrawingReadiness||!e.equals(o))if(delete this._pendingCameraDrawingReadiness,this._cameraWillChange(!!t),!t&&!n||this.cameraAnimation)delete this._pointAdjustmentReference,this.camera=e,this.cameraZoomWasSet(),this._cameraDidChange();else{let s;t?s=this._cameraBeforeBoundaryChange||o:(s=e.copy(),s.rotation=o.rotation),this._cameraChangesMayHaveStarted(),this.cameraAnimation=new Hn(this,s,e,i),this._cameraBeforeBoundaryChange&&(this.cameraAnimation.unconstrained=!0),this.cameraAnimation.rotating&&(this._rotating=!0),this.cameraAnimation.zooming&&this.cameraZoomWasSet(e)}}cameraWillStartZooming(e,t,i){const s=this.node.delegate,o=()=>!!s&&"function"==typeof s.mapCanStartZooming&&!s.mapCanStartZooming(this.node);return this.cameraAnimation?!(this._zoomController.active||this.cameraAnimation.zooming||o())&&(this._suspendedZoom={animated:!!t,offCenter:!!i,level:this.zoomLevel,completed:!1},!0):o()?(this._zoomController.interrupt(),!1):(this._cameraWillStartZooming(s,e,t,i),!0)}_cameraWillStartZooming(e,t,i,s){e&&"function"==typeof e.mapWillStartZooming&&e.mapWillStartZooming(this.node,t,i,s),this._cameraChangesMayHaveStarted(),this._zooming=!0,this.beforeCameraZoomChange(!0),this._cameraWillChange(!!i)}cameraDidStopZooming(){if(this.snapsToIntegralZoomLevels&&(this.camera.zoom=Math.round(this.camera.zoom)),this._suspendedZoom)return void(this._suspendedZoom.complete=!0);delete this._zooming,this.beforeCameraZoomChange(!1),this._cameraDidChange(),this._cameraChangesMayHaveEnded();const e=this.node.delegate;e&&"function"==typeof e.mapDidStopZooming&&e.mapDidStopZooming(this.node)}cameraWillStartRotating(){const e=this.node.delegate;!!e&&"function"==typeof e.mapCanStartRotating&&!e.mapCanStartRotating(this.node)||(this._cameraChangesMayHaveStarted(),this._rotating=!0,this._cameraWillChange())}cameraDidStopRotating(){if(!this._rotating)return;delete this._rotating,this._cameraDidChange(),this._cameraChangesMayHaveEnded();const e=this.node.delegate;e&&"function"==typeof e.mapDidStopRotating&&e.mapDidStopRotating(this.node)}setPoiFiltered(e,t){t?(this._filteredPois.has(e)&&console.warn("[MapKit] Multiple annotations linked to a single place have been added to the map, display instability may occur."),this._filteredPois.add(e)):this._filteredPois.delete(e),this.updatePointOfInterestFilter()}migrateStateTo(e){e.configuration=this.node.configuration,e.setTintAndEmphasis(this.node.tint,this.node.tileTint,this.node.emphasis),e.language=this.node.language,e.pannable=this.node.pannable,e.allowWheelToZoom=this.node.allowWheelToZoom,e.allowWheelToZoom2=this.node.allowWheelToZoom2,e.pointOfInterestFilter=this.node._impl.pointOfInterestFilter,e.showsDefaultTiles=this.node.showsDefaultTiles,e.tileOverlays=this.node.tileOverlays,e.size=this.node.size,e.usesInteractionCenter=this.node.usesInteractionCenter;const t=this.node.visibleMapRect;t.size.width>0&&t.size.height>0&&(e.visibleMapRect=t),e.zoomable=this.node.zoomable,e.isRotationEnabled=this.isRotationEnabled,e.rotation=this.rotation,e[Un]=this[Un],this._cameraZoomRange&&e.setCameraZoomRangeAnimated(this._cameraZoomRange,!1),this._cameraZoomLevelLimit&&e.setCameraZoomLevelLimitAnimated(this._cameraZoomLevelLimit,!1),this._cameraDistance>=0&&e.setCameraDistanceAnimated(this._cameraDistance,!1),this._cameraBoundaryRect&&e.setCameraBoundaryAnimated(this._cameraBoundaryRect,!1),e._impl._filteredPois=this._filteredPois,e._impl.updatePointOfInterestFilter(),e._impl.debug=this.debug,e._impl.isRotationLocked=this.isRotationLocked,this.cameraAnimation&&(this.cameraAnimation.map=e._impl,e._impl.cameraAnimation=this.cameraAnimation,this.cameraChangesHaveStarted&&(e._impl.cameraChangesHaveStarted=!0))}createLabelRegion(){}updatedLabelRegion(){}unregisterLabelRegion(){}get debug(){return this._debug}set debug(e){this._debug!==!!e&&(this._debug=!!e,this.refresh())}updateConfiguration(e){this._configuration=e,this._updateMinAndMaxZoomLevels(this.camera.viewportSize),this.setCameraAnimated(this.camera),this.refresh()}updatePointOfInterestFilter(){this.refresh()}refresh(){}beforeCameraZoomChange(){}cameraZoomWasSet(){}prepareLayer(e){}cleanupLayer(e){}addLayer(e){}insertBefore(e,t){}insertAfter(e,t){}removeLayer(e){}get showsDefaultTiles(){return this._showsDefaultTiles}set showsDefaultTiles(e){this._showsDefaultTiles!==e&&(this._showsDefaultTiles=e,this._tileOverlaysDidChange())}get tileOverlays(){return this._tileOverlays}set tileOverlays(e){if(0===this._tileOverlays.length&&0===e.length)return;g(e,"[MapKit] Map.tileOverlays should be an array, got `"+e+"` instead."),e.forEach((e=>{m(e,Sa,"[MapKit] Map.tileOverlays can only contain TileOverlays, but got `"+e+"` instead.")})),this._tileOverlays.forEach((e=>{e.removeEventListener(Ma.RELOAD_EVENT,this)})),this._tileOverlays=e,this._tileOverlays.forEach((e=>{e.addEventListener(Ma.RELOAD_EVENT,this)})),this._tileOverlaysDidChange()}addTileOverlay(e){return m(e,Sa,"[MapKit] Map.addTileOverlay expected a TileOverlay, but got `"+e+"` instead."),this.addTileOverlays([e]),e}addTileOverlays(e){return g(e,"[MapKit] Map.addTileOverlays expected an array, but got `"+e+"` instead."),e.forEach((function(e){if(m(e,Sa,"[MapKit] Map.addTileOverlays expected only TileOverlays, but got `"+e+"` instead."),"number"==typeof e.minimumZ&&e.minimumZ<this.currentMinZoomLevel){const t=Math.ceil(100*this.currentMinZoomLevel)/100;console.warn("[MapKit] This TileOverlay has its minimumZ set to "+e.minimumZ+", but this map can only zoom to a minimum value of "+t+". As a result, some zoom levels supported by the TileOverlay cannot be viewed on this map.")}}),this),this.tileOverlays=this.tileOverlays.concat(e),e}removeTileOverlay(e){return m(e,Sa,"[MapKit] Map.removeTileOverlay expected a TileOverlay, but got `"+e+"` instead."),this.tileOverlays=this.tileOverlays.filter((t=>t!==e)),e}removeTileOverlays(e){return g(e,"[MapKit] Map.removeTileOverlays expected an array, but got `"+e+"` instead."),e.forEach((function(e){m(e,Sa,"[MapKit] Map.removeTileOverlays expected only TileOverlays, but got `"+e+"` instead."),this.removeTileOverlay(e)}),this),e}handleEvent(){}cameraWillStartPanning(){const e=this.node.delegate;this.cameraAnimation||(()=>!!e&&"function"==typeof e.mapCanStartPanning&&!e.mapCanStartPanning(this.node))()?this._panController.interrupt():(e&&"function"==typeof e.mapWillStartPanning&&e.mapWillStartPanning(this.node),this.refresh(),this._cameraChangesMayHaveStarted(),this._panning=!0,this._cameraWillChange())}cameraWillStopPanning(){const e=this.node.delegate;e&&"function"==typeof e.mapWillStopPanning&&e.mapWillStopPanning(this.node)}cameraDidStopPanning(){delete this._panning,this._cameraDidChange(),this._cameraChangesMayHaveEnded();const e=this.node.delegate;e&&"function"==typeof e.mapDidStopPanning&&e.mapDidStopPanning(this.node)}cameraAnimationDidProgress(e,t){this.setCameraAnimated(e,!1,null,t)}cameraAnimationDidEnd(){const e=this.cameraAnimation;this.cameraAnimation=null;let t=!1;if(e.zooming&&!e.zoomIsAdditive&&(this.cameraDidStopZooming(),t=!0),e.rotating&&(this.cameraDidStopRotating(),t=!0),t||this._cameraDidChange(),this._cameraChangesMayHaveEnded(),this._suspendedZoom){const e=this._suspendedZoom;delete this._suspendedZoom,this._cameraWillStartZooming(this.node.delegate,"",e.animated),e.complete&&(this.setZoomLevelAnimated(e.level,e.animated),e.animated||this.cameraDidStopZooming())}this._nextCameraZoomRange&&(this.setCameraZoomRangeAnimated(this._nextCameraZoomRange,!1),delete this._nextCameraZoomRange)}interactionDidStart(){this._panController&&this._panController.stopDecelerating(),this._zoomController&&this._zoomController.stopDecelerating(),this._rotationController&&this._rotationController.stopDecelerating()}beganRecognizingRotation(){this._zoomController&&(this._zoomController._singleTapWithTwoFingersRecognizer.enabled=!1),this.isRotationLocked&&(this.restrictedCamera=this.camera.copy(),this.restrictIncomingRotation=!0)}finishedRecognizingRotation(){this._zoomController&&(this._zoomController._singleTapWithTwoFingersRecognizer.enabled=!0),this.resetRestrictedCamera()}compassRotationWillStart(){this.isRotationLocked&&(this.restrictedCamera=this.camera.copy(),this.restrictIncomingRotation=!1)}compassRotationDidEnd(){this.resetRestrictedCamera()}resetRestrictedCamera(){this.restrictedCamera&&(this.restrictedCamera.rotation=0,this.setCameraAnimated(this.restrictedCamera,!0),delete this.restrictedCamera,this.restrictIncomingRotation=!1)}tileGridDidFinishRendering(){const e=this.node.delegate;e&&"function"==typeof e.mapDidFinishRendering&&e.mapDidFinishRendering(this.node)}tileAccessForbidden(){const e=this.node.delegate;e&&"function"==typeof e.tileAccessForbidden&&e.tileAccessForbidden(this.node)}updateMinAndMaxZoomLevelsWhenConfigurationChanges(){this.minZoomLevel=tr.DEFAULT_MIN_ZOOM_LEVEL,this.maxZoomLevel=tr.DEFAULT_MAX_ZOOM_LEVEL,this._configuration.tileSources.forEach((function(e){this.minZoomLevel=Math.max(this.minZoomLevel,e.minZoomLevel),this.maxZoomLevel=Math.min(this.maxZoomLevel,e.maxZoomLevel)}),this),this.minAndMaxZoomLevelsWereUpdated(),this.currentMinZoomLevel=this.minZoomLevel,this.currentMaxZoomLevel=this.maxZoomLevel}minAndMaxZoomLevelsWereUpdated(){}_updateMinAndMaxZoomLevels(e){if(e.width<=0||e.height<=0)return!1;this._configuration&&this.updateMinAndMaxZoomLevelsWhenConfigurationChanges(),this.minZoomLevel=Math.max(this.minZoomLevel,this.minZoomLevelForViewportSize(e,vi.tileSize)),this.snapsToIntegralZoomLevels&&(this.minZoomLevel=Math.ceil(this.minZoomLevel)),this.currentMinZoomLevel=Math.max(this.currentMinZoomLevel,this.minZoomLevel),this.adjustForSize(this.size)}_cameraChangesMayHaveStarted(e){if(!(this.cameraChangesHaveStarted||this._panning||this._zooming||this._rotating||this.cameraAnimation)){this.cameraChangesHaveStarted=!0;const t=this.node.delegate;t&&"function"==typeof t.mapCameraChangesWillStart&&t.mapCameraChangesWillStart(this.node,e)}}_cameraWillChange(e){this._cameraChangesMayHaveStarted(e),this._cameraWillChangeAnimated=!!e;const t=this.node.delegate;t&&"function"==typeof t.mapCameraWillChange&&t.mapCameraWillChange(this.node,!!e)}_cameraDidChange(){const e=this.node.delegate;e&&"function"==typeof e.mapCameraDidChange&&e.mapCameraDidChange(this.node,!!this._cameraWillChangeAnimated),delete this._cameraWillChangeAnimated,this._cameraChangesMayHaveEnded()}_cameraChangesMayHaveEnded(e){if(this.cameraChangesHaveStarted&&!this._panning&&!this._zooming&&!this._rotating&&!this.cameraAnimation){delete this.cameraChangesHaveStarted;const e=this.node.delegate;return e&&"function"==typeof e.mapCameraChangesDidEnd&&e.mapCameraChangesDidEnd(this.node),!0}}isMapPointWithinBounds(e){if(!this._cameraBoundaryRect)return!0;const t=this._constrainCenterWithinBounds(e);return e.x===t.x&&e.y===t.y}_constrainCenterWithinBounds(e){if(0===this.camera.viewportSize.width||0===this.camera.viewportSize.height)return e;const t=this.camera.center,i=this.transformCenter,s=t.x-i.x,o=t.y-i.y,n=l(this._cameraBoundaryRect.origin.x+s,1),a=n+this._cameraBoundaryRect.size.width;let r=l(e.x,1);if(r<n&&(r+=1),r>a){let e=r-n;e>.5&&(e=1-e);let t=r-a;t>.5&&(t=1-t),r=e<t?n:a}const h=c(e.y,this._cameraBoundaryRect.minY()+o,this._cameraBoundaryRect.maxY()+o);return r!==e.x||h!==e.y?new gi(r,h):e}_updateMinAndMaxZoomLevelsAtY(e){let t=this.minZoomLevel,i=this.maxZoomLevel;if(this._cameraZoomRange){const s=vi.convertYToLatitude(e);t=c(this._zoomLevelForCameraDistanceAtLatitude(this._cameraZoomRange.maxCameraDistance,s),t,i),i=c(this._zoomLevelForCameraDistanceAtLatitude(this._cameraZoomRange.minCameraDistance,s),t,i),this.snapsToIntegralZoomLevels&&(t=Math.ceil(t),i=Math.floor(i))}else this._cameraZoomLevelLimit&&(t=c(this._cameraZoomLevelLimit.minZoomLevel,t,i),i=c(this._cameraZoomLevelLimit.maxZoomLevel,t,i));this.currentMinZoomLevel=t,this.currentMaxZoomLevel=i}_updateZoom(e){this._updateMinAndMaxZoomLevelsAtY(this.camera.center.y);const t=c(this.camera.zoom,this.currentMinZoomLevel,this.currentMaxZoomLevel);if(t!==this.camera.zoom)e&&(this._nextCameraZoomRange=this._cameraZoomRange,delete this._cameraZoomRange),this.setZoomLevelAnimated(t,e);else{const e=this.node.delegate;e&&"function"==typeof e.mapMinAndMaxZoomLevelsDidChange&&e.mapMinAndMaxZoomLevelsDidChange(this.node)}}_zoomLevelForCameraDistanceAtLatitude(e,t){return vi.zoomLevelForCameraDistanceAtLatitudeAndViewportWidth(e,t,this.camera.viewportSize.width)}get[Un](){return this._[Un]}set[Un](e){this._[Un]=e}[Gn](e){throw new Error}}$a(tr,"DEFAULT_MIN_ZOOM_LEVEL",-1/0),$a(tr,"DEFAULT_MAX_ZOOM_LEVEL",1/0);const ir=tr,sr="rgba(0, 0, 0, 0.5)",or="white",nr="rgba(255, 255, 255, 0.75)",ar="black";const rr=class extends Go{draw(e){const t=this._node.size.width,i="standard"===this._node.tile.settings.configuration.name;e.fillStyle=i?sr:nr,e.fillRect(0,0,t,1),e.fillRect(0,1,1,t-1);const s=["x","y","z"].map((e=>e+" = "+this._node.tile[e]));e.font="12px -apple-system-font",e.beginPath(),e.moveTo(1,1);let o=1,n=1;s.forEach(((t,i)=>{const s=e.measureText(t).width;o=1+s+16,e.lineTo(o,n),n+=20,0===i&&(n+=8),e.lineTo(o,n)})),e.lineTo(1,n),e.closePath(),e.fill(),e.fillStyle=i?or:ar,e.textBaseline="hanging",s.forEach(((i,s)=>{e.fillText(i,9,9+20*s,t)}))}};const lr=class extends Ls{constructor(e){super(),this._tile=e,this._renderer=new rr(this)}get tile(){return this._tile}stringInfo(){return"DebugNode<x:"+this.tile.x+",y:"+this.tile.y+",z:"+this.tile.z+">"}};const hr=class extends qo{constructor(e){super(),this._tileSource=e._public,this._tileSource&&"function"==typeof this._tileSource.addEventListener&&this._tileSource.addEventListener(Ma.OPACITY_EVENT,this)}handleEvent(){this._tileSource&&(this.opacity=this._tileSource.opacity)}wasRemoved(){setTimeout((()=>{this.parent&&this.parent.scene||this._tileSource&&"function"==typeof this._tileSource.removeEventListener&&this._tileSource.removeEventListener(Ma.OPACITY_EVENT,this)}),0)}};function cr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const dr=le,ur=new ss,pr=new es(vi.tileSize,vi.tileSize);function mr(e){const t=new hr(e.tileSource);return t.size=pr,e.loaderState===dr.Succeeded&&(t.image=e.image,t.opacity=e.preferredOpacity),t}const gr=class extends Ho{constructor(e){super(),cr(this,"stale",!1),cr(this,"fullyRendered",!1),cr(this,"_pendingTileCount",0),cr(this,"_tileData",null),this._scale=1,this._nodesByTileKey={},this._fadingNodes=[],this._debug=!!e}get locked(){return this.wantsLayerBacking}set locked(e){e!==this.wantsLayerBacking&&(e&&this._fadingNodes.length>0?this.wantsLayerBacking=!0:!e&&this._wantsLayerBacking?this.wantsLayerBacking=!1:this.frozen=e)}get tileData(){return this._tileData}setTileDataAnimated(e,t){this._fadingNodes=[],delete this._failedTileAndImage;const i=e.tiles,s=e.range.min,o=Math.pow(2,s.z);this._tileData&&this._tileData.tiles.forEach((function(e){if(e.removeEventListener(da.Events.LoadSuccess,this),e.removeEventListener(da.Events.LoadFail,this),-1===i.indexOf(e)){const t=e.key,i=this._nodesByTileKey[t];i&&(i.remove(),delete this._nodesByTileKey[t])}}),this),this._tileData=e,this.fullyRendered=!1,this._pendingTileCount=i.length;const n=this.childCount,a=e.range.min.x,r=e.range.max.x-a===o,h=o*vi.tileSize;i.forEach((function(e){const i=new ts(l(e.x-s.x,o)*vi.tileSize,(e.y-s.y)*vi.tileSize),c=this._ensureNodeForTile(e);c.position=i,c.opacity=0,r&&e.x===a&&(c.repeatOffset=h),this.addChild(c),e.loaded?((n>0||!t)&&(c.opacity=1),this._tileDidLoad(e)):(t||(c.opacity=1),e.addEventListener(da.Events.LoadSuccess,this),e.addEventListener(da.Events.LoadFail,this))}),this)}get pendingTileCount(){return this._pendingTileCount}set scale(e){e!==this._scale&&(this._scale=e,this.transform=1===e?ur:(new ss).scale(e))}get debug(){return this._debug}stringInfo(){return"TileGridNode"+(this.tileData?"<range:("+this.tileData.range.toString()+")>":"")}get cssBackgroundProperty(){if(!this.fullyRendered)return"";const e=this.position;return Array.prototype.concat.apply([],this._tileData.tiles.map((function(t){const i=this._nodesByTileKey[t.key];return t.tileImages.reduce(((t,s,o)=>"url("+s.image.src+") "+(e.x+i.position.x)+"px "+(e.y+i.position.y)+"px / "+vi.tileSize+"px no-repeat"+(0===o?"":", ")+t),"")}),this)).join(", ")}handleEvent(e){const t=e.target;switch(e.type){case da.Events.LoadSuccess:t.removeEventListener(da.Events.LoadSuccess,this),this._tileDidLoad(t);break;case da.Events.LoadFail:this._tileLoadFail(t,e.tileImage)}}performScheduledUpdate(){this._updateFadingNodes(),0===this._pendingTileCount&&0===this._fadingNodes.length&&this._allTilesDidDraw()}_tileDidLoad(e){this._pendingTileCount--,0===this._pendingTileCount&&this._failedTileAndImage&&(this._failedTileAndImage.tile._requestTileImageLoadStatus(this._failedTileAndImage.tileImage,(e=>this._handleTileImageLoadStatus(e))),delete this._failedTileAndImage);const t=this._nodesByTileKey[e.key];if(0===t.childCount){const i=e.tileImages;if(t.children=i.map(mr),this.debug){const i=new lr(e);i.size=pr,t.addChild(i)}}t.opacity<1?(this._fadingNodes.push(t),bt.scheduleASAP(this)):0===this._pendingTileCount&&this._allTilesDidDraw()}_tileLoadFail(e,t){this._failedTileAndImage={tile:e,tileImage:t}}_handleTileImageLoadStatus(e){403===e.target.status&&this.parent&&this.parent.tileAccessForbidden(this)}_updateFadingNodes(){const e=Date.now();this._fadingNodes=this._fadingNodes.filter((t=>(t._startTime?t.opacity=Math.min(1,(e-t._startTime)/150):0===t.opacity&&(t._startTime=e),1!==t.opacity||(delete t._startTime,!1)))),this._fadingNodes.length>0?bt.scheduleOnNextFrame(this):this._wantsLayerBacking&&(this.wantsLayerBacking=!1,this.frozen=!0)}_allTilesDidDraw(){this.fullyRendered=!0,this.parent&&this.parent.tileGridDidFinishRendering(this)}_ensureNodeForTile(e){const t=e.key;let i=this._nodesByTileKey[t];return i?delete i.repeatOffset:i=this._nodesByTileKey[t]=new Ho,i}};const _r=class extends Ho{constructor(e){var t,i,s;super(),s=!1,(i="fullyRendered")in(t=this)?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,this._map=e}scheduleRefresh(){this.children.forEach((e=>{e.stale=!0})),this.invalidate()}destroy(){this._releaseChildren(!0)}invalidate(){this.fullyRendered=!1,bt.scheduleASAP(this)}stringInfo(){return"TileGridsGroupNode"}get cssBackgroundProperty(){return this.fullyRendered?this.lastChild.cssBackgroundProperty:""}handleEvent(e){this.scheduleRefresh()}performScheduledUpdate(){if(!this._canDraw())return;const e=this._map,t=e.camera,i=this.lastChild,s=!!i&&i.debug!==this._map.debug,o=!!i&&i.tileData.settings.showsDefaultTiles!==this._map.showsDefaultTiles;if(!this._tileDataAtZoomCompletion){let n;if(Math.round(t.zoom)!==t.zoom&&e.tileSettings.showsLabels){if(!i)return;n=i.tileData}else n=new ba(t,e.tileSettings);if(i){if((i.stale||!i.locked)&&(!n.equals(i.tileData)||s||o)){const e=i.tileData;e.tiles.forEach((e=>{n.tiles.indexOf(e)<0&&e.unschedule()}));const t=n.settings.configuration===e.settings.configuration,o=n.sameSettings(e)&&n.resolution===e.resolution&&!s;if(t?!o:n.sharesTileSourcesWithTileData(e))i.locked=!0,this._addNewTileGridAnimated(n,!0);else if(!i.locked){const e=t&&this._children.length>1;delete i.stale,i.setTileDataAnimated(n,e);const s=this._children[this._children.length-2];s&&!n.sharesTileSourcesWithTileData(s.tileData)&&(this._releaseChildren(!1),this._children=[i])}}}else this._addNewTileGridAnimated(n,!1)}const n=t.zoom,a=e.visibleMapRect,r=a.origin,l=a.size,h=this.children,c=h.length;for(let e=0;e<c;++e){const t=h[e],i=t.tileData,s=i.zoom,o=i.mapRect.origin,a=Math.pow(2,n-s),d=Math.pow(2,s)*(vi.tileSize*a);let u=o.x-r.x;if(u>l.width)u--;else{const e=i.mapRect.size.width;e>0&&u+e<0&&u++}t.scale=a,t.position=new ts(Eo.roundToDevicePixel(u*d),Eo.roundToDevicePixel((o.y-r.y)*d)),e<c-1&&i.cancel()}this.fullyRendered=c>0&&this.children[c-1].fullyRendered}cameraWillStartZooming(e){if(!this._canDraw())return;const t=this._map;e&&(this._tileDataAtZoomCompletion=new ba(e,t.tileSettings),this._tileDataAtZoomCompletion.load()),this.children.forEach((e=>{e.locked=!0}))}cameraDidStopZooming(){if(this._canDraw())if(this._tileDataAtZoomCompletion)this._addNewTileGridAnimated(this._tileDataAtZoomCompletion,!0,!0),delete this._tileDataAtZoomCompletion;else{const e=this._map,t=this.lastChild;if(t&&e.camera.zoom===t.tileData.zoom)t.locked=!1;else{const t=new ba(e.camera,e.tileSettings);this._addNewTileGridAnimated(t,!0,!0)}}}tileGridDidFinishRendering(e){const t=this.children,i=t.length,s=t[i-1];if(s.fullyRendered&&!s.locked){for(let e=0;e<i-1;++e)t[e].tileData.releaseTiles();i>1&&(this.children=[s]),this.fullyRendered=!0,this._map.tileGridDidFinishRendering()}}tileAccessForbidden(e){this._map.tileAccessForbidden()}_canDraw(){const e=this._map;return e&&!!e.configuration&&!!e.language}_addNewTileGridAnimated(e,t,i){const s=new gr(this._map.debug),o=this.lastChild;o&&!e.sharesTileSourcesWithTileData(o.tileData)?(this._releaseChildren(!0),this.children=[s]):this.addChild(s),s.setTileDataAnimated(e,t),i&&bt.scheduleASAP(this)}_releaseChildren(e){for(let t=this.childCount-(e?1:2);t>=0;--t){const e=this.children[t].tileData;e.cancel(),e.releaseTiles()}}};const fr=class extends ir{constructor(e){super(e),this._backgroundGrid=this.node.addChild(new Fn),this._tileGridsGroup=this.node.addChild(new _r(this)),this._labels=!0,this.rotation=0,this._backgroundGrid.initialRendering=!0,this._tileGridsGroup.opacity=0,setTimeout((()=>{this._backgroundGrid.initialRendering=!1,this._tileGridsGroup.opacity=1}),0)}stringInfo(){return"MapNode<camera:"+this.camera.toString()+">"}get tileSettings(){return{configuration:this._configuration,tint:this._tileTint,emphasis:this._emphasis,language:this._language,showsPOI:this._showsPOI(),showsLabels:this._labels,showsDefaultTiles:this._showsDefaultTiles,showsTileInfo:this._debug,tileOverlays:this._tileOverlays}}get fullyRendered(){return this._tileGridsGroup.fullyRendered}get cssBackgroundProperty(){return this._tileGridsGroup.cssBackgroundProperty}get labels(){return this._labels}set labels(e){this._labels=!!e,this.refresh()}destroy(e){super.destroy(e),this._tileGridsGroup.destroy()}updateTintAndEmphasis(e,t,i){this._backgroundGrid.updateThemeFromTint(e),this.refresh()}refresh(){this._tileGridsGroup.scheduleRefresh()}cameraZoomWasSet(e){e?this._tileGridsGroup.cameraWillStartZooming(e):this._tileGridsGroup.invalidate()}tileGridDidFinishRendering(){this._tileOverlays.forEach((e=>{e._impl.reloadComplete()})),super.tileGridDidFinishRendering()}handleEvent(){this._tileGridsGroup.scheduleRefresh()}beforeCameraZoomChange(e){e?this._tileGridsGroup.cameraWillStartZooming():this._tileGridsGroup.cameraDidStopZooming()}devicePixelRatioDidChange(){return this._tileGridsGroup.scheduleRefresh(),!0}minZoomLevelForViewportSize(e,t){const i=Math.max(e.width,e.height);return h(i/t)}minAndMaxZoomLevelsWereUpdated(){this.tileOverlays.forEach((function(e){"number"!=typeof e.minimumZ||isNaN(e.minimumZ)||(this.minZoomLevel=Math.min(this.minZoomLevel,e.minimumZ)),"number"!=typeof e.maximumZ||isNaN(e.maximumZ)||(this.maxZoomLevel=Math.max(this.maxZoomLevel,e.maximumZ))}),this)}_tileOverlaysDidChange(){this._updateMinAndMaxZoomLevels(this.camera.viewportSize),this._tileGridsGroup.scheduleRefresh()}_showsPOI(){return(null==this._pointOfInterestFilter||null==this._pointOfInterestFilter._includes&&0===this._pointOfInterestFilter._excludes.length)&&this.labels}needsReplacing(e){return e}};const yr=class extends Wn{constructor(){super(),Object.defineProperty(this,"_impl",{value:new fr(this)})}get cssBackgroundProperty(){return this._impl.cssBackgroundProperty}get labels(){return this._impl.labels}set labels(e){this._impl.labels=e}get pointOfInterestFilter(){return null===this._impl._pointOfInterestFilter?null:null===this._impl._pointOfInterestFilter._includes&&0===this._impl._pointOfInterestFilter._excludes.length?this._impl._pointOfInterestFilter:Ve.filterExcludingAllCategories}set pointOfInterestFilter(e){this._impl.pointOfInterestFilter=e}get rotation(){return 0}set rotation(e){this._impl.rotation=e}rotateCameraAroundMapPoint(e,t){this._impl.rotation+=t}};function vr(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const br=Object.freeze({Uninitialized:0,Initializing:1,Ready:2,Deactivated:3,DestroyPending:4,Destroyed:5});let wr=0;function Cr(){throw new Error("[MapKit] The specified reference layer has not been added to the map.")}const kr=Ue.performanceMarkers.rendering,Mr=Ue.performanceMarkers["frame-updates"];class Sr{constructor(e){vr(this,Un,void 0),vr(this,Gn,void 0),vr(this,"frozen",!1),delete this[Un],delete this[Gn],this.node=e,this._id=wr++,this._state=br.Uninitialized,this._unregisteredLabelRegions=[],this._unregisteredLayers=[],this._baseLoadedOnce=!1,this._fullyLoadedOnce=!1,this._fullyRenderedOnce=!1,this.availability=void 0}init(e,t,i,s,o,n,a){this._state=br.Initializing,this.SyrupRenderer=t,this.Camera=i,this.Camera.hasRotationLock=!0,this._initialDisplayOptions=o,this._initialPoiFilter=n,this.initRenderer(t,e,s).then((()=>this.syrupInitHandler(a))).catch((e=>this.syrupInitErrorHandler(a,e)))}initRenderer(e,t,i){const s=this._syrupRenderer=new e(i);return s.on("invalid-access-key",(()=>{t.accessKeyHasExpired()}),Lr),s.on("zoom-support-did-change",(()=>this.node.didReconfigure()),xr),s.init(t)}syrupInitErrorHandler(e,t){if(this._state===br.DestroyPending)return this._state=br.Uninitialized,void this.destroy();this._state=br.Uninitialized,e(t||new Error)}syrupInitHandler(e){if(this._state===br.DestroyPending)return this._state=br.Deactivated,void this.destroy();this._state=br.Ready;const t=z(this._syrupRenderer).DrawPasses;t&&(this._drawPasses=[t.BaseMap,t.Roads,t.Borders,t.Buildings,t.Icons,t.Labels]);const i=z(this._syrupRenderer);i.setDeterministicCollisions(!0),i.setLanguage(this.node.language),i.setDeterministicCollisions(!1),i.setPixelRatio(Eo.devicePixelRatio),this._canvas=i.element(),this.updateConfiguration(z(this.node.configuration),z(this._initialDisplayOptions)),this._initialDisplayOptions=null,this._initialPoiFilter&&(this.updatePointOfInterestFilter(this._initialPoiFilter),this._initialPoiFilter=null),this.performScheduledDraw(),this[Un]&&this[Un](z(this.node[Un])),z(this._unregisteredLabelRegions).forEach((e=>{i.registerLabelRegion(e)})),delete this._unregisteredLabelRegions;const s=this._unregisteredLayers;delete this._unregisteredLayers,z(s).forEach((e=>{this.prepareLayer(e),e._impl.syrupToken=i.addLayer(z(e._impl.syrupLayer))})),e()}deactivate(){this._state!==br.Initializing?this._state!==br.DestroyPending&&(this._state=br.Deactivated):this._state=br.DestroyPending}destroy(){this._state!==br.Initializing?this._state!==br.DestroyPending&&this._state!==br.Destroyed&&(this._state=br.Destroyed,this._syrupRenderer&&(this._syrupRenderer.off("invalid-access-key",null,Lr),this._syrupRenderer.off("zoom-support-did-change",null,xr),"function"==typeof this._syrupRenderer.destroy&&this._syrupRenderer.destroy(),this._syrupRenderer=null)):this._state=br.DestroyPending}get snapsToIntegralZoomLevels(){return!!this._syrupRenderer&&!this._syrupRenderer.supportsNonIntegralZoomLevels()}getMapFeatureRegions(){return this._syrupRenderer&&this._syrupRenderer.getMapFeatureRegions?this._syrupRenderer.getMapFeatureRegions():[]}performScheduledDraw(e){if(this._state!==br.Ready&&this._state!==br.Deactivated)return;const t=[this.node.size.width,this.node.size.height];if(0===t[0]||0===t[1])return;this.node.delegate&&this.node.delegate.mapCustomCanvasWillRender&&this.node.delegate.mapCustomCanvasWillRender(this.node);const i=new(z(this.Camera))(t[0]/t[1]),s=this.node.zoomLevel,o=[this.node.camera.center.x,1-this.node.camera.center.y,0];i.setTarget(o),i.setZoomLevel(s),i.setRotation(this.node.camera.rotation*Ar*-1);const n=Mr?performance.now():void 0;let a;z(this._syrupRenderer).update(i,t,void 0,void 0,e);const r=z(this.SyrupRenderer).StatusType;if(Mr&&(a=z(this._syrupRenderer).status(),performance.measure("mapkit-syrup-update-frame",{start:n,detail:{syrupStatus:a,timestamp:e,baseLoaded:a>=r.BASE_LOADED,fullyLoaded:a>=r.FULLY_LOADED}})),this._state!==br.Destroyed){for(const e of Sr.PostUpdateHandlers)e.call(this);kr&&!this._fullyRenderedOnce&&z(this._syrupRenderer).status&&(a||(a=z(this._syrupRenderer).status()),!this._baseLoadedOnce&&a>=r.BASE_LOADED&&(this._baseLoadedOnce=!0,performance.measure("mapkit-map-land-cover-rendered","mapkit-map-start")),!this._fullyLoadedOnce&&a>=r.FULLY_LOADED&&(this._fullyLoadedOnce=!0,performance.measure("mapkit-map-base-map-loaded","mapkit-map-start")),!this._fullyRenderedOnce&&a>=r.FULLY_RENDERED&&(this._fullyRenderedOnce=!0,performance.measure("mapkit-map-base-map-rendered","mapkit-map-start"))),z(this._syrupRenderer).mapFullyRendered()?this.node._impl.tileGridDidFinishRendering():this.node.needsDisplay=!0}}forceRerender(){this._state===br.Ready&&z(this._syrupRenderer).forceRerender()}devicePixelRatioDidChange(){this._syrupRenderer&&this._syrupRenderer.setPixelRatio(Eo.devicePixelRatio)}get element(){return this.canvas}get canvas(){return this._canvas}get fullyRendered(){return this._syrupRenderer&&this._syrupRenderer.mapFullyRendered()}set language(e){this._syrupRenderer&&this._syrupRenderer.setLanguage(e)}set fontSizeRatio(e){this._syrupRenderer&&this._syrupRenderer.setFontSize(e)}updateNetworkConfiguration(e){this._syrupRenderer&&this._syrupRenderer.updateNetworkConfiguration(e)}updateConfiguration(e,t){this._syrupRenderer&&(t.mode=e.name,this._syrupRenderer.setDisplayOptions(t),e.countryCode&&this._syrupRenderer.setLocationInfo(e.countryCode,e.countryCode))}updatePointOfInterestFilter(e){this._syrupRenderer?this._syrupRenderer.setPOIFilter(e):this._initialPoiFilter=e}createLabelRegion(){if(!this._syrupRenderer)return;const e=this._syrupRenderer.createLabelRegion();return this._unregisteredLabelRegions?this._unregisteredLabelRegions.push(e):this._syrupRenderer.registerLabelRegion(e),e}unregisterLabelRegion(e){this._unregisteredLabelRegions?this._unregisteredLabelRegions.splice(this._unregisteredLabelRegions.indexOf(e),1):this._syrupRenderer&&this._syrupRenderer.unregisterLabelRegion(e)}prepareLayer(e){if(!this._unregisteredLayers){if(!e._impl.syrupLayer||e._impl.rendererId!==this._id){0;const t={},i=e._impl.blendMode;if(void 0!==i){if(!d(i,Ds))throw new Error("Invalid blendMode: "+i);t.blendMode=i}const s=e._impl.backdropFilter;if(void 0!==s){if(!d(s,zs))throw new Error("Invalid backdropFilter: "+s);t.backdropFilter=s}e._impl.rendererId=this._id,e._impl.syrupLayer=z(this._syrupRenderer).createWebGLLayer(e._impl,t)}e._impl.syrupLayer.setDrawPass(z(this._drawPasses)[z(e._impl.passIndex)]+e._impl.passOffset)}}cleanupLayer(e){e._impl.syrupLayer=void 0}addLayer(e){const t=this._unregisteredLayers;if(t){const i=t.indexOf(e);i>=0&&t.splice(i,1),t.push(e)}else{const t=z(this._syrupRenderer),i=e._impl,s=e=>{i.syrupToken=t.addLayer(e)};i.syrupToken?i.syrupToken.then(s):s(z(i.syrupLayer))}}insertBefore(e,t){const i=this._unregisteredLayers;if(i){const s=i.indexOf(t);if(s<0)return void Cr();const o=i.indexOf(e);o!==s&&(o>=0&&i.splice(o,1),i.splice(s,0,e))}else{const i=z(this._syrupRenderer),s=t._impl.syrupToken;if(!s)return void Cr();s.then((t=>{const s=e._impl,o=e=>{s.syrupToken=i.insertBefore(e,t)};s.syrupToken?s.syrupToken.then(o):o(z(s.syrupLayer))}))}}insertAfter(e,t){const i=this._unregisteredLayers;if(i){const s=i.indexOf(t);if(s<0)return void Cr();const o=i.indexOf(e);o!==s&&(o>=0&&i.splice(o,1),i.splice(s+1,0,e))}else{const i=z(this._syrupRenderer),s=t._impl.syrupToken;if(!s)return void Cr();s.then((t=>{const s=e._impl,o=e=>{s.syrupToken=i.insertAfter(e,t)};s.syrupToken?s.syrupToken.then(o):o(z(s.syrupLayer))}))}}removeLayer(e){if(this._unregisteredLayers){const t=this._unregisteredLayers.indexOf(e);if(t<0)return void Cr();this._unregisteredLayers.splice(t,1)}else{const t=z(this._syrupRenderer),i=e._impl.syrupToken;if(!i)return void Cr();e._impl.syrupToken=void 0,i.then((e=>{t.removeLayer(e)}))}}}const Lr="mapkit-re-bootstrap-notification",xr="mapkit-zoom-support-notification";Sr.PostUpdateHandlers=[];const Ar=Math.PI/180;const Er=Sr,Tr={fontFamily:"-apple-system-font, sans-serif",margin:"2em auto",width:"20em",borderRadius:"0.5em",color:"#f8f9f0",backgroundColor:"rgba(0, 0, 0, 0.7)",padding:"1em",textAlign:"center",position:"relative"},Ir={listStyleType:"none",margin:0,paddingLeft:0},Or={width:"1em",height:"1em",position:"absolute",top:"0.5em",left:"0.5em"};function Rr(e,t){for(const i in t)e.style[i]=t[i];return e}const Pr=class{constructor(e,t){this._element=Rr(document.createElement("div"),Tr);const i=Rr(this._element.appendChild(document.createElement("ul")),Ir);this._items=[function(e){const t=e.center.toCoordinate();return"Center: "+t.latitude.toFixed(6)+", "+t.longitude.toFixed(6)},function(e){return"Zoom: "+e.zoom.toFixed(6)+", rotation: "+e.rotation.toFixed(6)},function(e){const t=Math.floor(e.zoom),i=Math.pow(2,t);return"Center tile: x="+Math.floor(l(e.center.x,1)*i)+", y="+Math.floor(e.center.y*i)+", z="+t},function(e){return"Viewport: "+e.viewportSize.width+"Ã"+e.viewportSize.height}].map((e=>{const t=i.appendChild(document.createElement("li"));return function(i){t.textContent=e(i)}}));const s=Eo.svgElement("svg",{viewBox:"-16 -16 32 32"},Eo.svgElement("circle",{r:16,fill:"#ccc"}),Eo.svgElement("g",{"stroke-width":4,stroke:"#222"},Eo.svgElement("line",{x1:-8,y1:-8,x2:8,y2:8}),Eo.svgElement("line",{x1:8,y1:-8,x2:-8,y2:8})));this._element.appendChild(Rr(s,Or)),s.addEventListener("click",e),this.update(t),this.update=wt(this.update,50,this)}attachTo(e){e.appendChild(this._element)}detach(){this._element.remove()}update(e){this._items.forEach((t=>{t(e)}))}};const Dr=Ue.performanceMarkers.interactions,zr=180/Math.PI,Nr=3*zr,Fr=1e-4*zr*1e3,Ur=.995;const Gr=class extends qn{constructor(e){var t,i,s;super(e),s=!1,(i="decelerating")in(t=this)?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,this._recognizer=this.addRecognizer(new wn)}stopDecelerating(){this.decelerating&&this._decelerationEnded()}destroy(){super.destroy(),this.stopDecelerating(),delete this._recognizer}handleEvent(e){const t=e.target;t===this._recognizer&&(t.state===bo.Began&&(this.map.beganRecognizingRotation(),this.map.currentGestureType="rotate",this.map.cameraWillStartRotating()),t.state===bo.Ended&&(delete this._restricted,this.map.finishedRecognizingRotation(),this._startDeceleratingWithVelocity(t)),this._handleRotationChange(e.target),Dr&&performance.measure("mapkit-map-rotate-interaction",{start:t.lastEventTimeStamp,detail:t.state}))}_handleRotationChange(e){this._lastRotationCenter=this.centerForGesture(e);const t=this.map.cameraIsRotating&&e.state===bo.Changed,i=2===e.numberOfTouches&&Math.abs(e.rotation)<=150/e._distance();t&&!i&&(this.map.rotateCameraAroundMapPoint(this._lastRotationCenter,e.rotation),e.rotation=0)}_centerWithRecognizer(e){const t=this.map,i=e.locationInElement();let s=this.map.node.convertPointFromPage(i);s=t.camera.transformGestureCenter(s);const o=t.visibleMapRect,n=t.camera.viewportSize;return new vi.MapPoint(o.minX()+s.x/n.width*o.size.width,o.minY()+s.y/n.height*o.size.height)}performScheduledUpdate(e){const t=Dr?performance.now():void 0;if(!this.decelerating)return;if(null==e)return void this._decelerationEnded();const i=e-this._timeAtPreviousFrame;if(i>300)return void this._decelerationEnded();let s=this._velocity/1e3;const o=Math.pow(Ur,i),n=Ur*s*(o-1)/-.0050000000000000044;if(s*=o,this.map.cameraAnimation?this.map.cameraAnimation.adjustRotation(this._lastRotationCenter,n):this.map.rotateCameraAroundMapPoint(this._lastRotationCenter,n),this._velocity*=o,Math.abs(this._velocity)<=Fr)this._decelerationEnded();else{if(this._velocity*=o,Math.abs(this._velocity)<=Fr)return this._decelerationEnded(),void(Dr&&performance.measure("mapkit-map-rotate-deceleration",{start:t}));this._timeAtPreviousFrame=e,this._schedule(),Dr&&performance.measure("mapkit-map-rotate-deceleration",{start:t})}}_startDeceleratingWithVelocity(e){const t=e.velocity;if(Math.abs(t)>1440||isNaN(t))this.map.cameraDidStopRotating();else{if(Math.abs(t)<Nr)return this.decelerating=!1,void this.map.cameraDidStopRotating();this._velocity=t,this.decelerating=!0,this._timeAtPreviousFrame=e.lastEventTimeStamp,this._schedule()}}_schedule(){bt.scheduleOnNextFrame(this)}_decelerationEnded(){this.decelerating=!1,this.map.cameraDidStopRotating()}};const Br=class extends ir{constructor(e){var t,i,s;super(e),s=!1,(i="forcedSnapsToIntegralZoomLevels")in(t=this)?Object.defineProperty(t,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[i]=s,this._renderer=e._renderer,this._requiresFallback=!1,this._fallback=()=>{this._requiresFallback=!0}}init(e,t,i,s,o){if(this._requiresFallback)return void e.syrupRequestedFallback(As.FEATURE_ERROR);this._fallback=()=>e.syrupRequestedFallback(As.FEATURE_ERROR);const n={tint:this.tileTint,emphasis:this.emphasis};this._renderer.init(this.networkConfigurationFor(e),t,i,s,n,this._getRendererPoiFilter(),(e=>{this._updateMinAndMaxZoomLevels(this.camera.viewportSize),o(e,this._renderer)}))}get isRotationEnabled(){return this._isRotationEnabled}set isRotationEnabled(e){!e&&this._rotationController?(this._rotationController.destroy(),delete this._rotationController):e&&!this._rotationController&&(this._initialInteractionController||(this._initialInteractionController=new Vn(this)),this._rotationController=new Gr(this),this.camera._initialRotation=0),this._isRotationEnabled=e}get rotation(){return this.camera.rotation}set rotation(e){if(this._cameraWillChange(),this.camera.rotation=e,this._updateDisplay(),this._cameraDidChange(),this.cameraAnimation&&this.cameraAnimation.rotating)return;const t=this.node.delegate;t&&"function"==typeof t.mapRotationDidChange&&t.mapRotationDidChange(this.node)}set fontSizeRatio(e){this._renderer.fontSizeRatio=e,this._updateDisplay()}updateNetworkConfiguration(e){this._renderer.updateNetworkConfiguration(this.networkConfigurationFor(e))}forceRerender(){this._renderer.forceRerender()}prepareLayer(e){this._renderer.prepareLayer(e)}cleanupLayer(e){this._renderer.cleanupLayer(e)}addLayer(e){this._renderer.addLayer(e)}insertBefore(e,t){this._renderer.insertBefore(e,t)}insertAfter(e,t){this._renderer.insertAfter(e,t)}removeLayer(e){this._renderer.removeLayer(e)}adjustForSize(e){super.adjustForSize(e),this.forceRerender()}adjustMapItemPoint(e){return this.cameraIsZooming||this.cameraIsPanning||this.cameraIsRotating||(e.x=Eo.roundToDevicePixel(e.x),e.y=Eo.roundToDevicePixel(e.y)),e}networkConfigurationFor(e){if(!e)return{};let t=null;e.proxyPrefixes&&!e.customMadabaUrl&&(t=e.proxyPrefixes.slice(0));const i=!(!e.withCredentials||e.customMadabaUrl);return{madabaDomains:e.madabaDomains.slice(0),rasterTiles:e.rasterTilesForSyrup,proxyPrefixes:t,withCredentials:i,tileGroup:e.tileGroup,accessKey:e.accessKey,accessKeyHasExpired:()=>e.accessKeyHasExpired()}}rotateCameraAroundMapPoint(e,t){if(this.isRotationLocked){if(!this.restrictedCamera)return;if(this.restrictIncomingRotation){const e=l(this.camera.rotation+t,360),i=Eo.restrictRotation(e);i!==e&&(t=i-this.camera.rotation)}}if(0===t)return;this._cameraWillChange(),this.camera.rotateAroundCenter(e,t),this.constrainCamera(this.camera),this._updateDisplay(),this._cameraDidChange();const i=this.node.delegate;i&&"function"==typeof i.mapRotationDidChange&&i.mapRotationDidChange(this.node)}deactivate(){super.deactivate(),this.isRotationEnabled=!1,this._renderer.deactivate()}getMapFeatureRegions(){return this._renderer.getMapFeatureRegions()}destroy(e){super.destroy(e),this.customCanvas&&this.customCanvas.parentNode&&this.customCanvas.parentNode.removeChild(this.customCanvas),this._renderer&&(this._renderer.destroy(),this._renderer=null)}stringInfo(){return"SyrupNode<camera:"+this.camera.toString()+">"}get backgroundGridTheme(){return this._backgroundGridTheme}set backgroundGridTheme(e){this._backgroundGridTheme=e}get fullyRendered(){return this._renderer.fullyRendered}get customCanvas(){return this._renderer&&this._renderer.canvas}get camera(){return this._camera}set camera(e){this._camera=e,this.node.needsDisplay=!0}get language(){return this._language}set language(e){this._language!==e&&(this._language=e,this._renderer&&(this._renderer.language=e,this.node.needsDisplay=!0))}updateConfiguration(e){const t=this._configuration&&(e.name!==this._configuration.name||e.provider!==this._configuration.provider||e.countryCode!==this._configuration.countryCode);super.updateConfiguration(e),t&&this._renderer&&(this._renderer.updateConfiguration(e,{}),this.node.needsDisplay=!0)}updateTintAndEmphasis(e,t,i){this._renderer.node.pendingConfigurationUpdates?(this._renderer.node.pendingConfigurationUpdates.tint=e,this._renderer.node.pendingConfigurationUpdates.tileTint=t,this._renderer.node.pendingConfigurationUpdates.emphasis=i):this._renderer&&this._configuration&&(this._renderer.updateConfiguration(this._configuration,{tint:t,emphasis:i}),this.node.needsDisplay=!0)}updatePointOfInterestFilter(){this._renderer&&(this._renderer.updatePointOfInterestFilter(this._getRendererPoiFilter()),this.node.needsDisplay=!0)}makePendingConfigurationUpdates(){const e=this._renderer.node.pendingConfigurationUpdates;e&&(delete this._renderer.node.pendingConfigurationUpdates,e.tint&&e.emphasis&&this.updateTintAndEmphasis(e.tint,e.tileTint,e.emphasis),e.poiFilter&&this.updatePointOfInterestFilter())}devicePixelRatioDidChange(){return!this._renderer}get snapsToIntegralZoomLevels(){return this.forcedSnapsToIntegralZoomLevels||this._renderer&&this._renderer.snapsToIntegralZoomLevels}set snapsToIntegralZoomLevels(e){0}get debug(){return this._debug}set debug(e){this._debug!==!!e&&(this._debug=!!e,this._debug?this._showDebugPanel():this._hideDebugPanel())}minZoomLevelForViewportSize(e,t){return this._renderer&&this._renderer.Camera?this._renderer.Camera.getMinZoomLevel([e.width,e.height],t):this.minZoomLevel}needsReplacing(e){return!e}createLabelRegion(){return this._renderer.createLabelRegion()}updatedLabelRegion(){this.forceRerender(),this.node.needsDisplay=!0}unregisterLabelRegion(e){this._renderer.unregisterLabelRegion(e),this.node.needsDisplay=!0}_tileOverlaysDidChange(){this._fallback()}_showDebugPanel(){this._debugPanel=new Pr((()=>{this.debug=!1}),this.camera),this._debugPanel.attachTo(this._element)}_hideDebugPanel(){this._debugPanel.detach(),delete this._debugPanel}_updateDisplay(){this.forceRerender(),this.node.needsDisplay=!0}_getRendererPoiFilter(){const e=null!==this.pointOfInterestFilter,t=0!==this._filteredPois.size,i={};return e&&(i.categoryInclude=this.pointOfInterestFilter._includes,i.categoryExclude=this.pointOfInterestFilter._excludes),t&&(i.muidExclude=Array.from(this._filteredPois)),e||t?i:null}_cameraDidChange(){super._cameraDidChange(),this._debugPanel&&this._debugPanel.update(this.camera)}get[Un](){return this._[Un]}set[Un](e){this._[Un]=e,this._renderer[Un]?.(e)}[Gn](e){return this._renderer[Gn]?.(e)}};const Wr=class extends Wn{constructor(){super(),this._renderer=new Er(this),Object.defineProperty(this,"_impl",{value:new Br(this)})}get isRotationEnabled(){return this._impl.isRotationEnabled}set isRotationEnabled(e){this._impl.isRotationEnabled=e}get customCanvas(){return this._impl.customCanvas}set needsDisplay(e){e&&bt.scheduleDraw(this._renderer)}get forcedSnapsToIntegralZoomLevels(){return this._impl.forcedSnapsToIntegralZoomLevels}set forcedSnapsToIntegralZoomLevels(e){this._impl.forcedSnapsToIntegralZoomLevels=e}init(e,t,i,s,o){this._impl.init(e,t,i,s,o)}updateNetworkConfiguration(e){this._impl.updateNetworkConfiguration(e)}forceRerender(){this._impl.forceRerender()}forceDraw(){this._impl.forceRerender(),this._impl._renderer.performScheduledDraw()}requireRender(){this._impl.forceRerender(),bt.scheduleDraw(this._renderer)}rotateCameraAroundMapPoint(e,t){this._impl.rotateCameraAroundMapPoint(e,t)}makePendingConfigurationUpdates(){this._impl.makePendingConfigurationUpdates()}didReconfigure(){this.dispatchEvent(new D.Event("reconfigured"))}getMapFeatureRegions(){return this._impl.getMapFeatureRegions()}},Zr=Object.freeze({name:"functions",fn:function(){return!!(Array.prototype.fill&&Uint8Array.from&&"undefined"!=typeof Set&&Set.prototype.forEach&&window.btoa)}});function Kr(e){return{VERSION:e.getParameter(e.VERSION),MAX_RENDERBUFFER_SIZE:e.getParameter(e.MAX_RENDERBUFFER_SIZE)}}const jr=Object.freeze({name:"webGL",fn:function(e,t){if(t)return{capable:!0};const i=e?[e]:["webgl2","webgl"];for(let e=0;e<i.length;e++){const t=document.createElement("canvas");t.width=t.height=0;const o=t.getContext(i[e],{antialias:!1,stencil:!0,failIfMajorPerformanceCaveat:!0});if(null!=o)return{contextType:i[e],capable:(s=o,s.getParameter(s.MAX_TEXTURE_SIZE)>=4096&&s.getParameter(s.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>=8&&s.getParameter(s.MAX_VARYING_VECTORS)>=8&&s.getParameter(s.STENCIL_BITS)>=8),gpuInfo:Kr(o)}}var s;return!1}});let Hr;const Vr=()=>{if(window.Syrup||window.Spile&&window.Spile.Syrup)return Promise.resolve();if(!Hr){const e=Ue.performanceMarkers.loading;e&&performance.mark("mapkit-syrup-load-start");const t=()=>new Promise(((e,t)=>{const i=document.head.appendChild(document.createElement("script"));i.addEventListener("error",(e=>t(e)),{once:!0}),i.addEventListener("load",(()=>e()),{once:!0}),Ue.nonce&&St.isSyrupUrlTrusted()&&(i.nonce=Ue.nonce),i.crossOrigin=sa.getCorsAttribute(Ue._syrupUrl?Ue.urlWithCredentials(Ue._syrupUrl):Ue.withCredentials),i.src=St.createSyrupUrl()})).then((()=>{const t=window.Syrup||window.Spile?.Syrup;t&&(e&&performance.measure("mapkit-syrup-load","mapkit-syrup-load-start"),Ue.componentVersions.set("s",t.Version))}),(e=>{console.error(e)}));Hr=Ue._syrupUrl?t():Ue.loginPromise.then(t)}return Hr},qr=ce,Yr=V,Xr={sg_grid:{"global-configuration":"sg_ready",upgrade:"syrup_insert"},sg_insert:{"global-configuration":"sg_ready",upgrade:"syrup_insert",recreate:"sg_insert"},syrup_insert:{"global-configuration":"syrup_need_load",fallback:"sg_insert",recreate:"syrup_insert"},syrup_need_load:{"syrup-load":"syrup_init",fallback:"sg_insert",recreate:"syrup_insert"},syrup_init:{"global-configuration":"syrup_network_stalled",fallback:"sg_insert",recreate:"syrup_insert","syrup-complete":"syrup_ready"},syrup_network_stalled:{"global-configuration":"syrup_network_stalled",fallback:"sg_insert",recreate:"syrup_insert","syrup-complete":"syrup_ready"},sg_ready:{"global-configuration":"sg_ready",upgrade:"syrup_insert",recreate:"sg_insert","map-configuration":"sg_ready"},syrup_ready:{"global-configuration":"syrup_ready",upgrade:"syrup_insert",fallback:"sg_insert",recreate:"syrup_insert","map-configuration":"syrup_ready","print-match":"syrup_printing"},syrup_printing:{"print-unmatch":"syrup_ready"}},$r=Object.keys(Ps).map((e=>Ps[e]));class Jr{constructor(e,t){this._state=null,this._map=e,this._previousNode=null,this.node=null,this._initialOptions=t,this._cachedWebGLCheck=null,this._layers=[],this.loadPriority=Ns.LandCover,void 0!==t.loadPriority&&(d(t.loadPriority,Ns)?this.loadPriority=t.loadPriority:console.warn("[MapKit] Unknown value for `loadPriority`. Choose from mapkit.Map.LoadPriorities.")),this.initialContextType=t.contextType,this._previousCanRunCSR=!1;this._updateState("sg_grid")}get usingSSR(){return"sg_insert"===this._state||"sg_ready"===this._state}get csrCapable(){return"HYBRID"===Ue.forcedRenderingMode||"CLIENT"===Ue.forcedRenderingMode||this._webglCheckResult.shouldTryCSR}get shouldDynamicallyLoadSyrup(){return this._webglCheckResult.shouldTryCSR}get _webglCheckResult(){return null===this._cachedWebGLCheck&&(this._cachedWebGLCheck=function(e,t){const i={};return i.shouldTryCSR=[Zr,jr].every((s=>{const o=s.fn(e,t);return i[s.name]=o,"object"==typeof o?o.capable:o})),i}(this.initialContextType,Ue._disableWebGLCheck)),this._cachedWebGLCheck}get renderingMode(){let e="CLIENT";return this.usingSSR?e="SERVER":this._switchedToLoCSR&&(e="HYBRID"),e}configurationDidBecomeAvailable(e){const t=this._previousCanRunCSR,i=Ue.canRunCSR;this._previousCanRunCSR=i,!t||i||this.usingSSR?!t&&i?this.handleUpgrade():e||this.handleGlobalConfigurationChange():this.handleFallback(As.CONFIG_CHANGE)}forceSyrup(){this._transition("upgrade")}_findLayerIndex(e){let t;const i=this._layers;if("string"==typeof e)for(t=i.length;t--&&i[t].name!==e;);else t=i.indexOf(e);if(t<0)throw new Error("[MapKit] Layer not found");return t}_addLayer(e,t,i){const s=this._layers;let o;const n=$r.indexOf(t);if(n<0)o=this._findLayerIndex(t),e._impl.passIndex=s[o]._impl.passIndex,o+=i;else{for(o=0;o<s.length&&s[o].passIndex<n+i;)o++;e._impl.passIndex=n,e._impl.passOffset=i-1}this.node._impl.prepareLayer(e),o===s.length?this.node._impl.addLayer(e):0===o?this.node._impl.insertBefore(e,s[0]):this.node._impl.insertAfter(e,s[o-1]),s.splice(o,0,e)}_addedLayer(e){this.usingSSR?e._impl.contextFailed():this.node.requireRender()}addLayerAbove(e,t){void 0===t?(e._impl.passIndex=$r.length-1,e._impl.passOffset=0,this.node._impl.prepareLayer(e),this.node._impl.addLayer(e),this._layers.push(e)):this._addLayer(e,t,1),this._addedLayer(e)}addLayerBelow(e,t){if(void 0===t)throw new Error("[MapKit] Relative layer not specified");this._addLayer(e,t,0),this._addedLayer(e)}removeLayer(e){const t=this._findLayerIndex(e);this._layers.splice(t,1),this.node._impl.removeLayer(e),this.node.requireRender()}requireRender(){this.node.requireRender()}updateSize(e){this.node.size=e,this._previousNode&&(this._previousNode.size=e)}destroy(){this._layers.forEach((e=>this.node._impl.removeLayer(e))),this.node.removeEventListener("reconfigured",this),this.node.destroy(),this.node.delegate=null,this.node=null,this._previousNode&&(this._previousNode.destroy(),this._previousNode=null)}handleEvent(e){"reconfigured"===e.type&&(this._switchedToLoCSR=this.node.snapsToIntegralZoomLevels,this._map.didReconfigureMapNode(this.node))}handleGlobalConfigurationChange(){this._transition("global-configuration")}handleSyrupLoad(){this._transition("syrup-load")}handleFallback(e,t){const i=Ue.didFallback&&Ue.fallbackType||e;i&&this._logFallback(i,t),this._fallbackInfo={reason:e,message:t},this._transition("fallback")}handleUpgrade(){this._fallbackInfo=void 0,this._transition("upgrade")}handleRecreate(){this._transition("recreate")}handleMapConfigurationChange(){this._transition("map-configuration"),this._previousNode&&this._previousNode.configuration&&(this._previousNode.language=Ue.language,this._previousNode.configuration=Ue.types[this._map.mapType])}handleSyrupComplete(){this._transition("syrup-complete")}handlePrintMatch(){this._transition("print-match")}handlePrintUnmatch(){this._transition("print-unmatch")}handleMapRendered(){this.node instanceof Wr&&(this.node.forcedSnapsToIntegralZoomLevels=!1,this._removePreviousMapNode(!0))}setPointOfInterestFilter(e){this._previousNode&&(this._previousNode.pointOfInterestFilter=e)}setTintAndEmphasis(e,t,i){this._previousNode&&this._previousNode.setTintAndEmphasis(e,t,i)}mapCameraDidChange(){this._previousNode&&this._previousNode.setCameraAnimated(this.node.camera.copy())}_transition(e){const t=Xr[this._state][e];t&&this._updateState(t)}_updateState(e){this._state=e;const t=this["_enter_"+e];"function"==typeof t&&t.call(this)}_loadSyrupIfNeeded(e){Vr().then((()=>{e.call(this,!!window.Syrup||!!window.Spile&&!!window.Spile.Syrup)}))}_insertSceneGraphNode(){this.usingSSR&&(this.node.isRotationEnabled=!1);const e=new yr;this._insertNewMapNode(e),this._map.didFinishMapNodeInitialization(e)}_enter_sg_grid(){this._insertSceneGraphNode(),Ue.ready&&!Ue.canRunCSR&&this._updateState("sg_ready")}_enter_sg_insert(){this._insertSceneGraphNode(),Ue.ready&&this._updateState("sg_ready")}_enter_syrup_insert(){const e=new Wr;e.pendingConfigurationUpdates={},this._insertNewMapNode(e),Ue.state===Ue.States.READY&&this._updateState("syrup_need_load")}_insertNewMapNode(e){const t=this._initialOptions||{};this._initialOptions||this.node._impl._cameraWillChange(this.node,!1);const i=this.node;if(i)this._removePreviousMapNode(),i.migrateStateTo(e),i.removeEventListener("reconfigured",this),i.deactivate(),this._layers.forEach((e=>{i._impl.cleanupLayer(e),i._impl.removeLayer(e)})),this._previousNode=i;else{e.allowWheelToZoom=void 0!==t._allowWheelToZoom&&!!t._allowWheelToZoom,e.allowWheelToZoom2=void 0!==t._allowWheelToZoom2&&!!t._allowWheelToZoom2,e.pannable=void 0===t.isScrollEnabled||!!t.isScrollEnabled,e.zoomable=void 0===t.isZoomEnabled||!!t.isZoomEnabled,void 0!==t.pointOfInterestFilter?(void 0!==t.showsPointsOfInterest&&console.warn("[MapKit] `showsPointsOfInterest` is ignored because `pointOfInterestFilter` is set."),null!==t.pointOfInterestFilter&&m(t.pointOfInterestFilter,Ve,"[MapKit] Unknown value for `pointOfInterestFilter`. It must be an instance of mapkit.PointOfInterestFilter."),e.pointOfInterestFilter=t.pointOfInterestFilter):void 0!==t.showsPointsOfInterest&&(t.showsPointsOfInterest?e.pointOfInterestFilter=null:e.pointOfInterestFilter=Ve.filterExcludingAllCategories),e.showsDefaultTiles=void 0===t._showsDefaultTiles||!!t._showsDefaultTiles;for(const i of Jr.InitialOptionsHandlers)i.call(this,e,t)}this.node=e,this.node.addEventListener("reconfigured",this),this._map.didInsertNewMapNode(e),this._layers.forEach((t=>{e._impl.prepareLayer(t),e._impl.addLayer(t)})),this._initialOptions?delete this._initialOptions:this.node._impl._cameraDidChange(this.node,!1)}_removePreviousMapNode(e){if(this._previousNode)if(e){if(this._previousNode.animators&&this._previousNode.animators.length)return;const e=this._previousNode;new Qr({node:this._previousNode,duration:150,from:1,to:0,customCanvas:this._previousNode.customCanvas,done:()=>{e===this._previousNode&&this._removePreviousMapNode(!1)}}).begin()}else this._previousNode.destroy(!0),this._previousNode.remove(),this._previousNode=null}_enter_syrup_need_load(){if(this.shouldDynamicallyLoadSyrup){if(this.loadPriority&&this._previousNode&&this._previousNode instanceof yr&&!this._previousNode.configuration)if(0!==this.node.rotation)0;else{const e=this.loadPriority===Ns.PointsOfInterest;this._previousNode.snapsToIntegralZoomLevels=e,this._previousNode.labels=e,e&&(this.node.forcedSnapsToIntegralZoomLevels=!0,this.node.setZoomLevelAnimated(Eo.getIntegralZoom(this.node.zoomLevel))),this._previousNode.language=Ue.language,this._previousNode.configuration=Ue.types[this._map.mapType],this._previousNode.delegate={mapDidFinishRendering:e=>this._map.previousMapDidFinishRendering(e)},this._previousNode.setCameraBoundaryAnimated(null),this._previousNode.setCameraZoomRangeAnimated(null)}this._loadSyrupIfNeeded((e=>{e?this.handleSyrupLoad():(Ue.syrupRequestedFallback(),this.handleFallback(As.NETWORK_ERROR))}))}else this.handleFallback(As.BROWSER_SUPPORT_ERROR)}_enter_syrup_init(){if(!this.node)return;if(!Ue.madabaDomains||!Ue.madabaDomains.length)return this._csrWarning("Network error"),void this.handleFallback(As.CONFIG_MISSING);const e="object"==typeof Syrup?Syrup.SyrupRenderer:Spile.getRendererWithoutAnyWarranty(),t="object"==typeof Syrup?Syrup.Camera:Spile.Syrup.Camera;this._switchedToLoCSR=!1,Ue.forcedRenderingMode&&(this._switchedToLoCSR="HYBRID"===Ue.forcedRenderingMode);const i=this.node;this._reConfigureMapNode();const s=Ue.performanceMarkers.rendering?performance.now():void 0;i.init(Ue,e,t,{startInLoCSR:this._switchedToLoCSR,contextType:this._webglCheckResult.webGL.contextType,performanceMarkers:Ue.performanceMarkers.rendering},(e=>{Ue.performanceMarkers.rendering&&performance.measure("mapkit-syrup-init",{start:s}),e?(this._csrWarning(e),this.handleFallback(e.type||As.UNKNOWN_ERROR,e.message)):(this._reConfigureMapNode(),i.needsDisplay=!0,this._map.didFinishMapNodeInitialization(i),this.handleSyrupComplete())}))}_csrWarning(e){console.warn("[MapKit] CSR is unavailable. "+e)}_enter_syrup_network_stalled(){this.node.updateNetworkConfiguration(Ue)}_enter_sg_ready(){this._removePreviousMapNode(),this.node.snapsToIntegralZoomLevels=!0,this.node.isRotationEnabled=!1,"HYBRID"!==Ue.forcedRenderingMode&&"CLIENT"!==Ue.forcedRenderingMode||(this._map.mapNodeDidFail(this._fallbackInfo),console.warn("[MapKit] Not rendering raster tiles under forced client rendering."),this.node.showsDefaultTiles=!1),this._reConfigureMapNode(),this._map.mapNodeReady(!1),this._layers.forEach((e=>{e._impl.contextFailed()}))}_enter_syrup_ready(){!this.node.fullyRendered&&this._previousNode&&this._previousNode.configuration?(this._previousNode.language=Ue.language,this._previousNode.configuration=Ue.types[this._map.mapType]):this._removePreviousMapNode(),this._reConfigureMapNode(),this.node.updateNetworkConfiguration(Ue),this.node.makePendingConfigurationUpdates(),this._map.mapNodeReady(!0)}_reConfigureMapNode(){this.node.language=Ue.language,this.node.configuration=Ue.types[this._map.mapType],this.node._impl.debug||(this.node._impl.debug=!!Ue.showsTileInfo),this._map.didReconfigureMapNode(this.node)}_enter_syrup_printing(){this.node.forceRerender(),this.node.needsDisplay=!0}_sendAnalytics(e){let t="https://gsp10.apple-mapkit.com/hvr/mw/v1/spile";if(Ue.proxyPrefixes){t=Ue.proxyPrefixes[Ue.proxyPrefixes.length-1]+t}const i={};e&&(i.ssrFallback=e);new qr(t,{getDataToSend:function(e){return e.setRequestHeader("Content-Type","text/plain"),e.responseType="text",JSON.stringify(i)}},{method:"POST",priority:Yr.Low,withCredentials:Ue.withCredentials}).schedule()}_logFallback(e,t){const i=Vt.uaParserInfo.browserInfo,s=Vt.uaParserInfo.deviceInfo,o=this._usingCSRAPI();this._sendAnalytics({reason:e,message:t,usingCSRAPI:o,devicePlatform:s.platform,deviceOs:s.os,browserName:i.name,browserVersion:i.version})}_usingCSRAPI(){return!(this._map._showsCompass!==Us.Visible&&(this._map._showsCompass!==Us.Adaptive||this._map._usingDefaultShowsCompassValue)&&0===this._map.rotation&&!this._map._annotationsController.containsMarkerAnnotation())}}Jr.InitialOptionsHandlers=[];class Qr extends Jo{constructor(e){super(e),this.customCanvas=e.customCanvas}update(e){this.customCanvas&&(this.customCanvas.style.opacity=this.valueAt(e)),super.update(e)}}const el=Jr,tl=(e,t,i)=>{const s=e.createShader(t);e.shaderSource(s,i),e.compileShader(s);if(e.getShaderParameter(s,e.COMPILE_STATUS))return s;e.deleteShader(s)};const il=function(e){this._impl={scene:e,failed:!1,prepare(e){if(this.failed)return;const t=tl(e,e.VERTEX_SHADER,"\nattribute vec2 a_position;\nvarying vec2 v_texcoord;\nvoid main() {\n gl_Position = vec4((a_position * 2.0 - 1.0) * vec2(1, -1), 0, 1);\n v_texcoord = a_position;\n}\n"),i=tl(e,e.FRAGMENT_SHADER,"precision mediump float;\nvarying vec2 v_texcoord;\nuniform sampler2D u_texture;\nvoid main() {\n gl_FragColor = texture2D(u_texture, v_texcoord);\n}");this.program=((e,t,i)=>{const s=e.createProgram();if(e.attachShader(s,t),e.attachShader(s,i),e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS))return s;e.deleteProgram(s)})(e,t,i)},release(e){this.failed||e.deleteProgram(this.program)},added(e){this.prepare(e)},removed(e){this.release(e)},render(e,t){if(this.failed)return;const i=this.program,s=e.getAttribLocation(i,"a_position"),o=e.getUniformLocation(i,"u_texture"),n=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,n);const a=e.canvas.width,r=e.canvas.height;e.viewport(0,0,a,r),e.useProgram(this.program),e.enableVertexAttribArray(s),e.bindBuffer(e.ARRAY_BUFFER,n);const l=e.createTexture();e.bindTexture(e.TEXTURE_2D,l),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this.scene.element),e.generateMipmap(e.TEXTURE_2D),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.vertexAttribPointer(s,2,e.FLOAT,!1,0,0),e.uniform1i(o,0),e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLES,0,6)},contextFailed(){this.failed=!0}}},sl={"logo-autonavi":{xMin:.132,xMax:.828},"logo-autonavi-rtl":{xMin:.127,xMax:.833},"logo-autonavi-satellite":{xMin:.132,xMax:.828},"logo-autonavi-satellite-rtl":{xMin:.186,xMax:.862},"logo-wordmark-ar-SA":{xMin:.36,xMax:.996},"logo-wordmark-ca-ES":{xMin:.003,xMax:.631},"logo-wordmark-cs-CZ":{xMin:.003,xMax:.546},"logo-wordmark-da-DK":{xMin:.003,xMax:.434},"logo-wordmark-de-DE":{xMin:.003,xMax:.616},"logo-wordmark-el-GR":{xMin:.003,xMax:.681},"logo-wordmark-en-US":{xMin:.003,xMax:.539},"logo-wordmark-en-GB":{xMin:.003,xMax:.539},"logo-wordmark-es-ES":{xMin:.003,xMax:.63},"logo-wordmark-fr-CA":{xMin:.003,xMax:.533},"logo-wordmark-fi-FI":{xMin:.003,xMax:.578},"logo-wordmark-fr-FR":{xMin:.003,xMax:.533},"logo-wordmark-he-IL":{xMin:.491,xMax:.996},"logo-wordmark-hi-IN":{xMin:.003,xMax:.523},"logo-wordmark-hr-HR":{xMin:.003,xMax:.523},"logo-wordmark-hu-HU":{xMin:.003,xMax:.807},"logo-wordmark-es-MX":{xMin:.003,xMax:.63},"logo-wordmark-id-ID":{xMin:.003,xMax:.454},"logo-wordmark-ja-JP":{xMin:.003,xMax:.506},"logo-wordmark-ko-KR":{xMin:.003,xMax:.407},"logo-wordmark-it-IT":{xMin:.003,xMax:.644},"logo-wordmark-ms-MY":{xMin:.003,xMax:.454},"logo-wordmark-nb-NO":{xMin:.003,xMax:.432},"logo-wordmark-nl-NL":{xMin:.003,xMax:.704},"logo-wordmark-pt-BR":{xMin:.003,xMax:.63},"logo-wordmark-pl-PL":{xMin:.003,xMax:.546},"logo-wordmark-pt-PT":{xMin:.003,xMax:.63},"logo-wordmark-ru-RU":{xMin:.003,xMax:.605},"logo-wordmark-ro-RO":{xMin:.003,xMax:.488},"logo-wordmark-satellite-ar-SA":{xMin:.357,xMax:.996},"logo-wordmark-satellite-ca-ES":{xMin:.003,xMax:.635},"logo-wordmark-satellite-de-DE":{xMin:.003,xMax:.62},"logo-wordmark-satellite-da-DK":{xMin:.003,xMax:.437},"logo-wordmark-satellite-cs-CZ":{xMin:.003,xMax:.551},"logo-wordmark-satellite-en-GB":{xMin:.003,xMax:.542},"logo-wordmark-satellite-en-US":{xMin:.003,xMax:.542},"logo-wordmark-satellite-es-ES":{xMin:.003,xMax:.633},"logo-wordmark-satellite-es-MX":{xMin:.003,xMax:.633},"logo-wordmark-satellite-el-GR":{xMin:.003,xMax:.685},"logo-wordmark-satellite-fr-CA":{xMin:.003,xMax:.537},"logo-wordmark-satellite-fi-FI":{xMin:.003,xMax:.581},"logo-wordmark-satellite-he-IL":{xMin:.487,xMax:.997},"logo-wordmark-satellite-fr-FR":{xMin:.003,xMax:.537},"logo-wordmark-satellite-hu-HU":{xMin:.003,xMax:.814},"logo-wordmark-satellite-hi-IN":{xMin:.003,xMax:.525},"logo-wordmark-satellite-hr-HR":{xMin:.003,xMax:.523},"logo-wordmark-satellite-id-ID":{xMin:.003,xMax:.458},"logo-wordmark-satellite-it-IT":{xMin:.003,xMax:.648},"logo-wordmark-satellite-ja-JP":{xMin:.003,xMax:.51},"logo-wordmark-satellite-ko-KR":{xMin:.003,xMax:.41},"logo-wordmark-satellite-nl-NL":{xMin:.003,xMax:.707},"logo-wordmark-satellite-nb-NO":{xMin:.003,xMax:.435},"logo-wordmark-satellite-ms-MY":{xMin:.003,xMax:.458},"logo-wordmark-satellite-pt-BR":{xMin:.003,xMax:.633},"logo-wordmark-satellite-pl-PL":{xMin:.003,xMax:.551},"logo-wordmark-satellite-pt-PT":{xMin:.003,xMax:.633},"logo-wordmark-satellite-ro-RO":{xMin:.003,xMax:.492},"logo-wordmark-satellite-ru-RU":{xMin:.003,xMax:.608},"logo-wordmark-satellite-sk-SK":{xMin:.003,xMax:.551},"logo-wordmark-satellite-sl-SI":{xMin:.003,xMax:.881},"logo-wordmark-satellite-sv-SE":{xMin:.003,xMax:.588},"logo-wordmark-satellite-th-TH":{xMin:.003,xMax:.542},"logo-wordmark-satellite-tr-TR":{xMin:.003,xMax:.574},"logo-wordmark-satellite-uk-UA":{xMin:.003,xMax:.588},"logo-wordmark-satellite-vi-VN":{xMin:.003,xMax:.636},"logo-wordmark-satellite-zh-CN":{xMin:.003,xMax:.407},"logo-wordmark-satellite-zh-HK":{xMin:.003,xMax:.407},"logo-wordmark-satellite-zh-TW":{xMin:.003,xMax:.407},"logo-wordmark-sv-SE":{xMin:.003,xMax:.585},"logo-wordmark-sk-SK":{xMin:.003,xMax:.546},"logo-wordmark-sl-SI":{xMin:.003,xMax:.882},"logo-wordmark-th-TH":{xMin:.003,xMax:.539},"logo-wordmark-vi-VN":{xMin:.003,xMax:.633},"logo-wordmark-zh-CN":{xMin:.003,xMax:.403},"logo-wordmark-tr-TR":{xMin:.003,xMax:.571},"logo-wordmark-uk-UA":{xMin:.003,xMax:.584},"logo-wordmark-zh-HK":{xMin:.003,xMax:.403},"logo-wordmark-zh-TW":{xMin:.003,xMax:.403}},ol="satellite",nl="autonavi";function al(e,t,i){const s=e._delegate,o=function(e,t){let i=["logo-wordmark"];Ue.isAutoNavi&&(i=["logo",nl]);e&&i.push(ol);Ue.isAutoNavi&&t&&i.push("rtl");Ue.isAutoNavi||i.push(Vi.localeId);return i.join("-")}(i,e.rtl),n="logos/"+o,a=Ue.isAutoNavi,r=a?[1,2,3]:[1],l=a||1===Eo.devicePixelRatio?".png":".svg",h=sl[o];h&&s.logoUpdated(h),t.classList.toggle("mk-logo-autonavi",Ue.isAutoNavi),t.element.crossOrigin=sa.getCorsAttribute(Ue.distUrlWithCredentials),t.setAttribute("src",St.createImageUrl(Eo.imagePathForDevice(r,n,l)))}const rl=class extends io{constructor(e){const t=Eo.htmlElement("img");super(Eo.htmlElement("div",{class:e.logoEnablesContainerQuery?"mk-cq-logo-control":"mk-logo-control"},t)),this._delegate=e,this._logoElement=t,this._logoElementNode=new io(this._logoElement),this._logoElementNode.classList.add("mk-logo"),this.tint=void 0,Vi.addEventListener(Vi.Events.LocaleChanged,this),Ue.addEventListener(Ue.Events.Changed,this),this.rtl=Vi.activeLocale.rtl}updateWithMapNodeTint(e){this.tint=e;const t=Eo.darkColorScheme(e),i=this._logoElementNode;if(Ue.state===Ue.States.UNINITIALIZED){const e=()=>{Ue.removeEventListener(Ue.Events.Initialized,e),al(this,i,t)};Ue.addEventListener(Ue.Events.Initialized,e)}else al(this,i,t);const s=Ue.tileProvider?Ue.tileProvider:Ue.TileProviders.Apple;i.setAttribute("alt",Vi.get("Logo."+s+".Tooltip"))}handleEvent(e){switch(e.type){case Vi.Events.LocaleChanged:this.rtl=e.locale.rtl,this._handleLocaleChange(e);break;case Ue.Events.Changed:if(!this.tint)return void 0;this.updateWithMapNodeTint(this.tint)}}mapWasDestroyed(){Vi.removeEventListener(Vi.Events.LocaleChanged,this),Ue.removeEventListener(Ue.Events.Changed,this)}_handleLocaleChange(e){this.tint&&this.updateWithMapNodeTint(this.tint)}};const ll=class extends io{constructor(e=!1){super(Eo.htmlElement("a",{target:"_blank",tabindex:0,class:e?"mk-legal mk-cq-legal":"mk-legal"}));const t=Eo.htmlElement("span");t.textContent=Vi.get("Legal.Label"),this._labelNode=new io(t),this._labelNode.classList.add("mk-legal-label"),this.element.appendChild(this._labelNode.element),this._handleKeyPressEventListener=e=>this._handleKeyPressEvent(e)}updateWithMapType(e){if(this.mapType=e,this._labelNode.element.textContent=Vi.get("Legal.Label"),Ue.isAutoNavi)if(Ue.ready){const e=z(Ue.types[z(this.mapType)]).tileSources[0];e.attribution&&e.attribution.url&&this.setAttribute("href",e.attribution.url)}else this.removeAttribute("href");else this.setAttribute("href",Vi.get("Legal.Apple.URL"))}willMoveToParent(e){e?this.parent||(this._handleLocaleChangedListener=e=>this._handleLocaleChanged(e),Vi.addEventListener(Vi.Events.LocaleChanged,this._handleLocaleChangedListener),this.element.addEventListener("keypress",this._handleKeyPressEventListener)):(Vi.removeEventListener(Vi.Events.LocaleChanged,this._handleLocaleChangedListener),this.element.removeEventListener("keypress",this._handleKeyPressEventListener))}_handleLocaleChanged(e){this.mapType&&this.updateWithMapType(this.mapType)}_handleKeyPressEvent(e){"Space"===e.code&&(e.preventDefault(),this.element.click())}};function hl(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const cl={CONTROL:"mk-control",DISABLED:"mk-disabled",FOCUS:"mk-focus"};class dl{constructor(e){this._control=e}destroy(){window.removeEventListener(Eo.startEventType,this._control._cancelFocusEventListener,!0),this._removeEventListeners(),delete this._control}handleEvent(e){switch(e.type){case"click":this._click(e);break;case Eo.startEventType:this._touchesBegan(e);break;case Eo.moveEventType:this._control.touchesMoved(e);break;case Eo.endEventType:this._removeEventListeners(),this._control.touchesEnded(e);break;case Eo.cancelEventType:this._removeEventListeners(),this._control.touchesCanceled(e);break;case"keydown":this._keyDown(e);break;case"keyup":this._keyUp(e);break;case"focus":this._focus(e);break;case"blur":this._blur(e);break;case Vi.Events.LocaleChanged:this._control.localeChanged(e)}}_click(e){this._swallowEvent(e),this._control.clicked(e)}_touchesBegan(e){this._swallowEvent(e);("mousedown"===e.type||"pointerdown"===e.type&&"mouse"===e.pointerType)&&(0!==e.button||e.ctrlKey)||(window.addEventListener(Eo.moveEventType,this,!0),window.addEventListener(Eo.endEventType,this,!0),Eo.cancelEventType&&window.addEventListener(Eo.cancelEventType,this,!0),this._control.touchesBegan(e))}_keyDown(e){switch(e.keyCode){case t:this._control.escapeKeyDown(e);break;case i:e.preventDefault(),this._control.spaceBarKeyDown(e);break;case a:e.preventDefault(),this._control.downArrowKeyDown(e);break;case o:e.preventDefault(),this._control.upArrowKeyDown(e);break;case n:e.preventDefault(),this._control.rightArrowKeyDown(e);break;case s:e.preventDefault(),this._control.leftArrowKeyDown(e)}}_keyUp(e){switch(e.keyCode){case t:this._control.escapeKeyUp(e);break;case a:e.preventDefault(),this._control.downArrowKeyUp(e);break;case o:e.preventDefault(),this._control.upArrowKeyUp(e);break;case n:e.preventDefault(),this._control.rightArrowKeyUp(e);break;case s:e.preventDefault(),this._control.leftArrowKeyUp(e);break;case i:e.preventDefault(),this._control.spaceBarKeyUp(e)}}_focus(e){if(this._control.hasFocus)return void 0;Eo.containingDocumentOrShadowRoot(this._control.element).activeElement===e.target&&(this._control.hasFocus=!0,this._control.classList.add(cl.FOCUS),window.addEventListener(Eo.startEventType,this._control._cancelFocusEventListener,!0),this._control.focused(e))}_blur(e){this._control.hasFocus&&(this._control.hasFocus=!1,window.removeEventListener(Eo.startEventType,this._control._cancelFocusEventListener,!0),this._control.classList.remove(cl.FOCUS),this._control.blurred(e))}_removeEventListeners(){window.removeEventListener(Eo.moveEventType,this,!0),window.removeEventListener(Eo.endEventType,this,!0),Eo.cancelEventType&&window.removeEventListener(Eo.cancelEventType,this,!0)}_swallowEvent(e){e.preventDefault(),e.stopPropagation()}}class ul{constructor(e){this._control=e}destroy(){delete this._control}handleEvent(e){this._control.blurFocusedElement(e)}}class pl{constructor(e){this._control=e}destroy(){delete this._control}handleEvent(e){switch(e.type){case"focus":this._control.pageHasFocus||(this._control.pageHasFocus=!0,this._control.pageDidFocus(e));break;case"blur":this._control.pageHasFocus=!1,this._control.pageDidBlur(e)}}}const ml=class extends io{constructor(e){super(e),hl(this,"addEventListener",I.prototype.addEventListener),hl(this,"removeEventListener",I.prototype.removeEventListener),hl(this,"dispatchEvent",I.prototype.dispatchEvent),this.classList.add(cl.CONTROL),void 0===this._enabled&&(this._enabled=!1),void 0===this.hasFocus&&(this.hasFocus=!1),void 0===this.pageHasFocus&&(this.pageHasFocus=!1)}get enabled(){return this._enabled}set enabled(e){const t=!!e;this._enabled!==t&&(t?this.enable():this.disable(),this._enabled=t,this.reset())}set canShowTooltips(e){e?this._updateLabels():this._clearLabels()}willMoveToParent(e){e?this.parent||(this._createListeners(),Vi.addEventListener(Vi.Events.LocaleChanged,this._eventListener),this.enabled&&(this._addFocusAndBlurListeners(),this._addKeyboardListeners(),this.addEventListeners())):(Vi.removeEventListener(Vi.Events.LocaleChanged,this._eventListener),this.removeEventListeners(),this._removeFocusAndBlurListeners(),this._removeKeyboardListeners(),this._destroyListeners())}enable(){this.classList.remove(cl.DISABLED),this._createListeners(),this.element.addEventListener(Eo.startEventType,this._eventListener),this.element.addEventListener("click",this._eventListener),this.parent&&(this._addFocusAndBlurListeners(),this._addKeyboardListeners(),this.addEventListeners())}disable(){this.classList.add(cl.DISABLED),this.element.removeEventListener(Eo.startEventType,this._eventListener),this.element.removeEventListener("click",this._eventListener),this.removeEventListeners(),this._removeFocusAndBlurListeners(),this._removeKeyboardListeners()}blurFocusedElement(e){const t=Eo.getShadowDOMTargetFromEvent(this.element,e);if(!this.element.contains(t)){const e=Eo.containingDocumentOrShadowRoot(this.element);e.activeElement&&this.element.contains(e.activeElement)&&e.activeElement.blur()}}reset(){}saveEndEventProps(e){if(e&&e.type===Eo.endEventType){const t=e.changedTouches?e.changedTouches[0]:e;this._endEventProps=[t.clientX,t.clientY,t.screenX,t.screenY]}}checkClickEventProps(e){if(!this._endEventProps)return!1;const t=[e.clientX,e.clientY,e.screenX,e.screenY];let i=!0;for(let e=0;e<t.length;e++)if(Math.abs(this._endEventProps[e]-t[e])>1){i=!1;break}return delete this._endEventProps,i}clicked(){}touchesBegan(e){}touchesMoved(e){}touchesEnded(e){}touchesCanceled(e){}spaceBarKeyDown(e){}spaceBarKeyUp(e){}escapeKeyDown(e){}escapeKeyUp(e){}downArrowKeyUp(e){}downArrowKeyDown(e){}upArrowKeyUp(e){}upArrowKeyDown(e){}rightArrowKeyUp(e){}leftArrowKeyUp(e){}rightArrowKeyDown(e){}leftArrowKeyDown(e){}focused(e){}blurred(e){}pageDidFocus(e){}pageDidBlur(e){}updateTintColor(e){}removeEventListeners(){}addEventListeners(){}localeChanged(){}_clearLabels(){Eo.updateLabel(this.element,"")}_createListeners(){this._eventListener||(this._eventListener=new dl(this)),this._windowEventListener||(this._windowEventListener=new pl(this)),this._cancelFocusEventListener||(this._cancelFocusEventListener=new ul(this))}_destroyListeners(){this._eventListener&&(this.element.removeEventListener(Eo.startEventType,this._eventListener),this.element.removeEventListener("click",this._eventListener),this._eventListener.destroy(),delete this._eventListener),this._windowEventListener&&(this._windowEventListener.destroy(),delete this._windowEventListener),this._cancelFocusEventListener&&(this._cancelFocusEventListener.destroy(),delete this._cancelFocusEventListener)}_addFocusAndBlurListeners(){this.element.addEventListener("focus",this._eventListener,!0),this.element.addEventListener("blur",this._eventListener,!0),window.addEventListener("focus",this._windowEventListener),window.addEventListener("blur",this._windowEventListener),this.hasFocus=Eo.containingDocumentOrShadowRoot(this.element).activeElement===this.element}_removeFocusAndBlurListeners(){this.element.removeEventListener("focus",this._eventListener,!0),this.element.removeEventListener("blur",this._eventListener,!0),window.removeEventListener(Eo.startEventType,this._cancelFocusEventListener,!0),window.removeEventListener("focus",this._windowEventListener),window.removeEventListener("blur",this._windowEventListener)}_addKeyboardListeners(){this.element.addEventListener("keydown",this._eventListener),this.element.addEventListener("keyup",this._eventListener)}_removeKeyboardListeners(){this.element.removeEventListener("keydown",this._eventListener),this.element.removeEventListener("keyup",this._eventListener)}};const gl={CONTROL:"mk-popover",ARROW:"mk-popover-arrow",SHOWN:"mk-shown"};const _l=class extends io{constructor(){super(Eo.htmlElement("div",{class:gl.CONTROL,role:"dialog",tabindex:"-1"})),this.element.appendChild(Eo.createSVGIcon(Eo.svgElement("g",Eo.svgElement("rect",{y:12,x:0,height:2,width:30}),Eo.svgElement("path",{d:"M0 13v-.5c4.038 0 8.305-3.53 12.835-10.477.454-.71 1.005-1.137 1.564-1.326h.001a2.07 2.07 0 011.814.225c.273.175.505.407.68.68C21.525 8.829 25.881 12.5 30 12.5v.5"})),{class:gl.ARROW,"aria-hidden":!0,width:30,height:14}))}open(){this.classList.add(gl.SHOWN)}handleEvent(e){this.classList.contains(gl.SHOWN)&&this.focus()}focus(){this.element.focus()}close(){this.classList.remove(gl.SHOWN)}didMoveToParent(e){e?this.element.addEventListener("transitionend",this):this.element.removeEventListener("transitionend",this)}};const fl={CONTROL:"mk-map-type-button",LIGHT_ICON:"mk-light-icon",DARK_ICON:"mk-dark-icon"};function yl(e,t){const i=["icons/map-type"];return i.push(e.toLowerCase()),t&&i.push("dark"),St.createImageUrl(Eo.imagePathForDevice([1,2],i.join("-"),".png"))}const vl=class extends io{constructor(e,t,i){super(Eo.htmlElement("label",{class:fl.CONTROL})),this.delegate=i,this.mapType=e,this.enabled=!1,this._handleChangeEventListener=()=>this._handleChangeEvent();const s=i.mapTypes[e]===i.mapType,o=Vi.get("Mode."+e),n=Eo.htmlElement("input",{type:"radio",name:t,"aria-label":o,tabindex:"0"});n.checked=s,this.radioElement=n,this.element.appendChild(n);const a=function(e,t){const i=[];t[e]===t.Standard?(i.push(Eo.htmlElement("img",{class:fl.LIGHT_ICON,"aria-hidden":!0,crossOrigin:sa.getCorsAttribute(Ue.distUrlWithCredentials),src:yl(e,!1)})),i.push(Eo.htmlElement("img",{class:fl.DARK_ICON,"aria-hidden":!0,crossOrigin:sa.getCorsAttribute(Ue.distUrlWithCredentials),src:yl(e,!0)}))):i.push(Eo.htmlElement("img",{"aria-hidden":!0,crossOrigin:sa.getCorsAttribute(Ue.distUrlWithCredentials),src:yl(e,!1)}));return i}(e,i.mapTypes);a.forEach((e=>this.element.appendChild(e)))}focus(){this.radioElement.focus()}setSelected(){this.element.firstChild.checked=!0}updateLabels(){const e=Vi.get("Mode."+this.mapType);this.radioElement.setAttribute("aria-label",e)}activate(){this.radioElement.addEventListener("change",this._handleChangeEventListener),this._handleChangeEvent()}deactivate(){this.radioElement.removeEventListener("change",this._handleChangeEventListener)}_handleChangeEvent(){this.radioElement.checked&&this._handleSelected(this.radioElement.checked)}_handleSelected(){this.delegate.mapType=this.delegate.mapTypes[this.mapType]}},bl=["Standard","Hybrid","Satellite"];const wl={POPOVER:"mk-map-type-popover",MAP_TYPE_LABEL:"mk-map-type-label"},Cl=class extends _l{constructor(e){super(),this.classList.add(wl.POPOVER),this.setAttribute("aria-label",Vi.get("MapType.Tooltip")),this.delegate=e,this.buttons={},this.labels={};const t=`mk-map-type-button-${Math.random().toString(32).substring(2)}`;bl.forEach((i=>{const s=new io,o=new vl(i,t,e);s.addChild(o);const n=new io(Eo.htmlElement("div",{"aria-hidden":"true",class:wl.MAP_TYPE_LABEL}));n.element.textContent=Vi.get("Mode."+i),s.addChild(n),this.addChild(s),this.buttons[i]=o,this.labels[i]=n,e.mapTypes[i]===e.mapType&&(this.selectedButton=o)}))}focus(){this.selectedButton.focus()}updateSelected(){const e=bl.find((e=>this.delegate.mapTypes[e]===this.delegate.mapType));this.selectedButton=this.buttons[e],this.selectedButton.setSelected()}updateLabels(){this.setAttribute("aria-label",Vi.get("MapType.Tooltip")),bl.forEach((e=>{this.labels[e].element.textContent=Vi.get("Mode."+e),this.buttons[e].updateLabels()}))}didMoveToParent(e){super.didMoveToParent(e),e?bl.forEach((e=>this.buttons[e].activate())):bl.forEach((e=>this.buttons[e].deactivate()))}},kl="data-l10n-key";class Ml{constructor(e){this._control=e}get mapTypes(){return this._control.mapTypes}get mapType(){return this._control.mapType}set mapType(e){this._control.mapType=e}}const Sl="mk-map-type-control",Ll="mk-pressed";class xl extends ml{constructor(e,t,i){super(Eo.htmlElement("div",{role:"button",tabindex:"0"})),this.classList.add(Sl),this._delegate=new Ml(this),this._focusDelegate=i;const s=function(){const e=Eo.svgElement("path"),t=Eo.createSVGIcon(e,{});return t.setAttribute("viewBox","0 0 45 24"),[t,e]}();this.element.appendChild(s[0]),this._iconElement=s[1],this._mapType=t,this._mapTypes=e,this._updateIcon(),this._updateLabels(),this.enabled=!0,this._isOpen=!1}get mapType(){return this._mapType}set mapType(e){e!==this._mapType&&(this._mapType=e,this._updateIcon(),this.popover.updateSelected(),this.dispatchEvent(new D.Event(xl.EVENTS.MAP_TYPE_CHANGE)))}get mapTypes(){return this._mapTypes}localeChanged(e){this._updateLabels(),this.popover.updateLabels()}touchesBegan(e){this._pressed()}touchesEnded(e){this.reset()}clicked(e){this._toggle()}touchesCanceled(e){this.reset()}spaceBarKeyDown(e){this._pressed()}spaceBarKeyUp(e){this.reset(),this._open(!0)}updateTintColor(e){this.tintColor=e,this._iconElement.style.fill=e}reset(){this.classList.remove(Ll),this._focusDelegate.controlWasReleased(this)}handleEvent(e){switch(e.type){case Eo.startEventType:{const t=Eo.getShadowDOMTargetFromEvent(this.element,e);this.popover.element.contains(t)||this.element.contains(t)||this._close();break}case"keydown":if((e=>e.keyCode===t)(e)){this._close();const e=Eo.containingDocumentOrShadowRoot(this.element).activeElement;e&&this.popover.element.contains(e)&&this.element.focus()}break;case"blur":this.popover.element.contains(e.relatedTarget)||this._close()}}didMoveToParent(e){e?(this.popover=new Cl(this._delegate),this.parent.insertAfter(this.popover,this)):(window.removeEventListener(Eo.startEventType,this,!0),window.removeEventListener("keydown",this,!0),this.popover.element.removeEventListener("blur",this,!0),this.popover.remove(),this.popover=null)}focused(e){this._focusDelegate.controlDidGetFocus(this)}blurred(e){this._focusDelegate.controlDidLoseFocus(this)}_updateLabels(){Eo.updateLabel(this,Vi.get("MapType.Tooltip"))}_toggle(){this._isOpen?this._close():this._open()}_pressed(){this.classList.add(Ll),this._focusDelegate.controlWasPressed(this)}_open(){this._isOpen||(this._isOpen=!0,this.popover.open(),window.addEventListener(Eo.startEventType,this,!0),window.addEventListener("keydown",this,!0),this.popover.element.addEventListener("blur",this,!0))}_close(){this._isOpen&&(this._isOpen=!1,this.popover.close(),window.removeEventListener(Eo.startEventType,this,!0),window.removeEventListener("keydown",this,!0),this.popover.element.removeEventListener("blur",this,!0))}_handleLocaleChange(){this.children.forEach((e=>{const t=e.element.getAttribute(kl);e.element.textContent=Vi.get(t)}))}_updateIcon(){this._iconElement.setAttribute("d",Al[this._mapType])}}xl.EVENTS={MAP_TYPE_CHANGE:"map-type-change"};const Al={standard:"M24.597 18.663V8.233L21.53 6.369a1.83 1.83 0 00-.413-.178v10.569l3.136 1.764c.06.03.116.058.171.083a.815.815 0 00.172.057zm-7.548-.178c.17 0 .356-.057.559-.171l2.615-1.416V6.285c-.06.026-.125.055-.197.089-.072.034-.14.07-.203.108l-2.958 1.695c-.199.11-.346.246-.44.41a1.118 1.118 0 00-.144.574v8.544c0 .25.07.442.207.577.137.136.324.203.561.203zm8.436.153a.641.641 0 00.204-.09l3.269-1.853c.203-.114.352-.251.447-.412.095-.161.143-.354.143-.578V7.18c0-.254-.07-.447-.21-.58-.14-.134-.332-.2-.577-.2-.17 0-.358.057-.565.17l-2.71 1.505v10.563z",hybrid:"M22.918 13.579c.13 0 .262-.023.393-.067.131-.044.275-.111.432-.2l4.951-2.875c.267-.157.456-.303.568-.438a.741.741 0 00.168-.49.724.724 0 00-.168-.475c-.112-.136-.301-.282-.568-.438L23.743 5.72a2.539 2.539 0 00-.432-.2 1.22 1.22 0 00-.79 0c-.129.045-.274.111-.435.2l-4.951 2.876c-.267.156-.456.302-.568.438a.724.724 0 00-.168.476c0 .19.056.353.168.489.112.135.301.28.568.438l4.951 2.875c.161.089.306.156.435.2.13.044.261.067.397.067zm0 3.135a.81.81 0 00.343-.076c.11-.05.237-.116.38-.197l5.409-3.192a.775.775 0 00.292-.28.656.656 0 00.095-.33.601.601 0 00-.12-.374.81.81 0 00-.267-.235l-5.847 3.377c-.055.034-.105.06-.152.08a.352.352 0 01-.133.028.366.366 0 01-.14-.029 1.063 1.063 0 01-.152-.08L16.78 12.03a.81.81 0 00-.267.235.601.601 0 00-.12.374c0 .11.032.22.098.33.065.11.164.203.295.28l5.402 3.192c.144.08.27.146.38.197.11.051.227.076.35.076zm0 2.94a.81.81 0 00.343-.077c.11-.05.237-.118.38-.203l5.409-3.186a.825.825 0 00.288-.277.644.644 0 00.099-.34.582.582 0 00-.12-.361.887.887 0 00-.267-.241l-5.847 3.383a2.55 2.55 0 01-.152.076.322.322 0 01-.133.032.335.335 0 01-.14-.032 2.55 2.55 0 01-.152-.076L16.78 14.97a.887.887 0 00-.267.241.582.582 0 00-.12.362c0 .118.032.231.098.34.065.107.164.2.295.275l5.402 3.187c.144.085.27.152.38.203.11.05.227.076.35.076z",satellite:"M22.915 18.923c.888 0 1.725-.169 2.51-.507a6.62 6.62 0 002.079-1.41 6.62 6.62 0 001.41-2.079 6.271 6.271 0 00.507-2.51c0-.889-.17-1.726-.508-2.51a6.583 6.583 0 00-1.41-2.076 6.682 6.682 0 00-2.081-1.41 6.26 6.26 0 00-2.514-.51c-.888 0-1.725.17-2.51.51a6.654 6.654 0 00-3.482 3.485 6.271 6.271 0 00-.508 2.511c0 .889.17 1.725.508 2.51a6.62 6.62 0 001.41 2.08c.6.6 1.293 1.07 2.078 1.409a6.271 6.271 0 002.51.507zm0-.92c-.762 0-1.48-.147-2.155-.441a5.732 5.732 0 01-1.781-1.21 5.687 5.687 0 01-1.206-1.78 5.37 5.37 0 01-.438-2.155c0-.762.146-1.479.438-2.152.209-.48.473-.92.794-1.32l.188-.222-.068.254a4.38 4.38 0 00-.127 1.04c0 .695.23 1.23.689 1.607.459.376 1.114.564 1.964.564.115 0 .196.04.245.121.048.08.041.171-.022.273a2.875 2.875 0 00-.311.584c-.055.157-.083.32-.083.489 0 .283.069.525.206.723.138.2.304.361.499.486a3.2 3.2 0 00.57.295l-.247.997c-.076.296-.039.53.111.704.15.174.348.26.594.26.245 0 .478-.114.698-.342l1.543-1.67c.258-.275.443-.524.555-.749.112-.224.168-.448.168-.672a1.11 1.11 0 00-.11-.426 3.165 3.165 0 00-.664-.958 1.378 1.378 0 00-.594-.337 3.345 3.345 0 00-.784-.076h-.342l-.35-.685.965-.362c.271.178.487.313.648.406.16.093.317.14.47.14.194 0 .347-.06.457-.178a.582.582 0 00.155-.435.742.742 0 00-.225-.485l-.99-1.048c-.064-.063-.096-.124-.096-.18 0-.058.028-.118.083-.182a4.83 4.83 0 00.431-.552c.144-.211.216-.442.216-.692a.813.813 0 00-.084-.357l-.045-.078.183.073c.675.292 1.27.695 1.784 1.21a5.709 5.709 0 011.21 1.78c.291.673.437 1.39.437 2.152a5.37 5.37 0 01-.438 2.155 5.687 5.687 0 01-1.206 1.78 5.732 5.732 0 01-1.78 1.21 5.336 5.336 0 01-2.155.44z"};const El=xl;function Tl(e,t){if(!t)return this._targetOpacity=e,void(this.opacity=e);e!==this._targetOpacity&&(e!==this.opacity?(this._targetOpacity=e,this._startTime=null,this._startOpacity=this._opacity,bt.scheduleOnNextFrame(this)):this._targetOpacity=e)}function Il(e){if(null==this._startTime&&(this._startTime=e),"function"==typeof this.constructor.prototype.performScheduledUpdate&&this.constructor.prototype.performScheduledUpdate.call(this,e),null===this._targetOpacity)return;if(null==e&&(this.opacity=this._targetOpacity),this._targetOpacity===this.opacity)return this._startTime=null,this._startOpacity=null,void(this._targetOpacity=null);const t=e-this._startTime,i=this._targetOpacity-z(this._startOpacity),s=Math.abs(i*this._totalDurationMs),o=Math.min(t/s,1),n=Eo.easeInOut(o)*i+z(this._startOpacity);this.opacity=c(n,0,1),bt.scheduleOnNextFrame(this)}const Ol=function(e,t){const i=e;return i._targetOpacity=null,i._startOpacity=null,i._startTime=null,i._totalDurationMs=t||300,i.setOpacityAnimated=Tl,i.performScheduledUpdate=Il,i},Rl=Object.freeze({GlobalFadeDuration:700,InnerTransitionDuration:200,MinimumNumberOfSegments:2,MaximumNumberOfSegments:5,MagicNumbers:[1.25,2.5,5],FirstMagicExponent:-3,LastMagicExponent:7,MaximumNumberOfDisplayedSegments:3,SegmentThickness:3,LegendHorizontalMargin:6,LegendMarginBottom:8,LegendSpacing:1,OutlineWidth:1,LightSegmentColorRegular:"rgba(255, 255, 255, 0.7)",DarkSegmentColorRegular:"rgba(0, 0, 0, 0.73)",OutlineColorRegular:"rgba(255, 255, 255, 0.5)",LightSegmentColorSatellite:"rgba(255, 255, 255, 0.8)",DarkSegmentColorSatellite:"rgba(178, 178, 178, 0.8)",OutlineColorSatellite:"rgba(0, 0, 0, 1)",SegmentInnerStrokeColor:"rgba(0, 0, 0, 0.2)",SegmentInnerStrokeWidth:.5,LegendFontSize:9,LegendFontFamily:"'-apple-system-font', 'Helvetica Neue', 'Helvetica', 'Arial', 'sans-serif'",LegendColorRegular:"rgba(72, 69, 65, 1)",LegendOuterStrokeColorRegular:"rgba(255, 255, 255, 0.5)",LegendColorSatellite:"rgba(255, 255, 255, 1)",LegendOuterStrokeColorSatellite:"rgba(0, 0, 0, 1)",LegendOuterStrokeWidth:1,MetersThreshold:500,FeetThreshold:.25,MilesToMeters:1609.344,MetersToMiles:1/1609.344,MilesToFeet:5280});const Pl=class extends Go{measureTextOverflow(e,t){const i=this._node;if(!i.legend)return 0;const s=Rl.LegendFontSize*this.node.fontSizeRatio;let o;e.font=`${s}px ${Rl.LegendFontFamily}`,o=t?i.legend.labels[0]:i.legend.labels[i.numberOfSegments];const n=e.measureText(o).width/2;let a;return a=t?0:e.measureText(" "+i.legend.unit).width,n+a}draw(e){const t=this._node;if(!t.legend)return;const i=Rl.LegendFontSize*this.node.fontSizeRatio;e.font=`${i}px ${Rl.LegendFontFamily}`,e.textAlign="center",e.textBaseline="bottom",e.lineWidth=Rl.LegendOuterStrokeWidth,e.fillStyle=z(t.fillColor),e.strokeStyle=z(t.strokeColor);const s=t.size.height-Rl.LegendMarginBottom-Rl.LegendSpacing;let o=t.segmentStart;for(let i=0;i<=t.numberOfSegments;i++){const n=t.legend.labels[i];e.strokeText(n,o,s),e.fillText(n,o,s),this.node.leftAligned?i===t.numberOfSegments?o+=e.measureText(n).width/2:o+=t.segmentWidth:i===t.numberOfSegments?o-=e.measureText(n).width/2:o-=t.segmentWidth}const n=" "+t.legend.unit;e.textAlign=this.node.leftAligned?"left":"right",e.strokeText(n,o,s),e.fillText(n,o,s)}};function Dl(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const zl=class extends Ls{constructor(...e){super(...e),Dl(this,"fontSizeRatio",1),Dl(this,"_legend",null),Dl(this,"_segmentWidth",0),Dl(this,"_segmentStart",0),Dl(this,"_numberOfSegments",0),Dl(this,"_fillColor",null),Dl(this,"_strokeColor",null),Dl(this,"_renderer",new Pl(this)),Dl(this,"_leftAligned",void 0)}get leftAligned(){return this._leftAligned}set leftAligned(e){this._leftAligned=e,this.needsDisplay=!0}get legend(){return this._legend}set legend(e){this._legend=e,this.needsDisplay=!0}get segmentStart(){return this._segmentStart}set segmentStart(e){this._segmentStart=e,this.needsDisplay=!0}get segmentWidth(){return this._segmentWidth}set segmentWidth(e){this._segmentWidth=e,this.needsDisplay=!0}get numberOfSegments(){return this._numberOfSegments}set numberOfSegments(e){this._numberOfSegments=e,this.needsDisplay=!0}get fillColor(){return this._fillColor}set fillColor(e){this._fillColor=e,this.needsDisplay=!0}get strokeColor(){return this._strokeColor}set strokeColor(e){this._strokeColor=e,this.needsDisplay=!0}stringInfo(){const e="~"+this.fillColor+"/"+this.strokeColor+"~ ",t=this.leftAligned?"":", rtl";if(!this._legend)return"LegendNode "+e;return"LegendNode<labels:["+this._legend.labels.slice(0,this.numberOfSegments+1).join(", ")+"], unit:"+this._legend.unit+t+")> "+e}measureTextOverflow(e,t=!1){return this._renderer.measureTextOverflow(e,t)}};const Nl=class extends Go{draw(e){const t=this._node,i=t.fillColor,s=t.strokeColor,o=t.lineWidth;i&&(e.fillStyle=i,e.fillRect(0,0,t.size.width,t.size.height));s&&o&&(o>=1||Eo.devicePixelRatio>1)&&(e.lineWidth=o,e.strokeStyle=s,t.innerStroke?e.strokeRect(o/2,o/2,t.size.width-o,t.size.height-o):e.strokeRect(-o/2,-o/2,t.size.width+o,t.size.height+o))}};function Fl(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Ul=class extends Ls{constructor(...e){super(...e),Fl(this,"_fillColor",null),Fl(this,"_strokeColor",null),Fl(this,"_lineWidth",null),Fl(this,"_innerStroke",!1),Fl(this,"_renderer",new Nl(this))}get fillColor(){return this._fillColor}set fillColor(e){this._fillColor=e,this.needsDisplay=!0}get strokeColor(){return this._strokeColor}set strokeColor(e){this._strokeColor=e,this.needsDisplay=!0}get innerStroke(){return this._innerStroke}set innerStroke(e){this._innerStroke=e,this.needsDisplay=!0}get lineWidth(){return this._lineWidth}set lineWidth(e){this._lineWidth=e,this.needsDisplay=!0}};const Gl=class extends Ul{constructor(){var e,t,i;super(),i=()=>{},(t="setOpacityAnimated")in(e=this)?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,Ol(this,Rl.InnerTransitionDuration),this.lineWidth=Rl.OutlineWidth}stringInfo(){return"OutlineNode "+("~"+this.strokeColor+"~ ")}};const Bl=class extends Ul{constructor(){var e,t,i;super(),i=()=>{},(t="setOpacityAnimated")in(e=this)?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,Ol(this,Rl.InnerTransitionDuration),this.lineWidth=Rl.SegmentInnerStrokeWidth,this.innerStroke=!0}stringInfo(){return"SegmentNode "+("~"+this.fillColor+"~ ")}};function Wl(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Zl extends Ho{constructor(){super(),Wl(this,"_needsLayout",!1),Wl(this,"_distance",0),Wl(this,"_mapWidth",0),Wl(this,"_theme",Zl.Themes.light),Wl(this,"_leftAligned",!1),Wl(this,"_l10n",null),Wl(this,"_legendNode",this.addChild(new zl)),Wl(this,"_segmentWidth",0),Wl(this,"_oldNumberOfSegments",0),Wl(this,"_legend",{labels:[],unit:""}),Wl(this,"_outlineNodes",void 0),Wl(this,"_activeOutlineNode",void 0),Wl(this,"_segmentNodes",void 0),Wl(this,"_useMetric",!1),Wl(this,"setOpacityAnimated",(()=>{})),this._outlineNodes=[0,1].map((()=>this.addChild(new Gl))),this._activeOutlineNode=this._outlineNodes[0],this._outlineNodes[1].opacity=0,this._segmentNodes=[0,1,2].map((e=>this.addChild(new Bl))),this._updateColors(),Ol(this,Rl.GlobalFadeDuration)}get layerBounds(){return new is(0,0,this.size.width,Math.max(this.size.height,48))}get fontSizeRatio(){return this._legendNode.fontSizeRatio}set fontSizeRatio(e){this._legendNode.fontSizeRatio=e,this._computeSegments()}get distance(){return this._distance}set distance(e){Math.abs(e-this._distance)/this._distance<.01||(this._distance=e,this._computeSegments())}get mapWidth(){return this._mapWidth}set mapWidth(e){e!==this._mapWidth&&(this._mapWidth=e,this._computeSegments())}get theme(){return this._theme}set theme(e){this._theme=e,this._updateColors()}get l10n(){return this._l10n}set l10n(e){this._l10n&&this._l10n.removeEventListener(this._l10n.Events.LocaleChanged,this),this._l10n=e,e&&e.addEventListener(e.Events.LocaleChanged,this)}get useMetric(){return this._useMetric}set useMetric(e){this._useMetric!==e&&(this._useMetric=e,this._computeSegments())}get leftAligned(){return this._leftAligned}set leftAligned(e){this._leftAligned=e,this.needsLayout=!0}stringInfo(){return"ScaleNode<distance:"+Math.round(100*this.distance)/100+"m>"}get needsLayout(){return this._needsLayout}set needsLayout(e){this._needsLayout!==e&&(this._needsLayout=e,e&&bt.scheduleASAP(this))}performScheduledUpdate(){this.needsLayout&&this.parent&&(this.layoutSubNodes(),this.needsLayout=!1)}layoutSubNodes(){const e=this._computeSegmentsRects();for(let t=0;t<Rl.MaximumNumberOfDisplayedSegments;t++){const i=e[t],s=this._segmentNodes[t];i?(s.position=i.origin,s.size=i.size,s.setOpacityAnimated(1,!0)):s.setOpacityAnimated(0,!0)}const t=is.unionOfRects(e).round();if(e.length!==this._oldNumberOfSegments){this._activeOutlineNode.setOpacityAnimated(0,!0);const e=0===this._outlineNodes.indexOf(this._activeOutlineNode)?1:0;this._activeOutlineNode=this._outlineNodes[e],this._activeOutlineNode.setOpacityAnimated(1,!0)}this._activeOutlineNode.position=t.origin,this._activeOutlineNode.size=t.size;const i=e[0];this._legendNode.segmentStart=this.leftAligned?i.origin.x:i.origin.x+i.size.width,this._legendNode.leftAligned=this.leftAligned,this._legendNode.segmentWidth=i.size.width,this._legendNode.size.width=this.size.width,this._legendNode.size.height=this.size.height,this._oldNumberOfSegments=e.length}handleEvent(){this._computeSegments()}_updateColors(){const e=this.theme===Zl.Themes.dark;this._legendNode.fillColor=e?Rl.LegendColorSatellite:Rl.LegendColorRegular,this._legendNode.strokeColor=e?Rl.LegendOuterStrokeColorSatellite:Rl.LegendOuterStrokeColorRegular;const t=e?[Rl.LightSegmentColorSatellite,Rl.DarkSegmentColorSatellite]:[Rl.DarkSegmentColorRegular,Rl.LightSegmentColorRegular];this._segmentNodes.forEach(((i,s)=>{i.fillColor=t[s%2],i.strokeColor=e?null:Rl.SegmentInnerStrokeColor}),this);const i=e?Rl.OutlineColorSatellite:Rl.OutlineColorRegular;this._outlineNodes.forEach((e=>{e.strokeColor=i}))}_computeSegments(){if(0===this.size.width||0===this.mapWidth||!this._l10n)return;const e=this.size.width,t=this.mapWidth;let i=this.distance*e/t;const s=!this._useMetric;let o=!1,n=1,a=0;function r(e,t){return a=e*Math.pow(10,t),n=i/a,n>=Rl.MinimumNumberOfSegments&&n<Rl.MaximumNumberOfSegments}s&&(i*=Rl.MetersToMiles,i<Rl.FeetThreshold&&(o=!0,i*=Rl.MilesToFeet));let l=!1;for(let e=Rl.FirstMagicExponent;!l&&e<Rl.LastMagicExponent;e++)l=Rl.MagicNumbers.some((t=>r(t,e)));this._segmentWidth=n?e/n:0;const h=a;s&&(o&&(a/=Rl.MilesToFeet),a*=Rl.MilesToMeters),this._computeLegend(a,h,o)}_computeLegend(e,t,i){let s=0;const o=z(this._l10n);this._useMetric?e>Rl.MetersThreshold?(this._legend.unit=o.get("Scale.Kilometer.Short"),s=e/1e3):(this._legend.unit=o.get("Scale.Meter.Short"),s=e):(this._legend.unit=i?o.get("Scale.Feet.Short"):o.get("Scale.Mile.Short"),s=t);const n=[];let a;"object"==typeof Intl&&Intl&&Intl.NumberFormat&&(a=new Intl.NumberFormat(o.activeLocale.localeId));for(let e=0;e<Rl.MaximumNumberOfSegments;e++){const t=e*s,i=a?a.format(t):t.toString();n.push(i)}this._legend.labels=n,this._legendNode.legend=this._legend,this.needsLayout=!0}_computeSegmentsRects(){const e=z(z(this.scene).contextForMeasurement);let t=0,i=this.leftAligned?Rl.LegendHorizontalMargin+this._legendNode.measureTextOverflow(e,!0):this.size.width-Rl.LegendHorizontalMargin-this._legendNode.measureTextOverflow(e,!0);const s=this.size.height-Rl.LegendMarginBottom+Rl.LegendSpacing,o=this._segmentWidth,n=[];for(let a=0;a<Rl.MaximumNumberOfDisplayedSegments;a++){const a=new is(this.leftAligned?i:i-o,s,o,Rl.SegmentThickness).round();n.push(a),i=this.leftAligned?a.origin.x+a.size.width:a.origin.x,this._legendNode.numberOfSegments=n.length,t=this._legendNode.measureTextOverflow(e);const r=o+t+Rl.LegendHorizontalMargin;if(this.leftAligned&&i+r>this.size.width)break;if(!this.leftAligned&&i-r<0)break}return 0===this._oldNumberOfSegments&&(this._oldNumberOfSegments=n.length),n}}const Kl={light:"Light",dark:"Dark"};Zl.Themes=Kl,Zl.ScaleNode=Zl;const jl=Zl,Hl=new es(170,20),Vl="mk-scale";const ql=class extends io{constructor(e){const t=new jo;super(t.element),this.scene=t,this._map=e;const i=Hl.copy();i.height=this._getHeight(),this.scene.size=i,this.node=this.scene.addChild(new jl),this.node.size=i,this.node.position=new ts(0,0),this.node.opacity=0,this.node.l10n=Vi,this.node.fontSizeRatio=e.fontSizeRatio,this.node.useMetric=e.useMetric,Vi.addEventListener(Vi.Events.LocaleChanged,this),this.classList.add(Vl),this.element.setAttribute("aria-hidden","true"),this.size=Hl}get shouldDisplayScale(){return this._map._showsScale===Us.Visible||this._map._showsScale===Us.Adaptive&&this._map.cameraIsZooming}updateTheme(e){this.node.theme=Kl[e]}update(){const e=this._map;if(!this.node||!this.shouldDisplayScale)return;const t=e.renderingMapRect.origin.toCoordinate().latitude,i=e.renderingMapRect.size.width/vi.mapUnitsPerMeterAtLatitude(t);if(i/e._visibleFrame.size.width*Eo.devicePixelRatio>=7500)return void this.hideIfNeeded(!0);const s=this._getHeight();if(s!==this.node.size.height){const e=Hl.copy();e.height=s,this.scene.size=e,this.node.size=e}this.node.fontSizeRatio=e.fontSizeRatio,this.node.distance=i,this.node.useMetric=this._map.useMetric,this.node.setOpacityAnimated(1,!1)}hideIfNeeded(e){!this.node||this.shouldDisplayScale&&!e||this.node.setOpacityAnimated(0,!0)}handleEvent(e){this.node.useMetric=this._map.useMetric}mapWasDestroyed(){this.node.l10n=null,this.node.remove(),this.scene.destroy(),Vi.removeEventListener(Vi.Events.LocaleChanged,this)}_getHeight(){const e=Rl.LegendFontSize*this._map.fontSizeRatio;return Hl.height-Rl.LegendFontSize+e}},Yl="mk-zoom-controls",Xl="mk-divider",$l="mk-zoom-in",Jl="mk-zoom-out",Ql="mk-pressed",eh="mk-pill-pressed",th="mk-disabled";class ih extends ml{constructor(){const e=Eo.htmlElement("div");super(e),this.classList.add(Yl),this._zoomInEnabled=!0,this._zoomOutEnabled=!0,this._zoomInButton=Eo.htmlElement("div",{role:"button",tabindex:"0"}),this._zoomInButtonNode=new po.Node(this._zoomInButton),this._zoomInButtonNode.classList.add($l),this._zoomInButton.appendChild(function(){const e=Eo.svgElement("path",{d:"M11.813 17.404c.4 0 .724-.33.724-.705v-3.974h3.872a.726.726 0 00.717-.723.73.73 0 00-.717-.724h-3.872V7.305a.72.72 0 00-.724-.705.724.724 0 00-.724.705v3.973H7.217a.739.739 0 00-.717.724c0 .4.343.723.717.723h3.872V16.7c0 .375.33.705.724.705z"}),t=Eo.createSVGIcon(e,{width:"100%",height:"100%"});return t.setAttribute("viewBox","0 0 24 24"),t}()),e.appendChild(this._zoomInButton),e.appendChild(Eo.htmlElement("div",{class:Xl})),this._zoomOutButton=Eo.htmlElement("div",{role:"button",tabindex:"0"}),this._zoomOutButtonNode=new po.Node(this._zoomOutButton),this._zoomOutButtonNode.classList.add(Jl),this._zoomOutButton.appendChild(function(){const e=Eo.svgElement("path",{d:"M16.325 12.75c.364 0 .675-.336.675-.75 0-.408-.31-.75-.675-.75h-8.65c-.352 0-.675.342-.675.75 0 .414.323.75.675.75h8.65z"}),t=Eo.createSVGIcon(e,{width:"100%",height:"100%"});return t.setAttribute("viewBox","0 0 24 24"),t}()),e.appendChild(this._zoomOutButton),this._updateLabels()}get zoomInEnabled(){return this._zoomInEnabled}set zoomInEnabled(e){this._enabled&&e===this._zoomInEnabled||(this._zoomInEnabled=this._enabled&&e,sh(this._zoomInButtonNode,this._zoomInEnabled))}get zoomOutEnabled(){return this._zoomOutEnabled}set zoomOutEnabled(e){this._enabled&&e===this._zoomOutEnabled||(this._zoomOutEnabled=this._enabled&&e,sh(this._zoomOutButtonNode,this._zoomOutEnabled))}localeChanged(e){this._updateLabels()}touchesBegan(e){this._pressed(e)}touchesEnded(e){this.saveEndEventProps(e),this.reset(e)}clicked(e){this.checkClickEventProps(e)||(this._pressed(e),this.reset(e))}touchesCanceled(e){this.reset(e)}focused(e){this.updateTintColor(this.tintColor),e.target.style.fill=Eo.focusColor}blurred(e){this.updateTintColor(this.tintColor)}spaceBarKeyDown(e){this._pressed(e)}spaceBarKeyUp(e){this.reset(e)}updateTintColor(e){this.tintColor=e,this._zoomInButton.firstChild.style.fill=e,this._zoomOutButton.firstChild.style.fill=e}reset(e){let t;if(this._zoomInButtonNode.classList.contains(Ql)?t=this._zoomInButtonNode:this._zoomOutButtonNode.classList.contains(Ql)&&(t=this._zoomOutButtonNode),t){t.classList.remove(Ql),this.classList.remove(eh);const e=new D.Event(ih.EVENTS.ZOOM_END);this.dispatchEvent(e)}window.removeEventListener(Eo.endEventType,this),Eo.supportsPointerEvents?window.removeEventListener("pointercancel",this):Eo.supportsTouches&&window.removeEventListener("touchcancel",this)}_clearLabels(e){Eo.updateLabel(this._zoomInButtonNode,""),Eo.updateLabel(this._zoomOutButtonNode,"")}_updateLabels(e){Eo.updateLabel(this._zoomInButtonNode,Vi.get("Zoom.In.Tooltip")),Eo.updateLabel(this._zoomOutButtonNode,Vi.get("Zoom.Out.Tooltip"))}_pressed(e){const t=this._findButtonNodeFromButtonDOMElement(Eo.parentNodeForSvgTarget(e.target));if(!t||t.classList.contains(th))return;if(this.hasFocus){const e=Eo.containingDocumentOrShadowRoot(this.element).activeElement;e!==t.element&&e.blur()}t.classList.add(Ql),this.classList.add(eh);const i=new D.Event(ih.EVENTS.ZOOM_START);i.zoomIn=t===this._zoomInButtonNode,this.dispatchEvent(i)}_findButtonNodeFromButtonDOMElement(e){return e===this._zoomOutButton?this._zoomOutButtonNode:e===this._zoomInButton?this._zoomInButtonNode:null}}function sh(e,t){t?(e.classList.remove(th),e.removeAttribute("aria-disabled"),e.setAttribute("tabindex",0)):(e.classList.add(th),e.setAttribute("aria-disabled","true"),e.setAttribute("tabindex",-1))}ih.EVENTS={ZOOM_START:"zoom-start",ZOOM_END:"zoom-end"};const oh=ih;const nh={POP_OVER:"mk-user-location-error-popover",ERROR:"mk-error-message",ERROR_TEXT:"mk-error-text",ERROR_SUPPORT:"mk-error-support"},ah=class extends _l{constructor(){super(),this.classList.add(nh.POP_OVER),this._errorMessageElement=this._createErrorMessageElement(),this._errorMessageNode=new io(this._errorMessageElement),this.update(),this.addChild(this._errorMessageNode)}get errorMessageElement(){return this._errorMessageElement}update(){this._errorMessageElement.getElementsByClassName(nh.ERROR_TEXT)[0].textContent=Vi.get("Location.Error.Message")+" ",this._supportLink.textContent=Vi.get("Location.Error.Support.Label"),Eo.supportsTouches?this._supportLink.href="https://support.apple.com/HT203033":this._supportLink.href="https://support.apple.com/guide/mac-help/allow-apps-to-detect-the-location-of-your-mac-mh35873/mac"}_createErrorMessageElement(){const e=Eo.htmlElement("div",{class:nh.ERROR});return this._supportLink=Eo.htmlElement("a",{class:nh.ERROR_SUPPORT,target:"_blank"}),e.appendChild(Eo.htmlElement("span",{class:nh.ERROR_TEXT})),e.appendChild(this._supportLink),e}},rh={CONTROL:"mk-user-location-control",WRAPPER:"mk-user-location-control-wrapper",PRESSED:"mk-pressed",TRACKING:"mk-tracking",WAITING:"mk-waiting",DISABLED:"mk-disabled",WAITING_ICON:"mk-icon-waiting",ARROW_ICON:"mk-icon-arrow",SCALED_OUT:"mk-scaled-out"};class lh extends ml{constructor(e,t,i){super(Eo.htmlElement("div",{class:rh.CONTROL,role:"button",tabindex:"0"})),this._state=lh.States.Default,this._tintColor="",this._wrapper=Eo.htmlElement("div",{class:rh.WRAPPER}),this.element.appendChild(this._wrapper),this._arrowIconNode=new po.Node(Eo.createSVGIcon(Eo.svgElement("path"),{class:rh.ARROW_ICON,viewBox:ch})),this._waitingIconNode=new po.Node(function(){const e=[];for(let t=0;t<ph;++t)e.push(Eo.svgElement("rect",{x:fh,y:yh,width:mh,height:gh,rx:_h,transform:"rotate("+45*t+")"}));const t=["g",{transform:"scale("+uh+", "+-uh+")"}].concat(e);return Eo.createSVGIcon(Eo.svgElement.apply(null,t),{class:[rh.WAITING_ICON,rh.SCALED_OUT].join(" "),viewBox:dh})}()),this._wrapper.appendChild(this._arrowIconNode.element),this._wrapper.appendChild(this._waitingIconNode.element),this._errorPopover=new ah,this._updateLabels(),this._updateArrowIcon(),this._waitingIconBlades=this._waitingIconNode.element.querySelectorAll("rect"),this._map=e,this._rtl=t,this._focusDelegate=i}get state(){return this._state}set state(e){this._state!==e&&(this._state=e,this.classList.toggle(rh.TRACKING,this.isTrackingState()),this.classList.toggle(rh.WAITING,this.isWaitingState()),this.classList.toggle(rh.DISABLED,this.isDisabledState()),this.updateTintColor(this._tintColor),this.isWaitingState()?this._animateArrowIconOut():this._animateWaitingIconOut())}isDefaultState(){return this.state===lh.States.Default}toDefaultState(){this.state=lh.States.Default,this._updateArrowIcon(),this._closeErrorPopover()}isTrackingState(){return this.state===lh.States.Tracking}toTrackingState(){this.state=lh.States.Tracking,this._updateArrowIcon(),this._closeErrorPopover()}isWaitingState(){return this.state===lh.States.Waiting}toWaitingState(){this.state=lh.States.Waiting}isDisabledState(){return this.state===lh.States.Disabled}toDisabledState(){this._map.tracksUserLocation&&this._map.userLocationAnnotation||(this.state=lh.States.Disabled,this._updateArrowIcon(),this._openErrorPopover())}handleEvent(e){switch(e.type){case Eo.startEventType:{const t=Eo.getShadowDOMTargetFromEvent(this.element,e);this._errorPopover.errorMessageElement.contains(t)||(this._closeErrorPopover(),window.removeEventListener(Eo.startEventType,this,!0));break}case"keydown":27===e.keyCode&&this._closeErrorPopover();break;case"blur":this._errorPopover.element.contains(e.relatedTarget)||this._closeErrorPopover()}}touchesBegan(e){this._pressed(e)}touchesEnded(){this.reset()}clicked(){this.dispatchEvent(new D.Event(lh.EVENTS.PRESSED))}touchesCanceled(e){this.reset()}spaceBarKeyDown(e){this._pressed(e)}spaceBarKeyUp(e){this.reset(e),this.dispatchEvent(new D.Event(lh.EVENTS.PRESSED))}updateTintColor(e){this._tintColor=e,this._arrowIconNode.element.querySelector("g").style.fill=this.isTrackingState()?"":e,this._waitingIconNode.element.querySelector("g").style.fill=e,this.element.style.backgroundColor=this.isTrackingState()?e:""}reset(){this.classList.contains(rh.PRESSED)&&(this.classList.remove(rh.PRESSED),this._focusDelegate.controlWasReleased(this),this.isDefaultState()||this.isDisabledState()?this.toWaitingState():this.toDefaultState()),window.removeEventListener(Eo.endEventType,this),Eo.supportsPointerEvents?window.removeEventListener("pointercancel",this):Eo.supportsTouches&&window.removeEventListener("touchcancel",this)}localeChanged(e){this._updateLabels(),this._rtl=e.locale.rtl,this._errorPopover.update()}mapWasDestroyed(){delete this._map}focused(e){this._focusDelegate.controlDidGetFocus(this)}blurred(e){this._focusDelegate.controlDidLoseFocus(this)}didMoveToParent(e){e?this.parent.insertAfter(this._errorPopover,this):(this._closeErrorPopover(),this._errorPopover.remove())}_updateLabels(){Eo.updateLabel(this.element,Vi.get("Track.User.Location.Tooltip"))}_pressed(e){this.classList.add(rh.PRESSED),this._focusDelegate.controlWasPressed(this)}_animateArrowIconOut(){this._arrowIconNode.classList.add(rh.SCALED_OUT),this._waitingIconNode.classList.remove(rh.SCALED_OUT)}_animateWaitingIconOut(){this._waitingIconNode.classList.add(rh.SCALED_OUT),this._arrowIconNode.classList.remove(rh.SCALED_OUT)}_openErrorPopover(){this._errorPopover.open(),window.addEventListener(Eo.startEventType,this,!0),window.addEventListener("keydown",this,!0),this._errorPopover.element.addEventListener("blur",this,!0)}_closeErrorPopover(){this._errorPopover.close(),window.removeEventListener(Eo.startEventType,this,!0),window.removeEventListener("keydown",this,!0),this._errorPopover.element.removeEventListener("blur",this,!0)}_updateArrowIcon(){this._arrowIconNode.element.querySelector("path").setAttribute("d",hh[this.state])}}lh.States={Default:"default",Waiting:"waiting",Tracking:"tracking",Disabled:"disabled"},lh.EVENTS={PRESSED:"pressed"};const hh={default:"M24.675 17.91L29.48 7.512c.514-1.11-.349-1.847-1.409-1.358l-10.448 4.818c-.971.444-.768 1.802.342 1.809l4.723.019c.095 0 .127.038.127.133l.013 4.691c0 1.092 1.365 1.34 1.847.286zm-.711-1.448l.025-4.272c0-.387-.184-.577-.584-.577l-4.272.025c-.05 0-.07-.057-.012-.089l8.95-4.094c.076-.032.12.013.082.089l-4.1 8.925c-.025.063-.089.05-.089-.007z",disabled:"M27.112 12.641l2.368-5.129c.514-1.11-.349-1.847-1.409-1.358l-5.097 2.348.882.883 4.215-1.93c.076-.032.12.013.082.089l-1.93 4.208.89.89zm2.4 4.196a.51.51 0 000-.717l-9.934-9.934a.517.517 0 00-.724 0 .522.522 0 000 .717l9.947 9.934c.197.197.52.197.71 0zm-4.837 1.073l1.301-2.812-.882-.883-1.041 2.254c-.025.063-.089.05-.089-.007l.02-3.351-1.493-1.492-3.358.02c-.05 0-.07-.058-.012-.09l2.266-1.034-.876-.876-2.888 1.333c-.971.444-.768 1.802.342 1.809l4.723.019c.095 0 .127.038.127.133l.013 4.691c0 1.092 1.365 1.34 1.847.286z",tracking:"M24.675 17.91L29.48 7.512c.514-1.11-.349-1.847-1.409-1.358l-10.448 4.818c-.971.444-.768 1.802.342 1.809l4.723.019c.095 0 .127.038.127.133l.013 4.691c0 1.092 1.365 1.34 1.847.286z"},ch="0 0 45 24",dh="-22.5 -12 45 24",uh=2/3,ph=8,mh=2.5,gh=6,_h=1.25,fh=-mh/2,yh=5;const vh=lh,bh="mk-rotation-control",wh="mk-pressed",Ch="mk-heading",kh="mk-rotation-wrapper",Mh="mk-rotation-slider";function Sh(e,t,i,s){let o;const n=t-s,a=e-i;return o=e>i?t<s?90+Lh(Math.atan(n/a)):180-Lh(Math.atan(a/n)):t<s?360-Lh(Math.atan(a/n)):0!==a?270+Lh(Math.atan(n/a)):180,o}function Lh(e){return 180*e/Math.PI}function xh(e){const t=St.createImageUrl("icons/compass-sheet.svg");e.crossOrigin=sa.getCorsAttribute(Ue.distUrlWithCredentials),e.src=t}const Ah=class extends ml{constructor(e){const t=Eo.htmlElement("div");super(t),this.element=t,this._isDragging=!1,this._isDraggingPrevented=!1,this.classList.add(bh);const i=Eo.htmlElement("input",{class:Mh,type:"range",min:0,max:360,value:0,"aria-label":Vi.get("Compass.Degrees.Plural",{n:0})});i.addEventListener("change",this),this._slider=i,this._sliderNode=new po.Node(i),this.element.appendChild(i),this._compassNode=new po.Node(Eo.htmlElement("div",{class:kh},Eo.htmlElement("img",{role:"presentation"}))),this.element.appendChild(this._compassNode.element);const s=Eo.htmlElement("div");if(this._heading=s,this._headingNode=new po.Node(s),this._headingNode.classList.add(Ch),this.element.appendChild(s),Ue.state===Ue.States.UNINITIALIZED){const e=()=>{Ue.removeEventListener(Ue.Events.Initialized,e),xh(this._compassNode.element.firstChild)};Ue.addEventListener(Ue.Events.Initialized,e)}else xh(this._compassNode.element.firstChild);this._map=e,this._rotation=0,this._activeKeyRightAt=null,this._activeKeyLeftAt=null,this._updateLabels()}enable(){super.enable(),this._setupGestureRecognizers(),this._sliderNode.removeAttribute("aria-disabled"),this._sliderNode.setAttribute("tabindex",0)}disable(){super.disable(),this._sliderNode.setAttribute("aria-disabled","true"),this._sliderNode.setAttribute("tabindex",-1)}set rotation(e){e===this._rotation||360===this._rotation&&0===e||(this._rotation=e,this._updateHeading(),this._updateSlider(),this._rotateTo(e))}localeChanged(e){this._updateLabels()}mapWasDestroyed(){delete this._map}updateTintColor(e){this.tintColor!==e&&(this.tintColor=e,this._heading.style.color=e)}updateImage(e,t){this._dprValue===e&&this._darkColorScheme===t||(this._dprValue=e,this._darkColorScheme=t,Ue.state!==Ue.States.UNINITIALIZED&&xh(this._compassNode.element))}touchesEnded(e){this.saveEndEventProps(e)}clicked(e){this.checkClickEventProps(e)||this.reset(e)}reset(e){const t=e&&(e.target===this._tapRecognizer||"click"===e.type||e.keyCode===o||e.keyCode===i);this._map&&this._center&&!t&&this._isDragging&&(this._map.mapDidStopRotating(),this._map.compassRotationDidEnd()),this.classList.remove(wh),t&&this._map.setRotationAnimated(0,!0),this._isDragging=!1,this._isDraggingPrevented=!1,delete this._angleOffset}spaceBarKeyDown(e){this.reset(e)}upArrowKeyUp(e){this.reset(e)}rightArrowKeyDown(e){this._beginKeyboardRotate(e)}rightArrowKeyUp(e){this._endKeyboardRotate(e)}leftArrowKeyDown(e){this._beginKeyboardRotate(e)}leftArrowKeyUp(e){this._endKeyboardRotate(e)}performScheduledUpdate(){if(!this._activeKeyRightAt&&!this._activeKeyLeftAt)return!1;this._keyboardRotate(),bt.scheduleOnNextFrame(this)}handleEvent(e){switch(e.target){case this._tapRecognizer:e.target.state===bo.Recognized&&this.reset(e);break;case this._panRecognizer:e.target.state===bo.Possible?this._beginDrag(e):e.target.state===bo.Changed?this._drag(e):e.target.state!==bo.Recognized&&e.target.state!==bo.Failed||this.reset(e);break;case this._slider:this._handleSliderChange(e)}}fadeIn(){this.element.style.opacity=1}fadeOut(){this.element.style.opacity=0}_updateHeading(){const e=360-this._rotation,t=Math.round(e/360*4)%4;this._heading.textContent=Vi.get("Compass."+["NorthIndicator","EastIndicator","SouthIndicator","WestIndicator"][t])}_updateLabels(){this._updateHeading(),Eo.updateLabel(this.element,Vi.get("Compass.Tooltip"))}_rotateTo(e){this._compassNode.transform="rotate("+e+"deg)"}_setupGestureRecognizers(){const e=new mn;e.numberOfTapsRequired=1,e.addEventListener("statechange",this),e.target=this.element,this._tapRecognizer=e;const t=new vn;t.addEventListener("statechange",this),t.target=this.element,this._panRecognizer=t}removeEventListeners(){this._tapRecognizer.removeEventListener("statechange",this),this._tapRecognizer.enabled=!1,this._tapRecognizer.target=null,this._panRecognizer.removeEventListener("statechange",this),this._panRecognizer.enabled=!1,this._panRecognizer.target=null,this._slider.removeEventListener("change",this)}_beginDrag(e){this.classList.add(wh);const t=this.element.getBoundingClientRect();this._center={x:t.right-t.width/2,y:t.bottom-t.height/2};const i=Sh(e.target.locationInClient().x,e.target.locationInClient().y,this._center.x,this._center.y);this._angleOffset=i-this._map.rotation}_drag(e){if(!this._center||isNaN(this._angleOffset))return;if(this._isDraggingPrevented)return;if(!this._isDragging){if(!this._map.mapCanStartRotating())return void(this._isDraggingPrevented=!0);this._isDragging=!0}this._map.compassRotationWillStart(!0);let t=Sh(e.target.locationInClient().x,e.target.locationInClient().y,this._center.x,this._center.y)-this._angleOffset;t=this._map.compassRotate(t,!0),this._rotateTo(t)}_beginKeyboardRotate(e){const t=this._activeKeyRightAt&&e.keyCode===n,i=this._activeKeyLeftAt&&e.keyCode===s;if(t||i)return;const o=Date.now();e.keyCode===n?this._activeKeyRightAt=o:this._activeKeyLeftAt=o,this._map.mapCanStartRotating()&&(this._timeAtLastFrame=o,bt.scheduleASAP(this),this._map.compassRotationWillStart(!1))}_keyboardRotate(){const e=Math.max(this._activeKeyRightAt||0,this._activeKeyLeftAt||0);if(!e||!this._timeAtLastFrame)return;const t=Date.now();let i=this._rotation;const s=t-this._timeAtLastFrame;i+=(4*(e===this._activeKeyLeftAt)?-1:1)*(60*s)/1e3,this._map.compassRotate(i,!1),this._timeAtLastFrame=Date.now()}_endKeyboardRotate(e){e.keyCode===n?this._activeKeyRightAt=null:this._activeKeyLeftAt=null,this._activeKeyRightAt||this._activeKeyLeftAt||(this._timeAtLastFrame=null),this._map.mapDidStopRotating(),this._map.compassRotationDidEnd()}_handleSliderChange(e){const t=parseInt(e.target.value);if(t===this._rotation)return;let i=t;0===t?i=360:360===t&&(i=0),this.rotation=i,this._map.setRotationAnimated(i,!1,!0)}_updateSlider(){const e=Math.round(this._rotation);this._slider.value=e;const t=Vi.get(1===e?"Compass.Degrees.Single":"Compass.Degrees.Plural",{n:e});this._sliderNode.setAttribute("aria-label",t)}},Eh=["ca-ES","en-GB","en-US","es-ES","es-MX","hi-IN","id-ID","ja-JP","ko-KR","ms-MY","nb-NO","pt-BR","pt-PT","ro-RO","zh-CN","zh-HK","zh-TW"],Th=Us,Ih="mk-rtl",Oh="mk-autonavi",Rh="mk-controls-container-controls-normal",Ph="mk-controls-container-controls-larger",Dh="mk-text-zoom",zh=["mk-top-right-controls-container-children-none","mk-top-right-controls-container-children-one","mk-top-right-controls-container-children-two"],Nh="mk-with-zoom-control",Fh="mk-pill-focus",Uh="mk-pill-pressed",Gh=new ts(7,11);class Bh extends io{constructor(e){super(Eo.htmlElement("div",{class:"mk-controls-container"})),this._rtl=!1,this._map=e,this._topRightControlsNode=new io(Eo.htmlElement("div",{class:this._getTopRightControlsClass()})),this._bottomRightControlsNode=new io(Eo.htmlElement("div",{class:"mk-bottom-right-controls-container"})),this._bottomLeftControlsNode=new io(Eo.htmlElement("div",{class:"mk-bottom-left-controls-container"})),this._setPendingControls(),this._shadowRootNode=Eo.addShadowRootChild(this,Ue.shadowDOMMode,'@media (inverted-colors){:host(.mk-controls) img,:host(.mk-controls-container) img{filter:initial}}:host(.mk-controls-container) *{box-sizing:content-box}:host(.mk-controls-container) ::selection{background:0 0}.mk-error-message{font-family:-apple-system-font,"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:calc(100% * 13 / var(--font-size-default));width:200px;padding:10px;pointer-events:auto}.mk-error-support{white-space:nowrap}:host(.mk-controls) :focus,:host(.mk-controls-container) :focus{outline:0}:host(.mk-controls){container-name:controls-container;container-type:size;--logo-xmin:0;--logo-xmax:1;display:flex;flex-direction:row;justify-content:flex-end}.mk-logo-control .mk-logo{vertical-align:bottom;width:auto}:host(.mk-controls-container) .mk-bottom-left-controls-container{--logo-width:101px;--logo-height:24px;--logo-xmin:1;--logo-xmax:0;font:16px sans-serif;--font-size-default:16}.mk-cq-logo-control .mk-logo{display:block;--logo-width:101px;--logo-height:24px;width:var(--logo-width);height:var(--logo-height);margin:0;transition:width .3s ease-in-out,height .3s ease-in-out}@container controls-container (min-width:1240px){.mk-cq-logo-control .mk-logo{--logo-width:126.25px;--logo-height:30px}}:host(.mk-controls-container.mk-text-zoom) .mk-bottom-left-controls-container{font:initial}@supports (font:-apple-system-body) and (-webkit-touch-callout:default){:host(.mk-controls-container.mk-text-zoom) .mk-bottom-left-controls-container{font:-apple-system-body;--font-size-default:17}}:host(.mk-controls-container) .mk-bottom-left-controls-container.mk-controls-container-controls-larger{--logo-width:126.25px;--logo-height:30px}:host(.mk-controls-container) .mk-bottom-left-controls-container.mk-autonavi{--logo-width:68px;--logo-height:45px}:host(.mk-controls-container) .mk-bottom-left-controls-container.mk-autonavi.mk-controls-container-controls-larger{--logo-width:85px;--logo-height:56.25px}:host(.mk-controls-container) div.mk-logo-control img.mk-logo{width:var(--logo-width);height:var(--logo-height);margin:0;transition:width .3s ease-in-out,height .3s ease-in-out}.mk-legal{height:calc(1em * 16 / var(--font-size-default));padding:0 6px;margin:2px 4px;border-radius:5px;pointer-events:auto;z-index:1;text-align:center;vertical-align:middle;line-height:calc(100% * 12 / var(--font-size-default));cursor:pointer}.mk-legal .mk-legal-label{display:inline-block;font-size:calc(100% * 9 / var(--font-size-default));font-family:-apple-system-font,"Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:500;text-decoration:underline;white-space:nowrap}.mk-cq-legal{--logo-width:101px;--logo-height:24px}@container controls-container (min-width:1240px){.mk-cq-legal{--logo-width:126.25px;--logo-height:30px}}@container controls-container (max-width:201px){.mk-cq-legal{transition:none}}:host(.mk-controls-container) .mk-bottom-right-controls-container{font:16px sans-serif;--font-size-default:16}:host(.mk-controls-container.mk-text-zoom) .mk-bottom-right-controls-container{font:initial}@supports (font:-apple-system-body) and (-webkit-touch-callout:default){:host(.mk-controls-container.mk-text-zoom) .mk-bottom-right-controls-container{font:-apple-system-body;--font-size-default:17}}.mk-zoom-controls{width:48px;height:24px;border-radius:25%/50%;pointer-events:auto;transition:width .3s ease-in-out,height .3s ease-in-out}.mk-controls-container-controls-larger .mk-zoom-controls{width:60px;height:30px}.mk-zoom-controls .mk-zoom-in .mk-icon,.mk-zoom-controls .mk-zoom-out .mk-icon{pointer-events:none;display:block;opacity:.55}.mk-zoom-controls .mk-zoom-in.mk-pressed .mk-icon,.mk-zoom-controls .mk-zoom-in:focus .mk-icon,.mk-zoom-controls .mk-zoom-out.mk-pressed .mk-icon,.mk-zoom-controls .mk-zoom-out:focus .mk-icon{opacity:.85}@media not all and (hover:none){.mk-zoom-controls .mk-zoom-in:hover .mk-icon,.mk-zoom-controls .mk-zoom-out:hover .mk-icon{opacity:.85}}.mk-zoom-controls .mk-zoom-in.mk-disabled .mk-icon,.mk-zoom-controls .mk-zoom-out.mk-disabled .mk-icon{opacity:.2}.mk-zoom-controls .mk-zoom-in,.mk-zoom-controls .mk-zoom-out{position:absolute;z-index:2;width:50%;height:100%;cursor:pointer}.mk-zoom-controls .mk-divider{position:absolute;left:calc(50% - 1px);width:2px;height:100%;box-sizing:border-box;z-index:100}:host(.mk-controls-container) .mk-top-left-controls-container{font:16px sans-serif;--font-size-default:16}:host(.mk-controls-container.mk-text-zoom) .mk-top-left-controls-container{font:initial}@supports (font:-apple-system-body) and (-webkit-touch-callout:default){:host(.mk-controls-container.mk-text-zoom) .mk-top-left-controls-container{font:-apple-system-body;--font-size-default:17}}.mk-top-right-controls-container{position:relative;width:0;height:24px;transition:width .3s ease-in-out,height .3s ease-in-out}:host(.mk-controls-container) .mk-top-right-controls-container{font:16px sans-serif;--font-size-default:16}:host(.mk-controls-container.mk-text-zoom) .mk-top-right-controls-container{font:initial}@supports (font:-apple-system-body) and (-webkit-touch-callout:default){:host(.mk-controls-container.mk-text-zoom) .mk-top-right-controls-container{font:-apple-system-body;--font-size-default:17}}.mk-controls-container-controls-larger.mk-top-right-controls-container{height:30px}.mk-top-right-controls-container-children-one{width:45px;border-radius:20%/37.5%}.mk-controls-container-controls-larger.mk-top-right-controls-container-children-one{width:56.25px}.mk-top-right-controls-container-children-two{width:90px;border-radius:10%/37.5%}.mk-controls-container-controls-larger.mk-top-right-controls-container-children-two{width:112.5px}:host(.mk-controls-container) .mk-map-type-control,:host(.mk-controls-container) .mk-user-location-control{display:inline-block;position:absolute;width:45px;height:24px;cursor:pointer;pointer-events:auto;transition:width .3s ease-in-out,height .3s ease-in-out}:host(.mk-controls-container) .mk-user-location-control{left:0}:host(.mk-controls-container.mk-rtl) .mk-user-location-control{left:auto;right:0}:host(.mk-controls-container) .mk-map-type-control{right:0}:host(.mk-controls-container.mk-rtl) .mk-map-type-control{left:0;right:auto}:host(.mk-controls-container) .mk-controls-container-controls-larger .mk-map-type-control,:host(.mk-controls-container) .mk-controls-container-controls-larger .mk-user-location-control{width:56.25px;height:30px}:host(.mk-controls-container) .mk-user-location-control .mk-icon{position:absolute;left:0;height:100%;width:100%;display:block;transition:transform .2s ease-in-out}:host(.mk-controls-container) .mk-user-location-control .mk-scaled-out{transform:scale(0)}:host(.mk-controls-container) .mk-user-location-control .mk-icon.mk-icon-waiting rect{animation:.8s infinite mk-spinner}:host(.mk-controls-container) .mk-user-location-control .mk-icon.mk-icon-waiting rect:nth-child(2){animation-delay:-.1s}:host(.mk-controls-container) .mk-user-location-control .mk-icon.mk-icon-waiting rect:nth-child(3){animation-delay:-.2s}:host(.mk-controls-container) .mk-user-location-control .mk-icon.mk-icon-waiting rect:nth-child(4){animation-delay:-.3s}:host(.mk-controls-container) .mk-user-location-control .mk-icon.mk-icon-waiting rect:nth-child(5){animation-delay:-.4s}:host(.mk-controls-container) .mk-user-location-control .mk-icon.mk-icon-waiting rect:nth-child(6){animation-delay:-.5s}:host(.mk-controls-container) .mk-user-location-control .mk-icon.mk-icon-waiting rect:nth-child(7){animation-delay:-.6s}:host(.mk-controls-container) .mk-user-location-control .mk-icon.mk-icon-waiting rect:nth-child(8){animation-delay:-.7s}@keyframes mk-spinner{0%{opacity:1}88%{opacity:.15}}:host(.mk-controls-container) .mk-map-type-control .mk-icon,:host(.mk-controls-container) .mk-user-location-control .mk-icon{pointer-events:none;display:block;opacity:.55}:host(.mk-controls-container) .mk-map-type-control.mk-pressed .mk-icon,:host(.mk-controls-container) .mk-map-type-control:focus .mk-icon,:host(.mk-controls-container) .mk-map-type-control:hover .mk-icon,:host(.mk-controls-container) .mk-user-location-control.mk-pressed .mk-icon,:host(.mk-controls-container) .mk-user-location-control:focus .mk-icon,:host(.mk-controls-container) .mk-user-location-control:hover .mk-icon{opacity:.85}@media (hover:none){:host(.mk-controls-container) .mk-map-type-control:hover:not(.mk-pressed,:focus) .mk-icon,:host(.mk-controls-container) .mk-user-location-control:hover:not(.mk-pressed,:focus) .mk-icon{opacity:.55}}:host(.mk-controls-container) .mk-popover{visibility:hidden;transform:scale(.5);opacity:0;border-radius:10px;transition:.2s opacity cubic-bezier(.25, .1, .25, 1),.2s visibility step-end,.2s transform step-end;will-change:transform,opacity,visibility;border-width:1px;border-style:solid;cursor:default}:host(.mk-controls-container) .mk-popover.mk-shown{visibility:visible;pointer-events:auto;transform:none;opacity:1;transition:.2s transform cubic-bezier(.25, .1, .25, 1.3),.2s opacity cubic-bezier(.25, .1, .25, 1.3)}:host(.mk-controls-container) .mk-popover-arrow path{stroke-width:1px}:host(.mk-controls-container) .mk-map-type-popover{width:241px;padding:20px 20px 0}:host(.mk-controls-container) .mk-map-type-popover>div{width:67px;display:inline-block}:host(.mk-controls-container) .mk-map-type-label{margin-top:10px;margin-bottom:17px;text-align:center;font-size:calc(100% * 13 / var(--font-size-default));line-height:calc(16 / 13 * 100%);font-family:-apple-system-font,HelveticaNeue-Medium,Helvetica,Arial,sans-serif}.mk-map-type-button{position:relative;display:block;cursor:pointer;width:65px;height:52px}.mk-map-type-button input{appearance:none;padding:0;margin:0}.mk-map-type-button img,.mk-map-type-button input,.mk-map-type-button::after{position:absolute;top:0;left:0;width:65px;height:52px;border-radius:8px}.mk-map-type-button::after{content:""}:host(.mk-controls-container) .mk-map-type-button img.mk-dark-icon,:host(.mk-controls-container.mk-color-scheme-dark) .mk-map-type-button img.mk-light-icon{display:none}:host(.mk-controls-container.mk-color-scheme-dark) .mk-map-type-button img.mk-dark-icon{display:block}.mk-open-dialog{pointer-events:auto;width:36px;height:36px;appearance:none;border:none;border-radius:10px}:host(.mk-controls) .mk-open-dialog svg.mk-icon{pointer-events:none;display:block;margin:auto;width:15px;height:15px;opacity:.55}:host(.mk-controls.mk-rtl) .mk-open-dialog svg.mk-icon{transform:scale(-1,1)}.mk-transition-path{transition:.5s fill ease-in-out}.mk-transition-path.mk-path-hidden{fill:transparent}:host(.mk-controls) .mk-open-dialog:active svg.mk-icon,:host(.mk-controls) .mk-open-dialog:focus-visible svg.mk-icon{opacity:.85}.mk-close{font:calc(100% * 13.5 / var(--font-size-default)) -apple-system-font,HelveticaNeue-Medium,Helvetica,Arial,sans-serif;font-weight:500;pointer-events:auto;height:36px;appearance:none;border:none;border-radius:10px;padding:6px 10px}.mk-close .mk-close-label{opacity:.55;pointer-events:none}.mk-close:active .mk-close-label,.mk-close:focus-visible .mk-close-label{opacity:.85}@media not all and (hover:none){:host(.mk-controls) .mk-open-dialog:hover svg.mk-icon{opacity:.85}.mk-close:hover .mk-close-label{opacity:.85}}.mk-style-helper{opacity:0;pointer-events:none}.mk-compass,.mk-rotation-control{width:48px;height:48px;pointer-events:auto;border-radius:50%;overflow:hidden;line-height:0;transition:opacity .1s cubic-bezier(.19, 1, .22, 1)}.mk-compass.mk-compass-small{transform:scale(.75)}.mk-rotation-control{cursor:grab}.mk-rotation-control.mk-pressed{cursor:grabbing}@supports ((backdrop-filter:blur(30px)) or (-webkit-backdrop-filter:blur(30px))){.mk-close,.mk-compass,.mk-focus .mk-zoom-in,.mk-focus .mk-zoom-out,.mk-legal:focus-visible,.mk-open-dialog,.mk-pill-focus .mk-map-type-control,.mk-pill-focus .mk-user-location-control,.mk-pill-pressed .mk-map-type-control,.mk-pill-pressed .mk-user-location-control,.mk-pill-pressed .mk-zoom-in,.mk-pill-pressed .mk-zoom-out,.mk-rotation-control,.mk-top-right-controls-container:not( .mk-pill-pressed,.mk-pill-focus,:empty ),.mk-zoom-controls:not(.mk-pill-pressed,.mk-focus){-webkit-backdrop-filter:blur(30px);backdrop-filter:blur(30px)}}.mk-compass>.mk-compass-wrapper,.mk-rotation-control>.mk-rotation-wrapper{width:100%;height:100%;position:absolute;will-change:transform;overflow:hidden;pointer-events:none}.mk-rotation-control>.mk-rotation-wrapper>img{position:absolute;left:0;top:0;width:200%;height:200%;pointer-events:none}.mk-rotation-control.mk-focus>.mk-rotation-wrapper>img,.mk-rotation-control.mk-pressed>.mk-rotation-wrapper>img,.mk-rotation-control:hover>.mk-rotation-wrapper>img{left:-100%}.mk-compass .mk-compass-part-dial{fill-opacity:0.12}.mk-compass .mk-compass-part-dial-ews{fill-opacity:0.64}.mk-compass:is(:hover,:active) .mk-compass-part-dial-ews{fill-opacity:1}@media (hover:none){.mk-rotation-control:hover:not(.mk-focus,.mk-pressed)>.mk-rotation-wrapper>img{left:0}}:host(.mk-dark-mode) .mk-rotation-control>.mk-rotation-wrapper>img{top:-100%}.mk-compass .mk-compass-heading,.mk-rotation-control .mk-heading{font:15.5px -apple-system-font,HelveticaNeue-Medium,Helvetica,Arial,sans-serif;font-weight:500;position:absolute;left:0;width:100%;overflow:hidden;text-overflow:clip;text-align:center;opacity:.55;pointer-events:none}.mk-compass .mk-compass-heading{top:0;line-height:48px}.mk-rotation-control .mk-heading{top:calc(50% - 1em / 15.5 * 10.5);line-height:19px}.mk-compass:active .mk-compass-heading,.mk-compass:hover .mk-compass-heading,.mk-rotation-control.mk-focus .mk-heading,.mk-rotation-control.mk-pressed .mk-heading,.mk-rotation-control:hover .mk-heading{opacity:.85}.mk-compass:has(:focus-visible) .mk-compass-heading{opacity:.85}@media (hover:none){.mk-rotation-control:not(.mk-focus,.mk-pressed):hover .mk-heading{opacity:.55}.mk-compass:not(:has(:focus-visible),:active):hover .mk-compass-heading{opacity:.55}}.mk-rotation-control .mk-rotation-slider{position:absolute;left:0;width:100%;height:15px;top:-30px}.mk-compass-slider{all:initial;opacity:0;position:absolute;display:block;width:100%;height:100%;top:0;left:0;border-radius:24px;margin:0;padding:0}.mk-compass.mk-compass-reset-only .mk-compass-slider{cursor:pointer}.mk-compass:not(.mk-compass-reset-only) .mk-compass-slider{cursor:grab}.mk-compass:not(.mk-compass-reset-only) .mk-compass-slider:active{cursor:grabbing}.mk-compass-slider::-webkit-slider-runnable-track,.mk-compass-slider::-webkit-slider-thumb{all:initial;appearance:none;display:block;width:100%;height:100%;top:0;left:0}.mk-compass-slider::-moz-range-progress,.mk-compass-slider::-moz-range-thumb,.mk-compass-slider::-moz-range-track{all:initial;appearance:none;display:block;width:100%;height:100%}:host(.mk-controls-container.mk-dragging-annotation) .mk-legal,:host(.mk-controls-container.mk-dragging-annotation) .mk-map-type-control,:host(.mk-controls-container.mk-dragging-annotation) .mk-rotation-control,:host(.mk-controls-container.mk-dragging-annotation) .mk-rotation-control input,:host(.mk-controls-container.mk-dragging-annotation) .mk-user-location-control,:host(.mk-controls-container.mk-dragging-annotation) .mk-zoom-in,:host(.mk-controls-container.mk-dragging-annotation) .mk-zoom-out{cursor:none}.mk-compass,.mk-rotation-control,.mk-top-right-controls-container:not(.mk-pill-pressed,.mk-pill-focus,:empty),.mk-zoom-controls{box-shadow:0 0 0 .5px rgb(0 0 0 / 5%)}.mk-compass,.mk-focus .mk-zoom-in,.mk-focus .mk-zoom-out,.mk-pill-focus .mk-map-type-control,.mk-pill-focus .mk-user-location-control,.mk-pill-pressed .mk-map-type-control,.mk-pill-pressed .mk-user-location-control,.mk-pill-pressed .mk-zoom-in,.mk-pill-pressed .mk-zoom-out,.mk-rotation-control,.mk-top-right-controls-container:not(.mk-pill-pressed,.mk-pill-focus,:empty),.mk-zoom-controls:not(.mk-pill-pressed,.mk-focus){background-color:rgb(255 255 255)}.mk-compass:active,.mk-map-type-control.mk-pressed,.mk-rotation-control.mk-pressed,.mk-user-location-control.mk-pressed,.mk-zoom-controls .mk-zoom-in.mk-pressed:not(.mk-disabled),.mk-zoom-controls .mk-zoom-out.mk-pressed:not(.mk-disabled){background-color:rgb(229 229 229)}.mk-legal:focus-visible,.mk-map-type-control:focus,.mk-rotation-control.mk-focus,.mk-user-location-control:focus,.mk-zoom-controls.mk-focus .mk-zoom-in:focus,.mk-zoom-controls.mk-focus .mk-zoom-out:focus{background-color:rgb(204 229 255)}.mk-legal:focus-visible,.mk-map-type-control:focus,.mk-pill-focus .mk-map-type-control,.mk-pill-focus .mk-user-location-control,.mk-rotation-control.mk-focus,.mk-user-location-control:focus,.mk-zoom-controls.mk-focus{box-shadow:0 0 0 2px rgb(0 124 255)}.mk-compass:has(:focus-visible){background-color:rgb(204 229 255);box-shadow:0 0 0 2px rgb(0 124 255)}.mk-map-type-control.mk-focus.mk-pressed,.mk-rotation-control.mk-focus.mk-pressed,.mk-user-location-control.mk-focus.mk-pressed,.mk-zoom-controls.mk-focus .mk-zoom-in.mk-pressed:focus,.mk-zoom-controls.mk-focus .mk-zoom-out.mk-pressed:focus{background-color:rgb(127 189 255)}.mk-compass:has(:focus-visible):active{background-color:rgb(127 189 255)}.mk-zoom-controls.mk-focus .mk-divider{border-left:2px solid rgb(0 124 255)}.mk-map-type-control .mk-icon,.mk-user-location-control .mk-icon,.mk-zoom-controls .mk-icon{fill:#000}:host(.mk-controls-container) .mk-popover{background-color:rgb(239 239 239);color:#000;border-color:transparent;box-shadow:0 5px 10px 0 rgb(0 0 0 / 30%)}:host(.mk-controls-container) .mk-popover-arrow{fill:rgb(239 239 239)}.mk-error-message{color:#333}.mk-error-message a{color:#007aff}.mk-error-message a:visited{color:#af52de}.mk-legal .mk-legal-label{color:rgb(0 0 0 / 70%);text-shadow:0 0 1px rgb(255 255 255 / 85%)}.mk-compass .mk-compass-heading,.mk-rotation-control .mk-heading{color:#000}.mk-popover .mk-map-type-button input{box-shadow:0 0 0 .5px rgb(0 0 0 / 14%)}.mk-popover .mk-map-type-button input:checked{box-shadow:0 0 0 2px rgb(0 124 255)}.mk-popover .mk-map-type-button input:focus-visible{box-shadow:0 0 0 4px rgb(0 124 255 / 40%)}.mk-popover .mk-map-type-button input:checked:focus-visible{box-shadow:0 0 0 2px rgb(0 124 255),0 0 0 4px rgb(0 124 255 / 40%)}.mk-map-type-button:active::after{background-color:rgb(0 0 0 / 25%)}.mk-compass :is(.mk-compass-part-dial,.mk-compass-part-dial-ews){fill:#000}.mk-compass .mk-compass-part-dial-n{fill:#ff3b30}@supports ((backdrop-filter:blur(30px)) or (-webkit-backdrop-filter:blur(30px))){.mk-compass,.mk-focus .mk-zoom-in,.mk-focus .mk-zoom-out,.mk-pill-focus .mk-map-type-control,.mk-pill-focus .mk-user-location-control,.mk-pill-pressed .mk-map-type-control,.mk-pill-pressed .mk-user-location-control,.mk-pill-pressed .mk-zoom-in,.mk-pill-pressed .mk-zoom-out,.mk-rotation-control,.mk-top-right-controls-container:not( .mk-pill-pressed,.mk-pill-focus,:empty ),.mk-zoom-controls:not(.mk-pill-pressed,.mk-focus){background-color:rgb(255 255 255 / 75%)}.mk-compass:active,.mk-map-type-control.mk-pressed,.mk-rotation-control.mk-pressed,.mk-user-location-control.mk-pressed,.mk-zoom-controls .mk-zoom-in.mk-pressed:not(.mk-disabled),.mk-zoom-controls .mk-zoom-out.mk-pressed:not(.mk-disabled){background-color:rgb(229 229 229 / 60%)}.mk-legal:focus-visible,.mk-map-type-control.mk-focus,.mk-rotation-control.mk-focus,.mk-user-location-control.mk-focus,.mk-zoom-controls.mk-focus .mk-zoom-in:focus,.mk-zoom-controls.mk-focus .mk-zoom-out:focus{background-color:rgb(204 229 255 / 60%)}.mk-compass:has(:focus-visible){background-color:rgb(204 229 255 / 60%)}.mk-map-type-control.mk-focus.mk-pressed,.mk-rotation-control.mk-focus.mk-pressed,.mk-user-location-control.mk-focus.mk-pressed,.mk-zoom-controls.mk-focus .mk-zoom-in.mk-pressed:focus,.mk-zoom-controls.mk-focus .mk-zoom-out.mk-pressed:focus{background-color:rgb(127 189 255 / 60%)}.mk-compass:has(:focus-visible):active{background-color:rgb(127 189 255 / 60%)}}:host(.mk-dark-mode) .mk-compass,:host(.mk-dark-mode) .mk-rotation-control,:host(.mk-dark-mode) .mk-top-right-controls-container:not( .mk-pill-pressed,.mk-pill-focus,:empty ),:host(.mk-dark-mode) .mk-zoom-controls{box-shadow:0 0 0 .5px rgb(255 255 255 / 5%)}:host(.mk-dark-mode) .mk-close,:host(.mk-dark-mode) .mk-compass,:host(.mk-dark-mode) .mk-focus .mk-zoom-in,:host(.mk-dark-mode) .mk-focus .mk-zoom-out,:host(.mk-dark-mode) .mk-open-dialog,:host(.mk-dark-mode) .mk-pill-focus .mk-map-type-control,:host(.mk-dark-mode) .mk-pill-focus .mk-user-location-control,:host(.mk-dark-mode) .mk-pill-pressed .mk-map-type-control,:host(.mk-dark-mode) .mk-pill-pressed .mk-user-location-control,:host(.mk-dark-mode) .mk-pill-pressed .mk-zoom-in,:host(.mk-dark-mode) .mk-pill-pressed .mk-zoom-out,:host(.mk-dark-mode) .mk-rotation-control,:host(.mk-dark-mode) .mk-top-right-controls-container:not( .mk-pill-pressed,.mk-pill-focus,:empty ),:host(.mk-dark-mode) .mk-zoom-controls:not(.mk-pill-pressed,.mk-focus){background-color:rgb(18 18 18)}:host(.mk-dark-mode) .mk-close:active,:host(.mk-dark-mode) .mk-map-type-control.mk-pressed,:host(.mk-dark-mode) .mk-open-dialog:active,:host(.mk-dark-mode) .mk-user-location-control.mk-pressed,:host(.mk-dark-mode) .mk-zoom-controls .mk-zoom-in.mk-pressed:not(.mk-disabled),:host(.mk-dark-mode) .mk-zoom-controls .mk-zoom-out.mk-pressed:not(.mk-disabled){background-color:rgb(42 42 42)}:host(.mk-dark-mode) .mk-close:focus-visible,:host(.mk-dark-mode) .mk-legal:focus-visible,:host(.mk-dark-mode) .mk-map-type-control.mk-focus,:host(.mk-dark-mode) .mk-open-dialog:focus-visible,:host(.mk-dark-mode) .mk-rotation-control.mk-focus,:host(.mk-dark-mode) .mk-user-location-control.mk-focus,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-in:focus,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-out:focus{background-color:rgb(12 49 89)}:host(.mk-dark-mode) .mk-close:focus-visible,:host(.mk-dark-mode) .mk-legal:focus-visible,:host(.mk-dark-mode) .mk-map-type-control:focus,:host(.mk-dark-mode) .mk-open-dialog:focus-visible,:host(.mk-dark-mode) .mk-pill-focus .mk-map-type-control,:host(.mk-dark-mode) .mk-pill-focus .mk-user-location-control,:host(.mk-dark-mode) .mk-rotation-control.mk-focus,:host(.mk-dark-mode) .mk-user-location-control:focus,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus{box-shadow:0 0 0 2px rgb(0 124 255)}:host(.mk-dark-mode) .mk-compass:has(:focus-visible){background-color:rgb(12 49 89);box-shadow:0 0 0 2px rgb(0 124 255)}:host(.mk-dark-mode) .mk-close:focus-visible:active,:host(.mk-dark-mode) .mk-map-type-control.mk-focus.mk-pressed,:host(.mk-dark-mode) .mk-open-dialog:focus-visible:active,:host(.mk-dark-mode) .mk-rotation-control.mk-focus.mk-pressed,:host(.mk-dark-mode) .mk-user-location-control.mk-focus.mk-pressed,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-in.mk-pressed:focus,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-out.mk-pressed:focus{background-color:rgb(3 102 207)}:host(.mk-dark-mode) .mk-compass:has(:focus-visible):active{background-color:rgb(3 102 207)}:host(.mk-dark-mode) .mk-map-type-control .mk-icon,:host(.mk-dark-mode) .mk-open-dialog .mk-icon,:host(.mk-dark-mode) .mk-user-location-control .mk-icon,:host(.mk-dark-mode) .mk-zoom-controls .mk-icon{fill:#fff}:host(.mk-dark-mode) .mk-close-label{color:#fff}:host(.mk-controls-container.mk-dark-mode) .mk-popover{background-color:rgb(54 54 54);color:#fff;border-color:rgb(90 92 100)}:host(.mk-controls-container.mk-dark-mode) .mk-popover-arrow{fill:rgb(54 54 54)}:host(.mk-controls-container.mk-dark-mode) .mk-popover-arrow path{stroke:rgb(90 92 100)}:host(.mk-dark-mode) .mk-error-message{color:rgb(255 255 255 / 85%)}:host(.mk-dark-mode) .mk-error-message a{color:#0a84ff}:host(.mk-dark-mode) .mk-error-message a:visited{color:#bf5af2}:host(.mk-dark-mode) .mk-legal .mk-legal-label{color:rgb(255 255 255 / 90%);text-shadow:0 0 1px rgb(0 0 0 / 50%),0 0 10px rgb(0 0 0 / 100%)}:host(.mk-dark-mode) .mk-compass .mk-compass-heading,:host(.mk-dark-mode) .mk-rotation-control .mk-heading{color:#fff}:host(.mk-dark-mode) .mk-popover .mk-map-type-button input:not(:checked,:focus-visible){box-shadow:0 0 0 .5px rgb(255 255 255 / 30%)}:host(.mk-dark-mode) .mk-compass :is(.mk-compass-part-dial,.mk-compass-part-dial-ews){fill:#fff}:host(.mk-dark-mode) .mk-compass .mk-compass-part-dial-n{fill:#ff453a}@supports ((backdrop-filter:blur(30px)) or (-webkit-backdrop-filter:blur(30px))){:host(.mk-dark-mode) .mk-close,:host(.mk-dark-mode) .mk-compass,:host(.mk-dark-mode) .mk-focus .mk-zoom-in,:host(.mk-dark-mode) .mk-focus .mk-zoom-out,:host(.mk-dark-mode) .mk-open-dialog,:host(.mk-dark-mode) .mk-pill-focus .mk-map-type-control,:host(.mk-dark-mode) .mk-pill-focus .mk-user-location-control,:host(.mk-dark-mode) .mk-pill-pressed .mk-map-type-control,:host(.mk-dark-mode) .mk-pill-pressed .mk-user-location-control,:host(.mk-dark-mode) .mk-pill-pressed .mk-zoom-in,:host(.mk-dark-mode) .mk-pill-pressed .mk-zoom-out,:host(.mk-dark-mode) .mk-rotation-control,:host(.mk-dark-mode) .mk-top-right-controls-container:not( .mk-pill-pressed,.mk-pill-focus,:empty ),:host(.mk-dark-mode) .mk-zoom-controls:not(.mk-pill-pressed,.mk-focus){background-color:rgb(18 18 18 / 60%)}:host(.mk-dark-mode) .mk-close:active,:host(.mk-dark-mode) .mk-compass:active,:host(.mk-dark-mode) .mk-map-type-control.mk-pressed,:host(.mk-dark-mode) .mk-open-dialog:active,:host(.mk-dark-mode) .mk-rotation-control.mk-pressed,:host(.mk-dark-mode) .mk-type-control.mk-pressed,:host(.mk-dark-mode) .mk-user-location-control.mk-pressed,:host(.mk-dark-mode) .mk-zoom-controls .mk-zoom-in.mk-pressed:not(.mk-disabled),:host(.mk-dark-mode) .mk-zoom-controls .mk-zoom-out.mk-pressed:not(.mk-disabled){background-color:rgb(42 42 42 / 60%)}:host(.mk-dark-mode) .mk-close:focus-visible,:host(.mk-dark-mode) .mk-legal:focus-visible,:host(.mk-dark-mode) .mk-map-type-control.mk-focus,:host(.mk-dark-mode) .mk-open-dialog:focus-visible,:host(.mk-dark-mode) .mk-rotation-control.mk-focus,:host(.mk-dark-mode) .mk-user-location-control.mk-focus,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-in:focus,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-out:focus{background-color:rgb(12 49 89 / 60%)}:host(.mk-dark-mode) .mk-compass:has(:focus-visible){background-color:rgb(12 49 89 / 60%)}:host(.mk-dark-mode) .mk-close:focus-visible:active,:host(.mk-dark-mode) .mk-map-type-control.mk-focus.mk-pressed,:host(.mk-dark-mode) .mk-open-dialog:focus-visible:active,:host(.mk-dark-mode) .mk-rotation-control.mk-focus.mk-pressed,:host(.mk-dark-mode) .mk-user-location-control.mk-focus.mk-pressed,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-in.mk-pressed:focus,:host(.mk-dark-mode) .mk-zoom-controls.mk-focus .mk-zoom-out.mk-pressed:focus{background-color:rgb(3 102 207 / 60%)}:host(.mk-dark-mode) .mk-compass:has(:focus-visible):active{background-color:rgb(3 102 207 / 60%)}}.mk-scale{position:absolute;top:0;left:0;vertical-align:top}:host(.mk-rtl) .mk-scale{direction:rtl}:host(.mk-controls-container) .mk-popover{position:absolute;top:38px;right:-1px}:host(.mk-controls-container) .mk-popover-arrow{position:absolute;top:-13px}.mk-top-right-controls-container{position:absolute;top:9px;right:9px;direction:ltr}:host(.mk-controls-container:not(.mk-rtl)) .mk-top-right-controls-container>.mk-control:first-child{border-top-left-radius:20% 37.5%;border-bottom-left-radius:20% 37.5%}:host(.mk-controls-container:not(.mk-rtl)) .mk-top-right-controls-container>.mk-control:nth-last-child(2){border-top-right-radius:20% 37.5%;border-bottom-right-radius:20% 37.5%}:host(.mk-controls-container) .mk-popover.mk-user-location-error-popover{transform-origin:calc(100% - 69px) -12.416px}:host(.mk-controls-container) .mk-popover.mk-map-type-popover,:host(.mk-controls-container) .mk-popover.mk-user-location-error-popover:last-child{transform-origin:calc(100% - 24px) -12.416px}:host(.mk-controls-container) .mk-popover.mk-user-location-error-popover>.mk-popover-arrow{right:52.5px}:host(.mk-controls-container) .mk-popover.mk-map-type-popover>.mk-popover-arrow,:host(.mk-controls-container) .mk-popover.mk-user-location-error-popover:last-child>.mk-popover-arrow{right:10px}:host(.mk-controls-container) .mk-map-type-popover>div:not(:last-child){margin-right:20px}:host(.mk-controls-container) .mk-controls-container-controls-larger .mk-popover{top:44px}:host(.mk-controls-container) .mk-controls-container-controls-larger .mk-popover.mk-user-location-error-popover>.mk-popover-arrow{right:65px}:host(.mk-rtl) .mk-top-right-controls-container{left:9px;right:auto;direction:rtl}:host(.mk-controls-container.mk-rtl) .mk-top-right-controls-container>.mk-control:first-child{border-top-right-radius:20% 37.5%;border-bottom-right-radius:20% 37.5%}:host(.mk-controls-container.mk-rtl) .mk-top-right-controls-container>.mk-control:nth-last-child(2){border-top-left-radius:20% 37.5%;border-bottom-left-radius:20% 37.5%}:host(.mk-controls-container.mk-rtl) .mk-popover{right:auto;left:-1px}:host(.mk-controls-container.mk-rtl) .mk-popover.mk-user-location-error-popover{transform-origin:69px -12.416px}:host(.mk-controls-container.mk-rtl) .mk-popover.mk-map-type-popover,:host(.mk-controls-container.mk-rtl) .mk-popover.mk-user-location-error-popover:last-child{transform-origin:24px -12.416px}:host(.mk-controls-container.mk-rtl) .mk-popover.mk-user-location-error-popover>.mk-popover-arrow{right:auto;left:52.5px}:host(.mk-controls-container) .mk-controls-container-controls-larger .mk-popover.mk-map-type-popover>.mk-popover-arrow{right:12px}:host(.mk-controls-container.mk-rtl) .mk-popover.mk-map-type-popover>.mk-popover-arrow,:host(.mk-controls-container.mk-rtl) .mk-popover.mk-user-location-error-popover:last-child>.mk-popover-arrow{right:auto;left:10px}:host(.mk-controls-container.mk-rtl) .mk-controls-container-controls-larger .mk-popover.mk-user-location-error-popover>.mk-popover-arrow{right:auto;left:69.75px}:host(.mk-controls-container) .mk-controls-container-controls-larger .mk-popover.mk-user-location-error-popover:last-child>.mk-popover-arrow{right:12px}:host(.mk-controls-container.mk-rtl) .mk-controls-container-controls-larger .mk-popover.mk-map-type-popover>.mk-popover-arrow,:host(.mk-controls-container.mk-rtl) .mk-controls-container-controls-larger .mk-popover.mk-user-location-error-popover:last-child>.mk-popover-arrow{right:auto;left:13.25px}:host(.mk-controls-container.mk-rtl) .mk-map-type-popover>div:not(:last-child){margin-left:20px;margin-right:0}.mk-bottom-left-controls-container,.mk-bottom-right-controls-container{position:absolute;bottom:9px}.mk-rotation-control,.mk-zoom-controls{position:absolute;bottom:0}.mk-compass{position:absolute;top:9px}.mk-close,.mk-open-dialog{margin-block-start:9px;margin-inline-end:9px}.mk-close~.mk-compass,.mk-open-dialog~.mk-compass{top:54px}@container controls-container (max-width:100px) or (max-height:100px){:host(.mk-controls) .mk-compass,:host(.mk-controls) .mk-open-dialog{display:none}}@container controls-container (max-width:200px) or (max-height:100px){:host(.mk-controls.mk-long-legal) .mk-compass,:host(.mk-controls.mk-long-legal) .mk-open-dialog{display:none}}.mk-legal,.mk-logo-control{position:absolute}.mk-cq-logo-control{position:absolute;--control-margin:9px;bottom:5px}@container controls-container (max-width:100px) or (max-height:100px){:host(.mk-controls) .mk-cq-logo-control{display:none}}@container controls-container (max-width:200px) or (max-height:100px){:host(.mk-controls.mk-long-legal) .mk-cq-logo-control{display:none}}.mk-logo-control,:host(.mk-controls-container) .mk-legal{bottom:-4px}.mk-cq-legal{bottom:5px;--control-margin:9px}@container controls-container (max-width:100px) or (max-height:100px){.mk-cq-legal{--control-margin:4px}}@container controls-container (max-width:200px) or (max-height:100px){:host(.mk-long-legal) .mk-cq-legal{--control-margin:4px}}.mk-bottom-right-controls-container{right:9px}.mk-bottom-left-controls-container{left:9px}:host(.mk-reduce-margin) .mk-bottom-right-controls-container{right:0}:host(.mk-reduce-margin) .mk-bottom-left-controls-container{left:4px}.mk-logo-control{left:0}:host(.mk-controls:not(.mk-rtl)) .mk-cq-logo-control{left:var(--control-margin)}:host(.mk-controls-container) div.mk-logo-control img.mk-logo.mk-logo-autonavi.mk-logo-autonavi{margin:0 0 -6px -9px}.mk-rotation-control,.mk-zoom-controls,:host(.mk-controls-container) .mk-legal{right:0;left:auto}:host(:not(.mk-rtl))>.mk-compass{right:9px}:host(:not(.mk-rtl))>.mk-compass.mk-compass-small{transform-origin:top right}:host(.mk-controls-container) .mk-legal{right:auto;left:0}:host(:not(.mk-rtl))>:not(.mk-cq-logo-control)+.mk-cq-legal{left:var(--control-margin)}:host(:not(.mk-rtl))>.mk-cq-logo-control+.mk-cq-legal{left:calc(var(--logo-width) * var(--logo-xmax) + var(--control-margin))}@container controls-container (max-width:100px) or (max-height:100px){:host(:not(.mk-rtl))>.mk-cq-logo-control+.mk-cq-legal{left:var(--control-margin)}}@container controls-container (max-width:200px) or (max-height:100px){:host(.mk-long-legal:not(.mk-rtl))>.mk-cq-logo-control+.mk-cq-legal{left:var(--control-margin)}}.mk-zoom-controls .mk-zoom-in{border-top-right-radius:50%;border-bottom-right-radius:50%;right:0}.mk-zoom-controls .mk-zoom-out{border-top-left-radius:50%;border-bottom-left-radius:50%;left:0}.mk-rotation-control~.mk-zoom-controls{right:57px;left:auto}:host(.mk-controls-container) .mk-legal:nth-child(2){left:calc(var(--logo-width) * var(--logo-xmax))}:host(.mk-rtl) .mk-bottom-right-controls-container{left:9px;right:auto}:host(.mk-rtl) .mk-bottom-left-controls-container{left:auto;right:9px}:host(.mk-rtl.mk-reduce-margin) .mk-bottom-right-controls-container{left:0;right:auto}:host(.mk-rtl.mk-reduce-margin) .mk-bottom-left-controls-container{left:auto;right:4px}:host(.mk-rtl) .mk-logo-control{left:auto;right:0}:host(.mk-controls.mk-rtl) .mk-cq-logo-control{right:var(--control-margin)}:host(.mk-rtl.mk-controls-container) div.mk-logo-control img.mk-logo.mk-logo-autonavi.mk-logo-autonavi{margin:0 -9px -6px 0}:host(.mk-rtl) .mk-zoom-controls .mk-zoom-in{border-top-right-radius:0;border-bottom-right-radius:0;border-top-left-radius:50%;border-bottom-left-radius:50%;right:auto;left:0}:host(.mk-rtl) .mk-zoom-controls .mk-zoom-out{border-top-right-radius:50%;border-bottom-right-radius:50%;border-top-left-radius:0;border-bottom-left-radius:0;right:0;left:auto}:host(.mk-controls-container.mk-rtl) .mk-legal,:host(.mk-rtl) .mk-rotation-control,:host(.mk-rtl) .mk-zoom-controls{left:0;right:auto}:host(.mk-rtl)>.mk-compass{left:9px}:host(.mk-rtl)>.mk-compass.mk-compass-small{transform-origin:top left}:host(.mk-rtl)>:not(.mk-cq-logo-control)+.mk-cq-legal{right:var(--control-margin)}:host(.mk-rtl)>.mk-cq-logo-control+.mk-cq-legal{right:calc(var(--logo-width) * (1 - var(--logo-xmin)) + var(--control-margin))}@container controls-container (max-width:100px) or (max-height:100px){:host(.mk-rtl)>.mk-cq-logo-control+.mk-cq-legal{right:var(--control-margin)}}@container controls-container (max-width:200px) or (max-height:100px){:host(.mk-long-legal.mk-rtl)>.mk-cq-logo-control+.mk-cq-legal{right:var(--control-margin)}}:host(.mk-controls-container.mk-rtl) .mk-legal{left:auto;right:0}:host(.mk-rtl) .mk-rotation-control~.mk-zoom-controls{left:57px;right:auto}:host(.mk-controls-container) .mk-autonavi .mk-legal:nth-child(2){left:calc(var(--logo-width) * var(--logo-xmax) - 9px)}:host(.mk-controls-container.mk-rtl) .mk-legal:nth-child(2){right:calc(var(--logo-width) * (1 - var(--logo-xmin)))}:host(.mk-controls-container.mk-rtl) .mk-autonavi .mk-legal:nth-child(2){left:auto;right:calc(var(--logo-width) * (1 - var(--logo-xmin)) - 9px)}',Ue.nonce),this._shadowRootNode.addChild(this._topRightControlsNode),this._shadowRootNode.addChild(this._bottomRightControlsNode),this._shadowRootNode.addChild(this._bottomLeftControlsNode),this._logo=new rl({logoUpdated:e=>this.logoUpdated(e)}),this._legalNode=new ll,Ue.addEventListener(Ue.Events.Changed,this),this._updateAutoNaviClass(),this.textZoom=e.textZoom,Vi.activeLocale&&(this._rtl=Vi.activeLocale.rtl,this.setAttribute("lang",Vi.localeId),this.classList.toggle(Ih,this._rtl)),Vi.addEventListener(Vi.Events.LocaleChanged,this)}get textZoom(){return this.classList.contains(Dh)}set textZoom(e){this.classList.toggle(Dh,e)}get controlsPending(){return this._controlsPending}set canShowTooltips(e){this._userLocationControl&&(this._userLocationControl.canShowTooltips=e),this._zoomControl&&(this._zoomControl.canShowTooltips=e),this._mapTypeControl&&(this._mapTypeControl.canShowTooltips=e),this._rotationControl&&(this._rotationControl.canShowTooltips=e)}mapPaddingDidChange(e){const t=this.element.style;t.top=e.top+"px",t.left=e.left+"px",t.bottom=e.bottom+"px",t.right=e.right+"px",this.sizeDidChange()}sizeDidChange(){const e=this._shouldHideControls();this._toggleControl(this._map.showsZoomControl&&!e,this._zoomControl,this.updateZoomControl),this._toggleControl(this._map.showsMapTypeControl&&!e,this._mapTypeControl,this.updateMapTypeControl),this._toggleControl(this._map.showsUserLocationControl&&!e,this._userLocationControl,this.updateUserLocationControl),this.updateLogo(),this.updateLegalNode(),this.updateRotationControl(),this.updateScale(),this.zoomLevelDidChange();const t=this._getSizeClass();this._updateTopRightControlsContainer(!1),this._setSizeClass(this._bottomRightControlsNode,t),this._setSizeClass(this._bottomLeftControlsNode,t),this._setReduceMargin()}logoUpdated(e){const t=this._bottomLeftControlsNode.domNode;t.style.setProperty("--logo-xmin",e.xMin),t.style.setProperty("--logo-xmax",e.xMax)}zoomLevelDidChange(){this._zoomControl&&(this._zoomControl.zoomOutEnabled=this._map.canZoomOut,this._zoomControl.zoomInEnabled=this._map.canZoomIn)}update(){this._map&&(this.classList.toggle("mk-color-scheme-dark",Eo.darkColorScheme(this._map.currentColorScheme)),this.classList.toggle("mk-dark-mode",Eo.darkColorScheme(this._map.tint)),this._shouldHideControls()?(this._removeZoomControl(),this._removeMapTypeControl(),this._removeUserLocationControl(),this._removeRotationControl(),this._removeScale()):(this.updateZoomControl(),this.updateMapTypeControl(),this.updateUserLocationControl(),this.updateRotationControl(),this.updateScale()),this.updateLogo(),this.updateLegalNode(),this._setReduceMargin())}scaleDidChange(){this._scale&&(this._scale.update(),this._scale.hideIfNeeded())}updateScale(){this._map.showsScale===Th.Hidden||this._shouldHideControls()?this._removeScale():(this._addScale(),this._scale.node.mapWidth=this._map._mapNode.size.width,this._scale.updateTheme(this._map.mapNodeTint),this._positionScale(),this._scale.update())}updateZoomControl(){this._map.showsZoomControl&&!this._shouldHideControls()?(this._addZoomControl(),this._zoomControl.enabled=this._map.isZoomEnabled,this.zoomLevelDidChange(),this._zoomControl.updateTintColor(this._map.tintColorForControls)):this._removeZoomControl()}updateMapTypeControl(){this._map.showsMapTypeControl&&!this._shouldHideControls()?(this._addMapTypeControl(),this._mapTypeControl.mapType=this._map.mapType,this._mapTypeControl.enabled=!0,this._mapTypeControl.updateTintColor(this._map.tintColorForControls)):this._removeMapTypeControl()}updateUserLocationControl(){if(this._map.showsUserLocationControl&&!this._shouldHideControls()){switch(this._addUserLocationControl(),this._userLocationControl.enabled=!0,this._userLocationControl.state){case vh.States.Default:Bh.userLocation.isAvailable?this._map.tracksUserLocation&&Bh.userLocation.location?this._userLocationControl.toTrackingState():(this._map.tracksUserLocation||this._map.showsUserLocation&&!this._map.userLocationAnnotation)&&this._userLocationControl.toWaitingState():this._userLocationControl.toDisabledState();break;case vh.States.Waiting:Bh.userLocation.location&&this.userLocationDidChange(Bh.userLocation),this._map.showsUserLocation||this._userLocationControl.toDefaultState();break;case vh.States.Tracking:this._map.tracksUserLocation||this._userLocationControl.toDefaultState()}this._userLocationControl.updateTintColor(this._map.tintColorForControls)}else this._removeUserLocationControl()}updateRotationControl(){this._shouldHideControls()||this._map.isCompassHidden?this._removeRotationControl():(this._addRotationControl(),this._rotationControl.rotation=this._map.rotation,this._rotationControl.updateImage(Eo.devicePixelRatio,Eo.darkColorScheme(this._map.mapNodeTint)),this._rotationControl.updateTintColor(this._map.tintColorForControls))}updateLegalNode(){this._addAndUpdateLegalNode()}updateLogo(){!this._shouldHideLogo()&&Wh()?this._addAndUpdateLogo():this._logo.remove(),this._legalNode.updateWithMapType(this._map.mapType)}devicePixelRatioDidChange(){this._rotationControl&&this._rotationControl.updateImage(Eo.devicePixelRatio,Eo.darkColorScheme(this._map.mapNodeTint)),this._scale&&this._scale.update(),this._logo.updateWithMapNodeTint(this._map.mapNodeTint)}fontSizeDidChange(){this._scale&&this._scale.update()}handleEvent(e){if(this._map)switch(e.type){case El.EVENTS.MAP_TYPE_CHANGE:this._mapTypeControl&&(this._map.mapType=this._mapTypeControl.mapType);break;case vh.EVENTS.PRESSED:this._userLocationControl.state===vh.States.Waiting?this._map.tracksUserLocation=!0:this._userLocationControl.state!==vh.States.Tracking&&(this._map.tracksUserLocation=!1);break;case Vi.Events.LocaleChanged:this._handleLocaleChanged(e);break;case"update":this._unsetPendingControls(),this._map.addWaitingAnnotations();break;case Ue.Events.Changed:this._updateAutoNaviClass(),this.updateLogo(),this.updateLegalNode()}}mapWasDestroyed(){this._unsetPendingControls(),Vi.removeEventListener(Vi.Events.LocaleChanged,this),Ue.removeEventListener(Ue.Events.Changed,this),this._destroyZoomControl(),this._destroyMapTypeControl(),this._destroyUserLocationControl(),this._destroyRotationControl(!0),this._legalNode.remove(),delete this._legalNode,this._logo.mapWasDestroyed(),this._logo.remove(),delete this._logo,this._removeScale(),this.remove(),delete this._map}userLocationDidChange(e){this._userLocationControl&&(this._map.tracksUserLocation?this._userLocationControl.toTrackingState():this._userLocationControl.toDefaultState())}userLocationDidError(e){this._userLocationControl&&this._userLocationControl.toDisabledState(),this._map.userLocationAnnotation||3===e.errorCode||(this._map.showsUserLocation=!1)}_handleLocaleChanged(e){this.classList.toggle(Ih,e.locale.rtl),this.setAttribute("lang",Vi.localeId),this._rtl!==e.locale.rtl?(this._rtl=e.locale.rtl,this._rtlChanged=!0,this.update(),this._rtlChanged=!1):this.updateLogo()}_addScale(){this._scale||(this._setPendingControls(),this._scale=new ql(this._map),this._shadowRootNode.addChild(this._scale,0))}_positionScale(){const e=this._map.ensureVisibleFrame().size,t=!this._rtl;this._scale.node.leftAligned=t,this._scale.position=new ts(t?Gh.x:e.width-this._scale.size.width-Gh.x,Gh.y),this._scale.shouldDisplayScale||this._scale.node.setOpacityAnimated(0,!1)}_removeScale(){this._scale&&(this._setPendingControls(),this._scale.mapWasDestroyed(),this._scale.remove(),delete this._scale)}_addZoomControl(){!this._map.showsZoomControl||this._zoomControl||this._shouldHideControls()||(this._setPendingControls(),this._zoomControl=new oh,this._zoomControl.enabled=this._map.isZoomEnabled,this._zoomControl.addEventListener(oh.EVENTS.ZOOM_START,this._map),this._zoomControl.addEventListener(oh.EVENTS.ZOOM_END,this._map),this._bottomRightControlsNode.insertBefore(this._zoomControl,this._legalNode),this._rotationControl&&this._rotationControl.classList.add(Nh))}_removeZoomControl(){!this._shouldHideControls()&&this._map.showsZoomControl||!this._zoomControl||(this._setPendingControls(),this._zoomControl.enabled=!1,this._destroyZoomControl())}_destroyZoomControl(){this._zoomControl&&(this._zoomControl.removeEventListener(oh.EVENTS.ZOOM_START,this._map),this._zoomControl.removeEventListener(oh.EVENTS.ZOOM_END,this._map),this._zoomControl.remove(),this._rotationControl&&this._rotationControl.classList.remove(Nh),delete this._zoomControl)}_addMapTypeControl(){!this._map.showsMapTypeControl||this._mapTypeControl||this._shouldHideControls()||(this._setPendingControls(),this._mapTypeControl=new El(Is,this._map.mapType,this),this._mapTypeControl.addEventListener(El.EVENTS.MAP_TYPE_CHANGE,this),this._topRightControlsNode.addChild(this._mapTypeControl),this._updateTopRightControlsContainer(!0))}_removeMapTypeControl(){this._mapTypeControl&&(this._setPendingControls(),this._mapTypeControl.enabled=!1,this._destroyMapTypeControl(),this._updateTopRightControlsContainer(!0))}_destroyMapTypeControl(){this._mapTypeControl&&(this._mapTypeControl.removeEventListener(El.EVENTS.MAP_TYPE_CHANGE,this),this._mapTypeControl.remove(),delete this._mapTypeControl)}_toggleControl(e,t,i){(t&&!e||!t&&e)&&i.call(this)}_shouldHideControls(){if(!Ue.ready)return!0;const e=this._map.ensureVisibleFrame().size;return e.width<Zs.minimumSizeToShowControls.width||e.height<Zs.minimumSizeToShowControls.height}_shouldHideLogo(){if(!Ue.ready)return!0;const e=-1===Eh.indexOf(Vi.localeId)?Zs.minimumSizeToShowLogo:Zs.minimumSizeToShowLogoWithReducedMargin,t=this._map.ensureVisibleFrame().size;return t.width<e.width||t.height<e.height}_addRotationControl(){this._shouldHideControls()||this._rotationControl||(this._setPendingControls(),this._rotationControl=new Ah(this._map),this._rotationControl.enabled=!0,this._bottomRightControlsNode.insertBefore(this._rotationControl,this._zoomControl||this._legalNode),this._zoomControl&&this._rotationControl.classList.add(Nh))}_removeRotationControl(){this._rotationControl&&(this._setPendingControls(),this._destroyRotationControl())}_destroyRotationControl(e){if(this._rotationControl){if(e)this._rotationControl.mapWasDestroyed(),this._rotationControl.remove();else{const e=this._rotationControl,t=()=>{clearTimeout(i),e.element.removeEventListener("transitionend",t),e.mapWasDestroyed(),e.remove()};e.opacity=0;const i=setTimeout(t,300);e.element.addEventListener("transitionend",t)}delete this._rotationControl}}_addUserLocationControl(){!this._map.showsUserLocationControl||this._userLocationControl||this._shouldHideControls()||(this._setPendingControls(),this._userLocationControl=new vh(this._map,this._rtl,this),this._userLocationControl.addEventListener(vh.EVENTS.PRESSED,this),this._topRightControlsNode.insertBefore(this._userLocationControl,this._mapTypeControl),this._updateTopRightControlsContainer(!0))}controlDidGetFocus(e){this._toggleParentClass(e,Fh,!0)}controlDidLoseFocus(e){this._toggleParentClass(e,Fh,!1)}controlWasPressed(e){this._toggleParentClass(e,Uh,!0)}controlWasReleased(e){this._toggleParentClass(e,Uh,!1)}_setSizeClass(e,t){e.classList.toggle(Rh,Rh===t),e.classList.toggle(Ph,Ph===t)}_updateAutoNaviClass(){const e=this._bottomRightControlsNode,t=this._bottomLeftControlsNode;e.classList.toggle(Oh,Ue.isAutoNavi),t.classList.toggle(Oh,Ue.isAutoNavi)}_toggleParentClass(e,t,i){const s=e.parent;s===this._topRightControlsNode&&s.classList.toggle(t,i)}_removeUserLocationControl(){!this._shouldHideControls()&&this._map.showsUserLocationControl||!this._userLocationControl||(this._setPendingControls(),this._destroyUserLocationControl(),this._updateTopRightControlsContainer(!0))}_destroyUserLocationControl(){this._userLocationControl&&(this._userLocationControl.removeEventListener(vh.EVENTS.STATE_CHANGE,this._map),this._userLocationControl.mapWasDestroyed(),this._userLocationControl.remove(),delete this._userLocationControl)}_addAndUpdateLegalNode(){this._setPendingControls(),Ue.showLegalLink&&(this._bottomLeftControlsNode.addChild(this._legalNode),this._legalNode.updateWithMapType(this._map.mapType))}_addAndUpdateLogo(){this._logo.parent||(this._setPendingControls(),this._bottomLeftControlsNode.insertBefore(this._logo,this._legalNode)),this._logo.updateWithMapNodeTint(this._map.mapNodeTint)}_setPendingControls(){this._controlsPending=!0,po.addEventListener("update",this)}_unsetPendingControls(){this._controlsPending=!1,po.removeEventListener("update",this)}_setReduceMargin(){const e=this._map.ensureVisibleFrame().size.width,t=Zs,i=t.minimumSizeToShowLogo.width,s=t.minimumSizeToShowControls.width;this.classList.toggle("mk-reduce-margin",e<i&&Wh()),this.classList.toggle("mk-reduced-vertical-margin",e<s)}_updateTopRightControlsContainer(e){const t=this._topRightControlsNode,i=t.element,s=i&&i.parentNode;if(s&&e){const e=Eo.htmlElement("div",{class:i.className});for(;i.children.length>0;)e.appendChild(i.children[0]);s.insertBefore(e,i),s.removeChild(i),t.element=e}t.element&&(t.element.className=this._getTopRightControlsClass(),t.classList.reset())}_getSizeClass(){const e=this._map.ensureVisibleFrame().size,t=Zs.maximumSizeControlsNormal;return e.width>t.width&&e.height>t.height?Ph:Rh}_getTopRightControlsClass(){const e=(this._userLocationControl?1:0)+(this._mapTypeControl?1:0);return"mk-top-right-controls-container "+zh[e]+" "+this._getSizeClass()}controlBounds(){const e=[];return[this._topRightControlsNode,this._bottomLeftControlsNode,this._bottomRightControlsNode].forEach((function(t){0!==t.children.length&&(t===this._bottomRightControlsNode?Array.prototype.push.apply(e,t.children):e.push(t))}),this),e.map((function(e){try{const t=e.element.getBoundingClientRect();if("none"===window.getComputedStyle(this._map.element).transform){const e=this._map.element.getBoundingClientRect();return new is(t.left-e.left,t.top-e.top,t.width,t.height)}return is.rectFromClientRect(t)}catch(e){return new is}}),this)}}function Wh(){return Ue.isAutoNavi||Ue.showMapsLogo}Bh.ZoomControl=oh,W.jsModules.userLocation?Bh.userLocation=W.jsModules.userLocation:W.addEventListener("load",(function e(t){t.jsModules.userLocation&&(Bh.userLocation=t.jsModules.userLocation,W.removeEventListener("load",e))}));const Zh=Bh;class Kh{constructor({container:e,fontSizeDidChange:t}){const i=document.createElement("div");this.element=i,e.appendChild(i),i.className="mk-font-size-detector",i.textContent="A",i.ariaHidden="true",this.fontSizeDidChange=t,CSS.supports("(font: -apple-system-body) and (-webkit-touch-callout: default)")?(this.defaultFontSize=this.currentFontSize=17,i.style.font="-apple-system-body"):(this.defaultFontSize=this.currentFontSize=16,i.style.fontSize="initial",i.style.fontFamily="sans-serif"),this.ratio=1,"undefined"!=typeof ResizeObserver&&(this.observer=new ResizeObserver((()=>this._sizeChanged())),this.observer.observe(i))}_sizeChanged(){if(!this.element)throw new Error;const e=parseInt(window.getComputedStyle(this.element).fontSize);if(isNaN(e)||e===this.currentFontSize)return;const t=Math.min(e/this.defaultFontSize,2);this.currentFontSize=this.defaultFontSize*t,this.ratio=t,this.fontSizeDidChange(this)}destroy(){this.observer&&(this.observer.disconnect(),this.observer=null),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.element=null)}}let jh=Math.random().toString(36);function Hh(e){if(e===jh)return;jh=e;const t="[MapKit] Authorization token is invalid.";if("string"!=typeof e)return void console.warn(t);const i=e.split(".");if(3!==i.length)return void console.warn(t);let s;try{i.pop(),s=i.map((e=>{return JSON.parse((t=e,window.atob(t)));var t}))}catch(e){return void console.warn(t)}"alg"in s[0]?"ES256"!==s[0].alg&&console.warn('[MapKit] Authorization token has incorrect "alg" value.'):console.warn('[MapKit] Authorization token has no "alg" value.'),"typ"in s[0]?"JWT"!==s[0].typ&&console.warn('[MapKit] Authorization token has incorrect "typ" value.'):console.warn('[MapKit] Authorization token has no "typ" value.'),"kid"in s[0]||console.warn('[MapKit] Authorization token has no "kid" value.');const o=Date.now(),n=1e3*parseInt(s[1].iat);if(!("iat"in s[1])||isNaN(n)?console.warn('[MapKit] Authorization token has no "iat" value.'):n>o+36e5&&console.warn('[MapKit] Authorization token may have an "iat" value that is in the future ('+new Date(n)+")."),"exp"in s[1]){const e=1e3*parseInt(s[1].exp);(e<o||isNaN(e))&&console.warn('[MapKit] Authorization token may be expired according to its "exp" value.')}"origin"in s[1]||console.warn("[MapKit] Authorization token without origin restriction is not recommended in production environments.")}for(Object.defineProperties(Fe.prototype,{canRunCSR:{get:function(){const e="CLIENT"===this.forcedRenderingMode||"HYBRID"===this.forcedRenderingMode,t="SERVER"===this.forcedRenderingMode;return!(!this.ready||t||this._disableCsr&&!e||this._syrupRequestedFallback)}},madabaDomains:{get:function(){return this.customMadabaUrl||!this._madabaDomains&&this._madabaBaseUrl?[z(this._madabaBaseUrl)]:this._madabaDomains?this._madabaDomains:null}}}),Fe.prototype.syrupRequestedFallback=function(e){this._syrupRequestedFallback=!0,this._syrupRequestedFallbackType=e,setTimeout((()=>{const e=new Pe(Fe.ChangeStatus.Refreshed);this.dispatchEvent(e)}),0)},Fe.prototype.getMadabaDomainFromStringHash=function(e){if(!this.madabaDomains)throw new Error("");const t=function(e){let t=0,i=e.length;for(;i--;)t+=e.charCodeAt(i);return t}(e);return this.madabaDomains[t%this.madabaDomains.length]},Fe.prototype._parseMapData=function(){const e=this._data;if(!e)throw new Error("");this.customMadabaUrl||!e.madabaBaseUrl&&!e.madabaDomains||(this._madabaBaseUrl=e.madabaBaseUrl??null,this._madabaDomains=e.madabaDomains&&e.madabaDomains.length?e.madabaDomains.map((e=>e.match(/^(https?:)?\/\//)?e:-1!==e.indexOf(":")&&this.proxyPrefixes?"http://"+e:Fe.PROTOCOL+"//"+e)):null),this._disableCsr=!!e.disableCsr;const t={};e.attributions&&e.attributions.forEach((e=>{t[e.attributionId]=e,this.tileGroup=e.attributionId}));const i={};e.tileSources.forEach((e=>{const s=e.tileSource;i[s]={name:s,path:e.path,domains:e.domains,proxyPrefixes:this.proxyPrefixes,withCredentials:this.withCredentials,crossOrigin:!0,protocol:e.protocol||(this.proxyPrefixes&&-1!==e.domains[0].indexOf(":")?"http:":"https:"),attribution:t[e.attributionId],minZoomLevel:e.minZoomLevel,maxZoomLevel:e.maxZoomLevel,supportedSizes:e.supportedSizes,supportedResolutions:e.supportedResolutions,showPrivacyLink:e.showPrivacyLink,showTermsOfUseLink:e.showTermsOfUseLink},i[s].attribution&&i[s].attribution.global&&(i[s].attribution.name=i[s].attribution.global[0].name,i[s].attribution.url=i[s].attribution.global[0].url)})),this.types={},this.rasterTilesForSyrup={};for(const t in e.modes){const s=e.modes[t].layers;this.types[t]={name:t,provider:this.tileProvider,countryCode:this.countryCode,lowResolutionTileSource:i[s[0].lowResTileSource],tileSources:s.map((e=>i[e.tileSource]))},this.rasterTilesForSyrup[t]={name:t,provider:this.tileProvider,countryCode:this.countryCode,tileSources:s.map((e=>i[e.tileSource]))}}},Ue._data&&Ue._parseMapData(),Fe.prototype._checkJwtToken=Hh;Ue._jwtTokensToCheck.length;){const e=Ue._jwtTokensToCheck.shift();Ue._checkJwtToken(e)}function Vh(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const qh=Us,Yh=Eo.supportsTouches,Xh=new fi(0,0,1,1),$h="mk-panning",Jh="mk-dragging-cursor",Qh="mk-dragging-annotation",ec="InitializedWithoutConfiguration",tc="Initialized",ic="ReadyWithoutConfiguration",sc="Ready",oc="Rendered",nc="Switched",ac="Destroyed",rc={padding:"rw",isScrollEnabled:"rw",isZoomEnabled:"rw",center:"rw",region:"rw",rotation:"rw",isRotationEnabled:"rw",showsCompass:"rw",visibleMapRect:"rw",tintColor:"rw",annotations:"rw",selectedAnnotation:"rw",overlays:"rw",selectedOverlay:"rw",showsUserLocation:"rw",tracksUserLocation:"rw",mapType:"rw",contextType:"rw",colorScheme:"rw",_allowWheelToZoom:"rw",_allowWheelToZoom2:"rw",_showsDefaultTiles:"rw",_internalAppDelegate:"rw",loadPriority:"rw",showsPointsOfInterest:"rw",showsMapTypeControl:"rw",showsZoomControl:"rw",showsScale:"rw",showsUserLocationControl:"rw",pointOfInterestFilter:"rw",annotationForCluster:"rw",cameraDistance:"rw",cameraZoomRange:"rw",cameraZoomLimit:"rw",cameraBoundary:"rw",distances:"rw",tileOverlays:"rw",selectableMapFeatures:"rw",selectableMapFeatureSelectionAccessory:"rw",annotationForMapFeature:"rw",_unifiedCanvas:"rw",_textZoom:"rw",element:"ro",userLocationAnnotation:"ro"};function lc(e,t){return new Error(1===t.length?`[MapKit] mapkit.Map.${e} is available after loading the following library: ${t.join(", ")}.`:`[MapKit] mapkit.Map.${e} is available after loading one of the following libraries: ${t.join(", ")}.`)}const hc=Ue.performanceMarkers.loading,cc=Ue.performanceMarkers.rendering,dc=Ue.performanceMarkers["frame-updates"];dc&&po.setPerformanceMeasureName("mapkit-dom-update-frame");const uc="mk-dark-mode",pc="zoom-start",mc="zoom-end",gc="select",_c="deselect",fc="region-change-start",yc="region-change-end",vc="scroll-start",bc="scroll-end",wc="map-type-change",Cc="rotation-start",kc="rotation-change",Mc="rotation-end",Sc="single-tap",Lc="double-tap",xc="long-press",Ac="map-node-change",Ec="map-node-ready",Tc="complete",Ic="error",Oc="start-up-complete";class Rc{constructor(e,t,i){Vh(this,"_showsUserLocation",!1),Vh(this,"_tracksUserLocation",!1),Vh(this,"_tintColor",""),Vh(this,"_annotationForCluster",null),Vh(this,"_emphasis",Fs.Standard),Vh(this,"currentColorScheme",null),Vh(this,"tint",null),Vh(this,"_forcedInteractionCenter",null),Vh(this,"shouldDispatchRotationChangeEvent",!1),Vh(this,"selectionMayChange",!0),Vh(this,"unifiedCanvas",!1),Vh(this,"_completedOnce",!1),Vh(this,"_mapStabilizationTimeout",null),hc&&performance.mark("mapkit-map-start"),Ue.state!==Ue.States.UNINITIALIZED&&Vr(),Ue.state===Ue.States.READY?this.state=tc:this.state=ec,e._impl=this;try{(t=this._checkParent(t))&&(this._bootstrapSize=new es(t.offsetWidth,t.offsetHeight)),this.public=e,Rc.maps.push(this.public),i=_(i),this._checkOptions(i),void 0!==i._internalAppDelegate&&(this.public._internalAppDelegate=i._internalAppDelegate),this._setDefaultState(i),this._setupScene(),this._setupRenderTree(),this._setupControllers(i);const s=void 0!==i.isRotationEnabled;this._setIsRotationEnabled(!s||i.isRotationEnabled,s),void 0!==i.selectableMapFeatures&&(this.selectableMapFeatures=i.selectableMapFeatures),void 0!==i.selectableMapFeatureSelectionAccessory&&(this.selectableMapFeatureSelectionAccessory=i.selectableMapFeatureSelectionAccessory),this._flushToDOM(t),this._handleOptions(i,t),this._setupListeners(),bt.scheduleOnNextFrame(this)}catch(e){throw this.destroy(),e}finally{0,hc&&performance.measure("mapkit-map-constructor","mapkit-map-start")}}get padding(){return this._padding.copy()}set padding(e){if(m(e,dn,"[MapKit] The `padding` parameter passed to `Map.padding` is not a Padding."),this._padding.equals(e))return;this._padding=e.copy();const t=this.ensureRenderingFrame();if(!t.equals(is.Zero)){this.rotation=0;const e=this._mapRectAccountingForPadding(),i=e.midX(),s=e.midY();this._setRenderingFrameValue(t);const o=this._mapRectAccountingForPadding(),n=i-o.midX(),a=s-o.midY(),r=new fi(o.minX()+n,o.minY()+a,o.size.width,o.size.height);this.setVisibleMapRectAnimated(r,!1)}this.controlsLayer&&this.controlsLayer.mapPaddingDidChange(this._adjustedPadding)}get isScrollEnabled(){return this._mapNode.pannable}set isScrollEnabled(e){this._mapNode.pannable=!!e,this._mapUserInteractionController.updateGestureEnableState()}get isZoomEnabled(){return this._mapNode.zoomable}set isZoomEnabled(e){this._mapNode.zoomable=!!e,this.controlsLayer&&this.controlsLayer.updateZoomControl(),this._mapUserInteractionController.updateGestureEnableState()}get snapsToIntegralZoomLevels(){return this._mapNode.snapsToIntegralZoomLevels}set snapsToIntegralZoomLevels(e){this._mapNode.snapsToIntegralZoomLevels=!!e}get showsZoomControl(){return this._showsZoomControl}set showsZoomControl(e){(e=!!e)!==this._showsZoomControl&&(this._showsZoomControl=e,this.controlsLayer&&(this.controlsLayer.updateZoomControl(),this.controlsLayer.updateScale()))}get showsScale(){return this._showsScale}set showsScale(e){d(e,qh)?e!==this._showsScale&&(this._showsScale=e,this.controlsLayer&&this.controlsLayer.updateScale()):console.warn("[MapKit] value passed to `Map.showsScale` setter must be part of the mapkit.FeatureVisibility enum.")}get mapType(){return this._mapType}set mapType(e){e!==this._mapType&&(Dc(e,Rc.MapTypes,"mapType","Map.MapTypes"),this._setMapTypeAndEmphasis(e,this._emphasis))}getMapTypeWithEmphasis(){return this._mapType===Rc.MapTypes.Standard&&this._emphasis===Fs.Muted?Rc.MapTypes.MutedStandard:this._mapType}setMapTypeWithEmphasis(e){let t=Fs.Standard;e===Rc.MapTypes.MutedStandard?(e=Rc.MapTypes.Standard,t=Fs.Muted):Dc(e,Rc.MapTypes,"mapType","Map.MapTypes"),t===this._emphasis&&e===this._mapType||this._setMapTypeAndEmphasis(e,t)}_setMapTypeAndEmphasis(e,t){this._mapType=e,this._emphasis=t,this._annotationsController&&this._annotationsController.mapTypeDidChange(),this._updateMapNodeTintAndEmphasis(this._mapNode),this._mapNodeController.handleMapConfigurationChange(),this.controlsLayer&&this.controlsLayer.update(),this.public.dispatchEvent(new Be.Event(wc)),this._logWithMap(Vt.Events.MapTypeChange)}get distances(){return this._distances}set distances(e){e!==this._distances&&(Dc(e,Rc.Distances,"distances","Map.Distances"),this._distances=e,this.controlsLayer&&this.controlsLayer.updateScale())}get colorScheme(){return this._colorScheme}set colorScheme(e){e!==this._colorScheme&&(Dc(e,Rc.ColorSchemes,"colorScheme","Map.ColorSchemes"),this._colorScheme===qe.Adaptive&&(this._colorSchemeHandle.removeEventListener("change",this._boundDarkModeDidChange),Xe.removeHandle(this._colorSchemeHandle),this._colorSchemeHandle=null),this._colorScheme=e,e===qe.Adaptive&&(this._colorSchemeHandle=Xe.addHandle(),this._boundDarkModeDidChange=()=>this._updateMapNodeTintAndEmphasis(this._mapNode),this._colorSchemeHandle.addEventListener("change",this._boundDarkModeDidChange)),this._updateMapNodeTintAndEmphasis(this._mapNode))}get tileTint(){return this._mapNode.tileTint}get _allowWheelToZoom(){return this._mapNode.allowWheelToZoom}set _allowWheelToZoom(e){this._mapNode.allowWheelToZoom=e}get _allowWheelToZoom2(){return this._mapNode.allowWheelToZoom2}set _allowWheelToZoom2(e){this._mapNode.allowWheelToZoom2=e}get loadPriority(){return this._mapNodeController.loadPriority}set loadPriority(e){d(e,Rc.LoadPriorities)?this._mapNodeController.loadPriority=e:console.warn("[MapKit] Unknown value for `loadPriority`. Choose from mapkit.Map.LoadPriorities.")}get _showsTileInfo(){return this._mapNode._impl.debug}set _showsTileInfo(e){this._mapNode._impl.debug=e}get _showsDefaultTiles(){return this._mapNode.showsDefaultTiles}set _showsDefaultTiles(e){this._mapNode.showsDefaultTiles=e}get tileOverlays(){return this._mapNode.tileOverlays}set tileOverlays(e){this._mapNode.tileOverlays=e,this.controlsLayer&&this.controlsLayer.updateZoomControl()}addTileOverlay(e){if(!this._overlaysController)throw lc("addTileOverlay",["overlays"]);const t=this._mapNode.addTileOverlay(e);return this.controlsLayer&&this.controlsLayer.updateZoomControl(),t}addTileOverlays(e){if(!this._overlaysController)throw lc("addTileOverlays",["overlays"]);const t=this._mapNode.addTileOverlays(e);return this.controlsLayer&&this.controlsLayer.updateZoomControl(),t}removeTileOverlay(e){if(!this._overlaysController)throw lc("removeTileOverlay",["overlays"]);const t=this._mapNode.removeTileOverlay(e);return this.controlsLayer&&this.controlsLayer.updateZoomControl(),t}removeTileOverlays(e){if(!this._overlaysController)throw lc("removeTileOverlays",["overlays"]);const t=this._mapNode.removeTileOverlays(e);return this.controlsLayer&&this.controlsLayer.updateZoomControl(),t}get showsMapTypeControl(){return this._showsMapTypeControl}set showsMapTypeControl(e){(e=!!e)!==this._showsMapTypeControl&&(this._showsMapTypeControl=e,this.controlsLayer&&this.controlsLayer.updateMapTypeControl())}get showsUserLocationControl(){return!!this._userLocationController&&this._showsUserLocationControl}set showsUserLocationControl(e){if((e=!!e)!==this._showsUserLocationControl){if(!this._userLocationController)throw lc("showsUserLocationControl",["user-location"]);this._showsUserLocationControl=e,this.controlsLayer&&(this.controlsLayer.updateUserLocationControl(),this.controlsLayer.updateScale())}}get showsPointsOfInterest(){return null===this.pointOfInterestFilter||null===this.pointOfInterestFilter._includes&&0===this.pointOfInterestFilter._excludes.length}set showsPointsOfInterest(e){if(e){if(null===this.pointOfInterestFilter)return;this.pointOfInterestFilter=null}else{if(this.pointOfInterestFilter===Ve.filterExcludingAllCategories)return;this.pointOfInterestFilter=Ve.filterExcludingAllCategories}}get pointOfInterestFilter(){return this._mapNode.pointOfInterestFilter}set pointOfInterestFilter(e){null!==e&&m(e,Ve,"[MapKit] Value passed to `Map.pointOfInterestFilter` setter must be an instance of mapkit.PointOfInterestFilter."),this._mapNode.pointOfInterestFilter=e,this._mapNodeController.setPointOfInterestFilter(e)}setPoiFiltered(e,t){this._mapNode.setPoiFiltered(e,t)}get element(){return this.rootNode&&this.rootNode.element}set element(e){console.warn("[MapKit] The `element` property is read-only.")}get renderingMapRect(){return this._mapNode.visibleMapRect}get visibleMapRect(){return this._visibleMapRect||(this._visibleMapRect=this._mapRectAccountingForPadding()),this._visibleMapRect}set visibleMapRect(e){this.setVisibleMapRectAnimated(e,!1)}setVisibleMapRectAnimated(e,t,i){u(e,"[MapKit] Missing `visibleMapRect` parameter in call to `Map.setVisibleMapRectAnimated()`."),m(e,fi,"[MapKit] The `visibleMapRect` parameter passed to `Map.setVisibleMapRectAnimated()` is not a MapRect.");const s=this.ensureRenderingFrame();if(0===s.size.width||0===s.size.height)this._visibleMapRect=e;else{delete this._visibleMapRect;const t=this._visibleFrame;let i=e;const o=this._adjustedPadding;if(!o.equals(dn.Zero)){const n=s.size.width/t.size.width,a=s.size.height/t.size.height;i=new fi(e.minX()-o.left*n*e.size.width,e.minY()-o.top*a*e.size.height,e.size.width*n,e.size.height*a)}const n=new gi(e.midX(),e.midY());let a=vi.zoomLevelForMapRectInViewport(i,s.size,vi.tileSize);a=c(this._mapNode.snapsToIntegralZoomLevels?Eo.getIntegralZoom(a):a,this.minZoomLevel,this.maxZoomLevel);const r=Math.pow(2,Math.ceil(a))*(vi.tileSize*Math.pow(2,a-Math.ceil(a))),l=new _i(t.size.width/r,t.size.height/r);e=new fi(n.x-l.width/2,n.y-l.height/2,l.width,l.height)}return t=null==t||!!t,this._setVisibleMapRect(e,t,i),delete this._delayedShowItems,this.public}get region(){return this.visibleMapRect.toCoordinateRegion()}set region(e){this.setRegionAnimated(e,!1)}setRegionAnimated(e,t,i){return u(e,"[MapKit] Tried to set `Map.region` property to a non-existent value."),m(e,di,"[MapKit] Region passed to `Map.region` setter is not a CoordinateRegion."),this.region.equals(e)||this.setVisibleMapRectAnimated(e.toMapRect(),t,i),this.public}get isRotationAvailable(){return"HYBRID"===Ue.forcedRenderingMode||"CLIENT"===Ue.forcedRenderingMode?!Ue.didFallback&&this.csrCapable:Ue.ready||Ue.didFallback?Ue.canRunCSR&&this.csrCapable:this.csrCapable}set isRotationAvailable(e){console.warn("[MapKit] Map.isRotationAvailable is a read-only property")}get isRotationEnabled(){return this._mapNode.isRotationEnabled}set isRotationEnabled(e){this._setIsRotationEnabled(e,!0)}get isRotationLocked(){return this._mapNode.isRotationLocked}get rotation(){return this._mapNode.rotation}set rotation(e){this.setRotationAnimated(e,!1),this.controlsLayer&&this.controlsLayer.updateRotationControl()}get heading(){const e=this._mapNode.rotation;return 0===e?0:360-e}get showsCompass(){return this.usingCSR?this._showsCompass:qh.Hidden}set showsCompass(e){d(e,qh)?(this.isRotationEnabled||e!==qh.Visible&&e!==qh.Adaptive||console.warn("[MapKit] The compass cannot be shown when `Map.isRotationEnabled` is false."),this._usingDefaultShowsCompassValue=!1,e!==this._showsCompass&&(this._showsCompass=e,this.controlsLayer&&this.controlsLayer.updateRotationControl())):console.warn("[MapKit] value passed to `Map.showsCompass` setter must be part of the MapKit.FeatureVisibility enum.")}get usingCSR(){return!this._mapNodeController.usingSSR}compassRotate(e,t){if(t){if(this.isRotationLocked){const t=l(e,360),i=Eo.restrictRotation(t);e=t<180?i+.025*(t-i):i-.025*(i-t)}Math.abs(e)<5&&(e=0)}else this.isRotationLocked&&(e=Eo.restrictRotation(l(e,360)));return this.setRotationAnimated(e,!1,!0),e}setRotationAnimated(e,t,i){if(!this.isRotationAvailable)return void console.warn("[MapKit] Rotation is not available.");if(u(e,"[MapKit] Tried to set `Map.rotation` property to a non-existent value."),"number"!=typeof e||!isFinite(e))return void console.warn("[MapKit] Argument for `Map.rotation` is not a finite number.");this.isRotationLocked&&0!==e&&console.warn("[MapKit] Rotation is not available on this zoom.");const s=this.forcedInteractionCenter?this.forcedInteractionCenter:this._centerMapPoint(),o=l(e,360)-this._mapNode.getRotation();if(!o)return;const n=(t||null==t||!i)&&this.mapCanStartRotating();if((t||null==t)&&n){const e=this.camera.copy();e.rotateAroundCenter(s,o),this._mapNode.setCameraAnimated(e,!0,s)}else(n||i)&&this._mapNode.rotateCameraAroundMapPoint(s,o),i||this.mapDidStopRotating();return this.public}get center(){return this._centerMapPoint().toCoordinate()}set center(e){this.setCenterAnimated(e,!1)}setCenterAnimated(e,t,i){u(e,"[MapKit] Tried to set `Map.center` property to a non-existent value."),m(e,pi,"[MapKit] Value passed to `Map.center` setter is not a Coordinate object.");const s=this.ensureRenderingFrame();if(0!==s.size.width&&0!==s.size.height){const t=this._offsetCenterWithPaddingAndRotation(e.toMapPoint(),-1);t&&(e=t.toCoordinate())}return this._mapNode.setCenterAnimated(e,null==t||!!t),delete this._visibleMapRect,i||(this.tracksUserLocation=!1),this.public}get cameraZoomLevelLimit(){return this._mapNode.cameraZoomLimit}set cameraZoomLevelLimit(e){this.setCameraZoomLevelLimitAnimated(e,!1)}setCameraZoomLevelLimitAnimated(e,t){return this._mapNode.setCameraZoomLevelLimitAnimated(e,null==t||!!t),this.public}get cameraZoomRange(){return this._mapNode.cameraZoomRange}set cameraZoomRange(e){this.setCameraZoomRangeAnimated(e,!1)}setCameraZoomRangeAnimated(e,t){return null!=e&&m(e,yi,"[MapKit] Expected a `mapkit.CameraZoomRange` object for `Map.cameraZoomRange`, but got `"+e+"` instead."),this._mapNode.setCameraZoomRangeAnimated(e,null==t||!!t),this.public}get cameraDistance(){return this._mapNode.getCurrentCameraDistance()}set cameraDistance(e){this.setCameraDistanceAnimated(e,!1)}setCameraDistanceAnimated(e,t){if(!(e>=0))throw new Error("[MapKit] Expected a number for Map.cameraDistance, but got `"+e+"` instead");return this._mapNode.setCameraDistanceAnimated(e,null==t||!!t),this.public}get cameraBoundary(){const e=this._cameraBoundary;return e?{region:e.toCoordinateRegion?e.toCoordinateRegion():e.copy(),mapRect:e.toMapRect?e.toMapRect():e.copy()}:null}set cameraBoundary(e){this.setCameraBoundaryAnimated(e,!1)}setCameraBoundaryAnimated(e,t){let i=null;if(null==e)delete this._cameraBoundary;else if(e instanceof di)i=e.toMapRect(),this._cameraBoundary=e.copy();else{if(!(e instanceof fi))throw new Error("[MapKit] `Map.cameraBoundaryRect` expected a CoordinateRegion or a MapRect, but got `"+e+"` instead.");i=e,this._cameraBoundary=i.copy()}const s=this._centerMapPoint();return this._mapNode.setCameraBoundaryAnimated(i,null==t||!!t),this.tracksUserLocation&&!this._mapNode.isMapPointWithinBounds(s)&&(this.tracksUserLocation=!1),this.public}get overlays(){return this._overlaysController?this._overlaysController.items:[]}set overlays(e){if(!this._overlaysController)throw lc("overlays",["overlays"]);this._overlaysController.items=e}get selectedOverlay(){return this._overlaysController?this._overlaysController.selectedItem:null}set selectedOverlay(e){if(!this._overlaysController)throw lc("selectedOverlay",["overlays"]);this._overlaysController.selectedItem=e}addOverlay(e){if(this._overlaysController)return this._overlaysController.addItem(e);throw lc("addOverlay",["overlays"])}addOverlays(e){if(this._overlaysController)return this._overlaysController.addItems(e),e;throw lc("addOverlays",["overlays"])}removeOverlay(e){if(this._overlaysController)return this._overlaysController.removeItem(e);throw lc("removeOverlay",["overlays"])}removeOverlays(e){if(this._overlaysController)return this._overlaysController.removeItems(e);throw lc("removeOverlays",["overlays"])}topOverlayAtPoint(e){if(!this._overlaysController)throw lc("topOverlayAtPoint",["overlays"]);m(e,window.DOMPoint,"[MapKit] Map.topOverlayAtPoint expected a DOMPoint, but got `"+e+"` instead.");const t=this.rootNode.convertPointFromPage(e),i=this._overlaysController.pickableItemsCloseToPoint(this.overlays,t,0),s=this.selectedOverlay;return s&&i.indexOf(s)>0?s:i[0]}overlaysAtPoint(e){if(!this._overlaysController)throw lc("overlaysAtPoint",["overlays"]);m(e,window.DOMPoint,"[MapKit] Map.overlaysAtPoint expected a DOMPoint, but got `"+e+"` instead.");const t=this.rootNode.convertPointFromPage(e);return this._overlaysController.pickableItemsCloseToPoint(this.overlays,t,0).reverse()}get annotations(){if(this._annotationsController)return this._annotationsController.items;throw lc("annotations",["annotations"])}set annotations(e){if(!this._annotationsController)throw lc("annotations",["annotations"]);this._annotationsController.items=e}get selectedAnnotation(){if(this._annotationsController)return this._annotationsController.selectedItem;throw lc("selectedAnnotation",["annotations"])}set selectedAnnotation(e){if(!this._annotationsController)throw lc("selectedAnnotation",["annotations"]);this._annotationsController.selectedItem=e}addAnnotation(e){if(this._annotationsController)return this._annotationsController.addItem(e);throw lc("addAnnotation",["annotations"])}addAnnotations(e){if(this._annotationsController)return this._annotationsController.addItems(e);throw lc("addAnnotations",["annotations"])}removeAnnotation(e){if(this._annotationsController)return this._annotationsController.removeItem(e);throw lc("removeAnnotation",["annotations"])}removeAnnotations(e){if(this._annotationsController)return this._annotationsController.removeItems(e);throw lc("removeAnnotations",["annotations"])}showItems(e,t){if(!Rc.LayerItemsController||!Rc.ItemCollection)throw lc("showItems",["annotations","overlays","user-location"]);const i=new Rc.ItemCollection(e).getFlattenedItemList();t=Rc.LayerItemsController.checkShowItemsParameters(i,t);const s=[],o=[];return i.forEach((function(e){Rc.OverlaysController&&e instanceof Rc.OverlaysController.Overlay&&!e.map&&(e._impl._map=this.public,s.push(e)),Rc.AnnotationsController&&e instanceof Rc.AnnotationsController.Annotation&&this._annotationsController&&this._annotationsController.preAddedAnnotation(e)&&o.push(e)}),this),this.isRooted()&&Rc.LayerItemsController.setRegionForItems(this,i,t)||(this._delayedShowItems=[i,t]),s.forEach((e=>{delete e._impl._map})),o.forEach((e=>this._annotationsController.resetAnnotation(e))),this._addItems(i),e}addItems(e){if(!Rc.ItemCollection)throw lc("addItems",["annotations","overlays","user-location"]);const t=new Rc.ItemCollection(e).getFlattenedItemList();return this._addItems(t),e}removeItems(e){if(!Rc.ItemCollection)throw lc("removeItems",["annotations","overlays","user-location"]);const t=new Rc.ItemCollection(e).getFlattenedItemList(),i=[],s=[];return t.forEach(((e,t)=>{const o=Rc.OverlaysController&&e instanceof Rc.OverlaysController.Overlay,n=Rc.AnnotationsController&&e instanceof Rc.AnnotationsController.Annotation;if(!o&&!n)throw new Error("[MapKit] Map.removeItems expected an Annotation, Overlay, ItemCollection, or Array of valid items at index "+t+", but got `"+e+"` instead.");o?i.push(e):s.push(e)}),this),this.removeOverlays(i),this.removeAnnotations(s),e}addLayerAbove(e,t){return this._mapNodeController.addLayerAbove(e,t)}addLayerBelow(e,t){return this._mapNodeController.addLayerBelow(e,t)}removeLayer(e){return this._mapNodeController.removeLayer(e)}requireRender(){return this._mapNodeController.requireRender()}annotationsInMapRect(e){if(this._annotationsController)return this._annotationsController.annotationsInMapRect(e);throw lc("annotationsInMapRect",["annotations"])}updateSize(e){return console.warn("[MapKit] Map resizing is now automatic, the Map.updateSize() method has been deprecated and will be removed in a future version."),this.public}convertCoordinateToPointOnPage(e){m(e,pi,"[MapKit] Map.convertCoordinateToPointOnPage expected a Coordinate, but got `"+e+"` instead.");const t=e.toMapPoint();t.x<this.camera.minX()&&(t.x+=1);const i=this.camera.transformMapPoint(t),s=this.rootNode.convertPointToPage(i);return new window.DOMPoint(s.x,s.y)}convertPointOnPageToCoordinate(e){m(e,window.DOMPoint,"[MapKit] Map.convertPointOnPageToCoordinate expected a DOMPoint, but got `"+e+"` instead.");const t=this.camera.transformGestureCenter(this.rootNode.convertPointFromPage(new ts(e.x,e.y))),i=this.renderingMapRect.origin;return new pi(vi.convertYToLatitude(i.y+t.y/this.worldSize),vi.convertXToLongitude(i.x+t.x/this.worldSize))}get showsUserLocation(){return!!this._userLocationController&&this._userLocationController.showsUserLocation}set showsUserLocation(e){if((e=!!e)!==this.showsUserLocation){if(!this._userLocationController)throw lc("showsUserLocation",["user-location"]);this._userLocationController.showsUserLocation=e,e||(this._removeUserLocationDisplay(),this.tracksUserLocation=!1),this.showsUserLocationControl&&this.controlsLayer&&(this.controlsLayer.updateUserLocationControl(),this.controlsLayer.updateScale())}}get userLocationAnnotation(){return this._userLocationController?this._annotationsController.userLocationAnnotation:null}get tracksUserLocation(){return!!this._userLocationController&&this._userLocationController.tracksUserLocation}set tracksUserLocation(e){if((e=!!e)!==this.tracksUserLocation){if(!this._userLocationController)throw lc("tracksUserLocation",["user-location"]);this._userLocationController.tracksUserLocation=e,this._mapNode.usesInteractionCenter=!(!e&&!this.forcedInteractionCenter),e?this.showsUserLocation=!0:this.userLocationAnnotation||(this.showsUserLocation=!1),this._firstCameraUpdateToTrackUserLocationPending=e,this._updateCameraToTrackUserLocation(this._userLocationController.userLocation),this._userLocationController.tracksUserLocation===e&&(this.controlsLayer&&this.controlsLayer.updateUserLocationControl(),this._userLocationTrackingDelegate&&"function"==typeof this._userLocationTrackingDelegate.mapUserLocationTrackingDidChange&&this._userLocationTrackingDelegate.mapUserLocationTrackingDidChange(this.public))}}get forcedInteractionCenter(){return this._forcedInteractionCenter}set forcedInteractionCenter(e){this._forcedInteractionCenter=e,this._mapNode.usesInteractionCenter=!(!this.tracksUserLocation&&!e)}get tintColor(){return this._tintColor}set tintColor(e){if(e!==this._tintColor){if(null!=e){if(p(e,"string","[MapKit] Expected a string value for Map.tintColor, but got `"+e+"` instead"),""!==e&&!Eo.isValidCSSColor(e))return void console.warn("[MapKit] value passed to `Map.tintColor` is not a valid color value. Ignoring: "+e);this._tintColor=e}else this._tintColor="";this.controlsLayer&&this.controlsLayer.update()}}get tintColorForControls(){return Eo.darkColorScheme(this.mapNodeTint)?"":this._tintColor}get minZoomLevel(){return this._mapNode.minZoomLevel}get maxZoomLevel(){return this._mapNode.maxZoomLevel}get zoomLevel(){return this._mapNode.zoomLevel}get canZoomIn(){const e=this.snapsToIntegralZoomLevels?Math.floor(this.maxZoomLevel):this.maxZoomLevel-.01;return this.zoomLevel<e}get canZoomOut(){const e=this.snapsToIntegralZoomLevels?Math.ceil(this.minZoomLevel):this.minZoomLevel+.01;return this.zoomLevel>e}set zoomLevel(e){this._mapNode.zoomLevel=e}get worldSize(){return vi.pointsPerAxis(this._mapNode.zoomLevel)}get camera(){return this._mapNodeController.node.camera}get cameraIsPanning(){return this._mapNode.cameraIsPanning}get cameraIsZooming(){return this._mapNode.cameraIsZooming}get cameraIsRotating(){return this._mapNode.cameraIsRotating}get cameraIsAnimating(){return this._mapNode.cameraIsAnimating}get cameraIsMoving(){return this.cameraIsPanning||this.cameraIsZooming||this.cameraIsRotating||this.cameraIsAnimating}get _mapNode(){return this._mapNodeController.node}get csrCapable(){return this._mapNodeController.csrCapable}destroy(){if(this.state===ac)return void console.warn("[MapKit] Map was already destroyed.");this.state=ac,this._annotationsController&&this.removeAnnotations(this.annotations),this._overlaysController&&this.removeOverlays(this.overlays),this._stopStabilizationTimeout(),this._linearZoomController?.stop(),this.showsUserLocation&&this._removeUserLocationDisplay(),this.controlsLayer?.mapWasDestroyed(),this.controlsLayer=null,this._mapUserInteractionController?.mapWasDestroyed(),this._overlaysController?.mapWasDestroyed(),this._annotationsController?.mapWasDestroyed(),this._userLocationController?.mapWasDestroyed(),this._linearZoomController?.mapWasDestroyed(),this._linearZoomController=null,this._colorSchemeHandle&&(Xe.removeHandle(this._colorSchemeHandle),this._colorSchemeHandle=null),Ue.removeEventListener(Ue.Events.Changed,this),Vi.removeEventListener(Vi.Events.LocaleChanged,this),this._dppxMediaQueryList?.removeListener(this._boundDevicePixelRatioDidChange),this._dppxMediaQueryList=null,this._boundDevicePixelRatioDidChange=null,this._iframe&&(this._iframe.removeEventListener("load",this),this._iframe.contentWindow&&this._iframe.contentWindow.removeEventListener("resize",this),this.element.removeChild(this._iframe),this._iframe=null),this._resizeObserver?.disconnect(),this._resizeObserver=null,this._mapNodeController?.destroy(),this._mapRoot?.remove(),this._mapRoot=null,this._scene?.destroy(),this._scene=null,this._removePrintListener(),this.textZoom&&(this.textZoom=!1),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.rootNode?.remove(),this.rootNode=null;const e=Rc.maps.indexOf(this.public);e>=0&&Rc.maps.splice(e,1)}adjustMapItemPoint(e){return this._mapNode.adjustMapItemPoint(e)}get annotationForCluster(){return this._annotationForCluster}set annotationForCluster(e){if(null==e)this._annotationForCluster=null;else{if("function"!=typeof e)throw new Error("[MapKit] annotationForCluster must be a function or null");this._annotationForCluster=e}}get selectableMapFeatures(){return this._selectableMapFeatures?Ue.ready&&(Ue.didFallback||!Ue.canRunCSR)||!this.csrCapable||"SERVER"===Ue.forcedRenderingMode?[]:this._selectableMapFeatures.slice():[]}set selectableMapFeatures(e){if(null==e)return delete this._selectableMapFeatures,void this._mapFeaturesLayerController.node.remove();if(!Rc.MapFeatureType)throw lc("selectableMapFeatures",["annotations"]);g(e,"[MapKit] Map.selectableMapFeatures expected an array of values, but got `"+e+"` instead."),e.forEach((e=>{Dc(e,Rc.MapFeatureType,"MapFeatureType","mapkit.MapFeatureType")}));const t=[];if(Object.values(Rc.MapFeatureType).forEach((i=>{-1!==e.indexOf(i)&&t.push(i)})),0===t.length)return delete this._selectableMapFeatures,void this._mapFeaturesLayerController.node.remove();(!Ue.ready||!Ue.didFallback&&Ue.canRunCSR)&&this.csrCapable&&"SERVER"!==Ue.forcedRenderingMode||console.warn("[MapKit] Selectable map features is not available."),this._selectableMapFeatures=t,this._updateMapFeatureRegionLayer()}get selectableMapFeatureSelectionAccessory(){return this._selectableMapFeatureSelectionAccessory?this._selectableMapFeatureSelectionAccessory:null}set selectableMapFeatureSelectionAccessory(e){if(!Rc.PlaceSelectionAccessory)throw lc("selectableMapFeatureSelectionAccessory",["annotations"]);null!==e&&m(e,Rc.PlaceSelectionAccessory,"[MapKit] The `selectableMapFeatureSelectionAccessory` parameter passed to `Map.selectableMapFeatureSelectionAccessory` is not a PlaceSelectionAccessory."),this._selectableMapFeatureSelectionAccessory=e}get annotationForMapFeature(){return this._annotationForMapFeature}set annotationForMapFeature(e){if(null==e)delete this._annotationForMapFeature;else{if("function"!=typeof e)throw new Error("[MapKit] annotationForMapFeature must be a function or null");this._annotationForMapFeature=e}}handleEvent(e){const t=Rc.ControlsLayer?Rc.ControlsLayer.ZoomControl.EVENTS.ZOOM_START:void 0,i=Rc.ControlsLayer?Rc.ControlsLayer.ZoomControl.EVENTS.ZOOM_END:void 0;switch(e.type){case Ue.Events.Initialized:Vr();break;case Ue.Events.Changed:this._configurationDidBecomeAvailable();break;case t:this.zoomControlStart(e.zoomIn);break;case i:this.zoomControlEnd();break;case Vi.Events.LocaleChanged:this._handleLocaleChange(e);break;case"load":this._iframeDidLoad();break;case"resize":this._sizeDidChange()}}elementShouldPreventDragstart(e){return!!this._annotationsController&&!this._annotationsController.isElementInCustomCallout(e)}elementWantsDefaultBrowserBehavior(e,t,i){if(t&&i&&("touchstart"===t.type||"pointerdown"===t.type&&"touch"===t.pointerType)){if(1===i&&!this.isScrollEnabled)return!0;if(2===i&&!this.isZoomEnabled&&!this.isRotationEnabled)return!0}return!!this._annotationsController&&this._annotationsController.isElementInAccessory(e)}getEventTargetFromSubShadowDOM(e){const t=e.touches?e.touches[0].target:e.target;return Eo.supportsShadowDOM&&this._annotationsController&&t===this._annotationsController.node.element&&this._annotationsController.getShadowDOMTargetFromEvent(e)||t}tileAccessForbidden(){Ue.accessKeyHasExpired()}previousMapDidFinishRendering(e){hc&&performance.measure("mapkit-map-start-up-rendered","mapkit-map-start"),this.state!==ac&&this.public.dispatchEvent(new Be.Event(Oc))}mapDidFinishRendering(e){this.state!==ac&&(this.state=oc,this._controlsLayer||setTimeout((()=>this._loadControlsLayer(!1))),this._mapNodeController.handleMapRendered(),this.addWaitingAnnotations(),this._startStabilizationTimeoutIfNeeded())}mapCanStartPanning(e){return this._panningWasPrevented?(delete this._panningWasPrevented,!1):!(this.tracksUserLocation&&this.cameraIsZooming||this._annotationsController&&this._annotationsController.dragging||this._isInitialInteractionTargetInUIElement()||!this.public.dispatchEvent(new Be.Event(vc)))}mapWillStartPanning(e){this._stopStabilizationTimeout(),this.tracksUserLocation=!1,this.rootNode.classList.add($h),"drag"===e.currentGestureType&&this.rootNode.classList.add(Jh),this._annotationsController&&this._annotationsController.node.classList.add($h),Vt._trackPanEvent&&this._logWithMap(Vt.Events.Pan)}mapWillStopPanning(e){this.rootNode.classList.remove(Jh)}mapDidStopPanning(e){this._startStabilizationTimeoutIfNeeded(),this.rootNode.classList.remove($h),this._annotationsController&&this._annotationsController.node.classList.remove($h),this.public.dispatchEvent(new Be.Event(bc))}mapCanStartZooming(e){return!(this._isInitialInteractionTargetInUIElement()||!this.public.dispatchEvent(new Be.Event(pc)))}mapWillStartZooming(e,t,i,s){this._stopStabilizationTimeout(),s&&(this.tracksUserLocation=!1),this._logWithMap(Vt.Events.Zoom,{eventValue:t})}mapDidStopZooming(e){this._startStabilizationTimeoutIfNeeded(),this.public.dispatchEvent(new Be.Event(mc)),this.controlsLayer&&this.controlsLayer.scaleDidChange()}mapCameraWillChange(e,t){this.mapNodeCameraBeforeChange=e.camera}mapCameraDidChange(e,t){if(this.state===ac)return;const i=this.mapNodeCameraBeforeChange;delete this.mapNodeCameraBeforeChange,delete this._visibleMapRect,this._mapNodeController.mapCameraDidChange(),this._overlaysController&&this._overlaysController.mapCameraDidChange(),this._annotationsController&&this._annotationsController.updateVisibleAnnotations();const s=!i||i.rotation!==e.camera.rotation;s&&this._dispatchRotationChangeEvent(),this.controlsLayer&&(this.controlsLayer.scaleDidChange(),s&&this.controlsLayer.updateRotationControl())}mapCameraChangesWillStart(e,t){this._mapFeaturesLayerController&&this._mapFeaturesLayerController.node.remove(),this._zoomLevelWhenCameraChangeStarted=this.zoomLevel,this._annotationsController&&this._annotationsController.mapRegionChangeWillStart(),this.public.dispatchEvent(new Be.Event(fc))}mapCameraChangesDidEnd(e){this.state!==ac&&(this._zoomLevelWhenCameraChangeStarted!==this.zoomLevel&&this.controlsLayer&&this.controlsLayer.zoomLevelDidChange(),delete this._zoomLevelWhenCameraChangeStarted,this._annotationsController&&this._annotationsController.mapRegionChangeDidEnd(),this.public.dispatchEvent(new Be.Event(yc)))}mapMinAndMaxZoomLevelsDidChange(e){this.controlsLayer&&this.controlsLayer.zoomLevelDidChange()}mapCanStartRotating(e){return this.public.dispatchEvent(new Be.Event(Cc))}mapRotationDidChange(e){this.controlsLayer&&this.controlsLayer.updateRotationControl(),this._dispatchRotationChangeEvent()}mapDidStopRotating(e){this.public.dispatchEvent(new Be.Event(Mc))}mapCustomCanvasWillRender(e){this.state!==ac&&this._canvas2dLayer&&this._scene.flush()}mapInteractionCenter(e){return this._forcedInteractionCenter?this._forcedInteractionCenter:this._centerMapPoint()}mapTransformCenter(e){return this._centerMapPoint()}userWillTap(e){const t=e.locationInElement();if(this._isInitialInteractionTargetInUIElement())return void(Eo.supportsTouches&&(this._delayedTapFunction=()=>this._elementWasTapped(this._mapUserInteractionController.initialEventTargetForCurrentInteraction)));const i=this.rootNode.convertPointFromPage(t),s=this._annotationsController?this._annotationsController.enabledItemCloseToPoint(i):void 0;if(s)return void(this._delayedTapFunction=()=>Pc.call(this,s));let o=!1;if(this._overlaysController){const e=this._overlaysController.enabledItemCloseToPoint(i);if(e){if(e!==this._overlaysController.userLocationAccuracyRingOverlay)return void(this._delayedTapFunction=()=>{e.selected=!0});o=!0}}if(this._annotationsController&&this._selectableMapFeatures&&this._mapNode.getMapFeatureRegions){const e=this._mapNode.getMapFeatureRegions(),t=-1!==this._selectableMapFeatures.indexOf(Rc.MapFeatureType.PointOfInterest),s=-1!==this._selectableMapFeatures.indexOf(Rc.MapFeatureType.Territory),o=-1!==this._selectableMapFeatures.indexOf(Rc.MapFeatureType.PhysicalFeature),n=e.filter((e=>-1!==["Poi","Territory","PhysicalFeature"].indexOf(e.category)&&(!(!t&&"Poi"===e.category)&&(!(!s&&"Territory"===e.category)&&!(!o&&"PhysicalFeature"===e.category))))),a=this._annotationsController.mapFeatureRegionCloseToPoint(i,n);if(a){const e=this._annotationsController.getMapFeatureAnnotationForRegion(a,this.selectableMapFeatureSelectionAccessory);return void(this._delayedTapFunction=()=>{this._annotationsController.mapFeatureDidSelect(e),this._logWithMap(Vt.Events.MapFeatureSelect,{eventValue:a.category})})}}if(o)return void(this._delayedTapFunction=()=>{const e=this.userLocationAnnotation;e&&Pc.call(this,e)});const n=zc(Sc,e);this._delayedTapFunction=()=>{this.public.dispatchEvent(n),n.defaultPrevented||(this._annotationsController&&(this._annotationsController.selectedItem=null),this._overlaysController&&(this._overlaysController.selectedItem=null))}}shouldDelaySingleTap(){return this.isZoomEnabled||this.public._listeners&&(this.public._listeners[Sc]&&this.public._listeners[Sc].length>0||this.public._listeners[Lc]&&this.public._listeners[Lc].length>0)}userDidTap(e){this._delayedTapFunction&&(this._delayedTapFunction(),delete this._delayedTapFunction)}userCanceledTap(e){delete this._delayedTapFunction}userDidDoubleTap(e){const t=e.modifierKeys.alt;(!this.isZoomEnabled||t&&this.zoomLevel===this._mapNode.minZoomLevel||!t&&this.zoomLevel===this._mapNode.maxZoomLevel)&&this.public.dispatchEvent(zc(Lc,e))}userDidLongPress(e){if(this._isInitialInteractionTargetInUIElement())return!1;const t=e.locationInElement(),i=this._annotationsController?this._annotationsController.enabledItemCloseToPoint(this.rootNode.convertPointFromPage(t),!0):void 0;if(!i){const t=zc(xc,e);return this.public.dispatchEvent(t),t.defaultPrevented&&(this._panningWasPrevented=!0),Eo.supportsTouches}return i._impl.isDraggable()&&!this.cameraIsMoving?(this._annotationsController.startDraggingAnnotation(i,t),!0):Eo.supportsTouches?(Pc.call(this,i),!0):Eo.supportsTouches}userMayStartPanningAfterLongPress(){delete this._panningWasPrevented}userDidPanAfterLongPress(e){this._annotationsController&&this._annotationsController.annotationDraggingDidChange(e)}userDidStopPanningAfterLongPress(e){this._annotationsController&&this._annotationsController.annotationDraggingDidEnd(e)}linearZoomControllerDidZoom(e){this.cameraIsZooming&&(this.zoomLevel=e,(e<=this.minZoomLevel&&!this._linearZoomController.zoomsIn||e>=this.maxZoomLevel&&this._linearZoomController.zoomsIn)&&this._mapNode.cameraDidStopZooming())}linearZoomControllerDidStop(){this._mapNode.cameraDidStopZooming()}userLocationDidChange(e){this._updateUserLocationDisplay(e.target),this.controlsLayer&&this.controlsLayer.userLocationDidChange(e.target),this.tracksUserLocation&&this._updateCameraToTrackUserLocation(e.target),this.public.dispatchEvent(e)}userLocationDidError(e){this._updateUserLocationDisplay(e.target),this.controlsLayer&&this.controlsLayer.userLocationDidError(e.target),this.public.dispatchEvent(e)}get mapNodeTint(){const e=this._mapNodeController&&this._mapNodeController.node;return e?e.tint:xs.Light}isRooted(){return this.element&&this.element.ownerDocument.body.contains(this.element)}stopDraggingAnnotation(){this._mapUserInteractionController._stopDraggingAnnotation()}translateVisibleMapRectAnimated(e,t){const i=this.visibleMapRect;this._setVisibleMapRect(new fi(i.minX()+e.x/this.worldSize,i.minY()+e.y/this.worldSize,i.size.width,i.size.height),!!t)}translateCameraAnimated(e,t){this._mapNode.setCameraAnimated(this.camera.translate(e),!!t)}setCameraAnimated(e,t){this._mapNode.setCameraAnimated(e,!!t)}shouldWaitForTilesAndControls(){return this.state!==oc||!this.controlsLayer||this.controlsLayer.controlsPending}ensureRenderingFrame(){return this._renderingFrame||new is}ensureVisibleFrame(){return this._visibleFrame||new is}annotationDraggingWillStart(){this.rootNode.classList.add(Qh),this._loadControlsLayer(!1),this.controlsLayer&&(this.controlsLayer.classList.add(Qh),this.controlsLayer.canShowTooltips=!1)}annotationDraggingDidEnd(){this.rootNode.classList.remove(Qh),this.controlsLayer&&(this.controlsLayer.classList.remove(Qh),this.controlsLayer.canShowTooltips=!0)}get useMetric(){switch(this.distances){case Rc.Distances.Adaptive:return Hi;case Rc.Distances.Metric:return!0;case Rc.Distances.Imperial:return!1}}get isCompassHidden(){return this.showsCompass===qh.Hidden||Eo.supportsTouches&&this.showsCompass===qh.Adaptive&&0===this.rotation||!this.isRotationEnabled}get fontSizeRatio(){return this._textZoomDetector?this._textZoomDetector.ratio:1}get textZoom(){return!!this._textZoomDetector}set textZoom(e){e&&!this._textZoomDetector?this._textZoomDetector=new Kh({container:this.element,fontSizeDidChange:()=>{this._mapNode&&(this._mapNode.fontSizeRatio=this.fontSizeRatio),this.controlsLayer&&this.controlsLayer.fontSizeDidChange(),this._annotationsController&&this._annotationsController.fontSizeDidChange()}}):!e&&this._textZoomDetector&&(this._textZoomDetector.destroy(),this._textZoomDetector=void 0,this._mapNode&&(this._mapNode.fontSizeRatio=this.fontSizeRatio)),this.controlsLayer&&(this.controlsLayer.textZoom=!!e),this._annotationsController&&(this._annotationsController.textZoom=!!e)}compassRotationWillStart(e){return e&&this.rootNode.classList.add(Jh),this._mapNodeController.node.compassRotationWillStart()}compassRotationDidEnd(){this.rootNode.classList.remove(Jh),this._mapNodeController.node.compassRotationDidEnd()}panningDuringAnnotationDrag(){this._annotationsController&&this._annotationsController.mapPanningDuringAnnotationDrag()}padMapRect(e,t,i){p(t,"object","[MapKit] padding must be an object with any of `top`, `left`, `bottom`, `right`"),["top","left","bottom","right"].forEach((e=>{if(e in t){const i=t[e];if("number"!=typeof i||i<0)throw new Error("[MapKit] property `"+e+"` of padding must be a number >= 0; got `"+i+"`")}else t[e]=0}));const s=this.ensureRenderingFrame().size;let o=h(Math.min((s.width-(t.left+t.right))/(e.size.width*vi.tileSize),(s.height-(t.top+t.bottom))/(e.size.height*vi.tileSize)));const n=Math.max(vi.pointsPerAxis(o),1),a=an(e,{top:t.top/n,left:t.left/n,bottom:t.bottom/n,right:t.right/n});if(void 0!==i&&i>=0){o=this._mapNode.zoomLevelForCameraDistanceAtY(i,a.midY());const e=n/vi.pointsPerAxis(o);return a.scale(e,new gi(a.midX(),a.midY()))}return a}supportsLabelRegions(){return!this._mapNodeController.usingSSR}createLabelRegion(){return this._mapNode.createLabelRegion()}updatedLabelRegion(){this._mapNode.updatedLabelRegion()}unregisterLabelRegion(e){this._mapNode.unregisterLabelRegion(e)}annotationPlaceSelectionAccessoryDidReveal(e,t){this._logWithMap(Vt.Events.PlaceAccessoryReveal,{eventValue:e,eventTarget:"PLACECARD_TRAY",states:{PLACE_CARD:()=>t}})}annotationPlaceSelectionAccessoryOpenInMapsClicked(e,t){this._logWithMap(Vt.Events.PlaceAccessoryOpenAppleMaps,{eventTarget:"PLACECARD_TRAY",states:{PLACE_CARD:()=>t}})}_addItems(e){const t=[];return e.forEach((function(e,i){const s=Rc.OverlaysController&&e instanceof Rc.OverlaysController.Overlay,o=Rc.AnnotationsController&&e instanceof Rc.AnnotationsController.Annotation;if(!s&&!o)throw new Error("[MapKit] Map.addItems expected an Annotation, Overlay, ItemCollection, or Array of valid items at index "+i+", but got `"+e+"` instead.");e.map||(s?this.addOverlay(e):t.push(e))}),this),this._annotationsController&&this.addAnnotations(t),e}_configurationDidBecomeAvailable(e){let t=e&&this.state===tc;e||(this.state===ec?(this.state=tc,t=!0):this.state===ic&&(this.state=sc,t=!0)),this._mapNodeController.configurationDidBecomeAvailable(e),t&&this._logWithMap(Vt.Events.MapsLoad),this.controlsLayer&&this.controlsLayer.update(),this.public._internalAppDelegate&&"function"==typeof this.public._internalAppDelegate.networkConfigurationUpdated&&this.public._internalAppDelegate.networkConfigurationUpdated({madabaDomains:Ue.madabaDomains,tileGroup:Ue.tileGroup,accessKey:Ue.accessKey})}_setupScene(){this._scene=new jo,this._scene.sceneDidUpdate=(e,t)=>this._sceneDidUpdate(e,t),dc&&(this._scene.performanceMeasureName="mapkit-scene-graph-update-frame");const e=this._scene.element;e.className="rt-root",Vi.activeLocale&&(e.lang=Vi.localeId,e.dir=Vi.activeLocale.rtl?"rtl":"ltr"),this._scene.element.setAttribute("aria-hidden","true")}_sceneDidUpdate(e,t){if(t||this.state===ac)return;this.unifiedCanvas&&this._mapNode&&this._mapNode.customCanvas&&!this._scene.isTainted()?(this._canvas2dLayer||(this._canvas2dLayer=new il(this._scene),this._scene.element.hidden=!0,this.addLayerAbove(this._canvas2dLayer,Ps.Labels)),this._mapNode.forceDraw()):this._canvas2dLayer&&(console.warn("[MapKit] Fallback to 2D rendering because canvas is tainted, or CSR became unavailable."),this.removeLayer(this._canvas2dLayer),this._canvas2dLayer=null,this._scene.element.hidden=!1)}_checkOptions(e){p(e,"object","[MapKit] The `options` object is invalid."),Object.keys(e).forEach((t=>{let i=rc[t];if(void 0===i){const s=j(t);i=rc[s],void 0!==i&&(e[s]=e[t])}"rw"===i||("ro"===i?console.warn("[MapKit] `"+t+"` is read-only and can't be set on a Map."):console.warn("[MapKit] `"+t+"` is not a valid property of Map."))}))}_checkParent(e){if(null==e)return;const t="string"==typeof e?document.getElementById(e):e;if(!t||!ne(t))throw new Error("[MapKit] `parent` must either be a DOM element or its ID.");return t}_setDefaultState(e){this._showsScale=qh.Hidden,this._visibleMapRect=Xh,this._padding=new dn,this._adjustedPadding=new dn,this._showsCompass=qh.Adaptive,this._usingDefaultShowsCompassValue=!0,this._distances=Rc.Distances.Adaptive,this._showsZoomControl=void 0!==e.showsZoomControl?!!e.showsZoomControl:!Yh,this._showsMapTypeControl=void 0!==e.showsMapTypeControl?!!e.showsMapTypeControl:!Yh,this._showsUserLocationControl=void 0!==e.showsUserLocationControl&&!!e.showsUserLocationControl,this._showsUserLocationControl&&!Rc.UserLocationController&&console.warn("[MapKit] mapkit.Map.showsUserLocationControl is available after loading the following library: user-location.");const t=e.mapType||Rc.MapTypes.Standard;Dc(t,Rc.MapTypes,"mapType","Map.MapTypes"),t===Rc.MapTypes.MutedStandard?(this._emphasis=Fs.Muted,this._mapType=Rc.MapTypes.Standard):(this._emphasis=Fs.Standard,this._mapType=t);const i=e.colorScheme||Rc.ColorSchemes.Light;Dc(i,Rc.ColorSchemes,"colorScheme","Map.ColorSchemes"),this._colorScheme=i,i===qe.Adaptive&&(this._colorSchemeHandle=Xe.addHandle(),this._boundDarkModeDidChange=()=>this._updateMapNodeTintAndEmphasis(this._mapNode),this._colorSchemeHandle.addEventListener("change",this._boundDarkModeDidChange))}_setIsRotationEnabled(e,t){"boolean"==typeof e?(this.isRotationAvailable?this._mapNode.isRotationEnabled=e:t&&e&&console.warn("[MapKit] Rotation can't be enabled because it's not available."),this.controlsLayer&&this.controlsLayer.updateRotationControl(),this._mapUserInteractionController.updateGestureEnableState()):console.warn("[MapKit] Value passed to `Map.isRotationEnabled` is not a Boolean.")}_setupRenderTree(){const e=document.createElement("div");e.className="mk-map-view",e.appendChild(this._scene.element),this.rootNode=new po.Node(e)}_setupControllers(e){this._loadControlsLayer(!0),Rc.OverlaysController&&this.addOverlaysController(),Rc.MapFeaturesLayerController&&this.addMapFeaturesLayerController(),Rc.AnnotationsController&&this.addAnnotationsController(),Rc.UserLocationController&&this.addUserLocationController(),this._mapNodeController=new el(this,e),this._linearZoomController=new pn(this._mapNode.snapsToIntegralZoomLevels,this),this._mapUserInteractionController=new Tn(this.rootNode.element,this)}addOverlaysController(){this.state===ac||this._overlaysController||(this._overlaysController=new Rc.OverlaysController(this),this._scene.insertAfter(this._overlaysController.node,this._mapNodeController?this._mapNodeController.node:void 0))}addMapFeaturesLayerController(){this._mapFeaturesLayerController=new Rc.MapFeaturesLayerController(this),this._startStabilizationTimeoutIfNeeded()}addAnnotationsController(){this.state===ac||this._annotationsController||(this._annotationsController=new Rc.AnnotationsController(this),this._mapRoot&&this._mapRoot.insertAfter(this._annotationsController.node,this._mapFeaturesLayerController.node),this._scene.insertAfter(this._annotationsController.sceneGraphNode,this._overlaysController?this._overlaysController.node:this._mapNodeController?this._mapNodeController.node:void 0))}addUserLocationController(){this._userLocationController=new Rc.UserLocationController(this),this._showsUserLocationControl&&this.controlsLayer&&(this.controlsLayer.updateUserLocationControl(),this.controlsLayer.updateScale())}getControlBounds(){return this.controlsLayer?this.controlsLayer.controlBounds():[]}_loadControlsLayer(e){var t;if(!this._loadControlsLayerHasFailed)return!e&&Rc.ControlsLayer?(this._insertControlsLayer(),void this._updateInitialControlsLayerState()):(t=t=>{if(!t)return this._showsDefaultTiles=!1,Object.defineProperty(this,"_showsDefaultTiles",{get:function(){return!1},set:function(){throw new Error("[MapKit] Default tiles are not shown because map controls has failed to load.")},configurable:!0}),void(this._loadControlsLayerHasFailed=!0);Rc.ControlsLayer=t,e?(bt.scheduleInBackground((()=>this._insertControlsLayer()),bt.Priority.Highest),bt.scheduleInBackground((()=>this._updateInitialControlsLayerState()),bt.Priority.Highest)):(this._insertControlsLayer(),this._updateInitialControlsLayerState())},void t(Zh))}_insertControlsLayer(){if(this.state!==ac&&!this.controlsLayer&&(this.controlsLayer=new Rc.ControlsLayer(this),this._mapRoot.insertAfter(this.controlsLayer,this._annotationsController?this._annotationsController.node:void 0),cc)){const e=()=>{po.removeEventListener("update",e),performance.measure("mapkit-map-controls-inserted","mapkit-map-start")};po.addEventListener("update",e)}}_updateInitialControlsLayerState(){this.state===ac||this._updateInitialControlsLayerStateCalled||(this._updateInitialControlsLayerStateCalled=!0,this.controlsLayer.update(),this.controlsLayer.mapPaddingDidChange(this._adjustedPadding))}_handleOptions(e,t){void 0!==e.contextType&&(this.contextType=e.contextType),void 0!==e.showsScale&&(this.showsScale=e.showsScale),void 0!==e.showsCompass&&(this.showsCompass=e.showsCompass),void 0!==e.padding&&(this.padding=e.padding),void 0!==e.cameraZoomRange&&(this.cameraZoomRange=e.cameraZoomRange),void 0!==e.cameraBoundary&&(this.cameraBoundary=e.cameraBoundary),void 0!==e.visibleMapRect?this.visibleMapRect=e.visibleMapRect:void 0!==e.region?this.region=e.region:(void 0!==e.center&&(this.center=e.center),void 0!==e.cameraDistance&&(this.cameraDistance=e.cameraDistance)),void 0!==e.rotation&&(this.rotation=e.rotation);const i=[],s=void 0===e.visibleMapRect&&void 0===e.region&&void 0===e.center&&t;if(void 0!==e.overlays&&(g(e.overlays,"[MapKit] Map constructor overlays option expected an array of overlays, but got `"+e.annotations+"` instead."),s?i.push.apply(i,e.overlays):this.overlays=e.overlays),void 0!==e.annotations&&(g(e.annotations,"[MapKit] Map constructor annotations option expected an array of annotations, but got `"+e.annotations+"` instead."),s?i.push.apply(i,e.annotations):this.annotations=e.annotations),i.length>0){const t={};void 0!==e.cameraDistance&&(t.cameraDistance=e.cameraDistance),this.showItems(i,t)}void 0!==e.selectedOverlay&&(this.selectedOverlay=e.selectedOverlay),void 0!==e.selectedAnnotation&&(this.selectedAnnotation=e.selectedAnnotation),void 0!==e.distances&&(this.distances=e.distances),void 0!==e.tintColor&&(this.tintColor=e.tintColor),void 0!==e.showsUserLocation&&(this.showsUserLocation=e.showsUserLocation),void 0!==e.tracksUserLocation&&(this.tracksUserLocation=e.tracksUserLocation),void 0!==e.tileOverlays&&(this.tileOverlays=e.tileOverlays),void 0!==e.annotationForCluster&&(this.annotationForCluster=e.annotationForCluster),void 0!==e.annotationForMapFeature&&(this.annotationForMapFeature=e.annotationForMapFeature),void 0!==e._unifiedCanvas&&(this.unifiedCanvas=!!e._unifiedCanvas),void 0!==e._textZoom&&(this.textZoom=!!e._textZoom)}_flushToDOM(e){this._addMapToParent(e),bt.flush(),this._ensureContainerIsPositioned()}_addMapToParent(e){null!=e&&(e.appendChild(this.element),this._bootstrapSize.width&&this._bootstrapSize.height&&this._updateRenderingFrameSize(this._bootstrapSize),delete this._bootstrapSize)}performScheduledUpdate(){if(this.state===ac)return;const e=this._mapNode.camera.zoom;e%1!=0&&(this.state===ec||this.state===tc)&&("SERVER"===Ue.forcedRenderingMode||Ue.ready&&(Ue.didFallback||!Ue.canRunCSR)||!this.csrCapable||"HYBRID"===Ue.forcedRenderingMode||this._mapNodeController.loadPriority===Ns.PointsOfInterest)&&this._mapNode.setZoomLevelAnimated(Eo.getIntegralZoom(e)),this.state===ec?this.state=ic:this.state===tc&&(this.state=sc),this._loadResizeDetector()}_loadResizeDetector(){if(!this._iframe&&!this._resizeObserver){if(window.ResizeObserver)return this._resizeObserver=new window.ResizeObserver((e=>this._sizeDidChange())),this._resizeObserver.observe(this.rootNode.element),void this._resizeDetectorDidInstall();this._iframe=Eo.htmlElement("iframe",{tabindex:-1,"aria-hidden":!0}),this._iframe.addEventListener("load",this),this.element.insertBefore(this._iframe,this.element.firstChild)}}_updateUserLocationDisplay(e){this._annotationsController.updateUserLocationAnnotation(e),this._overlaysController.updateUserLocationAccuracyRingOverlay(e)}_removeUserLocationDisplay(){this._annotationsController.removeUserLocationAnnotation(),this._overlaysController.removeUserLocationAccuracyRingOverlay()}_updateCameraToTrackUserLocation(e){let t,i;if(this.tracksUserLocation&&this.showsUserLocation&&e.coordinate){if(this._mapNode.isMapPointWithinBounds(e.coordinate.toMapPoint()))if(this._firstCameraUpdateToTrackUserLocationPending&&this.zoomLevel<9.5){let s=14;if(e.location.accuracy>0){const t=5*e.location.accuracy*vi.mapUnitsPerMeterAtLatitude(e.location.latitude),i=new fi(0,0,t,t),o=this.ensureVisibleFrame().size;s=Math.max(this.zoomLevel,vi.zoomLevelForMapRectInViewport(i,o,vi.tileSize))}t=this._mapRectForCenterAndZoomLevel(e.coordinate.toMapPoint(),s),this._userLocationTrackingDelegate&&"function"==typeof this._userLocationTrackingDelegate.mapRegionWillChangeToTrackUserLocation&&(i=t.toCoordinateRegion(),this._userLocationTrackingDelegate.mapRegionWillChangeToTrackUserLocation(this.public,i),t=i.toMapRect()),this._mapNode.setCameraAnimated(this.camera.withNewMapRect(t),!0,!0)}else this._userLocationTrackingDelegate&&"function"==typeof this._userLocationTrackingDelegate.mapRegionWillChangeToTrackUserLocation?(t=this._mapRectForCenterAndZoomLevel(e.coordinate.toMapPoint(),this.zoomLevel),i=t.toCoordinateRegion(),this._userLocationTrackingDelegate.mapRegionWillChangeToTrackUserLocation(this.public,i),this._mapNode.setCameraAnimated(this.camera.withNewMapRect(t),!0,!0)):this.setCenterAnimated(e.coordinate,!0,!0);else this.setCenterAnimated(e.coordinate,!0,!0),this._userLocationController.tracksUserLocation=!1,this._mapNode.usesInteractionCenter=!1,this.controlsLayer&&this.controlsLayer.updateUserLocationControl();delete this._firstCameraUpdateToTrackUserLocationPending}}_updateRenderingFrameFromElement(){const e=this.rootNode.element,t=e.offsetWidth,i=e.offsetHeight;0!==t&&0!==i&&this._updateRenderingFrameSize(new es(t,i))}_setRenderingFrameValue(e){this._renderingFrame=e,this._visibleFrame=e;const t=this._adjustedPadding.copy(),i=this._adjustedPaddingForMapSize(e.size);this._adjustedPadding=i,i.equals(dn.Zero)||(this._visibleFrame=new is(e.origin.x+i.left,e.origin.y+i.top,e.size.width-i.left-i.right,e.size.height-i.top-i.bottom)),!i.equals(t)&&this.controlsLayer&&this.controlsLayer.mapPaddingDidChange(i)}_adjustedPaddingForMapSize(e){const t=new es(Math.min(Zs.minimumSizeToShowLogo.width,e.width),Math.min(Zs.minimumSizeToShowLogo.height,e.height)),i=this._padding.copy();i.top<0&&(i.top=0),i.left<0&&(i.left=0),i.bottom<0&&(i.bottom=0),i.right<0&&(i.right=0);const s=i.left+i.right,o=i.top+i.bottom,n=s+t.width-e.width,a=o+t.height-e.height;if(n>0&&s>0){const e=(s-n)/s;i.left*=e,i.right*=e}if(a>0&&o>0){const e=(o-a)/o;i.top*=e,i.bottom*=e}return i}_iframeDidLoad(){try{this._iframe.contentWindow.addEventListener("resize",this)}catch(e){console.warn("[MapKit] Map resize detection is disabled when loaded in a sandboxed iframe.")}this._resizeDetectorDidInstall()}_resizeDetectorDidInstall(){const e=this._visibleMapRect&&this._visibleMapRect.copy(),t=this.rotation,i=this._padding&&!this._padding.equals(dn.Zero);this._ensureContainerIsPositioned(),this._sizeDidChange(),e&&i&&(e.size.width>0||e.size.height>0?(this.setVisibleMapRectAnimated(e,!1),t&&this.setRotationAnimated(t,!1)):this.setCenterAnimated(new gi(e.midX(),e.midY()).toCoordinate()))}_sizeDidChange(){this._printMediaQueryList&&this._printMediaQueryList.matches||this._updateRenderingFrameFromElement()}_updateRenderingFrameSize(e){const t=!this._renderingFrame;0===e.width||0===e.height||!t&&this._renderingFrame.size.equals(e)||(this._setRenderingFrameValue(new is(0,0,e.width,e.height)),this._scene.size=e,this._mapRoot.size=e,this._mapNodeController.updateSize(e),this._delayedShowItems&&(Rc.LayerItemsController.setRegionForItems(this,this._delayedShowItems[0],this._delayedShowItems[1]),delete this._delayedShowItems),this.controlsLayer&&this.controlsLayer.sizeDidChange(),this._annotationsController&&this._annotationsController.mapSizeDidUpdate())}_mapRectForCenterAndZoomLevel(e,t){const i=this.ensureVisibleFrame().size,s=vi.pointsPerAxis(t),o=i.width/s,n=i.height/s;return new fi(e.x-o/2,e.y-n/2,o,n)}_isInitialInteractionTargetInUIElement(){const e=this._mapUserInteractionController.initialEventTargetForCurrentInteraction;return!!e&&(!(!this._annotationsController||!this._annotationsController.isElementInAccessory(e))||!(!this.controlsLayer||!this.controlsLayer.element.contains(e)))}zoomControlStart(e){e&&!this.canZoomIn||!e&&!this.canZoomOut||this._linearZoomController.start(this.zoomLevel,e)&&this._mapNode.cameraWillStartZooming(Ws.Button)}zoomControlEnd(){this._linearZoomController.stop()}_centerMapPoint(){if(0!==this.rotation){const e=this.renderingMapRect,t=new gi(e.midX(),e.midY()),i=this._offsetCenterWithPaddingAndRotation(t,1);if(i)return i}const e=this.visibleMapRect;return new gi(e.midX(),e.midY())}_offsetCenterWithPaddingAndRotation(e,t){const i=2*t*this.worldSize,s=(this._adjustedPadding.right-this._adjustedPadding.left)/i,o=(this._adjustedPadding.bottom-this._adjustedPadding.top)/i;if(0!==s||0!==o){const t=-this.rotation/180*Math.PI;return new gi(e.x-s*Math.cos(t)+o*Math.sin(t),e.y-s*Math.sin(t)-o*Math.cos(t))}}_setVisibleMapRect(e,t,i){i||(this.tracksUserLocation=!1);let s=e;const o=this._adjustedPadding,n=this.ensureRenderingFrame(),a=this.ensureVisibleFrame();o.equals(dn.Zero)||a.equals(is.Zero)||(s=new fi(e.minX()-o.left/a.size.width*e.size.width,e.minY()-o.top/a.size.height*e.size.height,e.size.width*(n.size.width/a.size.width),e.size.height*(n.size.height/a.size.height))),this._mapNode.setVisibleMapRectAnimated(s,t)}_ensureContainerIsPositioned(){const e=this.rootNode.element;"static"===e.ownerDocument.defaultView.getComputedStyle(e).position&&(e.style.position="relative")}didInsertNewMapNode(e){e.delegate=this,this.state===oc&&(this.state=nc),this._updateMapRoot(e),this._updateMapNodeTintAndEmphasis(e),window.setTimeout((()=>this.public.dispatchEvent(new Be.Event(Ac))),0)}didReconfigureMapNode(e){e.snapsToIntegralZoomLevels&&e.zoomLevel%1!=0&&!e.cameraIsAnimating&&(e.zoomLevel=Eo.getIntegralZoom(e.zoomLevel)),this._linearZoomController&&(this._linearZoomController.snapsToIntegralZoomLevels=e.snapsToIntegralZoomLevels),e.fontSizeRatio=this.fontSizeRatio,this.controlsLayer&&this.controlsLayer.updateZoomControl()}didFinishMapNodeInitialization(e){e.customCanvas?(e.customCanvas.setAttribute("aria-hidden","true"),this.element.insertBefore(e.customCanvas,this.element.firstChild)):this._scene.addChild(e,0)}mapNodeDidFail(e){const t=new Be.Event(Ic);e&&(t.reason=e.reason,t.message=e.message),this.public.dispatchEvent(t)}mapNodeReady(e){window.setTimeout((()=>{const t=new Be.Event(Ec);t.usingCSR=e,this.public.dispatchEvent(t),this._logWithMap(Vt.Events.MapNodeReady)}),0),this.controlsLayer&&this.controlsLayer.updateRotationControl(),this._annotationsController&&this._annotationsController.mapSupportForLabelRegionsChanged()}_updateMapRoot(e){this._mapRoot&&this._mapRoot.remove(),this._mapRoot=this.rootNode.insertBefore(new po.Node(e.element),this.rootNode.firstChild),e.element.className="mk-map-node-element",this._mapRoot.size=e.size=this._scene.size,this._annotationsController&&this._mapRoot.addChild(this._annotationsController.node),this.controlsLayer&&this._mapRoot.addChild(this.controlsLayer)}_updateMapNodeTintAndEmphasis(e){const t=this._colorScheme===qe.Adaptive?Xe.currentColorScheme:this._colorScheme;this.currentColorScheme=t;const i=this._mapType===Rc.MapTypes.Standard?t:xs.Dark;this.tint=i;let s=t;this._mapType!==Rc.MapTypes.Hybrid&&this._mapType!==Rc.MapTypes.Satellite||(s=xs.Light),e.setTintAndEmphasis(i,s,this._emphasis),this._mapNodeController&&this._mapNodeController.setTintAndEmphasis(i,s,this._emphasis),this.controlsLayer&&this.controlsLayer.update(),this._annotationsController&&(this._annotationsController.mapNodeTintWasSet(i),this._annotationsController.node.classList.toggle(uc,Eo.darkColorScheme(i))),this.rootNode.classList.toggle(uc,Eo.darkColorScheme(i))}overlaySelectionDidChange(e){e.selected&&this._annotationsController&&(this._annotationsController.selectedItem=null);const t=new Be.Event(e.selected?gc:_c);t.overlay=e,this.selectionMayChange=!1,this.public.dispatchEvent(t),this.selectionMayChange=!0}annotationSelectionDidChange(e){e.selected&&this._overlaysController&&(this._overlaysController.selectedItem=null),this.selectionMayChange=!1,this.dispatchEventWithAnnotation(e.selected?gc:_c,e),this.selectionMayChange=!0}dispatchEventWithAnnotation(e,t,i){const s=new Be.Event(e);if(s.annotation=t,i)for(const e in i)s[e]=i[e];this.public.dispatchEvent(s)}addWaitingAnnotations(){this.shouldWaitForTilesAndControls()||(this._annotationsController?this._annotationsController.addWaitingAnnotations((()=>this._dispatchCompleteEvent())):this._dispatchCompleteEvent())}_dispatchCompleteEvent(){this._completedOnce||(this._completedOnce=!0,cc&&performance.measure("mapkit-map-annotations-rendered","mapkit-map-start")),this._mapNode.fullyRendered&&this.public.dispatchEvent(new Be.Event(Tc))}_dispatchRotationChangeEvent(){this.shouldDispatchRotationChangeEvent&&this.public.dispatchEvent(new Be.Event(kc))}_handleLocaleChange(e){const t=this._scene.element;t.lang=Vi.localeId,t.dir=Vi.activeLocale.rtl?"rtl":"ltr",this._mapNodeController.handleMapConfigurationChange(),this._annotationsController&&(this._annotationsController.localeChanged(),this._userLocationController&&this._annotationsController.updateUserLocationAnnotation(this._userLocationController.userLocation,!0));const i=this.ensureRenderingFrame();0!==i.size.width&&0!==i.size.height&&this._setRenderingFrameValue(i)}_elementWasTapped(e){for(;null!==e;e=e.parentNode)if("a"===(t=e).localName||"button"===t.localName||"input"===t.localName&&"button"===t.type)return void e.click();var t}_devicePixelRatioDidChange(){this._scene.needsDisplay=!0,this.controlsLayer&&this.controlsLayer.devicePixelRatioDidChange(),this._annotationsController&&this._annotationsController.devicePixelRatioDidChange(),this._mapNode.devicePixelRatioDidChange()||this._mapNodeController.handleRecreate()}_mapRectAccountingForPadding(){const e=this.renderingMapRect;if(this._adjustedPadding.equals(dn.Zero))return e.copy();const t=this.ensureVisibleFrame(),i=this.ensureRenderingFrame();return new fi(e.minX()+this._adjustedPadding.left/i.size.width*e.size.width,e.minY()+this._adjustedPadding.top/i.size.height*e.size.height,e.size.width*(t.size.width/i.size.width),e.size.height*(t.size.height/i.size.height))}_setupListeners(){Ue.state===Ue.States.READY&&this._configurationDidBecomeAvailable(!0),Ue.addEventListener(Ue.Events.Initialized,this),Ue.addEventListener(Ue.Events.Changed,this),Vi.activeLocale&&this._handleLocaleChange({locale:Vi.activeLocale}),Vi.addEventListener(Vi.Events.LocaleChanged,this),this._boundDevicePixelRatioDidChange=()=>this._devicePixelRatioDidChange(),this._dppxMediaQueryList=window.matchMedia("(-webkit-device-pixel-ratio: 1)"),this._dppxMediaQueryList.addListener(this._boundDevicePixelRatioDidChange),this._boundPrintMediaQueryChanged=()=>this._printMediaQueryChanged(),this._printMediaQueryList=window.matchMedia("print"),this._printMediaQueryList.addListener(this._boundPrintMediaQueryChanged)}_removePrintListener(){this._printMediaQueryList?.removeListener(this._boundPrintMediaQueryChanged),this._boundPrintMediaQueryChanged=null,this._printMediaQueryList=null}_printMediaQueryChanged(){const e=this._mapNode;this._printMediaQueryList.matches?(this.rootNode.element.style.background=this.rootNode.element.parentNode.dataset.mapPrintingBackground,e.fullyRendered?this._ensureMapCenterDuringPrint(!0):(e.opacity=0,this._annotationsController&&this._annotationsController.addWaitingAnnotations()),this._loadControlsLayer(!1),this._mapNodeController.handlePrintMatch(),bt.flush()):(this._mapNodeController.handlePrintUnmatch(),e.opacity=1,this.rootNode.element.style.background="",this._ensureMapCenterDuringPrint(!1))}_ensureMapCenterDuringPrint(e){const t=[this._scene.element];this._mapNode.customCanvas&&t.push(this._mapNode.customCanvas),t.forEach((function(t){if(e){const e=this._scene.size;t.style.left="50%",t.style.marginLeft="-"+e.width/2+"px",t.style.top="50%",t.style.marginTop="-"+e.height/2+"px"}else t.style.left="",t.style.marginLeft="",t.style.top="",t.style.marginTop=""}),this)}_startStabilizationTimeoutIfNeeded(){this._mapNodeController&&this._mapNode&&this._mapNode.fullyRendered&&!this.cameraIsMoving&&(this._stopStabilizationTimeout(),this._mapStabilizationTimeout=window.setTimeout((()=>bt.scheduleInBackground((()=>this._mapIsStabilized()))),500))}_stopStabilizationTimeout(){this._mapStabilizationTimeout&&(window.clearTimeout(this._mapStabilizationTimeout),this._mapStabilizationTimeout=null)}_mapIsStabilized(){this._updateMapFeatureRegionLayer(),this._updatePrintingBackground()}_updatePrintingBackground(){this._mapNode&&this._mapNode.cssBackgroundProperty&&this._mapNode.fullyRendered&&this.isRooted()&&(this.rootNode.element.parentNode.dataset.mapPrintingBackground=this._mapNode.cssBackgroundProperty)}_updateMapFeatureRegionLayer(){if(!(this._selectableMapFeatures&&this._mapNode&&this._mapNode.getMapFeatureRegions&&this._mapFeaturesLayerController))return;if(!this._mapNode.fullyRendered||!this.isRooted())return;const e=-1!==this._selectableMapFeatures.indexOf(Rc.MapFeatureType.PointOfInterest),t=-1!==this._selectableMapFeatures.indexOf(Rc.MapFeatureType.Territory),i=-1!==this._selectableMapFeatures.indexOf(Rc.MapFeatureType.PhysicalFeature),s=this._mapNode.getMapFeatureRegions().filter((s=>e&&"Poi"===s.category||t&&"Territory"===s.category||i&&"PhysicalFeature"===s.category));this._mapFeaturesLayerController.update(s,this._mapNode.camera),this._mapRoot.addChild(this._mapFeaturesLayerController.node,0)}_logWithMap(e,t={}){if(this.state===ac)return;const i={map:this,eventTarget:t.eventTarget||Vt.EventTarget};for(const e in t)i[e]=t[e];Vt.log(e,i)}}function Pc(e){e.selected=!0,this._logWithMap(Vt.Events.AnnotationClick)}function Dc(e,t,i,s){if(!d(e,t))throw new Error("[MapKit] Unknown value for `"+i+"`. Choose from "+s+".")}function zc(e,t){const i=new Be.Event(e),s=t.locationInElement();return i.pointOnPage=new DOMPoint(s.x,s.y),i.domEvents=t.domEvents.slice(),i}Vh(Rc,"maps",[]),Vh(Rc,"MapTypes",Is),Vh(Rc,"Distances",Rs),Vh(Rc,"ColorSchemes",qe),Vh(Rc,"LoadPriorities",Ns),Vh(Rc,"MapProperties",rc);const Nc=["LayerItemsController","ItemCollection","OverlaysController","MapFeaturesLayerController","AnnotationsController","PlaceSelectionAccessory","UserLocationController","MapFeatureType"];function Fc(){let e=!0;for(let t=0;t<Nc.length;t++){const i=Nc[t];!Rc[i]&&W.jsModules[i]?Rc[i]=W.jsModules[i]:e=!1}Rc.OverlaysController&&Rc.maps.forEach((e=>{e._impl.addOverlaysController()})),Rc.MapFeaturesLayerController&&Rc.maps.forEach((e=>{e._impl.addMapFeaturesLayerController()})),Rc.AnnotationsController&&Rc.maps.forEach((e=>{e._impl.addAnnotationsController()})),Rc.UserLocationController&&Rc.maps.forEach((e=>{e._impl.addUserLocationController()})),e&&W.removeEventListener("load",Fc)}W.addEventListener("load",Fc),Fc();const Uc=Rc;function Gc(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Bc extends Ge{constructor(e,t){super(),Object.defineProperty(this,"_impl",{value:new Uc(this,e,t)})}get padding(){return this._impl.padding}set padding(e){this._impl.padding=e}get isScrollEnabled(){return this._impl.isScrollEnabled}set isScrollEnabled(e){this._impl.isScrollEnabled=e}get isZoomEnabled(){return this._impl.isZoomEnabled}set isZoomEnabled(e){this._impl.isZoomEnabled=e}get showsZoomControl(){return this._impl.showsZoomControl}set showsZoomControl(e){this._impl.showsZoomControl=e}get showsScale(){return this._impl.showsScale}set showsScale(e){this._impl.showsScale=e}get mapType(){return this._impl.getMapTypeWithEmphasis()}set mapType(e){this._impl.setMapTypeWithEmphasis(e)}get colorScheme(){return this._impl.colorScheme}set colorScheme(e){this._impl.colorScheme=e}get distances(){return this._impl.distances}set distances(e){this._impl.distances=e}get _allowWheelToZoom(){return this._impl._allowWheelToZoom}set _allowWheelToZoom(e){this._impl._allowWheelToZoom=e}get _showsTileInfo(){return this._impl._showsTileInfo}set _showsTileInfo(e){this._impl._showsTileInfo=e}get _showsDefaultTiles(){return this._impl._showsDefaultTiles}set _showsDefaultTiles(e){this._impl._showsDefaultTiles=e}get loadPriority(){return this._impl.loadPriority}set loadPriority(e){this._impl.loadPriority=e}get tileOverlays(){return this._impl.tileOverlays}set tileOverlays(e){this._impl.tileOverlays=e}addTileOverlay(e){return this._impl.addTileOverlay(e)}addTileOverlays(e){return this._impl.addTileOverlays(e)}removeTileOverlay(e){return this._impl.removeTileOverlay(e)}removeTileOverlays(e){return this._impl.removeTileOverlays(e)}get showsMapTypeControl(){return this._impl.showsMapTypeControl}set showsMapTypeControl(e){this._impl.showsMapTypeControl=e}get showsUserLocationControl(){return this._impl.showsUserLocationControl}set showsUserLocationControl(e){this._impl.showsUserLocationControl=e}get showsPointsOfInterest(){return this._impl.showsPointsOfInterest}set showsPointsOfInterest(e){this._impl.showsPointsOfInterest=e}get pointOfInterestFilter(){return this._impl.pointOfInterestFilter}set pointOfInterestFilter(e){this._impl.pointOfInterestFilter=e}get element(){return this._impl.element}set element(e){this._impl.element=e}get visibleMapRect(){return this._impl.visibleMapRect}set visibleMapRect(e){this._impl.visibleMapRect=e}setVisibleMapRectAnimated(e,t){return this._impl.setVisibleMapRectAnimated(e,t)}get region(){return this._impl.region}set region(e){this._impl.region=e}setRegionAnimated(e,t){return this._impl.setRegionAnimated(e,t)}get isRotationAvailable(){return this._impl.isRotationAvailable}set isRotationAvailable(e){this._impl.isRotationAvailable=e}get isRotationEnabled(){return this._impl.isRotationEnabled}set isRotationEnabled(e){this._impl.isRotationEnabled=e}get rotation(){return this._impl.rotation}set rotation(e){this._impl.rotation=e}get showsCompass(){return this._impl.showsCompass}set showsCompass(e){this._impl.showsCompass=e}setRotationAnimated(e,t){return this._impl.setRotationAnimated(e,t)}get center(){return this._impl.center}set center(e){this._impl.center=e}setCenterAnimated(e,t){return this._impl.setCenterAnimated(e,t)}get cameraZoomRange(){return this._impl.cameraZoomRange}set cameraZoomRange(e){this._impl.cameraZoomRange=e}setCameraZoomRangeAnimated(e,t){return this._impl.setCameraZoomRangeAnimated(e,t)}get cameraDistance(){return this._impl.cameraDistance}set cameraDistance(e){this._impl.cameraDistance=e}setCameraDistanceAnimated(e,t){return this._impl.setCameraDistanceAnimated(e,t)}get cameraBoundary(){return this._impl.cameraBoundary}set cameraBoundary(e){this._impl.cameraBoundary=e}setCameraBoundaryAnimated(e,t){return this._impl.setCameraBoundaryAnimated(e,t)}get overlays(){return this._impl.overlays}set overlays(e){this._impl.overlays=e}get selectedOverlay(){return this._impl.selectedOverlay}set selectedOverlay(e){this._impl.selectedOverlay=e}addOverlay(e){return this._impl.addOverlay(e)}addOverlays(e){return this._impl.addOverlays(e)}removeOverlay(e){return this._impl.removeOverlay(e)}removeOverlays(e){return this._impl.removeOverlays(e)}topOverlayAtPoint(e){return this._impl.topOverlayAtPoint(e)}overlaysAtPoint(e){return this._impl.overlaysAtPoint(e)}get annotations(){return this._impl.annotations}set annotations(e){this._impl.annotations=e}get selectedAnnotation(){return this._impl.selectedAnnotation}set selectedAnnotation(e){this._impl.selectedAnnotation=e}addAnnotation(e){return this._impl.addAnnotation(e)}addAnnotations(e){return this._impl.addAnnotations(e)}removeAnnotation(e){return this._impl.removeAnnotation(e)}removeAnnotations(e){return this._impl.removeAnnotations(e)}showItems(e,t){return this._impl.showItems(e,t)}addItems(e){return this._impl.addItems(e)}removeItems(e){return this._impl.removeItems(e)}annotationsInMapRect(e){return this._impl.annotationsInMapRect(e)}updateSize(e){return this._impl.updateSize(e)}convertCoordinateToPointOnPage(e){return this._impl.convertCoordinateToPointOnPage(e)}convertPointOnPageToCoordinate(e){return this._impl.convertPointOnPageToCoordinate(e)}get showsUserLocation(){return this._impl.showsUserLocation}set showsUserLocation(e){this._impl.showsUserLocation=e}get userLocationAnnotation(){return this._impl.userLocationAnnotation}get tracksUserLocation(){return this._impl.tracksUserLocation}set tracksUserLocation(e){this._impl.tracksUserLocation=e}get tintColor(){return this._impl.tintColor}set tintColor(e){this._impl.tintColor=e}destroy(){this._impl.destroy()}get annotationForCluster(){return this._impl.annotationForCluster}set annotationForCluster(e){this._impl.annotationForCluster=e}get selectableMapFeatures(){return this._impl.selectableMapFeatures}set selectableMapFeatures(e){this._impl.selectableMapFeatures=e}get selectableMapFeatureSelectionAccessory(){return this._impl.selectableMapFeatureSelectionAccessory}set selectableMapFeatureSelectionAccessory(e){this._impl.selectableMapFeatureSelectionAccessory=e}get annotationForMapFeature(){return this._impl.annotationForMapFeature}set annotationForMapFeature(e){this._impl.annotationForMapFeature=e}}Gc(Bc,"MapTypes",Uc.MapTypes),Gc(Bc,"ColorSchemes",Uc.ColorSchemes),Gc(Bc,"Distances",Uc.Distances),Gc(Bc,"LoadPriorities",Uc.LoadPriorities);const Wc={MapInternal:Uc,css:".mk-map-view{width:100%;height:100%;overflow:hidden;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;user-select:none}.mk-map-view.mk-dragging-annotation{cursor:none}.mk-map-view.mk-disable-all-gestures{touch-action:none}.mk-map-view.mk-disable-pinch-gestures{touch-action:pan-x pan-y}.mk-map-view.mk-disable-zoom-gestures{touch-action:manipulation}.mk-map-view.mk-disable-pan-gestures{touch-action:none;touch-action:pinch-zoom}div.mk-map-view.mk-map-view img,div.mk-map-view.mk-map-view svg{margin:0;padding:0}.mk-annotation-container,.mk-map-view{z-index:0}.mk-map-view>*{position:absolute;left:0;-webkit-user-select:none;user-select:none}.mk-map-view .rt-root{letter-spacing:initial}.mk-map-view .mk-font-size-detector{position:absolute;height:1em;visibility:hidden;left:-100%;-webkit-text-size-adjust:none}.mk-controls-container{position:absolute;overflow:hidden;top:0;bottom:0;left:0;right:0;z-index:3;pointer-events:none}.mk-map-view.mk-dragging-cursor{cursor:grabbing}.mk-map-view>iframe{width:100%;height:100%;pointer-events:none;opacity:0;border:0}",utils:Eo,mapkit:{FeatureVisibility:Us,CoordinateRegion:di,CoordinateSpan:ui,Coordinate:pi,BoundingRegion:mi,MapPoint:gi,MapRect:fi,MapSize:_i,Padding:dn,CameraZoomRange:yi,Map:Bc,MapInternal:Uc,get maps(){return Uc.maps},PointOfInterestCategory:We,PointOfInterestFilter:Ve.exposedConstructor,get filterIncludingAllCategories(){return Ve.filterIncludingAllCategories},get filterExcludingAllCategories(){return Ve.filterExcludingAllCategories},PlaceDetail:Qi,get placeDetails(){return Ji}}};function Zc(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Kc=vi.MapRect,jc=vi.CoordinateSpan,Hc=vi.MapPoint,Vc=new jc(.001,.001),qc=new dn(12,12,12,12),Yc="select",Xc="deselect";class $c{constructor(e){Zc(this,"_map",null),Zc(this,"_selectedItem",null),Zc(this,"_selectionDistance",10),Zc(this,"_node",null),this._map=e,this._items=[]}static checkShowItemsParameters(e,t){return g(e,"[MapKit] Map.showItems expects an array of items as its first parameter."),t=_(t,"object"),Object.keys(t).forEach((e=>{switch(e){case"animate":break;case"padding":if(void 0===t.padding)break;m(t.padding,dn,"[MapKit] Map.showItems expects a Padding object for `options.padding`.");break;case"minimumSpan":if(void 0===t.minimumSpan)break;m(t.minimumSpan,jc,"[MapKit] Map.showItems expects a CoordinateSpan for `options.minimumSpan`.");break;case"cameraDistance":if(void 0===t.cameraDistance)break;p(t.cameraDistance,"number","[MapKit] Map.showItems expects a number for `options.cameraDistance`.");break;default:console.warn("[MapKit] `"+e+"` is not a valid option of Map.showItems.")}})),t}static getRegionForItems(e,t,i){let s=i.padding||qc;const o=i.minimumSpan||Vc;let n=0,a=0,r=0,l=0;const h=[];for(let i=0,s=t.length;i<s;++i){const s=t[i];if(s.map===e.public){const e=s._impl._boundingRect||s._impl.boundingRectAtScale&&s._impl.boundingRectAtScale(1);if(e){if(s._impl.style){const e=s._impl.style._impl.halfStrokeWidthAtResolution();n=Math.max(n,e),a=Math.max(a,e),r=Math.max(r,e),l=Math.max(l,e)}h.push(e)}else{s._impl.updateLayout(!0);const e=s._impl.delegate.paddingForAnnotation(s);n=Math.max(n,e.top),a=Math.max(a,e.right),r=Math.max(r,e.bottom),l=Math.max(l,e.left),h.push(new Kc(s._impl.x,s._impl.y,0,0))}}}if(0===h.length)return null;s=new dn(s.top+n,s.right+a,s.bottom+r,s.left+l);const c=function(e,t){const i=e.toCoordinateRegion();if(i.span.latitudeDelta>=t.latitudeDelta&&i.span.longitudeDelta>=t.longitudeDelta)return e;i.span.latitudeDelta=Math.max(i.span.latitudeDelta,t.latitudeDelta),i.span.longitudeDelta=Math.max(i.span.longitudeDelta,t.longitudeDelta);const s=i.span.latitudeDelta/2,o=i.span.longitudeDelta/2,n=new Hc(vi.convertLongitudeToX(i.center.longitude-o),vi.convertLatitudeToY(i.center.latitude+s)),a=new Hc(vi.convertLongitudeToX(i.center.longitude+o),vi.convertLatitudeToY(i.center.latitude-s));n.x>a.x&&n.x--;return new Kc(n.x,n.y,Math.min(a.x-n.x,1),a.y-n.y)}(ln(h.sort(((e,t)=>e.minX()-t.minX()))),o);return e.padMapRect(c,s,i.cameraDistance)}static setRegionForItems(e,t,i){if(e.ensureRenderingFrame().size.height<=0||e.ensureRenderingFrame().size.width<=0)return!1;if(0===t.length)return!0;const s=!!i.animate,o=$c.getRegionForItems(e,t,i);return!o||(e.setVisibleMapRectAnimated(o,s),!0)}get node(){return this._node}get items(){return this._items.filter(this.isItemExposed,this)}set items(e){g(e,"[MapKit] Map."+this.itemName+"s expected an array of "+this.itemName+"s, but got `"+e+"` instead."),e.forEach((function(e,t){m(e,this.itemConstructor,"[MapKit] Map."+this.itemName+"s expected an "+this.itemName+" at index "+t+", but got `"+e+"` instead.")}),this),e=e.filter((function(e){return!e.map||e.map._impl===this._map||(console.warn("[MapKit] Map."+this.capitalizedItemName+"s: "+this.itemName+" is already in another map."),!1)}),this);const t=[].concat(this._items);e=[].concat(this._items.filter((e=>!this.isItemExposed(e))),e);let i=0,s=0,o=!1;for(;i<e.length;)t[s]!==e[i]?t[s]&&-1===e.indexOf(t[s])?(this.removedItem(t[s],!0),o=!0,s++):(e[i].map&&e[i].map._impl===this._map?t.splice(t.indexOf(e[i]),1):(this.addedItem(e[i],!0),o=!0),i++):(i++,s++);for(;s<t.length;)this.removedItem(t[s],!0),o=!0,s++;e=e.filter((e=>e.map)),this._items=e,o&&this.manyItemsChanged(e,!0)}get selectedItem(){return this._selectedItem}set selectedItem(e){if(e!==this._selectedItem){if(null!=e&&(m(e,this.itemConstructor,"[MapKit] Map.selected"+this.capitalizedItemName+" expected an "+this.itemName+" or `null`, but got `"+e+"` instead."),e.map!==this._map.public))throw new Error("[MapKit] Map.selected"+this.capitalizedItemName+" cannot be set to an "+this.itemName+" that is not in the map.");if(this._selectedItem){const e=this._selectedItem;this._selectedItem=null,e.selected=!1,this._map.selectionMayChange=!1,e.dispatchEvent(new Be.Event(Xc)),this._map.selectionMayChange=!0}e&&(this._selectedItem=e,e.selected=!0,this._map.selectionMayChange=!1,e.dispatchEvent(new Be.Event(Yc)),this._map.selectionMayChange=!0)}}addItem(e,t){return m(e,this.itemConstructor,"[MapKit] Map.add"+this.capitalizedItemName+" expected an "+this.itemName+", but got `"+e+"` instead."),(e=this.addItemToList(e,!1,t))&&this.manyItemsAdded([e],!1),e}addItems(e){g(e,"[MapKit] Map.add"+this.capitalizedItemName+"s expected an array of "+this.itemName+"s, but got `"+e+"` instead.");const t=e.filter((function(e,t){return m(e,this.itemConstructor,"[MapKit] Map.add"+this.capitalizedItemName+"s expected an "+this.itemName+" at index "+t+", but got `"+e+"` instead."),!!this.addItemToList(e,!0)}),this);return t.length>0&&this.manyItemsAdded(t,!0),t}shouldAddItem(e,t){return e.map?(e.map._impl!==this._map&&console.warn("[MapKit] Map."+this.capitalizedItemName+(t?"s":"")+": "+this.itemName+" is already in another map."),!1):!e._impl.isMapFeature||(console.warn("[MapKit] Map."+this.capitalizedItemName+(t?"s":"")+": "+this.itemName+" cannot be added to another map."),!1)}removeItem(e){return m(e,this.itemConstructor,"[MapKit] Map.remove"+this.capitalizedItemName+" expected an "+this.itemName+", but got `"+e+"` instead."),this.isItemExposed(e)?e.map!==this._map.public?console.warn("[MapKit] Map.remove"+this.capitalizedItemName+": cannot remove "+this.itemName+" as it is not attached to this map."):this.removeAnyItem(e):console.warn("[MapKit] Map.remove"+this.capitalizedItemName+": cannot remove "+this.itemName),e}removeAnyItem(e){const t=this._items.indexOf(e);return t>=0&&(this._items.splice(t,1),this.removedItem(e),this.manyItemsRemoved([e],!1)),e}removeItems(e){return g(e,"[MapKit] Map.remove"+this.capitalizedItemName+"s expected an array of "+this.itemName+"s, but got `"+e+"` instead."),e.forEach((function(e,t){m(e,this.itemConstructor,"[MapKit] Map.remove"+this.capitalizedItemName+"s expected an "+this.itemName+" at index "+t+", but got `"+e+"` instead."),this.isItemExposed(e)?e.map!==this._map.public?console.warn("[MapKit] Map.remove"+this.capitalizedItemName+"s: cannot remove "+this.itemName+" at index "+t+" as it is not attached to this map."):e._impl._toBeRemoved=!0:console.warn("[MapKit] Map.remove"+this.capitalizedItemName+"s: cannot remove "+this.itemName+" at index "+t)}),this),this._items=this._items.filter((e=>!e._impl._toBeRemoved)),e.forEach((function(e){e._impl._toBeRemoved&&(delete e._impl._toBeRemoved,this.removedItem(e,!0))}),this),e.length>0&&this.manyItemsRemoved(e,!0),e}enabledItemCloseToPoint(e,t){return this._previousPointForPickingItem&&this._previousPointForPickingItem.equals(e)?(t||(this._closeItemIndex=(this._closeItemIndex+1)%this._closeItems.length),this._closeItems[this._closeItemIndex]):(this._previousPointForPickingItem=e,this._closeItems=this._itemsCloseToPoint(e).filter((e=>e.enabled)),this._closeItemIndex=!t&&this._closeItems.length>1&&this._closeItems[0].selected?1:0,this._closeItems[this._closeItemIndex])}get selectionMayChange(){return!this._map||this._map.selectionMayChange}addItemToList(e,t,i){if(this.shouldAddItem(e,t))return(void 0===i||i<0||i>this._items.length)&&(i=this._items.length),this._items.splice(i,0,e),this.addedItem(e,t),e}addedItem(e,t){"function"==typeof e._impl.setDelegate?e._impl.setDelegate(this):e._impl.delegate=this,e._impl.addedToMap&&e._impl.addedToMap()}manyItemsAdded(e,t){}removedItem(e){e.selected=!1,e._impl.delegate=null,e._impl.removedFromMap&&e._impl.removedFromMap()}manyItemsRemoved(e,t){}manyItemsChanged(e,t){}mapWasDestroyed(){this._map=null,this.removedReferenceToMap()}_deletePreviousPointForPickingItem(){delete this._previousPointForPickingItem,delete this._closeItems,delete this._closeItemIndex}_itemsCloseToPoint(e){const t=this._items.filter((e=>e._impl.canBePicked()));return 0===t.length?[]:this.pickableItemsCloseToPoint(t,e)}}const Jc=$c;const Qc=class extends Ho{constructor(e){super(),this._controller=e}stringInfo(){return"OverlaysControllerNode"}};function ed(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const td=["visible","enabled","selected","data"];const id=class{constructor(e,t){ed(this,"delegate",null),ed(this,"_map",null),ed(this,"_visible",!0),ed(this,"_enabled",!0),ed(this,"_selected",!1),ed(this,"_data",{}),this._public=e,t=_(t),td.forEach((function(e){void 0!==t[e]&&(this[e]=t[e])}),this),Object.keys(t).forEach((e=>{td.indexOf(e)<0&&console.warn("[MapKit] Unknown option: "+e+". Use the data property to store custom data.")}))}get map(){return this._map}set map(e){console.warn("[MapKit] The `map` property of an overlay is read-only. Use map.addOverlay() instead.")}get data(){return this._data}set data(e){this._data=e}get visible(){return this._visible}set visible(e){const t=!!e;this._visible!==t&&(this._visible=t,this.updatedProperty("visible"))}get enabled(){return this._enabled}set enabled(e){this._enabled=!!e}get selected(){return this._selected}set selected(e){const t=!!e;if(t!==this._selected){if(this.delegate&&!this.delegate.selectionMayChange)return void console.warn("[MapKit] Selection may not change in select/deselect event handler.");this._selected=t,this.updatedProperty("selected")}}canBePicked(){return this.shown&&this._visible}setMap(e){e?this._map=e:this._map&&(this._map=null)}handleEvent(){}updatedProperty(e){this.delegate&&this.delegate.overlayPropertyDidChange(this._public,e)}visibleAfterClipping(e,t,i,s,o){this._node.shapes=[];const n=this.visibilityToleranceAtScale(i),a=this._boundingRect||this.boundingRectAtScale(i);if(!this.visible||a.maxY()+n<e.minY()||a.minY()-n>e.maxY())return!1;const r=a.minX()-n,l=a.maxX()+n,h=r<0?1:0,c=1+h;for(let n=h-1;n<=c;++n){const a=0===n?e:new fi(e.origin.x-n,e.origin.y,e.size.width,e.size.height);if(l>=a.minX()&&r<=a.maxX()){const e=this.clipOverlay(a,t,i,s,o);e.length>0&&(e.xOffset=n,this._node.shapes.push(e))}}return this._node.shapes.length>0}visibilityToleranceAtScale(){return 0}};class sd extends Ge{constructor(e){super(),new.target===sd&&Object.defineProperty(this,"_impl",{value:new id(this,e)})}get map(){return this._impl.map}set map(e){this._impl.map=e}get data(){return this._impl.data}set data(e){this._impl.data=e}get visible(){return this._impl.visible}set visible(e){this._impl.visible=e}get enabled(){return this._impl.enabled}set enabled(e){this._impl.enabled=e}get selected(){return this._impl.selected}set selected(e){this._impl.selected=e}}var od,nd,ad;ad={Select:"select",Deselect:"deselect"},(nd="Events")in(od=sd)?Object.defineProperty(od,nd,{value:ad,enumerable:!0,configurable:!0,writable:!0}):od[nd]=ad;const rd=sd;const ld=class{constructor(){this._overlays=[]}fadeOverlayTo(e,t){Object.prototype.hasOwnProperty.call(e,"fadeInOutOpacity")?e.fadeInOutOpacity.durationMs=350*Math.abs(e.fadeInOutOpacity.value-e.fadeInOutOpacity.end):(e.fadeInOutOpacity={durationMs:350},e.setFadeInOutOpacity(1-t),this._overlays.push(e)),e.fadeInOutOpacity.start=e.fadeInOutOpacity.value,e.fadeInOutOpacity.end=t,e.fadeInOutOpacity.startTime=Date.now(),bt.scheduleASAP(this)}performScheduledUpdate(){const e=Date.now();this._overlays=this._overlays.filter((t=>(t.setFadeInOutOpacity(c(t.fadeInOutOpacity.start+(t.fadeInOutOpacity.end-t.fadeInOutOpacity.start)*((e-t.fadeInOutOpacity.startTime)/t.fadeInOutOpacity.durationMs),0,1)),t.fadeInOutOpacity.value!==t.fadeInOutOpacity.end||(delete t.fadeInOutOpacity,!1)))),this._overlays.length>0&&bt.scheduleOnNextFrame(this)}};function hd(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class cd extends Jc{constructor(e){super(e),hd(this,"itemConstructor",rd),hd(this,"itemName","overlay"),hd(this,"capitalizedItemName","Overlay"),this._node=new Qc(this),this._fadeAnimationController=new ld}get map(){return this._map}get userLocationAccuracyRingOverlay(){return this._userLocationAccuracyRingOverlay}isItemExposed(e){return e!==this._userLocationAccuracyRingOverlay}removeUserLocationAccuracyRingOverlay(){this._userLocationAccuracyRingOverlay&&(this.removeAnyItem(this._userLocationAccuracyRingOverlay),delete this._userLocationAccuracyRingOverlay)}removedReferenceToMap(){this._items.forEach((e=>{e._impl.setMap(null)}))}mapCameraDidChange(){0!==this._items.length&&(bt.scheduleASAP(this),this._deletePreviousPointForPickingItem())}overlayPropertyDidChange(e,t){switch(t){case"selected":e.selected?this.selectedItem=e:this.selectedItem=null,this._map.overlaySelectionDidChange(e),bt.scheduleASAP(this);break;case"style":case"visible":case"geometry":bt.scheduleASAP(this)}}fadeOverlayTo(e,t){this._fadeAnimationController.fadeOverlayTo(e,t)}updateUserLocationAccuracyRingOverlay(e){e.coordinate&&(this._userLocationAccuracyRingOverlay?this._userLocationAccuracyRingOverlay.updateForUserLocation(e):this._userLocationAccuracyRingOverlay=this.addItem(new cd.AccuracyRingOverlay(e)))}addedItem(e,t){super.addedItem(e,t),e._impl.setMap(this._map.public),e.selected&&(this.selectedItem=e),bt.scheduleASAP(this)}removedItem(e){e._impl.setMap(null),super.removedItem(e),bt.scheduleASAP(this)}pickableItemsCloseToPoint(e,t,i){const s=document.createElement("canvas",{willReadFrequently:!0}),o=s.getContext("2d"),n=s.width=s.height=1,a=this._map.camera,r=n/2,l=t.x-r,h=t.y-r;o.translate(-l,-h);const c="number"==typeof i?i:this._selectionDistance/Eo.devicePixelRatio;let d=!1;return e.filter((e=>{if(!e._impl.shown)return!1;d&&(o.clearRect(l,h,s.width,s.height),d=!1),e._impl.node._renderer.render(o,a,c),d=!0;return!!o.getImageData(Math.floor(r),Math.floor(r),1,1).data[3]}),this).reverse()}performScheduledUpdate(){const e=this.map;if(!e)return;const t=e.camera.toRenderingMapRect(),i=e.worldSize,s=Math.ceil(h(i)),o=[],n=this._items;for(let a=0,r=n.length;a<r;++a){const r=n[a];if(r._impl.shown=r._impl.visibleAfterClipping(t,true,i,s,!0),r===this._userLocationAccuracyRingOverlay){const t=e.mapType,i=t===Is.Satellite||t===Is.Hybrid?"satellite":e.tint;this._userLocationAccuracyRingOverlay.updateIsShown(e.region,e.worldSize,i)}r._impl.shown&&!r.selected&&(o.push(r._impl.node),r._impl.node.needsDisplay=!0)}const a=this.selectedItem;a&&a._impl.shown&&(o.push(a._impl.node),a._impl.node.needsDisplay=!0),this._node.children=o}}hd(cd,"Overlay",rd),W.jsModules.AccuracyRingOverlay?cd.AccuracyRingOverlay=W.jsModules.AccuracyRingOverlay:W.addEventListener("load",(function e(t){t.jsModules.AccuracyRingOverlay&&(cd.AccuracyRingOverlay=t.jsModules.AccuracyRingOverlay,W.removeEventListener("load",e))}));const dd=cd;function ud(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const pd=class{constructor(e,t){ud(this,"_items",void 0),ud(this,"_data",void 0),this._items=this._toItemsList(e),this._data=t}get data(){return this._data}set data(e){this._data=e}get items(){return this._items}set items(e){this._items=this._toItemsList(e)}_toItemsList(e){return e instanceof Array?e:null===e?[]:[e]}getFlattenedItemList(){return this.items.reduce(((e,t)=>{const i=t&&"object"==typeof t&&"getFlattenedItemList"in t&&"function"==typeof t.getFlattenedItemList?t.getFlattenedItemList():t;return e.concat(i)}),[])}};const md=class{constructor(e,t){!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"_impl",void 0),this._impl=new pd(e,t)}get data(){return this._impl.data}set data(e){this._impl.data=e}get items(){return this._impl.items}set items(e){this._impl.items=e}getFlattenedItemList(){return this._impl.getFlattenedItemList()}},gd=["butt","round","square"],_d=["miter","round","bevel"],fd=["nonzero","evenodd"];let yd=0;class vd extends I{constructor(e){if(super(),this._offsets=[[0],[1]],this._indices=[],this._lastUpdate=yd++,"object"==typeof e)for(const t in e)this.addColorStop(parseFloat(t),e[t])}get offsets(){return this._offsets}get indices(){return this._indices}get lastUpdate(){return this._lastUpdate}addColorStop(e,t){if("number"!=typeof e||!(e>=0&&e<=1))throw new Error("[MapKit] Expected a number between 0 and 1 for offset of LineGradient.addColorStop, but got `"+e+"` instead.");p(t,"string","[MapKit] Expected a string value for color in LineGradient.addColorStop, but got `"+t+"` instead."),this._addColorStop(this._offsets,e,t)}addColorStopAtIndex(e,t){if("number"!=typeof e||e<0||e%1!=0)throw new Error("[MapKit] Expected a integer greater than or equal to 0 for index of LineGradient.addColorStopAtIndex, but got `"+e+"` instead.");p(t,"string","[MapKit] Expected a string value for color in LineGradient.addColorStopAtIndex, but got `"+t+"` instead."),this._addColorStop(this._indices,e,t)}toString(){return"LineGradient"}_addColorStop(e,t,i){const s=e.length;let o=0;for(o=0;o<s&&e[o][0]<t;)++o;o<s&&e[o][0]===t?e[o][1]=i:e.splice(o,0,[t,i]),this._lastUpdate=yd++,this.dispatchEvent(new O(vd.UPDATE_EVENT))}}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(vd,"UPDATE_EVENT","update-color-stop");const bd=vd;const wd=class{constructor(e){Object.defineProperty(this,"_impl",{value:new bd(e)})}addColorStop(e,t){this._impl.addColorStop(e,t)}addColorStopAtIndex(e,t){this._impl.addColorStopAtIndex(e,t)}toString(){return this._impl.toString()}};var Cd;const kd="rgb(0, 122, 255)";class Md extends I{constructor(e){super(),_(e);for(const t in e){const i=Object.getOwnPropertyDescriptor(Md.prototype,t);i&&i.set?this[t]=e[t]:console.warn("[MapKit] Style has no property named `"+t+"`, ignoring.")}}get strokeColor(){return this._strokeColor}set strokeColor(e){null!=e&&p(e,"string","[MapKit] Expected a string value for Style.strokeColor, but got `"+e+"` instead."),this._strokeColor!==e&&(this._strokeColor=e,this._updated())}get strokeOpacity(){return this._strokeOpacity}set strokeOpacity(e){p(e,"number","[MapKit] Expected a number value for Style.strokeOpacity, but got `"+e+"` instead.");const t=c(e,0,1);this._strokeOpacity!==t&&(this._strokeOpacity=t,this._warnLineGradientComparability(),this._updated())}get strokeStart(){return this._strokeStart}set strokeStart(e){if("number"!=typeof e||!(e>=0&&e<=1))throw new Error("[MapKit] Expected a number between 0 and 1 for Style.strokeStart, but got `"+e+"` instead.");this._strokeStart!==e&&(this._strokeStart=e,this._updated())}get strokeEnd(){return this._strokeEnd}set strokeEnd(e){if("number"!=typeof e||!(e>=0&&e<=1))throw new Error("[MapKit] Expected a number between 0 and 1 for Style.strokeEnd, but got `"+e+"` instead.");this._strokeEnd!==e&&(this._strokeEnd=e,this._updated())}get lineWidth(){return this._lineWidth}set lineWidth(e){p(e,"number","[MapKit] Expected a number value for Style.lineWidth, but got `"+e+"` instead.");const t=Math.max(0,e);this._lineWidth!==t&&(this._lineWidth=t,this._updated())}get lineCap(){return this._lineCap}set lineCap(e){const t=gd,i="[MapKit] Expected one of "+t.map((e=>"`"+e+"`")).join(", ")+" for Style.lineCap, but got `"+e+"` instead.";if(p(e,"string",i),t.indexOf(e)<0)throw new TypeError(i);this._lineCap!==e&&(this._lineCap=e,this._warnLineGradientComparability(),this._updated())}get lineJoin(){return this._lineJoin}set lineJoin(e){const t=_d,i="[MapKit] Expected one of "+t.map((e=>"`"+e+"`")).join(", ")+" for Style.lineJoin, but got `"+e+"` instead.";if(p(e,"string",i),t.indexOf(e)<0)throw new TypeError(i);this._lineJoin!==e&&(this._lineJoin=e,this._warnLineGradientComparability(),this._updated())}get lineDash(){return this._lineDash}set lineDash(e){g(e,"[MapKit] Expected an array of numbers for Style.lineDash, but got `"+e+"` instead."),e.forEach(((e,t)=>{p(e,"number","[MapKit] Expected an array of numbers for Style.lineDash, but got `"+e+"` at index "+t+" instead.")})),this._lineDash=e.slice(),this._warnLineGradientComparability(),this._updated()}get lineDashOffset(){return this._lineDashOffset}set lineDashOffset(e){p(e,"number","[MapKit] Expected a number value for Style.lineDashOffset, but got `"+e+"` instead."),this._lineDashOffset!==e&&(this._lineDashOffset=e,this._updated())}get lineGradient(){return this._lineGradient}set lineGradient(e){null!==e&&m(e,wd,"[MapKit] Expected a LineGradient object value (or null) for Style.lineGradient, but got `"+e+"` instead."),this._lineGradient!==e&&(this._lineGradient&&this._lineGradient._impl.removeEventListener(bd.UPDATE_EVENT,this),this._lineGradient=e,this._lineGradient&&this._lineGradient._impl.addEventListener(bd.UPDATE_EVENT,this),this._warnLineGradientComparability(),this._updated())}colorStopsForOverlay(e){if(!this._lineGradient)return null;const t=this._lineGradient;return 0===t._impl.indices.length?t._impl.offsets:e.getColorStops(t._impl)}get fillColor(){return this._fillColor}set fillColor(e){null!=e&&p(e,"string","[MapKit] Expected a string value for Style.fillColor, but got `"+e+"` instead."),this._fillColor!==e&&(this._fillColor=e,this._updated())}get fillOpacity(){return this._fillOpacity}set fillOpacity(e){p(e,"number","[MapKit] Expected a number value for Style.fillOpacity, but got `"+e+"` instead.");const t=c(e,0,1);this._fillOpacity!==t&&(this._fillOpacity=t,this._updated())}get fillRule(){return this._fillRule}set fillRule(e){const t=fd,i="[MapKit] Expected one of "+t.map((e=>"`"+e+"`")).join(", ")+" for Style.fillRule, but got `"+e+"` instead.";if(p(e,"string",i),t.indexOf(e)<0)throw new TypeError(i);this._fillRule!==e&&(this._fillRule=e,this._updated())}shouldStroke(){return(this.strokeColor||this.lineGradient)&&this.strokeOpacity>0&&this.lineWidth>0}shouldFill(){return this.fillColor&&this.fillOpacity>0}halfStrokeWidthAtResolution(){return this.strokeColor&&this.strokeOpacity>0?this.lineWidth/2*Eo.devicePixelRatio:0}styleForHitTesting(e){const t=Object.create(this);return null!=this._fillColor&&(t._fillColor=kd,t._fillOpacity=1),t._strokeColor=kd,t._strokeOpacity=1,t._lineWidth=this.lineWidth+e,t._impl=t,t}toString(){return["strokeColor","strokeOpacity","strokeStart","strokeEnd","lineWidth","lineCap","lineJoin","lineDash","lineDashOffset","lineGradient","fillColor","fillOpacity","fillRule"].filter((function(e){return Object.prototype.hasOwnProperty.call(this,"_"+e)}),this).map((function(e){return e+":"+(Array.isArray(this[e])?JSON.stringify(this[e]):this.prop&&this[e].toString?this[e].toString():this[e])}),this).join(",")}handleEvent(e){e.type===bd.UPDATE_EVENT&&this._updated()}_warnLineGradientComparability(){if(!this.lineGradient)return;const e=[];1!==this.strokeOpacity&&e.push("strokeOpacity"),"round"!==this.lineCap&&e.push("lineCap"),"round"!==this.lineJoin&&e.push("lineJoin"),0!==this.lineDash.length&&e.push("lineDash"),0!==e.length&&(1===e.length?console.warn("[MapKit] lineGradient is incompatible with the following style property: "+e[0]+"."):console.warn("[MapKit] lineGradient is incompatible with the following style properties: "+e.join(", ")+"."))}_updated(){this.dispatchEvent(new O(Md.UPDATE_EVENT))}}(Cd=Md).prototype._strokeColor=kd,Cd.prototype._strokeOpacity=1,Cd.prototype._strokeStart=0,Cd.prototype._strokeEnd=1,Cd.prototype._lineWidth=1,Cd.prototype._lineCap="round",Cd.prototype._lineJoin="round",Cd.prototype._lineDash=[],Cd.prototype._lineDashOffset=0,Cd.prototype._lineGradient=null,Cd.prototype._fillColor=kd,Cd.prototype._fillOpacity=.1,Cd.prototype._fillRule="nonzero",Md.UPDATE_EVENT="update-style";const Sd=Md;const Ld=class{constructor(e){Object.defineProperty(this,"_impl",{value:new Sd(e)})}get strokeColor(){return this._impl.strokeColor}set strokeColor(e){this._impl.strokeColor=e}get strokeOpacity(){return this._impl.strokeOpacity}set strokeOpacity(e){this._impl.strokeOpacity=e}get strokeStart(){return this._impl.strokeStart}set strokeStart(e){this._impl.strokeStart=e}get strokeEnd(){return this._impl.strokeEnd}set strokeEnd(e){this._impl.strokeEnd=e}get lineWidth(){return this._impl.lineWidth}set lineWidth(e){this._impl.lineWidth=e}get lineCap(){return this._impl.lineCap}set lineCap(e){this._impl.lineCap=e}get lineJoin(){return this._impl.lineJoin}set lineJoin(e){this._impl.lineJoin=e}get lineDash(){return this._impl.lineDash}set lineDash(e){this._impl.lineDash=e}get lineDashOffset(){return this._impl.lineDashOffset}set lineDashOffset(e){this._impl.lineDashOffset=e}get lineGradient(){return this._impl.lineGradient}set lineGradient(e){this._impl.lineGradient=e}get fillColor(){return this._impl.fillColor}set fillColor(e){this._impl.fillColor=e}get fillOpacity(){return this._impl.fillOpacity}set fillOpacity(e){this._impl.fillOpacity=e}get fillRule(){return this._impl.fillRule}set fillRule(e){this._impl.fillRule=e}toString(){return this._impl.toString()}};class xd extends id{constructor(e,t={}){const i={};t&&Object.keys(t).forEach((e=>{"style"!==e&&(i[e]=t[e])})),super(e,i),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"_fillable",!0),t.style&&(this.style=t.style)}get style(){return this._style||(this._style=new Ld,this._style._impl.addEventListener(Sd.UPDATE_EVENT,this)),this._style}set style(e){if(this._style){if(this._style===e)return;this._style._impl.removeEventListener(Sd.UPDATE_EVENT,this)}m(e,Ld,"[MapKit] Expected a mapkit.Style value for Overlay.style, but got `"+e+"` instead."),this._style!==e&&(this._style=e,this._style&&this._style._impl.addEventListener(Sd.UPDATE_EVENT,this),this.updatedProperty("style"))}visibilityToleranceAtScale(e){return this.style._impl.halfStrokeWidthAtResolution()/e}clipOverlay(e,t,i,s,o){if(this._simplifiedShapeLevel!==s){const e=Math.abs(this._simplifiedShapeLevel-s),t=!!this._hasPoints,i=this._simplifiedShape;this._simplifiedShape=this.simplifyShapeAtLevel(s),this._simplifiedShapeLevel=s,this._hasPoints=this._simplifiedShape.length>0,1===e&&t!==this._hasPoints&&(this.delegate.fadeOverlayTo(this,t?0:1),t&&(this.fadeInOutOpacity.previousShape=this.clip(i)))}const n=this.fadeInOutOpacity.previousShape||(t||!this.clippedShape?this.clip(this._simplifiedShape,e,this.style._impl.halfStrokeWidthAtResolution()/i):this.clippedShape);return o&&(this.clippedShape=n),n}setFadeInOutOpacity(e){this.fadeInOutOpacity.value=e,this.updatedProperty("style")}handleEvent(e){e.type===Sd.UPDATE_EVENT&&this.updatedProperty("style")}fillPath(e,t){e.save(),e.fillStyle=t.fillColor,e.globalAlpha=t.fillOpacity*this.fadeInOutOpacity.value*this.node.opacity,e.fill(t.fillRule),e.restore()}strokePath(e,t,i,s){e.save(),e.strokeStyle=s||t.strokeColor,e.globalAlpha=t.strokeOpacity*this.fadeInOutOpacity.value*this.node.opacity;const o=i||Eo.devicePixelRatio;e.lineWidth=t.lineWidth*o,t.lineDash.length>0&&"function"==typeof e.setLineDash&&(e.setLineDash(t.lineDash.map((e=>e*o))),e.lineDashOffset=t.lineDashOffset*o),e.lineJoin=t.lineJoin,e.lineCap=t.lineCap,e.stroke(),e.restore()}updateGeometry(){const e=this.calculateBoundingRect();e&&(this._boundingRect=e,this.updatedProperty("geometry"))}}xd.prototype.fadeInOutOpacity={value:1};const Ad=xd;class Ed extends rd{constructor(e){super(),new.target===Ed&&Object.defineProperty(this,"_impl",{value:new Ad(this,e)})}get style(){return this._impl.style}set style(e){this._impl.style=e}}const Td=Ed;const Id=class extends Ls{constructor(e){super(),this.overlay=e}};const Od={colorMap:{},normalize:function(e){return Rd(this.stringToRGBA(e))},stringToRGBA:function(e){if(e in this.colorMap)return this.colorMap[e];if(!this.context){const e=re();this.context=e.getContext("2d")}this.context.canvas.width=this.context.canvas.height=1,this.context.fillStyle=e,this.context.fillRect(0,0,1,1);const t=this.context.getImageData(0,0,1,1).data,i=[t[0],t[1],t[2],t[3]];return this.colorMap[e]=i,i}};function Rd(e){return"rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+")"}function Pd(e,t,i){const s=1-i;return[Math.round(e[0]*s+t[0]*i),Math.round(e[1]*s+t[1]*i),Math.round(e[2]*s+t[2]*i),Math.round(e[3]*s+t[3]*i)]}const Dd=class extends Go{draw(e){if(!this._node.overlay.map)return;const t=this._node.overlay.map._impl.camera;this.render(e,t)}render(e,t,i){let s=this._node.overlay.style;"number"==typeof i&&(s=s._impl.styleForHitTesting(i));const o=this._node.closed&&s._impl.shouldFill(),n=s._impl.shouldStroke();(o||n)&&this.drawShapes(e,s,o,n,t)}drawShapes(e,t,i,s,o){t._impl.lineGradient&&this._node.supportsLineGradient?s&&this.drawGradient(e,t,o):(e.beginPath(),this._node.shapes.forEach((function(t){t.forEach((function(i){let s=o.transformMapPoint(new ts(i[0].x+t.xOffset,i[0].y));e.moveTo(s.x,s.y);for(let n=1,a=i.length;n<a;n++)s=o.transformMapPoint(new ts(i[n].x+t.xOffset,i[n].y)),e.lineTo(s.x,s.y);this._node.closed&&e.closePath()}),this)}),this),i&&this._node.overlay.fillPath(e,t),s&&this._node.overlay.strokePath(e,t,1))}drawGradient(e,t,i){const s=t._impl.colorStopsForOverlay(this._node.overlay);let o=0;this._node.shapes.forEach((function(n){n.forEach((function(a){const r=[];let l;for(;a[0]._offset>s[o][0];)++o,l=s[o][0];for(let e=0,h=a.length;e<h;){const h=a[e]._offset,c=i.transformMapPoint(new ts(a[e].x+n.xOffset,a[e].y));l=s[o][0];const d=Od.normalize(s[o][1]||t.strokeColor);if(h===l)r.push([h,c,d]),++e,++o;else if(h<l){const i=s[o-1],n=i[0],a=i[1]||t.strokeColor,u=Rd(Pd(Od.stringToRGBA(a),Od.stringToRGBA(d),(h-n)/(l-n)));r.push([h,c,u]),++e}else{r[r.length-1].push([l,d]),++o}}this.strokePathForLineEvents(e,r,t)}),this)}),this)}strokePathForLineEvents(e,t,i){for(let s=0,o=t.length-1;s<o;++s){e.beginPath();const o=t[s],n=o[1],a=t[s+1][1];e.moveTo(n.x,n.y),e.lineTo(a.x,a.y);const r=e.createLinearGradient(n.x,n.y,a.x,a.y);if(r.addColorStop(0,o[2]),o.length>2){const e=o[0],n=t[s+1][0]-e;for(let t=3;t<o.length;++t)r.addColorStop(c((o[t][0]-e)/n,0,1),o[t][1]||i.strokeColor)}r.addColorStop(1,t[s+1][2]),this._node.overlay.strokePath(e,i,1,r)}}};const zd=class extends Id{constructor(e,t,i=!0){super(e),this._closed=!!t,i&&(this._renderer=new Dd(this))}get closed(){return this._closed}},Nd=2*Math.PI;function Fd(e,t,i,s,o,n,a){e.beginPath();const r=t.transformMapPoint(new ts(i.x+s,i.y));n&&(n+=t.rotation),a&&(a-=t.rotation),e.arc(r.x,r.y,o,n||0,a||Nd,!0)}const Ud=class extends Dd{drawShapes(e,t,i,s,o){const n=this._node.overlay;this._node.shapes.forEach((function(a){const r=a[0],l=n._mapRadius,h=l*o.worldSize;h<.5||this.drawClipped(e,t,i,s,o,r,l,a.xOffset)||(Fd(e,o,r,a.xOffset,h),i&&n.fillPath(e,t),s&&n.strokePath(e,t,1))}),this)}drawClipped(e,t,i,s,o,n,a,r){const l=o.toRenderingMapRect();if(!s||a<l.size.width||a<l.size.height)return!1;const h=t._impl.halfStrokeWidthAtResolution()/o.worldSize,c=l.minX()-h-r,d=l.maxX()+h-r,u=l.minY()-h,p=l.maxY()+h,m=n.x,g=n.y;function _(e,t){const i=m-e,s=g-t;return i*i+s*s<=a*a}const f=[];let y;_(d,p)&&f.push(new gi(d,p));const v=Math.acos((d-m)/a);if(!isNaN(v)){let e=g+a*Math.sin(v);e>=u&&e<=p&&(y=new gi(d,e),y.angle=v,f.push(y)),e=g-a*Math.sin(v),e>=u&&e<=p&&(y=new gi(d,e),y.angle=Nd-v,f.push(y))}_(d,u)&&f.push(new gi(d,u));const b=Math.asin((u-g)/a);if(!isNaN(b)){let e=m+a*Math.cos(b);e>=c&&e<=d&&(y=new gi(e,u),y.angle=(b+Nd)%Nd,f.push(y)),e=m-a*Math.cos(b),e>=c&&e<=d&&(y=new gi(e,u),y.angle=Math.PI-b,f.push(y))}_(c,u)&&f.push(new gi(c,u));const w=Math.acos((c-m)/a);if(!isNaN(w)){let e=g-a*Math.sin(w);e>=u&&e<=p&&(y=new gi(c,e),y.angle=Nd-w,f.push(y)),e=g+a*Math.sin(w),e>=u&&e<=p&&(y=new gi(c,e),y.angle=w,f.push(y))}_(c,p)&&f.push(new gi(c,p));const C=Math.asin((p-g)/a);if(!isNaN(C)){let e=m-a*Math.cos(C);e>=c&&e<=d&&(y=new gi(e,p),y.angle=Math.PI-C,f.push(y)),e=m+a*Math.cos(C),e>=c&&e<=d&&(y=new gi(e,p),y.angle=(C+Nd)%Nd,f.push(y))}const k=f.length;let M=1;for(;k>2&&M<k&&(!isNaN(f[M-1].angle)||isNaN(f[M].angle)||isNaN(f[(M+1)%k].angle));)M+=1;if(M<k){let l=(M+1)%k;for(;k>2&&!isNaN(f[l].angle)&&!isNaN(f[(l+1)%k].angle);)l=(l+1)%k;const h=a*o.worldSize,c=Math.abs(f[M].angle-f[l].angle),d=h*c-2*h*Math.sin(c/2)>.001,u=o.transformMapPoint(new ts(f[M].x+r,f[M].y)),p=o.transformMapPoint(new ts(f[l].x+r,f[l].y));if(i){d?Fd(e,o,n,r,h,f[M].angle,f[l].angle):(e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y));for(let t=(l+1)%k;isNaN(f[t].angle);t=(t+1)%k){const i=o.transformMapPoint(new ts(f[t].x+r,f[t].y));e.lineTo(i.x,i.y)}this._node.overlay.fillPath(e,t)}s&&(d?Fd(e,o,n,r,h,f[M].angle,f[l].angle):(e.beginPath(),e.moveTo(u.x,u.y),e.lineTo(p.x,p.y)),this._node.overlay.strokePath(e,t))}else k>0&&i&&(e.fillStyle=t.fillColor,e.globalAlpha=t.fillOpacity,e.fillRect(0,0,l.size.width*o.worldSize,l.size.height*o.worldSize));return!0}};const Gd=class extends zd{constructor(e){super(e,!0,!1),this._renderer=new Ud(this)}stringInfo(){const e=this.overlay;return"CircleOverlayNode<radius:"+e.radius+","+e.coordinate.toString().toLowerCase()+">"+(e.style.toString()?"["+e.style+"]":"")}},Bd=vi.Coordinate,Wd=vi.MapRect;const Zd=class extends Ad{constructor(e,t,i,s){super(e,s),this._node=new Gd(this),this.coordinate=t,this.radius=i}get node(){return this._node}get coordinate(){return this._coordinate}set coordinate(e){m(e,Bd,"[MapKit] CircleOverlayInternal.coordinate expected a Coordinate value, but got `"+e+"` instead."),this._coordinate&&this._coordinate.latitude===e.latitude&&this._coordinate.longitude===e.longitude||(this._coordinate=e.copy(),this.updateGeometry())}get radius(){return this._radius}set radius(e){const t="[MapKit] CircleOverlayInternal.radius expected a non-negative number (radius in meters), but got `"+e+"` instead.";p(e,"number",t),e<0&&console.warn(t);const i=Math.max(0,e);this._radius!==i&&(this._radius=i,this.updateGeometry())}calculateBoundingRect(){if(!this._coordinate||isNaN(this._radius))return null;const e=this._center=this._coordinate.toMapPoint(),t=this._mapRadius=this._radius*vi.mapUnitsPerMeterAtLatitude(this._coordinate.latitude);return new Wd(e.x-t,e.y-t,2*t,2*t)}simplifyShapeAtLevel(){return this.clip()}clip(){return[this._coordinate.toMapPoint()]}};const Kd=class extends Td{constructor(e,t,i){super(),Object.defineProperty(this,"_impl",{value:new Zd(this,e,t,i)})}get coordinate(){return this._impl.coordinate}set coordinate(e){this._impl.coordinate=e}get radius(){return this._impl.radius}set radius(e){this._impl.radius=e}};const jd=class extends zd{constructor(e){super(e,!1),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"supportsLineGradient",!0)}stringInfo(){const e=this.overlay;return"PolylineOverlayNode<points:"+(e.points.map((e=>e.toString())).join(",")+">")+(e.style.toString()?"["+e.style+"]":"")}},Hd=function(e,t){const i=[];function s(e){const t=i.length;e._index=t,i.push(e),n(t)}function o(e,t){const s=i[e];return i[e]=i[t],i[t]=s,i[e]._index=e,i[t]._index=t,t}function n(e){for(;e>0;){const t=Math.floor((e-1)/2);if(i[t]._area<=i[e]._area)return;e=o(e,t)}}function a(e){for(;;){const t=2*e+1,s=2*e+2,n=i[e]._area,a=i[t]?i[t]._area:1/0,r=i[s]?i[s]._area:1/0;if(n<=a&&n<=r)return;e=o(e,a<=n&&a<=r?t:s)}}function r(){const e=i[0],t=i.pop();return i.length>0&&(i[0]=t,t._index=0,a(0)),e}function l(e){const t=e._prev,i=e,s=e._next;return Math.abs((t.x-s.x)*(i.y-t.y)-(t.x-i.x)*(s.y-t.y))/2}function h(e,t){const i=e._area;e._area=Math.max(l(e),t),e._area<i?n(e._index):a(e._index)}let c=e.length-1,d=!1,u=!1;t&&c>1&&(e[c].equals(e[0])||(e.push(e[0].copy()),d=!0,++c),u=!0,e.unshift(e[c-1].copy()),++c),e[0]._area=e[c]._area=1/0;for(let t=1;t<c;++t){const i=e[t];i._prev=e[t-1],i._next=e[t+1],i._area=l(i),s(i)}for(u&&e.shift(),d&&e.pop();i.length>0;){const e=r(),t=e._prev,i=e._next;t._prev&&(t._next=i,h(t,e._area)),i._next&&(i._prev=t,h(i,e._area)),delete e._index,delete e._next,delete e._prev}},Vd=function(e,t){const i=1/(t*t),s=e.filter((e=>e._area>i));if(2===s.length){const e=s[0].x-s[1].x,t=s[0].y-s[1].y;if(e*e+t*t<1*i)return[]}return s};const qd=vi.Coordinate,Yd=vi.MapRect,Xd=1e3;function $d(e,t,i){const s=e[i];let o=null;for(let t=i-1;!o;--t)void 0!==e[t]._offset&&(o=e[t]);let n=null;for(let t=i+1;!n;++t)void 0!==e[t]._offset&&(n=e[t]);const a=Math.sqrt(Math.pow(o.x-s.x,2)+Math.pow(o.y-s.y,2));e[i]._offset=Math.min(o._offset+a/t,n._offset)}function Jd(e,t,i,s,o){let n,a=o.minX()-o.size.width;if(e.x<a)return n=(a-e.x)/i,Qd(a,(1-n)*e.y+n*t.y,e,t,i,s);if(a=o.maxX()+o.size.width,e.x>a)return n=(a-e.x)/i,Qd(a,(1-n)*e.y+n*t.y,e,t,i,s);let r=o.minY()-o.size.height;return e.y<r?(n=(r-e.y)/s,Qd((1-n)*e.x+n*t.x,r,e,t,i,s)):(r=o.maxY()+o.size.height,e.y>r?(n=(r-e.y)/s,Qd((1-n)*e.x+n*t.x,r,e,t,i,s)):e)}function Qd(e,t,i,s,o,n){const a={x:e,y:t};if("number"==typeof i._offset&&"number"==typeof s._offset){const r=Math.sqrt(o*o+n*n),l=Math.sqrt(Math.pow(e-i.x,2)+Math.pow(t-i.y,2));a._offset=i._offset+(s._offset-i._offset)*(l/r)}return a}const eu=class extends Ad{constructor(e,t,i){super(e,i),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"_fillable",!1),this._node=new jd(this),this.points=t,this.updateGeometry()}get points(){return this._points.slice()}get node(){return this._node}set points(e){m(e,Array,"[MapKit] PolylineOverlay.points expected an array of Coordinates."),this._points=e.slice(),this._mapPoints=this._points.map(((e,t)=>(m(e,qd,"[MapKit] PolylineOverlay.points expected a Coordinate at index: "+t),e.toUnwrappedMapPoint()))),this._pointsNeedRemapping=!0,delete this._distances,delete this._colorStops,this.updateGeometry()}calculateBoundingRect(){if(0===this._mapPoints.length)return new Yd(0,0,0,0);const e=this._mapPoints.reduce(((e,t)=>(t.x<e.xMin&&(e.xMin=t.x),t.x>e.xMax&&(e.xMax=t.x),t.y<e.yMin&&(e.yMin=t.y),t.y>e.yMax&&(e.yMax=t.y),e)),{xMin:1/0,xMax:-1/0,yMin:1,yMax:0}),t=e.xMax-e.xMin,i=l(e.xMin,1);if(this._pointsNeedRemapping){delete this._pointsNeedRemapping,t>1&&console.warn("[MapKit] Polyline overlay spans over 360Âº in longitude and may not render correctly.");const s=e.xMin-i;this._mapPoints.forEach((e=>{e.x-=s})),Hd(this._mapPoints),delete this._simplifiedShapeLevel}return new Yd(i,e.yMin,t,e.yMax-e.yMin)}simplifyShapeAtLevel(e){delete this._distances;const t=this._simplifiedShapeLevel>e?this._simplifiedShape:this._mapPoints;return Vd(t,Math.pow(2,e))}clip(e,t,i){return e.length>0&&(e=this.clipShapeByStyleProperties(e)),!t||rn(t,this._boundingRect)?0===e.length?[]:[e]:function(e,t,i){const s=t.minX()-i,o=t.minY()-i,n=t.maxX()+i,a=t.maxY()+i,r=Xd*t.size.width,l=Xd*t.size.height,h=[];let c,d;for(let i=0,u=e.length;i<u-1;++i){const u=e[i];d=e[i+1];const p=d.x-u.x;let m,g;if(0!==p){const e=(s-u.x)/p,t=(n-u.x)/p;g=!(e<0&&t<0||e>1&&t>1)}else g=u.x>=s&&u.x<=n;if(g)if(m=d.y-u.y,0!==m){const e=(o-u.y)/m,t=(a-u.y)/m;g=!(e<0&&t<0||e>1&&t>1)}else g=u.y>=o&&u.y<=a;const _=Math.abs(p)>r||Math.abs(m)>l;g?(c||(c=[]),_?(c.push(Jd(u,d,p,m,t)),c.push(Jd(d,u,-p,-m,t)),h.push(c),c=null):c.push(u)):c&&(_?(c.push(Jd(u,d,p,m,t)),c.push(Jd(d,u,-p,-m,t))):c.push(u),h.push(c),c=null)}c&&(c.push(d),h.push(c));return h}(e,t,i)}clipShapeByStyleProperties(e){const t=this.style.strokeStart,i=this.style.strokeEnd,s=this.style.lineGradient;if(0!==t||1!==i||s){if(!this._distances||s&&!this._colorStops){this._length=0,this._distances=[];const t=e.length;for(let i=0;i<t-1;++i){const t=e[i],s=e[i+1],o=Math.sqrt(Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2));this._length+=o,this._distances.push(o)}if(s){if(s._impl.indices.length>0&&void 0!==this._mapPoints[0]._offset)for(let e=0,t=this._mapPoints.length;e<t;++e)delete this._mapPoints[e]._offset;for(let i=0,s=0;i<t-1;++i)e[i]._offset=s/this._length,s+=this._distances[i];t>0&&(e[t-1]._offset=1)}}0===t&&1===i||(e=function(e,t,i,s){if(i>=s)return[];let o=0,n=!1;const a=[];let r;for(let l=0,h=e.length;l<h-1;++l){let h=e[l];r=e[l+1];const c=t[l];if(o+=c,!n&&o>=i){n=!0;const e=(o-i)/c;h={x:e*h.x+(1-e)*r.x,y:e*h.y+(1-e)*r.y,_offset:e*h._offset+(1-e)*r._offset}}if(n&&(a.push(h),o>=s)){const e=(o-s)/c;r={x:e*h.x+(1-e)*r.x,y:e*h.y+(1-e)*r.y,_offset:e*h._offset+(1-e)*r._offset};break}}return a.push(r),a}(e,this._distances,t*this._length,i*this._length))}return e}getColorStops(e){if(!this._colorStops||this._colorStops.lastUpdate!==e.lastUpdate){const t=e.offsets,i=e.indices;this._colorStops=t.slice(),this._colorStops.lastUpdate=e.lastUpdate;let s=0;const o=this._mapPoints.length;for(let e=0,t=i.length;s<this._colorStops.length&&e<t;++s,++e){const t=i[e],n=t[0];if(!(n<o))break;{void 0===this._mapPoints[n]._offset&&$d(this._mapPoints,this._length,n);const e=this._mapPoints[n]._offset,i=t[1];for(;this._colorStops[s][0]<e;)++s;this._colorStops[s][0]===e?this._colorStops[s][1]=i:this._colorStops.splice(s,0,[e,i])}}}return this._colorStops}};const tu=class extends Td{constructor(e,t){super(),Object.defineProperty(this,"_impl",{value:new eu(this,e,t)})}get points(){return this._impl.points}set points(e){this._impl.points=e}};const iu=class extends zd{constructor(e){super(e,!0)}stringInfo(){const e=this.overlay;return"PolygonOverlayNode<points:"+(e.points.map((e=>e.map((e=>e.toString())).join(","))).join("|")+">")+(e.style.toString()?"["+e.style+"]":"")}},su=vi.Coordinate,ou=vi.MapRect;const nu=class extends Ad{constructor(e,t,i){super(e,i),this._node=new iu(this),this.points=t,this.updateGeometry()}get points(){return this._points.map((e=>e.slice()))}get node(){return this._node}set points(e){g(e,"[MapKit] PolygonOverlay.points expected an array of Coordinates."),Array.isArray(e[0])||(e=[e]),this._points=e.map(((e,t)=>(g(e,"[MapKit] PolygonOverlay.points expected an array at index: "+t),e.slice()))),this._polygons=this._points.map(((e,t)=>e.map(((e,i)=>(m(e,su,"[MapKit] PolygonOverlay.points expected a Coordinate at index: "+t+", "+i),e.toUnwrappedMapPoint()))))),this.updateGeometry()}calculateBoundingRect(){const e=function(e){const t=e.filter((e=>e.length>2)).map((e=>{const t=e.reduce(((e,t)=>(t.x<e.xMin&&(e.xMin=t.x),t.x>e.xMax&&(e.xMax=t.x),t.y<e.yMin&&(e.yMin=t.y),t.y>e.yMax&&(e.yMax=t.y),e)),{xMin:1/0,xMax:-1/0,yMin:1,yMax:0});return new ou(t.xMin,t.yMin,t.xMax-t.xMin,t.yMax-t.yMin)})).sort(((e,t)=>e.minX()-t.minX()));return ln(t)}(this._polygons);return delete this._simplifiedShapeLevel,e.size.width>1&&console.warn("[MapKit] Polygon overlay spans over 360Âº in longitude and may not render correctly."),this._polygons.forEach((t=>{0!==t.length&&(t.forEach((t=>{const i=l(t.x,1);t.x=i+(i<e.minX()?1:0)})),Hd(t,!0))})),e}simplifyShapeAtLevel(e){const t=this._simplifiedShapeLevel>e?this._simplifiedShape:this._polygons,i=Math.pow(2,e);return t.reduce(((e,t)=>{const s=Vd(t,i);return s.length>0&&e.push(s),e}),[])}clip(e,t,i){return!t||rn(t,this._boundingRect)?e:function(e,t,i){const s=t.minX()-i,o=t.minY()-i,n=t.maxX()+i,a=t.maxY()+i,r=[];for(let t=0,i=e.length;t<i;++t){const i=e[t],l=[];for(let e=0,t=i.length;e<t;++e){const o=i[e],n=i[(e-1+t)%t];if(o.x>=s){if(n.x<s){const e=(s-o.x)/(n.x-o.x);l.push({x:s,y:(1-e)*o.y+e*n.y})}l.push(o)}else if(n.x>=s){const e=(s-o.x)/(n.x-o.x);l.push({x:s,y:(1-e)*o.y+e*n.y})}}const h=[];for(let e=0,t=l.length;e<t;++e){const i=l[e],s=l[(e-1+t)%t];if(i.y>=o){if(s.y<o){const e=(o-i.y)/(s.y-i.y);h.push({x:(1-e)*i.x+e*s.x,y:o})}h.push(i)}else if(s.y>=o){const e=(o-i.y)/(s.y-i.y);h.push({x:(1-e)*i.x+e*s.x,y:o})}}const c=[];for(let e=0,t=h.length;e<t;++e){const i=h[e],s=h[(e-1+t)%t];if(i.x<=n){if(s.x>n){const e=(n-i.x)/(s.x-i.x);c.push({x:n,y:(1-e)*i.y+e*s.y})}c.push(i)}else if(s.x<=n){const e=(n-i.x)/(s.x-i.x);c.push({x:n,y:(1-e)*i.y+e*s.y})}}const d=[];for(let e=0,t=c.length;e<t;++e){const i=c[e],s=c[(e-1+t)%t];if(i.y<=a){if(s.y>a){const e=(a-i.y)/(s.y-i.y);d.push({x:(1-e)*i.x+e*s.x,y:a})}d.push(i)}else if(s.y<=a){const e=(a-i.y)/(s.y-i.y);d.push({x:(1-e)*i.x+e*s.x,y:a})}}d.length>2&&r.push(d)}return r}(e,t,i)}};const au=class extends Td{constructor(e,t){super(),Object.defineProperty(this,"_impl",{value:new nu(this,e,t)})}get points(){return this._impl.points}set points(e){this._impl.points=e}},ru={OverlaysController:dd,LayerItemsController:Jc,ItemCollection:md,mapkit:{Style:Ld,LineGradient:wd,CircleOverlay:Kd,PolylineOverlay:tu,PolygonOverlay:au,TileOverlay:Sa}};const lu=class{constructor(e){this._map=e,this.panning=!1}update(e,t){if(!this._map.isScrollEnabled)return;const i=e._impl.translatedPosition(),s=i.x,o=s+t.size.width,n=i.y,a=n+t.size.height,r=this._map.ensureVisibleFrame();this._direction=new ts,s<=r.minX()?this._direction.x=1:o>=r.maxX()&&(this._direction.x=-1),n<=r.minY()+5?this._direction.y=1:a>=r.maxY()-5&&(this._direction.y=-1);const l=0!==this._direction.x||0!==this._direction.y;!this.panning&&l?(this.panning=!0,this._startTime=Date.now(),this._initialSpeed=Math.floor(1/104.1*(r.size.width+r.size.height)/2),bt.scheduleOnNextFrame(this)):this.panning&&!l&&this.stop()}stop(){this.panning&&(this.panning=!1,delete this._direction,delete this._startTime,delete this._initialSpeed)}performScheduledUpdate(){if(!this.panning)return;let e=this._initialSpeed;const t=Date.now()-this._startTime;t>4e3?e*=3:t>1e3&&(e*=1.5),this._map.translateCameraAnimated(new ts(this._direction.x*e,this._direction.y*e),!1),this._map.panningDuringAnnotationDrag(),bt.scheduleOnNextFrame(this)}mapWasDestroyed(){delete this._map}};var hu;const cu="mk-hidden",du="mk-invisible";class uu{constructor(e){!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"delegate",null),e&&(this._public=e),this._position=this._position?this._position:new ts,this._anchorPoint=this._anchorPoint?this._anchorPoint:new ts,this._anchorOffset=this._anchorOffset?this._anchorOffset:new window.DOMPoint}init(){}get node(){return this._node}get element(){return this._element}set element(e){console.warn("[MapKit] The `element` property is read-only.")}get anchorOffset(){return this._anchorOffset}set anchorOffset(e){m(e,window.DOMPoint,"[MapKit] Annotation.anchorOffset expected a DOMPoint, but got `"+e+"` instead."),this._anchorOffset=new window.DOMPoint(e.x,e.y),this.updatePosition()}get visible(){return this._visible}set visible(e){e=!!e,this._visible!==e&&(this._visible=e,this._updateVisibility())}get appearanceAnimation(){return this._appearanceAnimation}set appearanceAnimation(e){if(p(e,"string","[MapKit] Annotation.appearanceAnimation expected a string, but got `"+e+"` instead."),""===e)return void(this._appearanceAnimation=this._appearanceAnimationName="");const t=document.createElement("div");t.style.animation=e,this._appearanceAnimationName=t.style.animationName,this._appearanceAnimationName?this._appearanceAnimation=e:console.warn("[MapKit] Annotation.appearanceAnimation expects an animation style value with an animation name, but got `"+e+"` instead.")}nodePosition(){return this._nodePosition||this._node.position}calculateNodePosition(){return new ts(this._position.x-this._anchorPoint.x-this._anchorOffset.x,this._position.y-this._anchorPoint.y-this._anchorOffset.y)}updatePosition(){const e=this.calculateNodePosition();!this.renderedByDOMElement&&this.map&&this.map._impl.cameraIsMoving?this._nodePosition=e:(delete this._nodePosition,this._node.position=e),this.positionWasUpdated(e)}setShown(e){e=!!e,this._shown!==e&&(this._shown=e,this._node.element&&this._node.classList.toggle(cu,!e),this.shownPropertyWasUpdated(e))}shownPropertyWasUpdated(){}positionWasUpdated(e){}isShown(){return this._shown}position(){return this._position}setPosition(e){this._position=e,this.updatePosition()}updateVisibility(e){this._node.classList.toggle(du,e)}setSize(e){this._node.size=e,this._anchorPoint=new ts(e.width/2,e.height),this.updatePosition()}_updateVisibility(){!this._visible&&this._animating||(this.updateVisibility(!this._visible),this.delegate&&this.delegate.annotationPropertyDidChange(this._public||this,"visible"))}}(hu=uu).prototype._shown=!0,hu.prototype._visible=!0,hu.prototype._position=void 0,hu.prototype._anchorPoint=void 0,hu.prototype._anchorOffset=void 0,hu.prototype._appearanceAnimation="",hu.prototype.renderedByDOMElement=!0,hu.prototype.isMapFeature=!1;const pu=uu;class mu extends Ge{constructor(){super(),new.target===mu&&Object.defineProperty(this,"_impl",{value:new pu(this)})}get element(){return this._impl.element}set element(e){this._impl.element=e}get anchorOffset(){return this._impl.anchorOffset}set anchorOffset(e){this._impl.anchorOffset=e}get animates(){return this._impl.animates}set animates(e){this._impl.animates=e}get visible(){return this._impl.visible}set visible(e){this._impl.visible=e}get appearanceAnimation(){return this._impl.appearanceAnimation}set appearanceAnimation(e){this._impl.appearanceAnimation=e}}const gu=mu,_u=vi.Coordinate;class fu{constructor(e){this.displayLines=e.displayLines,e.id&&(this.id=e.id,this.alternateIds=e.alternateIds||[]),e.muid&&(this.muid=e.muid),e.location&&(this.coordinate=new _u(e.location.lat,e.location.lng)),this._completionUrl=e.completionUrl,e.attribution&&(this._providerId=e.attribution.vendorId,this._providerItemId=e.attribution.externalItemId),this.name=e.name,this.telephone=e.telephone,this.urls=e.urls||[],this.country=e.country,this.administrativeArea=e.administrativeArea,this.administrativeAreaCode=e.administrativeAreaCode,this.locality=e.locality,this.postCode=e.postCode,this.subLocality=e.subLocality,this.thoroughfare=e.thoroughfare,this.subThoroughfare=e.subThoroughfare,this.fullThoroughfare=e.fullThoroughfare,this.areasOfInterest=e.areasOfInterest,this.dependentLocalities=e.dependentLocalities,this.timezone=e.timezone,this.timezoneSecondsFromGmt=e.timezoneSecondsFromGmt}}fu.isConstructable=!1;const yu=function(e){if(fu.isConstructable)return new fu(e);throw new TypeError("[MapKit] SearchAutocompleteResult may not be constructed.")};fu.prototype.constructor=yu,yu.prototype=fu.prototype;const vu=fu,bu=(e,t,i)=>{const s=[];for(let o=0;o<e.length;o+=1){let n=parseInt(e.charAt(o),t),a=0;for(;n||a<s.length;)n+=(s[a]||0)*t,s[a]=n%i,n=(n-s[a])/i,a+=1}return s.reduce(((e,t)=>t.toString(i).toUpperCase()+e),"")},wu=(e,t)=>t?`${e}${bu(t.toString(),10,16)}`:"",Cu=e=>wu("G",e.protocolVersion)+wu("H",e.sourceId)+wu("I",e.muid),ku=e=>{const t={};let i=0,s=0;for(let o=0;o<=e.length;o+=1){const n=e.charCodeAt(o),a=isNaN(n)||n>=71&&n<=90;if(i!==s||a||(s=o),i!==s&&a){t[e.substring(i,s)]=e.substring(s,o),i=o,s=o}}const o=t.I;return o?{sourceId:t.H?parseInt(t.H,16):0,protocolVersion:t.G?parseInt(t.G,16):0,muid:bu(o,16,10)}:null},Mu=Object.freeze({Automatic:"automatic",Callout:"callout",FullCallout:"fullCallout",CompactCallout:"compactCallout",OpenInMaps:"openInMaps"});class Su{constructor({style:e}={}){this._impl={},this.style=e||Mu.Automatic}get style(){return this._impl.style}set style(e){if(!d(e,Mu))throw new Error("[MapKit] value passed to `PlaceSelectionAccessory.style` must be a value of `PlaceSelectionAccessory.Styles` enum.");this._impl.style=e}}function Lu(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Su.Styles=Mu;const xu=vi.Coordinate,Au=Object.freeze({element:"ro",map:"ro",coordinate:"ro",id:"rw",place:"rw",title:"rw",subtitle:"rw",data:"rw",accessibilityLabel:"rw",anchorOffset:"rw",calloutOffset:"rw",size:"rw",callout:"rw",selectionAccessory:"rw",selectionAccessoryOffset:"rw",visible:"rw",enabled:"rw",selected:"rw",calloutEnabled:"rw",animates:"rw",appearanceAnimation:"rw",collisionMode:"rw",padding:"rw",draggable:"rw",displayPriority:"rw",clusteringIdentifier:"rw"}),Eu={DragStart:"drag-start",Dragging:"dragging",DragEnd:"drag-end"},Tu={Low:250,High:750,Required:1e3},Iu={Rectangle:"rectangle",Circle:"circle",None:"none"};function Ou(e){var t;class i extends e{constructor(e,t,i,s){super(e),Lu(this,"_data",{}),Lu(this,"delegate",null),Lu(this,"dragOffset",ts.Zero)}init(e,t,s,o){this._calloutOffset=this._calloutOffset?this._calloutOffset:new window.DOMPoint(0,1),this._padding=this._padding?this._padding:new dn,this._selectionAccessoryOffset=this._selectionAccessoryOffset?this._selectionAccessoryOffset:new window.DOMPoint(0,0),super.init(e),_(o);if((t instanceof Si||t instanceof vu)&&((o=o?Object.create(o):{}).place=t,t=t.coordinate),this._setCoordinate(t),this._unsized=!0,this.occluded=!1,this._setNode(t,s,o),o){for(const[e,t]of Object.entries(this.ConstructorOptions))void 0!==o[e]&&("ro"!==t?i.OptionSetters[e]?i.OptionSetters[e].call(this,o[e]):this[e]=o[e]:console.warn("[MapKit] `"+e+"` is read-only and can't be set on the Annotation."));Object.keys(o).forEach((function(e){this.isAKnownOption(e)||console.warn("[MapKit] Unknown option for annotation: "+e+" (use the `data` property instead)")}),this)}Vi.addEventListener(Vi.Events.LocaleChanged,this),this.updateLocalizedText()}get map(){return this.delegate&&this.delegate.mapForAnnotation(this._public)}set map(e){console.warn("[MapKit] The `map` property is read-only.")}get coordinate(){return this._coordinate}set coordinate(e){this.memberAnnotations||this._setCoordinate(e)}get id(){return this._place&&this._place.id||this._id}set id(e){this._id=e}get place(){return this._place}set place(e){if(!(e instanceof Si)&&!(e instanceof vu))throw new TypeError("[MapKit] Expected a Place for Annotation.place, but got `"+e+"` instead");this._place=e}get title(){return this._title}set title(e){null!=e?(p(e,"string","[MapKit] Expected a string value for Annotation.title, but got `"+e+"` instead"),this._title=e):delete this._title,this.updateLocalizedText(),this._updatedProperty("title")}get subtitle(){return this._subtitle}set subtitle(e){null!=e?(p(e,"string","[MapKit] Expected a string value for Annotation.subtitle, but got `"+e+"` instead"),this._subtitle=e):delete this._subtitle,this.updateLocalizedText(),this._updatedProperty("subtitle")}get accessibilityLabel(){return this._accessibilityLabel}set accessibilityLabel(e){null!=e?(p(e,"string","[MapKit] Expected a string value for Annotation.accessibilityLabel, but got `"+e+"` instead"),this._accessibilityLabel=e):delete this._accessibilityLabel,this.updateLocalizedText()}get data(){return this._data}set data(e){this._data=e}get enabled(){return this._enabled}set enabled(e){this._enabled=!!e}get calloutEnabled(){return this._calloutEnabled}set calloutEnabled(e){this._calloutEnabled=!!e}get selected(){return this._selected}set selected(e){const t=!!e;if(t!==this._selected){if(this.delegate&&!this.delegate.selectionMayChange)return void console.warn("[MapKit] Selection may not change in select/deselect event handler.");this._selected=t,this._updatedProperty("selected")}}get animates(){return this._animates}set animates(e){this._animates=!!e}get calloutOffset(){return this._calloutOffset}set calloutOffset(e){m(e,window.DOMPoint,"[MapKit] Annotation.calloutOffset expected a DOMPoint, but got `"+e+"` instead."),this._calloutOffset=new window.DOMPoint(e.x,e.y),this._updatedProperty("calloutOffset")}get callout(){return this._callout}set callout(e){null!==e&&p(e,"object","[MapKit] Annotation.callout expected an object, but got `"+e+"` instead."),this._callout=e}get selectionAccessory(){return this._selectionAccessory}set selectionAccessory(e){if(!this.place&&!this.muid)throw new Error("[MapKit] Selection Accessory can only be set on an annotation with an associated `place`.");null!==e&&m(e,Su,"[MapKit] The `selectionAccessory` parameter passed to `Annotation.selectionAccessory` is not a PlaceSelectionAccessory."),this._selectionAccessory=e}get selectionAccessoryOffset(){return this._selectionAccessoryOffset}set selectionAccessoryOffset(e){m(e,window.DOMPoint,"[MapKit] Annotation.selectionAccessoryOffset expected a DOMPoint, but got `"+e+"` instead."),this._selectionAccessoryOffset=new window.DOMPoint(e.x,e.y),this._updatedProperty("selectionAccessoryOffset")}get draggable(){return this._draggable}set draggable(e){this.memberAnnotations||this._setDraggable(e)}get draggingLift(){return this._draggingLift}set draggingLift(e){if(p(e,"number","[MapKit] Annotation.draggingLift expected a number, but got `"+e+"` instead."),e<0)throw new Error("[MapKit] Annotation.draggingLift must be zero or more.");this._draggingLift=e}get size(){if(this._updateSize(),!this._unsized)return this._node.size.copy()}set size(e){const t="[MapKit] Annotation size expects a size object with width and height properties";p(e,"object",t),p(e.width,"number",t),p(e.height,"number",t),this.setSize(new es(e.width,e.height)),this._userSetSize=!0,this.updateSize()}get opacity(){return this.sceneGraphNode?this.sceneGraphNode.opacity:this.node.opacity}set opacity(e){this.sceneGraphNode?this.sceneGraphNode.opacity=e:this.node.opacity=e}get displayPriority(){return this._displayPriority}set displayPriority(e){this.memberAnnotations||this._setDisplayPriority(e)}isRequired(){return this.selected||this.displayPriority===Tu.Required}get collisionMode(){return this._collisionMode}set collisionMode(e){if(!d(e,Iu))throw new Error("[MapKit] Unknown value for `collisionMode`. Choose from Annotation.CollisionMode.");e!==this._collisionMode&&(this._collisionMode=e,this._updatedProperty("collisionMode"))}get clusteringIdentifier(){return this._clusteringIdentifier}set clusteringIdentifier(e){this.memberAnnotations||this._setClusteringIdentifier(e)}get padding(){return this._padding.copy()}set padding(e){m(e,dn,"[MapKit] The `padding` parameter passed to `Annotation.padding` is not a Padding."),this._padding.equals(e)||(this._padding=e.copy(),this._updatedProperty("padding"))}get needsLayout(){return this._sceneGraphNode&&this._sceneGraphNode.needsLayout}get elementInAnnotationDOM(){return this._node.element.firstChild}getMuidList(){const e=[],t=this.id,i=t?ku(t):null,s=i&&i.muid||this.place&&this.place.muid||this.muid;s&&e.push(s);const o=this.place&&this.place.alternateIds||[];for(const t of o){const i=t?ku(t):null;i&&i.muid&&e.push(i.muid)}return e}centerOffsetForSelectionAccessory(){const e=this.size;return new ts(-e.width/2,-e.height/2)}removedFromMap(){this._removedFromMap=!0,Vi.removeEventListener(Vi.Events.LocaleChanged,this),this._occludedAnimation&&this._occludedAnimation.end(),this._clusteringAnimation&&this._clusteringAnimation.end()}addedToMap(){this._removedFromMap&&(this._removedFromMap=!1,Vi.addEventListener(Vi.Events.LocaleChanged,this),this.updateLocalizedText())}setDelegate(e){this.delegate=e}updateLayout(){}doesAnimate(){return this._animates&&!!this._appearanceAnimationName}willMoveToMap(){this._isMoving=this.doesAnimate(),this._updateSize()}didMoveToMap(){this._isMoving&&this._appearanceAnimationName&&this._visible&&(this.element.style.animation=this._appearanceAnimation,this.element.style.animationName&&(this._animating=!0,this.element.addEventListener("animationend",this))),delete this._isMoving}isStable(){return!(this.isWaiting||this._isMoving||this._isAnimating||this._isLifted)}canShowCallout(){return this._calloutEnabled&&this.isStable()}canShowSelectionAccessory(){return this.isStable()}selectionAccessoryWillAppear(){}selectionAccessoryWillDisappear(){}canBePicked(){return this._shown&&this._visible&&!this._isMoving&&!this._isAnimating&&!this._isLifted&&!this.occluded}draggingDidStart(){this._public.dispatchEvent(new Be.Event(Eu.DragStart))}isDraggable(){return this.draggable&&!this._isLifted}isLifted(){return this._isLifted}dispatchDraggingEvent(){const e=new Be.Event(i.Events.Dragging);return e.coordinate=this._coordinateDuringDrag(),this._public.dispatchEvent(e),e}positionForCallout(){let e=this._calloutAnchorPoint;if(!e){const t=this._userSetSize?this._node.size:this.delegate.sizeForElement(this.elementInAnnotationDOM);e=new ts(-t.width/2,0)}const t=this.nodePosition();return new ts(t.x-e.x-this._calloutOffset.x,t.y-e.y-this._calloutOffset.y)}positionForSelectionAccessory(e,t){const i=this.centerOffsetForSelectionAccessory();i.x-=this._selectionAccessoryOffset.x,i.y-=this._selectionAccessoryOffset.y;const s=this.nodePosition(),o=this.size;let n;switch(e){case"top":n=new ts(i.x,t);break;case"left":n=new ts(t,i.y);break;case"right":n=new ts(-o.width-t,i.y);break;case"bottom":n=new ts(i.x,-o.height-t)}return new ts(s.x-n.x,s.y-n.y)}setDraggingTranslationForMapFrameSize(e,t){this._dragController.setTranslation(this.clampDraggingTranslationForMapFrameSize(e,t))}dropAfterDraggingAndRevertPosition(e){this._dragController.dropAnnotationAfterDraggingAndRevertPosition(e)}distanceToPoint(e){const t=this._node.position.x,i=t+this._node.size.width,s=t-e.x,o=i-e.x,n=s<=0&&o>=0?0:Math.min(Math.abs(s),Math.abs(o)),a=this._node.position.y,r=a+this._node.size.height,l=a-e.y,h=r-e.y,c=l<=0&&h>=0?0:Math.min(Math.abs(l),Math.abs(h));return n*n+c*c}lift(){this._isLifted=!0,this._dragController.lift(this._draggingLift),this._updatedProperty("")}translate(e,t){this.sceneGraphNode?this.sceneGraphNode.transform=(new ss).translate(e,t):this._node.transform=(new Ys).translate(e,t)}translatedPosition(){const e=this._dragController.getTranslation();return new ts(this._position.x-this._anchorPoint.x-this._anchorOffset.x+e.x,this._position.y-this._anchorPoint.y-this._anchorOffset.y+e.y)}updatedPosition(){return this.coordinate?(this.x=vi.convertLongitudeToX(vi.wrapLongitude(this.coordinate.longitude)),this.y=vi.convertLatitudeToY(this.coordinate.latitude),!0):(this.setShown(!1),this.sceneGraphNode&&this.sceneGraphNode.remove(),!1)}get sceneGraphNode(){return this._sceneGraphNode}mayBeDrawn(){return!!this.sceneGraphNode&&this._shown&&this.visible&&!this.isWaiting}isDrawn(){return(!this.occluded||this._occludedAnimation)&&this.mayBeDrawn()}animateOcclusion(){const e=this.occluded?0:1;this._sceneGraphNode&&(this._occludedAnimation&&this._occludedAnimation.end(),this._occludedAnimation=new Jo({node:this._sceneGraphNode,from:1-e,to:e,duration:200,done:()=>{delete this._occludedAnimation}}).begin());const t=this.occluded&&this.cluster&&this.cluster._impl&&!this.cluster._impl.occluded,i=!this.occluded&&this.previousCluster&&!this.previousCluster._impl.wasOccluded;(t||i)&&this._animateClustering()}positionWasUpdated(e){this._sceneGraphNode&&(this._sceneGraphNode.needsDisplay=!0)}handleEvent(e){switch(e.type){case Vi.Events.LocaleChanged:this.updateLocalizedText();break;case"animationend":if(e.animationName!==this._appearanceAnimationName)return;this.element.style.animation="",this.element.removeEventListener("animationend",this),this.finishedAnimating()}}updateLocalizedText(){this._node&&this._node.element&&this._node.element.setAttribute("aria-label",this.altText())}altText(){return this._accessibilityLabel||(this.title&&this.subtitle?Vi.get("Annotation.Generic.AccessibilityLabel",{title:this.title,subtitle:this.subtitle}):this.title||this.subtitle||"")}updateSize(){delete this._unsized,this._selected&&this.delegate&&this.delegate.selectedAnnotationDidMoveToMap(this._public)}clampDraggingTranslationForMapFrameSize(e,t){const i=this._anchorPoint.x+this._anchorOffset.x-this._position.x,s=t.width-this._node.size.width+i,o=this._anchorPoint.y+this._anchorOffset.y+this._dragController.liftAmount-this._position.y,n=t.height-this._node.size.height+o;return new ts(c(e.x,i,s),c(e.y,o,n))}droppedAfterLift(){delete this._isLifted,this._selected&&this.delegate&&this.delegate.selectedAnnotationDidMoveToMap(this._public),this._updatedProperty("")}draggingDidEnd(){this.coordinate=this._coordinateDuringDrag(),this.resetNodeTransform(),this._public.dispatchEvent(new Be.Event(i.Events.DragEnd))}resetNodeTransform(){this.node.transform=new Ys}finishedAnimating(){delete this._isAnimating,this._selected&&this.delegate&&this.delegate.selectedAnnotationDidMoveToMap(this._public),this._visible||this._updateVisibility(),this.delegate&&this.delegate.annotationFinishedAnimating(this._public)}isAKnownOption(e){return Object.keys(this.ConstructorOptions).includes(e)}_animateClustering(){if(this._sceneGraphNode){const e={annotation:this,node:this._sceneGraphNode,duration:200,done:()=>delete this._clusteringAnimation};this.cluster?(e.from=this.coordinate.toMapPoint(),e.to=this.cluster.coordinate.toMapPoint()):(e.from=this.previousCluster.coordinate.toMapPoint(),e.to=this.coordinate.toMapPoint());const t=e.to.x-e.from.x;t<-.5?e.to.x+=1:t>.5&&(e.from.x+=1),this._clusteringAnimation&&this._clusteringAnimation.end(),this._clusteringAnimation=new Ru(e).begin()}}_setCoordinate(e){m(e,xu,"[MapKit] Annotation.coordinate expected a Coordinate value."),delete this._translation,this._coordinate=e.copy(),this._updatedProperty("coordinate")}_setDraggable(e){const t=!!e;t!==this._draggable&&(this._draggable=t,this._updatedProperty("draggable"))}_setDisplayPriority(e){const t="[MapKit] Annotation displayPriority expects a number between 0 and "+Tu.Required;p(e,"number",t);const i=c(e,0,Tu.Required);if(i!==e)console.warn(t+", value was normalized");else if(i===this._displayPriority)return;this._displayPriority=i,this._updatedProperty("displayPriority")}_setClusteringIdentifier(e){null!==e&&p(e,"string","[MapKit] Annotation clusteringIdentifier expects a string"),this._clusteringIdentifier!==e&&(this._clusteringIdentifier=e,this._updatedProperty("clusteringIdentifier"))}_coordinateDuringDrag(){const e=this.sceneGraphNode?this._dragController.translation.x:0,t=this.sceneGraphNode?this._dragController.translation.y-this._dragController.liftAmount:0,i=this.node.convertPointToPage(new ts(e+this.dragOffset.x+this._anchorPoint.x+this.anchorOffset.x,t+this.dragOffset.y+this._anchorPoint.y+this.anchorOffset.y));return this.delegate._map.convertPointOnPageToCoordinate(new window.DOMPoint(i.x,i.y))}_updateSize(){if(!this._unsized||this._userSetSize||!this.delegate)return;const e=this.delegate.sizeForElement(this.elementInAnnotationDOM);e&&(delete this._unsized,this.setSize(e))}_updatedProperty(e){this.delegate&&this.delegate.annotationPropertyDidChange(this._public,e)}}return(t=i).prototype._calloutOffset=void 0,t.prototype._enabled=!0,t.prototype._selected=!1,t.prototype._calloutEnabled=!0,t.prototype._draggable=!1,t.prototype._title="",t.prototype._subtitle="",t.prototype._accessibilityLabel=null,t.prototype._displayPriority=Tu.Required,t.prototype._collisionMode=Iu.Rectangle,t.prototype._clusteringIdentifier=null,t.prototype._sceneGraphNode=null,t.prototype._padding=void 0,t.prototype._draggingLift=40,t.prototype.shouldHideLabels=!1,t.prototype._callout=null,t.prototype._selectionAccessory=null,t.prototype._selectionAccessoryOffset=void 0,t.prototype._animates=!1,t.prototype.ConstructorOptions=Au,Lu(i,"Events",Eu),Lu(i,"DisplayPriority",Tu),Lu(i,"CollisionMode",Iu),Lu(i,"OptionSetters",Object.freeze({draggable:t.prototype._setIsDraggable,displayPriority:t.prototype._setDisplayPriority,clusteringIdentifier:t.prototype._setClusteringIdentifier})),i}class Ru extends $o{constructor(e){super(e),this.annotation=e.annotation}update(e){const t=this.annotation;if(null==t.delegate)return;const i=t.delegate._map,s=i.camera.toRenderingMapRect(),o=vi.wrapX((1-e)*this.from.x+e*this.to.x,s.midX()),n=(1-e)*this.from.y+e*this.to.y,a=i.adjustMapItemPoint(i.camera.transformMapPoint(new ts(o,n)));this.node.transform=(new ss).translate(a.x-t._position.x,a.y-t._position.y)}stringInfo(){return super.stringInfo("translation*")}}Ou.Events=Eu,Ou.DisplayPriority=Tu,Ou.CollisionMode=Iu;const Pu=Ou;function Du(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const zu=class{constructor(e){Du(this,"liftDurationMs",200),Du(this,"liftOpacity",.5),this._annotation=e}animateLift(){const e=Math.min((Date.now()-this._liftAnimationStartDate)/this.liftDurationMs,1);this._annotation.translate(this.translation.x,this.translation.y-this.liftAmount*e),this._annotation.opacity=1-(1-this.liftOpacity)*e,e<1?(bt.scheduleOnNextFrame(this),this._liftAnimationProgress=e):(delete this._liftAnimationStartDate,delete this._liftAnimationProgress)}animateDropAfterLift(){const e=Math.max(this._dropAnimationStartP-Math.min((Date.now()-this._dropAfterLiftAnimationStartDate)/this.liftDurationMs,1),0);this._dropAnimationRevert&&this._annotation.translate(0,-this.liftAmount*e),this._annotation.opacity=1-(1-this.liftOpacity)*e,e>0?bt.scheduleOnNextFrame(this):this._annotation.droppedAfterLift()}dropAnnotationAfterDraggingAndRevertPosition(e){this._liftAnimationStartDate?(this._dropAnimationStartP=this._liftAnimationProgress,delete this._liftAnimationStartDate,delete this._liftAnimationProgress):this._dropAnimationStartP=1,e?this._annotation.resetNodeTransform():this._annotation.draggingDidEnd(),this._dropAfterLiftAnimationStartDate=Date.now(),this._dropAnimationRevert=e,bt.scheduleOnNextFrame(this)}lift(e){this.liftAmount=e,this.translation=new ts,e>0?(this._liftAnimationStartDate=Date.now(),this._liftAnimationProgress=0,bt.scheduleOnNextFrame(this)):this._annotation.opacity=this.liftOpacity}getTranslation(){return new ts(this.translation.x,this.translation.y-this.liftAmount)}setTranslation(e){this.translation=e,this._liftAnimationStartDate||this._annotation.translate(this.translation.x+this._annotation.dragOffset.x,this.translation.y-this.liftAmount+this._annotation.dragOffset.y)}performScheduledUpdate(){this._liftAnimationStartDate?this.animateLift():this._dropAfterLiftAnimationStartDate&&this.animateDropAfterLift()}},Nu=Pu(pu);Nu.prototype._animates=!0,Nu.prototype._setNode=function(e,t,i){p(t,"function");const s=ue(t,window,[e,i]);oe(s,"[MapKit] Annotation element factory must return a DOM element, got `"+s+"` instead."),this._element=s;let o=s;if(Eo.supportsShadowDOM){const e="mk-slot-"+Math.random().toString(32).substr(2,8);s.slot=e,o=Eo.htmlElement("slot"),o.name=e}this._node=new po.Node(Eo.htmlElement("div",o)),this._node.wantsHardwareCompositing=this.renderedByDOMElement,this._dragController||(this._dragController=new zu(this))},Nu.div=function(){return document.createElement("div")};const Fu=Nu;function Uu(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class Gu extends gu{constructor(e,t,i){super(),new.target===Gu&&(Object.defineProperty(this,"_impl",{value:new Fu(this,e,t,i)}),this._impl.init(this,e,t,i))}get map(){return this._impl.map}set map(e){this._impl.map=e}get coordinate(){return this._impl.coordinate}set coordinate(e){this._impl.coordinate=e}get id(){return this._impl.id}get title(){return this._impl.title}set title(e){this._impl.title=e}get subtitle(){return this._impl.subtitle}set subtitle(e){this._impl.subtitle=e}get accessibilityLabel(){return this._impl.accessibilityLabel}set accessibilityLabel(e){this._impl.accessibilityLabel=e}get data(){return this._impl.data}set data(e){this._impl.data=e}get enabled(){return this._impl.enabled}set enabled(e){this._impl.enabled=e}get calloutEnabled(){return this._impl.calloutEnabled}set calloutEnabled(e){this._impl.calloutEnabled=e}get selectionAccessory(){return this._impl.selectionAccessory}set selectionAccessory(e){this._impl.selectionAccessory=e}get selectionAccessoryOffset(){return this._impl.selectionAccessoryOffset}set selectionAccessoryOffset(e){this._impl.selectionAccessoryOffset=e}get selected(){return this._impl.selected}set selected(e){this._impl.selected=e}get animates(){return this._impl.animates}set animates(e){this._impl.animates=e}get calloutOffset(){return this._impl.calloutOffset}set calloutOffset(e){this._impl.calloutOffset=e}get callout(){return this._impl.callout}set callout(e){this._impl.callout=e}get draggable(){return this._impl.draggable}set draggable(e){this._impl.draggable=e}get size(){return this._impl.size}set size(e){this._impl.size=e}get displayPriority(){return this._impl.displayPriority}set displayPriority(e){this._impl.displayPriority=e}get collisionMode(){return this._impl.collisionMode}set collisionMode(e){this._impl.collisionMode=e}get clusteringIdentifier(){return this._impl.clusteringIdentifier}set clusteringIdentifier(e){this._impl.clusteringIdentifier=e}get padding(){return this._impl.padding}set padding(e){this._impl.padding=e}}Uu(Gu,"EVENTS",Pu.EVENTS),Uu(Gu,"DisplayPriority",Pu.DisplayPriority),Uu(Gu,"CollisionMode",Pu.CollisionMode);const Bu=Gu;const Wu=class extends Go{pathForSquareDot(e,t){const i=.6*t,s=.4*t;e.moveTo(t,0),e.lineTo(t+s,0),e.arc(t+s,i,i,Math.PI/2*3,0),e.lineTo(2*t,t+s),e.arc(t+s,t+s,i,0,Math.PI/2),e.lineTo(i,2*t),e.arc(i,t+s,i,Math.PI/2,Math.PI),e.lineTo(0,t-s),e.arc(i,i,i,Math.PI,Math.PI/2*3),e.lineTo(t,0)}};let Zu;const Ku=["default","selected","bubble"];let ju=[],Hu=" ",Vu="default-loading";function qu(e,t,i,s){null==s&&(s=t.glyphText),e.save(),e.fillStyle=t.glyphColor;let o,n=i.glyphFontSize;do{e.font=n--+"px "+Bs,o=e.measureText(s).width}while(o>i.glyphImageSize&&n>0);e.textBaseline="alphabetic";const a=i.balloonRadius+.35*n;let r;return"1"===s?(e.textAlign="left",r=i.balloonRadius-o/2-o/16,e.fillText(s,r,a,i.glyphImageSize)):(e.textAlign="center",e.fillText(s,i.balloonRadius,a,i.glyphImageSize)),e.restore(),n+1}function Yu(){const e=Math.min(Eo.imagePixelRatio,3),t=(e>1?"_"+e+"x":"")+".png",i={};let s=Ku.length;function o(){--s,0===s&&(Zu=i,Zu.lifted=Zu.default,Hu="",Vu="default",ju.forEach((e=>{e.freeze(),e.needsDisplay=!0})),ju=void 0)}Ku.forEach((e=>{i[e]={},function(e){const s=new oa(V.Highest,{urlForImageLoader:St.createImageUrl("pins/marker"+(e?"-":"")+e+t),loaderDidSucceed:function(){i[e]=s.image,o()},loaderDidFail:function(){console.warn("[MapKit] Error loading marker annotation image "+s.url+"; marker annotations may not display correctly."),Hu="?",Vu="default-error",o()}});s.crossOrigin=sa.getCorsAttribute(Ue.distUrlWithCredentials),s.schedule()}(e)}))}let Xu=!1;function $u(){Xu||(Xu=!0,Ue.state!==Ue.States.PENDING&&Ue.state!==Ue.States.READY?Ue.addEventListener(Ue.Events.Initialized,(function e(){Ue.removeEventListener(Ue.Events.Initialized,e),Yu()})):Yu())}const Ju=class extends Wu{static loadMarkerResources(){$u()}draw(e){this._sharedLayer&&(this._sharedLayer.renderer=this);const t=this._node,i=t.state,s=t.annotation,o=t.params;if(!s.balloonVisible)return;!s.warnOnUnselectedGlyphImageAccess||"default"!==i&&"lifted"!==i||console.warn("[MapKit] Unselected glyph image style is not available for this annotation."),delete this.glyphImageSrc,delete this.isTainted,delete this.renderType,e.save(),"bubble"!==o.style&&(e.shadowOffsetY=o.shadowOffsetY*o.balloonRadius,e.shadowBlur=o.shadowBlur,e.shadowColor=o.shadowColor);const n="poi"===o.style;if(e.beginPath(),"callout"===i)this.drawDotUnderCallout(e,s.haloColor||s.fillColor,o.radius);else{if(this.pathForBalloon(e,o.balloonRadius,o.style),n?e.fillStyle=s.haloColor||s.glyphColor:s.isPlaceStyle&&"selected"===i?e.fillStyle=s.haloColor||s.fillColor:e.fillStyle=s.fillColor,e.fill(),e.save(),n){e.beginPath();const t=o.balloonRadius-o.borderWidth;this.pathForMask(e,o.balloonRadius,t),e.fillStyle=s.fillColor,e.fill()}e.restore()}if(e.restore(),"callout"!==i)if(delete this.glyphFontSize,s.glyphText)this.glyphFontSize=qu(e,s,o),this.renderType="glyphText";else{const[n,a]=function(e,t,i,s,o,n){let a,r=o?2*s.balloonRadius:s.glyphImageSize,l=Eo.roundToDevicePixel((t.size.width-r)/2),h=!1;a="default"===i||"lifted"===i?t.glyphImage:t.selectedGlyphImage||t.glyphImage;0;0;if(!a&&t.enablesDefaultGlyphImage){if(Hu)return $u(),ju.indexOf(t)<0&&ju.push(t),qu(e,t.annotation,s,Hu),[null,!1];a=Zu["bubble"===t.params.style?"bubble":i],r=s.glyphImageSize,l=Eo.roundToDevicePixel((t.size.width-r)/2),o=!1,h=!0}try{let i;const c="poi"!==s.style&&"default"!==s.style&&t.annotation.haloColor&&t.annotation.haloColor!==t.annotation.fillColor?t.annotation.fillColor:void 0;return i=o?function(e,t,i,s,o){e._maskedPOIImage||(e._maskedPOIImage=[]);const n=Eo.devicePixelRatio,a=i*n;if(!e._maskedPOIImage[a]){const i=s*n/2,r=re();r.width=a,r.height=a;const l=r.getContext("2d");l.beginPath(),o(l,a/2,i),t&&(l.fillStyle=t,l.fill()),l.clip(),l.drawImage(e,0,0,a,a),e._maskedPOIImage[a]=r}return e._maskedPOIImage[a]}(a,c,r,2*(s.balloonRadius-s.borderWidth),n):function(e,t,i){e._tinted||(e._tinted={});e._tinted[t]||(e._tinted[t]=[]);const s=i*Eo.devicePixelRatio;if(!e._tinted[t][s]){const i=re();i.width=s,i.height=s;const o=i.getContext("2d");o.fillStyle=t,o.fillRect(0,0,s,s),o.globalCompositeOperation="destination-in",o.drawImage(e,0,0,s,s),e._tinted[t][s]=i}return e._tinted[t][s]}(a,t.annotation.glyphColor,r),e.drawImage(i,l,l,r,r),h?[null,!1]:[a.src,null===a.crossOrigin]}catch(e){return t.glyphImageError(),[null,!1]}}(e,t,i,o,s.isPlaceStyle,((e,t,i)=>this.pathForMask(e,t,i)));this.glyphImageSrc=n,this.isTainted=a,this.renderType=this.glyphImageSrc?"glyphImage":Vu}}get isFallbackGlyphTextPending(){return!Zu}addPendingNode(e){ju.indexOf(e)<0&&ju.push(e)}get fallbackGlyphText(){return Hu}get rendererForSharedLayer(){return this._sharedLayer?this._sharedLayer.renderer:this}drawDotUnderCallout(){0}pathForBalloon(){0}pathForMask(){0}};const Qu=class extends Ju{drawDotUnderCallout(e,t,i){e.strokeStyle=t,e.lineWidth=i,e.arc(i,i,i/2,0,2*Math.PI),e.stroke()}pathForBalloon(e,t,i){switch(i){case"balloon":e.save(),e.scale(t/256,t/256),e.moveTo(327.439,501.776),e.lineTo(327.525,501.776),e.bezierCurveTo(301.142,509.276,279.265,526.476,266.881,550.341),e.bezierCurveTo(263.709,556.456,261.65,562.811,255.956,562.811),e.bezierCurveTo(250.262,562.811,248.204,556.456,245.03,550.341),e.bezierCurveTo(232.648,526.471,210.771,509.272,184.388,501.776),e.lineTo(184.561,501.776),e.bezierCurveTo(77.943,470.858,0,372.507,0,255.944),e.bezierCurveTo(0,114.59,114.615,0,256,0),e.bezierCurveTo(397.385,0,512,114.59,512,255.944),e.bezierCurveTo(512,372.507,434.057,470.858,327.439,501.775),e.closePath(),e.restore();break;case"default":{const i=t/13.5*5,s=i/6,o=i/3,n=2*t,a=.448*t,r=.385*t;e.moveTo(n,t),e.bezierCurveTo(n,1.5*t,n-r,n-i/3,t+i/2+o,n),e.bezierCurveTo(t+i/3,n+i/3,t+s,n+i,t,n+i),e.bezierCurveTo(t-s,n+i,t-i/3,n+i/3,t-(i/2+o),n),e.bezierCurveTo(r,n-i/3,0,1.5*t,0,t),e.bezierCurveTo(0,a,a,0,t,0),e.bezierCurveTo(n-a,0,n,a,n,t),e.closePath();break}default:e.arc(t,t,t,0,2*Math.PI)}}pathForMask(e,t,i){e.arc(t,t,i,0,2*Math.PI)}};const ep=class extends Ju{drawDotUnderCallout(e,t,i){e.fillStyle=t,this.pathForSquareDot(e,i),e.fill()}pathForBalloon(e,t,i){e.save(),e.scale(t/256,t/256),e.moveTo(424.278,512.1),"balloon"!==i&&"default"!==i||(e.lineTo(363.104,512.1),e.bezierCurveTo(302.97,513.623,278.509,528.747,266.778,551.35),e.bezierCurveTo(263.607,557.462,261.548,563.819,255.857,563.819),e.bezierCurveTo(250.167,563.819,248.107,557.462,244.937,551.35),e.bezierCurveTo(233.205,528.747,208.743,513.623,148.61,512.1)),e.lineTo(87.723,512.1),e.bezierCurveTo(39.475,512.099,0,472.713,0,424.573),e.lineTo(0,87.525),e.bezierCurveTo(0,39.387,39.475,0,87.723,0),e.lineTo(424.278,0),e.bezierCurveTo(472.525,0,512,39.387,512,87.525),e.lineTo(512,424.573),e.bezierCurveTo(512,472.713,472.525,512.099,424.278,512.099),e.closePath(),e.restore()}pathForMask(e,t,i){e.save();const s=t-i;e.translate(s,s),e.scale(i/256,i/256),e.moveTo(424.278,512.1),e.lineTo(87.723,512.1),e.bezierCurveTo(39.475,512.099,0,472.713,0,424.573),e.lineTo(0,87.525),e.bezierCurveTo(0,39.387,39.475,0,87.723,0),e.lineTo(424.278,0),e.bezierCurveTo(472.525,0,512,39.387,512,87.525),e.lineTo(512,424.573),e.bezierCurveTo(512,472.713,472.525,512.099,424.278,512.099),e.closePath(),e.restore()}};function tp(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const ip=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const sp=class extends Ls{constructor(e,t){super(),tp(this,"delegate",null),tp(this,"enablesDefaultGlyphImage",!0),this.annotation=e,t&&(this._state=t)}setDelegate(e){this.delegate=e}isTainted(){return this._renderer.isTainted}stringInfo(){const e=this._renderer.rendererForSharedLayer,t=ip(this,"_state")?"<"+this.state+">":"",i=ip(e,"glyphFontSize")?' "'+this.annotation.glyphText+'"@'+e.glyphFontSize:"",s=[];this._renderer instanceof ep&&s.push("â¹"),this.annotation.balloonVisible||s.push("ð»"),this.annotation.isAppStyle&&s.push("â­ï¸"),this.annotation.isPlaceStyle&&s.push("ð");const o=s.length?` ${s.join(" ")}`:"",n=e.glyphImageSrc?" ð¼ "+e.glyphImageSrc:"";return"MarkerAnnotationBalloonNode"+t+("<color: "+this.annotation.fillColor+(this.annotation.haloColor?"/"+this.annotation.haloColor:"")+">")+i+n+o}get state(){return ip(this,"_state")?this._state:this.delegate.state}get params(){return this.delegate.getParamsFromState(this.state)}get layerBounds(){const e=Math.ceil(this.size.width/2),t=Math.ceil(this.size.height/4);return new is(-e,-t,this.size.width+2*e,Math.ceil(1.5*this.size.height)+t)}glyphImageError(e){"selected"===e&&this.selectedGlyphImage?delete this.selectedGlyphImage:delete this.glyphImage,this.needsDisplay=!0}setBalloonStyle(){if(this.annotation.useSquareBalloon){if(this._renderer&&this._renderer.constructor===ep)return;this._renderer=new ep(this)}else{if(this._renderer&&this._renderer.constructor===Qu)return;this._renderer=new Qu(this)}}freeze(){if("default"!==this.state&&"lifted"!==this.state)return void(this.keyForFrozenLayer="");const e=this.annotation;!e.glyph&&this._renderer.isFallbackGlyphTextPending&&this._renderer.addPendingNode(this);let t=e.fillColor;e.haloColor&&(t+="/"+e.haloColor),this.keyForFrozenLayer="balloon-"+[t,e.glyph?e.glyph:this._renderer.fallbackGlyphText,e.glyphColor,e.useSquareBalloon?"square":""].join("-"),this.annotation.balloonVisible||(this.keyForFrozenLayer+="-nonvisible"),this.annotation.isPlaceStyle&&(this.keyForFrozenLayer+="-place"),this.annotation.isAppStyle&&(this.keyForFrozenLayer+="-app")}};const op=class extends Wu{draw(e){const t=this._node;t.annotation.balloonVisible&&(e.save(),e.beginPath(),this.pathForDot(e,t.radius),e.fillStyle=t.annotation.haloColor||t.annotation.fillColor,e.fill(),e.restore())}pathForDot(){0}};const np=class extends op{pathForDot(e,t){e.arc(t,t,t,0,2*Math.PI)}};const ap=class extends op{pathForDot(e,t){this.pathForSquareDot(e,t)}};const rp=class extends Ls{constructor(e,t){super(),this.annotation=e,this.radius=t,e.useSquareBalloon?this._renderer=new ap(this):this._renderer=new np(this)}stringInfo(){const e=this._renderer instanceof ap?" â¹":"";return"MarkerAnnotationDotNode<color: "+this.annotation.fillColor+">"+e}};function lp(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class hp extends Go{constructor(e){super(e),lp(this,"_scale",1),lp(this,"_params",void 0),this._params=pp()}get params(){const e=(this.node?this.node.fontSizeRatio:0)||this._scale;return this.node&&this._scale!==e&&(this._scale=e,up(this._scale,this._params)),this._params}_setTextProperties(e){const t=this._node,i=this.params[t.kind];e.font=i.font,e.textAlign=this.params.textAlign,e.textBaseline="bottom",e.miterLimit=this.params.miterLimit}draw(e){const t=this._node,i=this.params[t.kind];this._setTextProperties(e);const s=t.parent.annotation.darkColorScheme?"dark":"light";e.fillStyle=i.color[s],e.strokeStyle=this.params.haloColor[s],e.lineWidth=this.params.haloSize;const o=t.size.width/2,n=i.height-i.yPadding;e.strokeText(t.text,o,n),e.fillText(t.text,o,n)}}const cp={title:{font:"600 11px "+Bs,fontWeight:600,fontFamily:Bs,height:16,fontSize:11,lineHeight:12,yPadding:1},subtitle:{font:"500 10px "+Bs,fontWeight:500,fontFamily:Bs,height:15,fontSize:10,lineHeight:11,yPadding:1}},dp=(e,t,i)=>{const s=cp[e],o=s.fontFamily||Bs,n=s.fontWeight||500,a=(s.fontSize||11)*t,r=`${n} ${a}px ${o}`;if(i){const e=(s.height||16)*t,o=(s.lineHeight||12)*t;i.weight=n,i.fontSize=a,i.height=e,i.lineHeight=o,i.font=r}return r},up=(e,t)=>{for(const i in t){const s=t[i];"object"==typeof s&&i in cp&&dp(i,e,s)}},pp=()=>{const e={haloColor:{light:"rgba(255, 255, 255, .8)",dark:"black"},haloSize:2,miterLimit:2,textAlign:"center",title:Object.assign({},cp.title,{color:{light:"#2b2b2b",dark:"#e7e6e4"}}),subtitle:Object.assign({},cp.subtitle,{color:{light:"#4c4c4c",dark:"#e7e6e4"}})};return up(1,e),e};hp.computeFont=dp;const mp=hp;const gp=class extends Ls{constructor(e,t,i,s,o,n){super(),this.text=e,this.kind=t,this._renderer=new mp(this),this.textAscent=s.actualBoundingBoxAscent||0,this.textDescent=s.actualBoundingBoxDescent||0;const a=this.textDescent>0?Math.ceil(this.textDescent):0;this.fontSizeRatio=n,this.size=new es(i,this._renderer.params[this.kind].height+a),this.keyForFrozenLayer=(o?"dark":"light")+(1!==n?`-${n}`:"")+"-"+t+"#"+this.text}stringInfo(){return"MarkerAnnotationLabelNode<"+this.kind+'> "'+this.text+'"'}get fontSize(){return this._renderer.params[this.kind].fontSize}get lineHeight(){return this._renderer.params[this.kind].lineHeight}},_p=1e-12,fp={borderWidth:1.5,labelOutlineWidth:2,shadowColor:"rgba(0, 0, 0, .15)",shadowOffsetY:.5,innerShadowColor:"rgba(0, 0, 0, .35)",transitionDuration:500,dotAnimationDuration:100,dotScale:1.5,anchorPointOffset:0},yp=Ap(fp,{balloonRadius:13.5,shadowBlur:11.25,dotRadius:0,glyphFontSize:15,glyphImageSize:20,offset:0,style:"default",height:32}),vp=11.5,bp=Ap(fp,{borderWidth:1.5,balloonRadius:vp,transitionDuration:250,shadowBlur:5,shadowOffsetY:0,dotRadius:0,glyphFontSize:15,glyphImageSize:16,offset:0,style:"poi",height:23,anchorPointOffset:-11.5}),wp=[];for(let e=2;e<=6;e++){const t=12+.5*e;wp[e]=Ap(bp,{balloonRadius:t,height:2*t})}const Cp=Ap(fp,{balloonRadius:30,shadowBlur:25,dotRadius:3,glyphFontSize:32,glyphImageSize:40,offset:8,style:"balloon",height:66}),kp=Ap(fp,{radius:4.5,shadowOffsetY:0,shadowBlur:0,shadowColor:"transparent"}),Mp=Ap(fp,{balloonRadius:20,dotRadius:3,glyphFontSize:28,glyphImageSize:30,offset:0,style:"bubble",height:40});class Sp extends Ho{constructor(e){super(),this.annotation=e,this._balloon=this.addChild(new sp(e)),this._balloon.setDelegate(this)}get position(){return this.annotation?this.annotation.nodePosition():new ts}stringInfo(){return"MarkerAnnotationNode"+("default"!==this.state?"<"+this.state+">":"")}get enablesDefaultGlyphImage(){return this._balloon.enablesDefaultGlyphImage}set enablesDefaultGlyphImage(e){this._balloon.enablesDefaultGlyphImage=e}set needsLayout(e){e&&!this._needsLayout&&bt.scheduleASAP(this),this._needsLayout=e}get needsLayout(){return this._needsLayout}getParamsFromState(e){const t=this.annotation.isAppStyle,i=t?Sp.POIIconParams:Sp.Params;return"default"===e&&this.annotation.n&&t?wp[Math.min(this.annotation.n,6)]:i[e]}balloonNodeSize(e){if(!this.annotation.balloonVisible)return new es(0,0);e||(e=this.state);const t=this.getParamsFromState(e);if("callout"===e)return new es(2*t.radius,2*t.radius);const i=2*t.balloonRadius;return new es(i,t.height+t.offset)}updateAppearance(e){this._balloon.freeze(),e&&(this.needsDisplay=!0)}updateState(e){if(this._usingStaticStyle)return;const t=this.annotation;this.state!==e&&(!t.selected&&"selected"!==this.state&&"callout"!==this.state||!this.state||this._animateFromState||(this._animateFromState=this.state),this.state=e,this.updateSizeAndAppearance())}updateSizeAndAppearance(){this.annotation._node.size=this._size=this._balloon.size=this.balloonNodeSize(),this.updateAppearance(),this.needsLayout=!0}performScheduledUpdate(){this.updateLayout(!1)}updateLayout(e){this._needsLayout&&(this._layoutSubNodes(e),this._needsLayout=!1)}updateGlyphText(){this.updateAppearance(!0),this._balloon.needsDisplay=!0}updateGlyphImage(e){this.updateAppearance(),this._balloon.glyphImage=e,this._balloon.needsDisplay=!0}updateSelectedGlyphImage(e){this._balloon.selectedGlyphImage=e,this._balloon.needsDisplay=!0}glyphImageError(){this.updateAppearance(),this._balloon.glyphImageError(this.state)}animateAppearance(e){const t=this.getParamsFromState(this.state);if(this.children.forEach((e=>{this.annotation.isAppStyle||e===this._balloon||Ep(e,t)})),!this.annotation.isAppStyle||this.annotation.selected)Ip(this._balloon,t,_p,1,new ts(this._balloon.size.width/2,this._balloon.size.height),void 0,e);else{const i=new ts(this._balloon.size.width/2,this._balloon.size.height/2);Tp(this._balloon,t,_p,1,i,e)}}fadeInLabels(){const e=this.children.filter((e=>e instanceof gp)),t=this.getParamsFromState(this.state);e.forEach((e=>{Ep(e,t)}))}preventAnimation(){this._animationPrevented=!0,this.needsLayout=!0}_layoutSubNodes(e){if(!this.annotation)return;this.updateAppearance();const t=this.children.slice();this.children=[this._balloon],this._dot&&this.addChild(this._dot);let i=this._balloon.size.width;const s=this.annotation,o=this.state,n=this.getParamsFromState(this.state),a=s.map&&!this._animationPrevented;delete this._animationPrevented;const r=s&&s.map&&s.map._impl.fontSizeRatio||1;function l(e,i){t.forEach((function(t){t.kind===e&&(this.addChild(t),function(e,t){e.fadingOut=!0,new on.Opacity({node:e,duration:t.transitionDuration,from:1,to:0,done:function(){delete e.fadingOut,e.remove()}}).begin()}(t,n,this.annotation))}),this),delete this[i]}let h=0;const c=(e,t)=>{const o=mp.computeFont(e,r),l=s[e],c=a&&!!this.parent&&l!==t&&(!l||!t),d=this.annotation.darkColorScheme;return function(e,t,i){e.font=i;const s=t.trim().split(/[\r\n]+/),o=[];for(const t of s){const i=t.split(/[\f\t\v\u0020\u2000-\u200b\u205f\u3000]+/);for(;i.length>0;){const t=[i.shift()];let s=t.join(" ").length;for(;i.length>0&&s<=16;)t.push(i.shift()),s=t.join(" ").length;s>16&&t.length>1&&i.unshift(t.pop());const n=t.join(" "),a=e.measureText(n),r=a.width+fp.labelOutlineWidth;o.push([n,r,a])}}return o}(this.scene?this.scene.contextForMeasurement:xp(),l,o).forEach((([t,s,o])=>{const a=new gp(t,e,s,o,d,r);i=Math.max(i,s),h=a.lineHeight/2,this.addChild(a),c&&Ep(a,n)}),this),l},d="callout"!==o&&"lifted"!==o&&!("default"===o&&s.selected)&&s.labelsCanBeShown(),u=d&&s.titleCanBeShown();u?this._prevTitle=c("title",this._prevTitle):l.call(this,"title","_prevTitle"),d&&s.subtitleCanBeShown(u)?this._prevSubtitle=c("subtitle",this._prevSubtitle):l.call(this,"subtitle","_prevSubtitle");let p=this._balloon.size.height;if("callout"===o&&s.isAppStyle){0!==this.children.filter((e=>e.lineHeight)).length&&(p+=this.getParamsFromState("default").balloonRadius)}let m=p,g=0;this.children.forEach((e=>{let t=0;if(e.lineHeight){const i=Math.ceil(e.textAscent-e.fontSize);if(i>0&&(t+=i),g>0){t+=Math.ceil(g)}}e.position=new ts((i-e.size.width)/2,e.lineHeight?m+t:0),e.lineHeight&&(m+=e.lineHeight+t,e.fadingOut||(p+=e.lineHeight+t,h=Math.round(e.lineHeight/2+(e.textDescent>0?e.textDescent:0))),g=e.textDescent)})),s._anchorPoint=new ts(i/2,this._balloon.size.height+n.anchorPointOffset),s._node.size=this.size=new es(i,p+h),s.updatePosition();const _=s._position.x-s._anchorPoint.x-s._anchorOffset.x,f=this.position.x;if(this.children.forEach((e=>{e.position=new ts(Eo.roundToDevicePixel(_+e.position.x)-f,e.position.y)})),"selected"===o?(this._dot||(this._dot=this.addChild(new rp(this.annotation,n.dotRadius*n.dotScale),1)),this._dot.size=new es(2*n.dotRadius*n.dotScale,2*n.dotRadius*n.dotScale),this._dot.position=new ts(this._balloon.position.x+n.balloonRadius-n.dotRadius,this._balloon.size.height-2*n.dotRadius),this._dot.transform=(new ss).scale(1/n.dotScale)):this._dot&&(this._dot.remove(),delete this._dot),a&&this._animateFromState){const e=this.getParamsFromState(this._animateFromState);if("callout"===o||"callout"===this._animateFromState){const t=Ap(n);t.transitionDuration/=2;const i=this.addChild(new sp(this.annotation,this._animateFromState));let s;i.setDelegate(this),i.glyphImage=this._balloon.glyphImage,i.selectedGlyphImage=this._balloon.selectedGlyphImage,i.setBalloonStyle(),i.size=this.balloonNodeSize(i.state),this._balloon.transform=(new ss).scale(_p),"callout"===o?(i.position=new ts((this.size.width-i.size.width)/2,this._balloon.size.height/2-i.size.height-e.anchorPointOffset+4.5),s=new ts(i.size.width/2,i.size.height+e.anchorPointOffset),Tp(i,t,1,_p,s,(()=>{i.remove();const e=Ap(n);e.transitionDuration/=2,Tp(this._balloon,e,_p,1,new ts(this._balloon.size.width/2,this._balloon.size.height/2))}))):(i.position=new ts((this.size.width-i.size.width)/2,this._balloon.size.height+n.anchorPointOffset-i.size.height/2-4.5),s=new ts(i.size.width/2,i.size.height/2),this.annotation.isAppStyle?Tp(i,t,1,_p,s,(()=>{i.remove();const e=new ts(this._balloon.size.width/2,this._balloon.size.height/2);Tp(this._balloon,n,_p,1,e)})):Tp(i,t,1,_p,s,(()=>{i.remove(),Ip(this._balloon,n,_p,1,new ts(this._balloon.size.width/2,this._balloon.size.height))})))}else{let t,i,a,r=0;s.isAppStyle?(t=e.balloonRadius/n.balloonRadius,r=Cp.height-Cp.balloonRadius+Cp.offset,"selected"===o?(i=new ts(n.balloonRadius,n.balloonRadius+r/(1-t)),a=new ts(this._balloon.size.width/2,this._balloon.size.height)):i=new ts(n.balloonRadius,n.balloonRadius-r/(1-t))):(t=this.balloonNodeSize(this._animateFromState).height/this.balloonNodeSize().height,i=new ts(this._balloon.size.width/2,this._balloon.size.height)),1!==t&&Ip(this._balloon,n,t,1,i,a);const l=this._dot;l&&Ep(l,{transitionDuration:n.dotAnimationDuration});let h=0;if(1!==t&&s.isAppStyle&&(h=(t<1?1:-1)*this.getParamsFromState("default").balloonRadius),0!==h){const e=new ts(0,0),t=new ts(0,h);this.children.forEach((i=>{i.lineHeight&&function(e,t,i,s){new on.Translation({node:e,duration:t.transitionDuration,from:i,to:s,pop:!0}).begin()}(i,n,t,e)}))}}delete this._animateFromState}e||s.updatedLayout()}}let Lp;Sp.Params={default:yp,lifted:yp,selected:Cp,bubble:Mp,callout:kp},Sp.POIIconParams=Ap(Sp.Params,{default:bp,lifted:bp}),Sp.FeatureVisibility=Us;const xp=function(){return Lp||(Lp=re()),Lp.getContext("2d")};function Ap(e,t){const i=Object.create(e);for(const e in t)i[e]=t[e];return i}function Ep(e,t){new on.Opacity({node:e,duration:t.transitionDuration}).begin()}function Tp(e,t,i,s,o,n){new on.Scale({node:e,duration:t.transitionDuration,from:i,to:s,center:o,done:n}).begin()}function Ip(e,t,i,s,o,n,a){new on.Float({node:e,duration:t.transitionDuration,from:i,to:s,center:o,floatCenter:n,done:a}).begin()}const Op=Sp;const Rp=class{constructor(e,t){!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"enablesDefaultGlyphImage",!0),e.useSquareBalloon?this._renderer=new ep(this):this._renderer=new Qu(this),this.frozen=!0,this.annotation=e,this.state="selected",this.params=t;const i=2*t.balloonRadius;this.size=new es(i,i),this.layerBounds=new is(0,0,this.size.width,this.size.height)}draw(){!this.annotation.glyph&&this._renderer.isFallbackGlyphTextPending&&this._renderer.addPendingNode(this);const e=this._renderer.layer;e.hidden=!1,e.style.width=e.style.height=this.size.width+"px",this._renderer.draw(e.getContext("2d"))}getLayer(){return this._renderer.layer}glyphImageError(e){"selected"===e&&this.selectedGlyphImage?delete this.selectedGlyphImage:delete this.glyphImage}updateGlyphImage(e){this.glyphImage=e}updateSelectedGlyphImage(e){this.selectedGlyphImage=e}freeze(){this.draw()}};const Pp=function(e,t){let i;if("function"!=typeof e.getImageUrl)return i=function(e){if(!e||"object"!=typeof e)return;let t;const i=Object.keys(e).filter((t=>!!e[t])).map(parseFloat).filter((e=>!isNaN(e))).sort(),s=Eo.imagePixelRatio;for(let e=i.length-1;e>=0&&((!t||i[e]>=s)&&(t=i[e]),!(i[e]<=s));--e);return t}(e),i?void t({ratio:i,glyphImageUrl:e[i]}):void t();i=Eo.imagePixelRatio,ue(e.getImageUrl,e,[i,function(e){setTimeout((()=>t(e?{ratio:i,glyphImageUrl:e}:void 0)))}])};function Dp(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const zp={light:"#ff5b40",dark:"#e6523b"},Np={light:"white",dark:"#e7e6e4"},Fp={light:"white",dark:"black"},Up={Default:"default",Dot:"dot",Large:"large"};function Gp(e){var t;class i extends e{constructor(t,i,s){super(t,i,e.div,s),Dp(this,"_labelOccluded",!1),Dp(this,"_labelRect",void 0),Dp(this,"_anchorPointWithLabel",void 0)}init(t,i,s){this._sceneGraphNode=new Op(this),super.init(t,i,e.div,s),this.updateGlyph(),this._setBalloonStyle(),this._userSetSize=!0,this._calloutWithSelectedState||(this._calloutAnchorPoint=new window.DOMPoint(-Op.Params.callout.radius,1));const o=this.selected?this.canShowCallout()?this.selectedStateForSceneGraphNode():"selected":"default";this._sceneGraphNode.updateState(o)}get size(){return this._sceneGraphNode.size.copy()}set size(e){console.warn("[MapKit] The `size` property of a marker annotation cannot be set.")}get color(){return null!==this._color?this._color:this.map?zp[this.map._impl.currentColorScheme]:zp.light}set color(e){null!==e&&p(e,"string","[MapKit] Expected a string value for MarkerAnnotation.color, but got `"+e+"` instead"),e!==this._color&&(this._color=e,this._sceneGraphNode.updateAppearance(!0),this._drawCalloutAccessory())}get fillColor(){return this.color}get haloColor(){return null}get glyphColor(){return null!==this._glyphColor?this._glyphColor:this.map?this.isPlaceStyle?Fp[this.map._impl.tint]:Np[this.map._impl.currentColorScheme]:Np.light}set glyphColor(e){null!==e&&p(e,"string","[MapKit] Expected a string value for MarkerAnnotation.glyphColor, but got `"+e+"` instead"),e!==this._glyphColor&&(this._glyphColor=e,this._sceneGraphNode.updateAppearance(!0),this._drawCalloutAccessory())}get glyphImage(){return this._glyphImage}set glyphImage(e){this._setGlyphImage("_glyphImage","updateGlyphImage",e)}get selectedGlyphImage(){return this._selectedGlyphImage}set selectedGlyphImage(e){this._setGlyphImage("_selectedGlyphImage","updateSelectedGlyphImage",e)}updateGlyphImages(){this._setGlyphImage("_glyphImage","updateGlyphImage",this._glyphImage),this._setGlyphImage("_selectedGlyphImage","updateSelectedGlyphImage",this._selectedGlyphImage)}get glyphText(){return this._glyphText}set glyphText(e){p(e,"string","[MapKit] Expected a string value for MarkerAnnotation.glyphText, but got `"+e+"` instead"),e!==this._glyphText&&(this._glyphText=e,this.updateLocalizedText(),this.updateGlyph(),this._sceneGraphNode.updateGlyphText(),this._drawCalloutAccessory())}get glyph(){return this._glyph}get titleVisibility(){return this._titleVisibility}set titleVisibility(e){if(!d(e,Op.FeatureVisibility))throw new Error("[MapKit] Expected one of Hidden, Visible or Adaptive for MarkerAnnotation.titleVisibility");e!==this._titleVisibility&&(this._titleVisibility=e,this._sceneGraphNode.needsLayout=!0)}get subtitleVisibility(){return this._subtitleVisibility}set subtitleVisibility(e){if(!d(e,Op.FeatureVisibility))throw new Error("[MapKit] Expected one of Hidden, Visible or Adaptive for MarkerAnnotation.subtitleVisibility");e!==this._subtitleVisibility&&(this._subtitleVisibility=e,this._sceneGraphNode.needsLayout=!0)}get labelOccluded(){return this._labelOccluded}set labelOccluded(e){this._labelOccluded!==e&&(this._sceneGraphNode.needsLayout=!0),this._labelOccluded=e}labelsCanBeShown(){return this.delegate&&this.delegate.supportsLabelRegions()}titleCanBeShown(){return this.title&&!this.labelOccluded&&this._titleVisibility!==Op.FeatureVisibility.Hidden}subtitleCanBeShown(e){return this.subtitle&&!this.labelOccluded&&(this._subtitleVisibility===Op.FeatureVisibility.Visible||this._subtitleVisibility===Op.FeatureVisibility.Adaptive&&(this._public.memberAnnotations||this.selected&&e))}updateLayout(e,t){!t&&e||(this._sceneGraphNode.needsLayout=!0),(t||e)&&this._sceneGraphNode.updateLayout(e)}updatedLayout(){this._updatedProperty("")}calculateNodePosition(){return new ts(Eo.roundToDevicePixel(this._position.x-this._anchorPoint.x-this._anchorOffset.x),this._position.y-this._anchorPoint.y-this._anchorOffset.y)}animateOcclusion(){if(!this.isLoadingIconMetadata)return super.animateOcclusion()}get darkColorScheme(){return!!this.map&&Eo.darkColorScheme(this.map._impl.mapNodeTint)}get isAppStyle(){return!!(this._glyphImage&&this._glyphImage.isPOIIcon||this._selectedGlyphImage&&this._selectedGlyphImage.isPOIIcon)}get isPlaceStyle(){return this.isAppStyle}get balloonVisible(){return!0}iconRect(){const e=this.nodePosition(),t=this.sceneGraphNode._balloon.position,i=this.sceneGraphNode._balloon.size;return new is(e.x+t.x,e.y+t.y,i.width,i.width)}labelRect(){if(!this._labelRect){0;const e=this.sceneGraphNode.children.filter((e=>e instanceof gp)).map((e=>new is(e.position.x,e.position.y,e.size.width,e.size.height)));this._labelRect=e.length?is.unionOfRects(e):new is(0,0,0,0),this._anchorPointWithLabel=this._anchorPoint.copy()}const e=new ts(Eo.roundToDevicePixel(this._position.x-this._anchorPointWithLabel.x-this._anchorOffset.x),this._position.y-this._anchorPointWithLabel.y-this._anchorOffset.y);return new is(e.x+this._labelRect.origin.x,e.y+this._labelRect.origin.y,this._labelRect.size.width,this._labelRect.size.height)}get warnOnUnselectedGlyphImageAccess(){return!1}get enablesDefaultGlyphImage(){return this._sceneGraphNode.enablesDefaultGlyphImage}set enablesDefaultGlyphImage(e){this._sceneGraphNode.enablesDefaultGlyphImage=e}setDelegate(e){super.setDelegate(e),this.labelsCanBeShown()&&this._updatedProperty("title")}doesAnimate(){return this._animates}willMoveToMap(e){this._isMoving=e&&this.animates}didMoveToMap(){const e=this._isMoving;if(super.didMoveToMap(),this.isLoadingIconMetadata)return this._sceneGraphNode.opacity=0,void(this._isMoving=e);this.animateAppearance(e)}animateAppearance(e,t=!1){this.delegate&&e&&this.visible&&!this._appearanceAnimation&&this._shown?(this._isAnimating=!0,this._sceneGraphNode.animateAppearance((e=>{e.node.annotation.finishedAnimating()})),t&&this._sceneGraphNode.fadeInLabels()):this._sceneGraphNode.preventAnimation()}iconMetadataLoaded(){this.isLoadingIconMetadata&&(this.isLoadingIconMetadata=!1,this._sceneGraphNode.opacity=1,this.animateAppearance(this._isMoving,!0),delete this._isMoving)}lift(e){this._sceneGraphNode.updateState("lifted"),super.lift(e)}droppedAfterLift(){this._sceneGraphNode.updateState("default"),super.droppedAfterLift()}canShowCallout(){return(!!this.callout||this.delegate&&!this.delegate.supportsLabelRegions())&&super.canShowCallout()}centerOffsetForSelectionAccessory(){return new ts(-this._node.size.width/2,-Op.Params.selected.balloonRadius)}selectedStateForSceneGraphNode(){return this.selectionAccessory||this._calloutWithSelectedState?"selected":"callout"}selectionAccessoryWillAppear(e){const t=e?this.selectedStateForSceneGraphNode():"selected";this.isStable()&&this._sceneGraphNode.updateState(t)}selectionAccessoryWillDisappear(){this.selected||(delete this._calloutAccessoryNode,this._sceneGraphNode.updateState("default"))}canvasForCalloutAccessory(){if(!this.callout||this.selectionAccessory||!(this.callout.calloutElementForAnnotation||this.callout.calloutContentForAnnotation||this.callout.calloutLeftAccessoryForAnnotation||this.callout.calloutRightAccessoryForAnnotation))return this._calloutAccessoryNode||(this._calloutAccessoryNode=new Rp(this,Op.Params.bubble),this._calloutAccessoryNode.glyphImage=this._sceneGraphNode._balloon.glyphImage,this._calloutAccessoryNode.selectedGlyphImage=this._sceneGraphNode._balloon.selectedGlyphImage,this._calloutAccessoryNode.glyphText=this._glyphText,this._drawCalloutAccessory()),this._calloutAccessoryNode.getLayer();delete this._calloutAccessoryNode}get ignoreCalloutCornerRadiusForLeftAccessory(){return!0}altText(){return super.altText()||Vi.get("Annotation.Marker.AccessibilityLabel")}resetNodeTransform(){this.sceneGraphNode.transform=new ss}updateGlyph(){this._glyph=this.glyphText||(this._glyphImageElement?this._glyphImageElement.src:"")}get staticStyle(){return this._staticStyle}set staticStyle(e){let t;switch(e){case Up.Dot:t="callout";break;case Up.Large:t="selected";break;default:e=Up.Default,t="default"}this._staticStyle=e,this._sceneGraphNode.updateState(t),this._sceneGraphNode._usingStaticStyle=!0}loadGlyphImage(e,t,i,s){Pp(s,(o=>{if(this[t]===s)return o?void function(e,t,i,s){const o=i+"Loader";e[o]&&e[o].unschedule();if(e[o]=new oa(V.Highest,{urlForImageLoader:t,loaderDidSucceed:function(t){e[o]===t&&(delete e[o],e[i]=t.image,e.updateGlyph(),e._sceneGraphNode[s](t.image),e._calloutAccessoryNode&&(e._calloutAccessoryNode[s](t.image),e._drawCalloutAccessory()))},loaderDidFail:function(t){e[o]===t&&(delete e[o],delete e[i],e.updateGlyph(),e._sceneGraphNode[s](),e._calloutAccessoryNode&&(e._calloutAccessoryNode[s](),e._drawCalloutAccessory()))}}),e.isGlyphImageInternal){const t=Ue.withCredentials&&!Ue.customMadabaUrl;e[o].crossOrigin=sa.getCorsAttribute(t)}e[o].schedule()}(this,o.glyphImageUrl,e,i):(delete this[e],this._sceneGraphNode.glyphImageError(),void(this._calloutAccessoryNode&&this._calloutAccessoryNode.glyphImageError()))}))}_setBalloonStyle(){this.useSquareBalloon=this._glyphImage&&this._glyphImage.useSquareBalloon||this._selectedGlyphImage&&this._selectedGlyphImage.useSquareBalloon,this._sceneGraphNode._balloon.setBalloonStyle()}_setGlyphImage(e,t,i){null!=i&&p(i,"object","[MapKit] Expected a hash value or an Image delegate for MarkerAnnotation."+e.replace(/^_/,"")+", but got `"+i+"` instead"),this[e]=i;const s=e+"Element";if(this._setBalloonStyle(),!i){delete this[s];const e=s+"Loader";return this[e]&&(this[e].unschedule(),delete this[e]),this._sceneGraphNode[t](null),void(this._calloutAccessoryNode&&(this._calloutAccessoryNode[t](null),this._drawCalloutAccessory()))}this.loadGlyphImage(s,e,t,i)}_updatedProperty(e){"title"!==e&&"subtitle"!==e||(this._labelRect=void 0,this._anchorPointWithLabel=void 0,this._sceneGraphNode&&(this._sceneGraphNode.needsLayout=!0)),super._updatedProperty(e)}_drawCalloutAccessory(){this._calloutAccessoryNode&&this._calloutAccessoryNode.draw()}}return t=i,Dp(i,"StaticStyles",Up),t.prototype._animates=!0,t.prototype._glyphImage=null,t.prototype._selectedGlyphImage=null,t.prototype._glyphText="",t.prototype._color=null,t.prototype._glyphColor=null,t.prototype._titleVisibility=Op.FeatureVisibility.Adaptive,t.prototype._subtitleVisibility=Op.FeatureVisibility.Adaptive,t.prototype.shouldHideLabels=!0,t.prototype.renderedByDOMElement=!1,t.prototype.isGlyphImageInternal=!1,t.prototype.ConstructorOptions=Object.freeze(Object.assign({},e.prototype.ConstructorOptions,{color:"rw",glyphColor:"rw",glyphImage:"rw",selectedGlyphImage:"rw",glyphText:"rw",titleVisibility:"rw",subtitleVisibility:"rw",_calloutWithSelectedState:"rw"})),Dp(i,"DefaultColor",zp),i}Gp.StaticStyles=Up,Gp.DefaultColor=zp,Gp.DefaultGlyphColor=Np;const Bp=Gp,Wp=Bp(Fu);class Zp extends Bu{constructor(e,t){super(),new.target===Zp&&(Object.defineProperty(this,"_impl",{value:new Wp(this,e,t)}),this._impl.init(this,e,t))}get size(){return this._impl.size}set size(e){this._impl.size=e}get color(){return this._impl.color}set color(e){this._impl.color=e}get glyphColor(){return this._impl.glyphColor}set glyphColor(e){this._impl.glyphColor=e}get glyphImage(){return this._impl.glyphImage}set glyphImage(e){this._impl.glyphImage=e}get selectedGlyphImage(){return this._impl.selectedGlyphImage}set selectedGlyphImage(e){this._impl.selectedGlyphImage=e}get glyphText(){return this._impl.glyphText}set glyphText(e){this._impl.glyphText=e}get titleVisibility(){return this._impl.titleVisibility}set titleVisibility(e){this._impl.titleVisibility=e}get subtitleVisibility(){return this._impl.subtitleVisibility}set subtitleVisibility(e){this._impl.subtitleVisibility=e}}const Kp=Zp,jp="mapsearch",Hp="callout",Vp=function(e,t){t=t||xs.Light;const i=e===Is.Hybrid||e===Is.Satellite?Os.Hybrid:Os.Standard;i===Os.Hybrid&&(t=xs.Light);return{iconStyle:i,tint:t,emphasis:e===Is.MutedStandard?Fs.Muted:Fs.Standard}};function qp(e=[]){if(e[0]||e[1]||e[2]||e[3])return"rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]/255+")"}class Yp{constructor(e){this.results={},this.completeCallback=e,this.loaders=[],this.loaderData=[]}static fillGraphImageUrlPath(e,t){let i=Yp._CALLOUT_GLYPH_IMAGE_ENDPOINT_URL_PATH;return Ue.tileGroup&&(i=i.replace("{{tileGroup}}",Ue.tileGroup)),i=i.replace("{{attributes}}",t?e.styleAttributes:encodeURIComponent(e.styleAttributes)),i}static keyFromFetchOptions(e){const t=Vp(e.mapType,e.colorScheme);return e.styleAttributes+e.iconContext+t.iconStyle+t.tint+t.emphasis}fetch(e){const t=new Map(e.map((e=>{const t=Vp(e.mapType,e.colorScheme);return[e,Yp.fillGraphImageUrlPath(e,!0).replace("&accessKey={{accessKey}}","").replace("{{scale}}","2").replace("{{size}}",e.iconContext===jp?"3":"4").replace("{{context}}",e.iconContext).replace("{{style}}",t.iconStyle).replace("{{tint}}",t.tint).replace("{{emphasis}}",t.emphasis).replace("{{tileGroup}}",Ue.tileGroup||e.tileGroup)]})));e.sort(((e,i)=>{const s=t.get(e),o=t.get(i);return s>o?1:s<o?-1:0}));const i=[];for(let t=0;t<e.length;t+=1)i.push(e.slice(t,t+1));let s=Ue.getMadabaDomainFromStringHash(e[0].styleAttributes)+Yp.ATLAS_URL.replace("{{accessKey}}",encodeURIComponent(Ue.accessKey||""));Ue.proxyPrefixes&&!Ue.customMadabaUrl&&(s=Ue.proxyPrefixes[0]+s),this.pendingRequestsCount=i.length;for(let e=0;e<i.length;e++){const o=i[e].map((e=>t.get(e))),n=s.replace("{{entries}}",encodeURIComponent(JSON.stringify({requests:o}))),a={withCredentials:Ue.withCredentials&&!Ue.customMadabaUrl,headers:{}};0;const r=new ce(n,this,a);this.loaders.push(r),this.loaderData.push([o,i[e]]),r.schedule()}}loaderDidSucceed(e,t){this.pendingRequestsCount--;const i=this.loaders.indexOf(e),s=this.loaderData[i],o=s[0],n=s[1],a=JSON.parse(t.responseText);o.forEach(((e,t)=>{const i=a.urls[e];if(!i)return void 0;const s=a["icon-metadata"][i],o=n[t].styleAttributes,r=Yp.keyFromFetchOptions(n[t]),l=Vp(n[t].mapType,n[t].colorScheme),h=!("labelIconSource"in s)||0!==s.labelIconSource,c=!("labelTextVisibility"in s)||"Never"!==s.labelTextVisibility;this.results[r]={context:n[t].iconContext,styleAttributes:o,iconStyle:l.iconStyle,tint:l.tint,emphasis:l.emphasis,badgeColor:qp(s.badgeColor),calloutColor:qp(s.calloutColor),calloutHaloColor:qp(s.calloutHaloColor),haloColor:qp(s.haloColor),calloutShape:s.calloutShape?s.calloutShape:"Circle",iconVisibility:h,labelVisibility:c}})),0===this.pendingRequestsCount&&this.completeCallback(this.results)}loaderDidFail(e,t){this.pendingRequestsCount--,0===this.pendingRequestsCount&&this.completeCallback(this.results)}}Yp.ATLAS_URL="/md/v1/atlas?data=false&dimension=1&entries={{entries}}&format=json&metadata=true&origin=top&type=icon&urls=true&accessKey={{accessKey}}",Yp._CALLOUT_GLYPH_IMAGE_ENDPOINT_URL_PATH="/md/v1/icon?subtype=poi&style={{style}}&context={{context}}&tint={{tint}}&emphasis={{emphasis}}&attributes={{attributes}}&v={{tileGroup}}&accessKey={{accessKey}}&scale={{scale}}&size={{size}}&glyph=true";class Xp{constructor(){this._deferredFetchOptionsMap=void 0}static fillGraphImageUrlPath(e){return Yp.fillGraphImageUrlPath(e)}static keyFromFetchOptions(e){return Yp.keyFromFetchOptions(e)}fetchAll(e,t){if(!e.length)return void setTimeout((()=>t({})));new Yp(t).fetch(e)}fetchDeferred(e,t){if(!this._deferredFetchOptionsMap)if(this._deferredFetchOptionsMap={},Ue.state!==Ue.States.READY){const e=()=>{Ue.removeEventListener(Ue.Events.Changed,e),setTimeout((()=>this._startDeferredFetch()),0)};Ue.addEventListener(Ue.Events.Changed,e)}else setTimeout((()=>this._startDeferredFetch()),0);const i=Xp.keyFromFetchOptions(e);this._deferredFetchOptionsMap[i]||(this._deferredFetchOptionsMap[i]={fetchOptions:e,callbacks:[]});this._deferredFetchOptionsMap[i].callbacks.push(t)}_startDeferredFetch(){const e=this._deferredFetchOptionsMap;this._deferredFetchOptionsMap=null,this.fetchAll(Object.values(e).map((e=>e.fetchOptions)),(t=>{Object.entries(e).forEach((([e,i])=>i.callbacks.forEach((i=>i.call(null,t[e])))))}))}}Xp.sharedMadabaIconMetadata=new Xp;const $p=Xp;function Jp(e,t,i,s,o){this.annotation=e,this._url=t.replace("{{size}}",i.toString()).replace("{{context}}",s),this.useSquareBalloon=o}Jp.prototype.getImageUrl=function(e,t){let i,s,o;if(this.annotation.map){0;const e=Vp(this.annotation.map.mapType,this.annotation.map._impl.tint);i=e.iconStyle,s=e.tint,o=e.emphasis}else if(this.annotation._impl.iconMetadata){const e=this.annotation._impl.iconMetadata;i=e.iconStyle,s=e.tint,o=e.emphasis}else i=Os.Standard,s=xs.Light,o=Fs.Standard;e=Math.ceil(Math.min(Math.max(e,1),3)),t(this._url.replace("{{accessKey}}",encodeURIComponent(Ue.accessKey)).replace("{{scale}}",e).replace("{{style}}",i).replace("{{tint}}",s).replace("{{emphasis}}",o))};const Qp=Jp;function em(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const tm=$p.sharedMadabaIconMetadata,{Event:im}=Be,sm=Symbol(""),om="load",nm="error";const am=function(e){var t;class i extends e{constructor(e,t,i){super(e,t,i),em(this,"styleAttributesHasIcon",!1),em(this,"styleAttributes",""),em(this,"iconContext",""),em(this,"iconMetadata",void 0),em(this,"muid",void 0)}init(e,t,s){if(super.init(e,t,s),this._cachedIconMetadata={},this.constructor===i){if(!this.place)throw new Error("[MapKit] Expected a Place for PlaceAnnotation.");if(!this.place.coordinate)throw new Error("[MapKit] Expected a Place with coordinate.");this.coordinate.equals(this.place.coordinate)||(this.coordinate=this.place.coordinate),this.styleAttributes=this.place._styleAttributes,this.iconContext=jp,this.styleAttributes&&(this.styleAttributesHasIcon=!0,this.enablesDefaultGlyphImage=!1),this.title||(this.title=this.place.name)}}get isAppStyle(){return!1}get isPlaceStyle(){return!(this.iconMetadata&&!this.iconMetadata.iconVisibility)}get balloonVisible(){return!(this.iconMetadata&&!this.iconMetadata.iconVisibility)}titleCanBeShown(){return!(this.iconMetadata&&!this.iconMetadata.labelVisibility)&&super.titleCanBeShown()}subtitleCanBeShown(){return!(this.iconMetadata&&!this.iconMetadata.labelVisibility)&&super.subtitleCanBeShown()}get _color(){return this.iconMetadata?this.iconMetadata&&!this.iconMetadata.iconVisibility?this.map?e.DefaultColor[this.map._impl.currentColorScheme]:e.DefaultColor.light:this.selected||this.staticStyle===i.StaticStyles.Large||this.staticStyle===i.StaticStyles.Dot?this.iconMetadata.calloutColor:this.iconMetadata.badgeColor||this.iconMetadata.calloutColor:null}get haloColor(){return this.iconMetadata?this.iconMetadata&&!this.iconMetadata.iconVisibility?null:this.selected||this.staticStyle===i.StaticStyles.Large||this.staticStyle===i.StaticStyles.Dot?this.iconMetadata.calloutHaloColor:this.iconMetadata.haloColor:null}get warnOnUnselectedGlyphImageAccess(){return!(!this.iconMetadata||"callout"!==this.iconMetadata.context)}loadGlyphImage(e,t,i,s){(this.map||this.iconMetadata)&&super.loadGlyphImage(e,t,i,s)}updateLayout(e){this.updateGlyphImages(),this.updateIconMetadata(!0),super.updateLayout(e)}addedToMap(){super.addedToMap(),this.updateIconMetadata(!1),this.updateGlyphImages()}updateIconMetadata(e){if(!this.map)return;if(!this.styleAttributesHasIcon)return;const t=Vp(this.map.mapType,this.map._impl.tint),i=this._cachedIconMetadata[t.iconStyle+t.tint+t.emphasis];return this.iconMetadata&&i===this.iconMetadata?void 0:i&&i!==sm?(this.iconMetadata=i,void this._sceneGraphNode.updateAppearance(e)):void this.fetchIconMetadata(this.map._impl.tint,this.map.mapType)}setIconMetadata(e,t){if(this._cachedIconMetadata[e.iconStyle+e.tint+e.emphasis]=e,!this.iconMetadata){if(this.iconMetadata=e,this.iconMetadata.iconVisibility){const i=t||$p.fillGraphImageUrlPath(this);let s=Ue.getMadabaDomainFromStringHash(this.styleAttributes)+i;Ue.proxyPrefixes&&!Ue.customMadabaUrl&&(s=Ue.proxyPrefixes[0]+s);const o="Square"===e.calloutShape;this.selectedGlyphImage=new Qp(this._public,s,4,e.context,o),e.context!==Hp&&(this.glyphImage=new Qp(this._public,s,3,e.context,o))}else this._sceneGraphNode.updateSizeAndAppearance(),this.enablesDefaultGlyphImage=!0;setTimeout((()=>this._public.dispatchEvent(new im(om))))}this.updateIconMetadata(!!this.map)}fetchIconMetadata(e,t,i){this.iconMetadata||(this.isLoadingIconMetadata=!0);const s={colorScheme:e,styleAttributes:this.styleAttributes,iconContext:this.iconContext,mapType:t},o=Vp(s.mapType,s.colorScheme),n=o.iconStyle+o.tint+o.emphasis;this._cachedIconMetadata[n]!==sm&&(this._cachedIconMetadata[n]=sm,tm.fetchDeferred(s,(e=>{this._cachedIconMetadata[n]=void 0,e?this.setIconMetadata(e):(console.warn("[MapKit] Unable to fetch icon style for annotation."),this.iconMetadata=void 0,this.enablesDefaultGlyphImage=!0,this.glyphImage=this.selectedGlyphImage=null,setTimeout((()=>this._public.dispatchEvent(new im(nm))))),this.iconMetadataLoaded(),"function"==typeof i&&i(this._public)})))}}return t=i,em(i,"StaticStyles",e.StaticStyles),t.prototype.isGlyphImageInternal=!0,t.prototype.ConstructorOptions=Object.freeze(Object.assign({},e.prototype.ConstructorOptions,{color:"ro",glyphColor:"ro",glyphImage:"ro",selectedGlyphImage:"ro",draggable:"ro",appearanceAnimation:"ro",anchorOffset:"ro",padding:"ro",size:"ro",glyphText:"ro"})),i},rm=am(Wp);class lm{constructor(e,t){this._selected=t,this._impl=t?e.selectedGlyphImage:e.glyphImage}getImageUrl(e,t){if(("number"!=typeof e||isNaN(e))&&(e=Eo.imagePixelRatio),"function"!=typeof t)throw new Error("[MapKit] Expects a callback to be provided.");HTMLCanvasElement.prototype.toBlob?this._impl.getImageUrl(e,(e=>{const i=new oa(V.Highest,{urlForImageLoader:e,loaderDidSucceed:e=>{const i=this._impl.annotation._impl.iconMetadata,s=this._selected?i.calloutColor:i.badgeColor,o=e.image,n=document.createElement("canvas");n.width=o.naturalWidth,n.height=o.naturalHeight;const a=n.getContext("2d");s&&(a.fillStyle=s,a.fillRect(0,0,n.width,n.height)),a.drawImage(o,0,0),n.toBlob((e=>{ue(t,null,[URL.createObjectURL(e)])}))},loaderDidFail:function(e){setTimeout((()=>{ue(t,null)}))}}),s=Ue.withCredentials&&!Ue.customMadabaUrl;i.crossOrigin=sa.getCorsAttribute(s),i.schedule()})):setTimeout((()=>{ue(t,null)}))}}const hm=function(){throw new Error("[MapKit] `MapFeatureAnnotationGlyphImage` may not be constructed directly.")};lm.prototype.constructor=hm,hm.prototype=lm.prototype;const cm=lm;class dm extends Kp{constructor(e,t){super(),new.target===dm&&(Object.defineProperty(this,"_impl",{value:new rm(this,e,t)}),this._impl.init(this,e,t))}get element(){return this._impl.element}get coordinate(){return this._impl.coordinate}get draggable(){return this._impl.draggable}get appearanceAnimation(){return this._impl.appearanceAnimation}get anchorOffset(){return this._impl.anchorOffset}get padding(){return this._impl.padding}get size(){return this._impl.size}get glyphText(){return this._impl.glyphText}get color(){return this._impl.color}get glyphColor(){return this._impl.glyphColor}get glyphImage(){return this._impl.glyphImage?(this._impl._glyphImagePublic||(this._impl._glyphImagePublic=new cm(this._impl,!1)),this._impl._glyphImagePublic):null}get selectedGlyphImage(){return this._impl.selectedGlyphImage?(this._impl._selectedGlyphImagePublic||(this._impl._selectedGlyphImagePublic=new cm(this._impl,!0)),this._impl._selectedGlyphImagePublic):null}}const um=dm;const pm=class{constructor(){this._requests={},this._types={},this._counter=1}add(e,t){const i=this._counter;return this._counter+=1,this._requests[i]=e,this._types[i]=t,i}get(e){return this._requests[e]}typeForId(e){return this._types[e]}idsByType(e){return Object.keys(this._requests).filter((t=>this._types[parseInt(t)]===e)).map((e=>parseInt(e)))}remove(e){return!!this.get(e)&&(delete this._requests[e],delete this._types[e],!0)}};for(Fe.prototype.appendServiceAuthOptions=function(e){return e.withCredentials=this.withCredentials,this.appendAuthOptions(e)},Fe.prototype._checkJwtToken=Hh;Ue._jwtTokensToCheck.length;){const e=Ue._jwtTokensToCheck.shift();z(Ue._checkJwtToken)(z(e))}function mm(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const gm={enableHighAccuracy:!1,timeout:8e3,maximumAge:9e5};class _m{constructor(e,t={}){mm(this,"_getsUserLocation",!1),mm(this,"_language",null),mm(this,"_watchingConfiguration",!1),this._name=e,this._requestMap=new pm,Ue.state===Ue.States.ERROR&&(this._configFailed=!0),this.language=t.language??null,void 0!==t.getsUserLocation&&(this.getsUserLocation=!!t.getsUserLocation)}get getsUserLocation(){return this._getsUserLocation}set getsUserLocation(e){this._getsUserLocation=!!e}get language(){return z(this._language)}set language(e){this._language=null==e?null:this._bestLanguage(e)}cancel(e){u(e,"[MapKit] Missing `id` in call to `"+this._name+".cancel()`."),p(e,"number","[MapKit] `id` passed to `"+this._name+".cancel()` is not a number.");const t=this._requestMap.typeForId(e);if(t)switch(t){case"query":case"geo":return this._requestMap.remove(e);case"xhr":{const t=this._requestMap.get(e);if(t)return t.unschedule(),this._requestMap.remove(e);break}default:throw new Error("Unknown type: "+t)}return!1}handleEvent(e){switch(e.type){case Ue.Events.Error:this._configFailed=!0;case Ue.Events.Changed:this._requestMap.idsByType("query").forEach((e=>{const t=z(this._requestMap.get(e));this._send(t.path,t.parameters,t.callback,t.transform,t.name),this._requestMap.remove(e)}))}0===this._requestMap.idsByType("query").length&&this._stopWatchingConfiguration()}_watchConfiguration(){this._watchingConfiguration||(this._watchingConfiguration=!0,Ue.addEventListener(Ue.Events.Changed,this),Ue.addEventListener(Ue.Events.Error,this))}_stopWatchingConfiguration(){this._watchingConfiguration&&(this._watchingConfiguration=!1,Ue.removeEventListener(Ue.Events.Changed,this),Ue.removeEventListener(Ue.Events.Error,this))}_logNetworkEvent(e,t){let i;switch(e){case"search":i=Vt.Events.Search;break;case"autocomplete":i=Vt.Events.SearchAC;break;case"placeLookup":i=Vt.Events.PlaceLookup;break;case"geocode":i=Vt.Events.ForwardGeocoder;break;case"reverseGeocode":i=Vt.Events.ReverseGeocoder;break;case"directions":i=Vt.Events.Directions;break;case"nearbyPoi":i=Vt.Events.PointsOfInterestSearch;break;default:return}Vt.log(i,t)}_send(t,i,s,o,n){const a=this._requestMap;if(!Ue.apiBaseUrl||Ue.state===Ue.States.PENDING)return this._configFailed?(setTimeout((()=>{ue(s,null,[new Error("MapKit failed to initialize.")])})),0):(this._watchConfiguration(),a.add({path:t,parameters:i,callback:s,transform:o,name:n},"query"));let r;r=0===t.search(/\/v?[0-9]+\//)?Ue.apiBaseUrl.replace(/\/v?[0-9]+\//,"")+t:Ue.apiBaseUrl+t,(i=i||{}).mkjsVersion=e.version;const l=new URLSearchParams;for(const[e,t]of Object.entries(i))t&&l.append(e,t);const h=l.toString();""!==h&&(r+=(t.indexOf("?")>-1?"&":"?")+h);const c={loaderDidSucceed:(e,t)=>{let r;if(this._logNetworkEvent(n,{responseCode:t.status}),a.remove(u),t.status<200||t.status>=300){try{r=JSON.parse(z(t.responseText))}catch(e){return void ue(s,null,[new Error("HTTP error: "+t.status)])}r&&r.error&&r.error.message?(/categor(y|ies)/i.test(r.error.message)&&console.warn("[MapKit] The version of MapKit may be deprecated."),ue(s,null,[new Error("HTTP error: "+t.status+". Message: "+r.error.message+".")])):ue(s,null,[new Error("HTTP error: "+t.status)])}else{try{r=JSON.parse(z(t.responseText))}catch(e){return void ue(s,null,[new Error("Failed to parse response: "+t.responseText)])}ue(s,null,[null,o(i,r)])}},loaderDidFail:(e,t)=>{this._logNetworkEvent(n,{responseCode:t.status}),a.remove(u);let i=Ue.ErrorStatus.Unknown;0===t.status?i=Ue.ErrorStatus.NetworkError:t.status===Ue.HTTP.UNAUTHORIZED?i=Ue.ErrorStatus.Unauthorized:t.status===Ue.HTTP.TOO_MANY_REQUESTS?i=Ue.ErrorStatus.TooManyRequests:t.status===Ue.HTTP.BAD_REQUEST&&(i=Ue.ErrorStatus.BadRequest),ue(s,null,[new Error(i)])}},d=new ce(r,c,z(Ue.appendServiceAuthOptions).call(Ue,{}));d.schedule();const u=a.add(d,"xhr");return u}_sendImmediatelyOrWithUserLocation(e,t,i,s,o){return this.getsUserLocation?this._sendWithUserLocation(e,t,i,s,o):this._send(e,t,i,s,o)}_sendWithUserLocation(e,t,i,s,o){const n=this._requestMap.add({path:e,parameters:t,callback:i,transform:s,name:o},"geo");return this._locate(((e,t)=>{const i=this._requestMap.get(n);i&&(e?console.warn("[MapKit] Unable to get current location:",e.message):i.parameters.userLocation=`${z(t).latitude},${z(t).longitude}`,this._send(i.path,i.parameters,i.callback,i.transform,i.name),this._requestMap.remove(n))})),n}_checkOptions(e,t){p(e,"object","[MapKit] The `options` object is invalid."),Object.keys(e).forEach((e=>{-1===t.indexOf(e)&&console.warn("[MapKit] `"+e+"` is not a valid option.")}))}_bestLanguage(e){p(e,"string","[MapKit] `language` is not a string."),"zh"===e.toLowerCase()&&(console.warn("[MapKit] `zh` is an ambiguous language ID. Please specify a script or reginal variant: `zh-Hans`, `zh-Hant`, or `zh-HK`."),Ue.countryCode&&(e="zh-"+Ue.countryCode));const t=T.bestMatch(e);return null===t&&console.warn("[MapKit] "+this._name+": â"+e+"â is not supported."),t}_locate(e){u(e,"Missing callback"),p(e,"function"),_m.userLocation.locate((function(t){const i=t.coords;e(null,new pi(i.latitude,i.longitude))}),(function(t){let i;switch(t.code){case t.PERMISSION_DENIED:i="PERMISSION_DENIED";break;case t.POSITION_UNAVAILABLE:i="POSITION_UNAVAILABLE";break;case t.TIMEOUT:i="TIMEOUT";break;default:throw new Error("Unknown PositionError code: "+t.code)}e(new Error(i))}),gm)}}W.jsModules.userLocation?_m.userLocation=W.jsModules.userLocation:W.addEventListener("load",(function e(t){t.jsModules.userLocation&&(_m.userLocation=t.jsModules.userLocation,W.removeEventListener("load",e))}));const fm=_m;const ym=class extends fm{constructor(){super("PlaceData",{})}fetch(e,t){const i={mapsId:JSON.stringify({muid:e}),lang:Ue.language};return this._send("placedata",i,t,((e,t)=>{if(t&&t.result)return new Si(t.result)}),"placedata")}};function vm(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const bm=function(e){var t;class i extends e{constructor(e,t,i){super(e,t,i),vm(this,"featureType",""),vm(this,"pointOfInterestCategory",null)}init(e,t,i){super.init(e,t,i),this._cachedIconMetadata={}}fetchPlace(e){u(e,"[MapKit] Missing `callback` in call to `MapFeatureAnnotation.fetch()`."),p(e,"function","[MapKit] `callback` passed to `MapFeatureAnnotation.fetch()` is not a function.");return(new ym).fetch(this.muid,e)}get isAppStyle(){return!0}}return t=i,vm(i,"StaticStyles",e.StaticStyles),t.prototype.ConstructorOptions=Object.freeze(Object.assign({},e.prototype.ConstructorOptions,{color:"rw",glyphColor:"rw",glyphImage:"rw",selectedGlyphImage:"rw",draggable:"rw",appearanceAnimation:"rw",anchorOffset:"rw",padding:"rw",size:"rw",glyphText:"rw"})),i},wm=bm(rm),Cm={PointOfInterest:"PointOfInterest",Territory:"Territory",PhysicalFeature:"PhysicalFeature"};class km extends um{constructor(e,t){super(),Object.defineProperty(this,"_impl",{value:new wm(this,e,t)}),this._impl.init(this,e,t)}get featureType(){return this._impl.featureType}fetchPlace(e){return this._impl.fetchPlace(e)}get pointOfInterestCategory(){return this._impl.pointOfInterestCategory}get map(){return this._impl.map}get collisionMode(){return this._impl.collisionMode}get title(){return this._impl.title}get subtitle(){return this._impl.subtitle}get titleVisibility(){return this._impl.titleVisibility}get subtitleVisibility(){return this._impl.subtitleVisibility}get accessibilityLabel(){return this._impl.accessibilityLabel}static fromMapFeatureRegion(e,t,i){const s=!!(e.calloutGlyphImageUrlTemplate&&e.metadata&&e.metadata.calloutColor),o=new km(new vi.MapPoint(e.position[0],e.position[1]).toCoordinate(),{selected:!0,id:Cu({muid:e.muid}),title:e.title});switch(e.annotation&&(o._impl.subtitle=e.annotation),o._impl.muid=e.muid,o._impl.styleAttributes=e.styleAttributes,e.category){case"Poi":o._impl.featureType=Cm.PointOfInterest;break;case"Territory":o._impl.featureType=Cm.Territory;break;case"PhysicalFeature":o._impl.featureType=Cm.PhysicalFeature}if(s){o._impl.styleAttributesHasIcon=!0;const s=e.metadata;s.iconVisibility=!("labelIconSource"in s)||0!==s.labelIconSource,s.labelVisibility=!("labelTextVisibility"in s)||"Never"!==s.labelTextVisibility,s.styleAttributes=e.styleAttributes,s.context=(e.calloutGlyphImageUrlTemplate.match(/context=(\w+)/)||[])[1],o._impl.iconContext=s.context;const{iconStyle:n,tint:a,emphasis:r}=Vp(t,i);s.iconStyle=n,s.tint=a,s.emphasis=r;const l=e.calloutGlyphImageUrlTemplate.replace(/emphasis=(standard|muted)/,"emphasis={{emphasis}}");o._impl.setIconMetadata(s,l),o._impl.enablesDefaultGlyphImage=!1,e.poiType&&We[e.poiType]&&(o._impl.pointOfInterestCategory=e.poiType)}return o}}function Mm(e,t){if(km.isConstructable)return new km(e,t);throw new TypeError("[MapKit] MapFeatureAnnotation may not be constructed.")}function Sm(){W.jsModules.fromStyleAttributes&&(km.isConstructable=!0,Mm.fromStyleAttributes=W.jsModules.fromStyleAttributes,Mm.IconContext=W.jsModules.IconContext,W.removeEventListener("load",Sm))}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(km,"isConstructable",!1),km.prototype.constructor=Mm,Mm.prototype=km.prototype,W.addEventListener("load",Sm),Sm();const Lm=km;const xm=class{constructor(e){this._annotationsController=e}getMapFeatureAnnotationForRegion(e,t){const i=this._annotationsController.map;let s=Lm.fromMapFeatureRegion(e,i.mapType,i.tileTint);const o=i.annotationForMapFeature;return"function"==typeof o&&(s=ue(o,i.public,[s])||s),s._impl.selected=!0,t&&(s._impl.selectionAccessory=t),s}mapFeatureDidSelect(e){this._annotationsController.addItem(e,0),e._impl.isMapFeature=!0}mapTypeDidChange(){const e=this._annotationsController.selectedItem;e&&e._impl.isMapFeature&&this._annotationsController.items.indexOf(e)>=0&&this._annotationsController.removeItem(e)}annotationSelectionDidChange(e){!e.selected&&e._impl.isMapFeature&&this._annotationsController.items.indexOf(e)>=0&&this._annotationsController.removeItem(e)}},Am=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const Em=class extends Wp{constructor(e,t,i,s){super(e,t,s)}init(e,t,i,s){this._memberAnnotations=i,super.init(e,t,s)}get memberAnnotations(){return this._memberAnnotations}get n(){return this._memberAnnotations.length}get title(){return Am(this,"_title")?this._title:this._topAnnotation.title}set title(e){Object.getOwnPropertyDescriptor(Fu.prototype,"title").set.call(this,e)}get subtitle(){const e=this.n-1;return Am(this,"_subtitle")?this._subtitle:Vi.get("Annotation.Clustering.More"+(e>1?".Plural":""),{n:Vi.digits(e)})}set subtitle(e){Object.getOwnPropertyDescriptor(Fu.prototype,"subtitle").set.call(this,e)}get glyphText(){return Am(this,"_glyphText")?this._glyphText:Am(this,"_glyphImage")||Am(this,"_selectedGlyphImage")?"":Vi.digits(this.n)}set glyphText(e){Object.getOwnPropertyDescriptor(Wp.prototype,"glyphText").set.call(this,e)}get draggable(){return!1}set draggable(e){}get displayPriority(){return this._topAnnotation.displayPriority}set displayPriority(e){}get clusteringIdentifier(){return this._topAnnotation.clusteringIdentifier}set clusteringIdentifier(e){}get _topAnnotation(){return this._memberAnnotations[0]}get _showDefaultAltText(){return Am(this,"_glyphText")||Am(this,"_glyphImage")||Am(this,"_selectedGlyphImage")}get isAppStyle(){return!!this._topAnnotation._impl.isAppStyle}get isPlaceStyle(){const e=this.isAppStyle;return e||!1}updateLocalizedText(){super.updateLocalizedText(),this.updateGlyph(),this._sceneGraphNode.updateAppearance(!0)}altText(){return this._showDefaultAltText?super.altText():this.title?Vi.get("Annotation.Clustering.AccessibilityLabel",{n:this.glyphText,title:this.title,subtitle:this.subtitle}):Vi.get("Annotation.Clustering.NoTitle.AccessibilityLabel",{n:this.glyphText,subtitle:this.subtitle})}};class Tm extends Kp{constructor(e,t,i){super(),Object.defineProperty(this,"_impl",{value:new Em(this,e,t,i)}),this._impl.init(this,e,t,i)}get memberAnnotations(){return this._impl.memberAnnotations}}const Im=function(){throw new TypeError("[MapKit] ClusterAnnotation may not be constructed.")};Tm.prototype.constructor=Im,Im.prototype=Tm.prototype;const Om=Tm,Rm=Ue.performanceMarkers.frameUpdates;function Pm(e,t){const i=Bu.DisplayPriority.Required,s=e.selected?i:e.displayPriority;return(t.selected?i:t.displayPriority)-s||t._impl.boundingBox.y2-e._impl.boundingBox.y2}function Dm(e,t){return t.displayPriority-e.displayPriority||e._impl.index-t._impl.index}function zm(e,t){return e._impl.collisionMode===Bu.CollisionMode.None||t._impl.collisionMode===Bu.CollisionMode.None?0:e._impl.boundingBox.x1-t._impl.boundingBox.x1}function Nm(e){const t=e._impl.node,i=e._impl.nodePosition(),s=e.padding,o=t.size,n=o.width,a=o.height,r=i.x+s.left,l=i.x+n-s.right,h=i.y+s.top,c=i.y+a-s.bottom;if(e._impl.isAppStyle&&!e.selected){const t=e._impl.iconRect(),i=e._impl.labelRect(),s=Math.min(t.size.width,t.size.height)/2;return{boundType:"circle",x1:t.origin.x,x2:t.origin.x+t.size.width,y1:t.origin.y,y2:t.origin.y+t.size.height,cx:t.origin.x+t.size.width/2,cy:t.origin.y+t.size.height/2,r:s/2,padding:0,iconBoundingBox:{boundType:"circle",x1:t.origin.x,x2:t.origin.x+t.size.width,y1:t.origin.y,y2:t.origin.y+t.size.height,cx:t.origin.x+t.size.width/2,cy:t.origin.y+t.size.height/2,r:s,padding:0},labelBoundingBox:{boundType:"rect",x1:i.origin.x,x2:i.origin.x+i.size.width,y1:i.origin.y,y2:i.origin.y+i.size.height,padding:1}}}return e._impl.collisionMode===Bu.CollisionMode.Circle?{boundType:"circle",x1:r,x2:l,y1:h,y2:c,cx:(r+l)/2,cy:(h+c)/2,r:Math.min(n,a)/2,padding:5}:{boundType:"rect",x1:r,x2:l,y1:h,y2:c,padding:5}}function Fm(e){switch(e.boundType){case"circle":return{boundType:e.boundType,x1:e.x1-e.padding,x2:e.x2+e.padding,y1:e.y1-e.padding,y2:e.y2+e.padding,cx:e.cx,cy:e.cy,r:e.r+e.padding,padding:0};case"rect":return{boundType:e.boundType,x1:e.x1-e.padding,x2:e.x2+e.padding,y1:e.y1-e.padding,y2:e.y2+e.padding,padding:0}}}function Um(e,t){const i=e.cx-c(e.cx,t.x1,t.x2),s=e.cy-c(e.cy,t.y1,t.y2);return i*i+s*s<=e.r*e.r}function Gm(e,t){if(!(t.x2>=e.x1&&t.x1<=e.x2&&t.y2>=e.y1&&t.y1<=e.y2))return!1;if("circle"===e.boundType){if("circle"===t.boundType){const i=e.cx-t.cx,s=e.cy-t.cy,o=Math.sqrt(i*i+s*s);return e.r+t.r>=o}return Um(e,t)}return"circle"!==t.boundType||Um(t,e)}function Bm(e,t){e._impl.occluded=t,e._impl.updateVisibility(t)}const Wm=class{constructor(e){this._annotationsController=e,this._clusters=[],this._previousClusters=[],this._previousOverlaps=[],this._previousAnnotations=[],this._frameCounter=0}collideAnnotations(e,t,i,s){this._locked||(this._annotations=e,this._zoomLevel=t,this._rotation=i,this._changesSinceLastCollision=s,bt.scheduleOnNextFrame(this))}setRequiredClusterAnnotationProperties(e,t){return e!==t&&(e||(e=t),e.coordinate=t.coordinate,e.draggable=!1,e.displayPriority=t.memberAnnotations[0].displayPriority,e.clusteringIdentifier=t.memberAnnotations[0].clusteringIdentifier,Object.defineProperty(e,"memberAnnotations",{enumerable:!0,get:function(){return this._impl.memberAnnotations}}),Object.defineProperty(e._impl,"memberAnnotations",{enumerable:!0,value:t.memberAnnotations})),e.animates=t.memberAnnotations.some((e=>!e._impl.wasCollided)),e.selected=!1,e}removedAnnotation(e){e.memberAnnotations||(this._previousClusters=this._previousClusters.filter((function(t){if(t.memberAnnotations.indexOf(e)<0)return!0;this._annotationsController.removeAnyItem(t)}),this))}mapWasDestroyed(){this._annotationsController=null}performScheduledUpdate(){const e=Rm?performance.now():void 0;if(!this._annotationsController)return;if(this._frameCounter=(this._frameCounter+1)%10,1!==this._frameCounter)return void bt.scheduleOnNextFrame(this);const t=this._needsUpdate();if(!t)return;this._changesSinceLastCollision=!1,this._previousZoomLevel=this._zoomLevel,this._previousRotation=this._rotation,this._previousAnnotations=this._annotations.slice(),this._locked=!0,this._annotationsController.willUpdateCollisions(),"region"===t&&this._annotationsController.deselectClusterAnnotation(),this._overlaps=[];let i=0;for(let e=0,t=this._annotations.length;e<t;++e){const t=this._annotations[e];if(t._impl.needsLayout)return this._frameCounter=0,this._locked=!1,void bt.scheduleOnNextFrame(this);t._impl.index=e,t._impl.occluded=!1,t._impl.previousCluster=t._impl.cluster,delete t._impl.cluster,t._impl.collisionMode!==Bu.CollisionMode.None&&(t._impl.boundingBox=Nm(t),i=Math.max(i,t._impl.boundingBox.x2-t._impl.boundingBox.x1))}const s=this._annotations.sort(zm),o={};s.forEach((e=>{if(e.selected||e._impl.collisionMode===Bu.CollisionMode.None)return;const t=e.clusteringIdentifier;t&&(o[t]?o[t].push(e):o[t]=[e])}));const n=this._clusters;this._clusters=[];for(const e in o)o[e].length>1&&(i=this._clusterAnnotationsWithMaxWidth(o[e],i));n.forEach((function(e){this._clusters.indexOf(e)<0&&(Bm(e,!0),e.selected&&(e.selected=!1))}),this),this._collideAnnotationsAndClusters(s,i),this._collideAnnotationLabels([...s,...this._clusters]),this._previousOverlaps=this._overlaps,this._annotationsController.didUpdateCollisions(),this._locked=!1,Rm&&performance.measure("mapkit-map-collision",{start:e})}_clusterAnnotationsWithMaxWidth(e,t){for(let i=0;i<e.length;){const s=e[i];if(s._impl.cluster){++i;continue}const o=s._impl.boundingBox.x2;let n=[s],a=i+1;if(s.memberAnnotations&&i>0){const o=s._impl.boundingBox.x1-t;for(a=i-1;a>0&&e[a]._impl.boundingBox.x1>=o;)a-=1}for(;a<e.length&&e[a]._impl.boundingBox.x1<=o;++a){const t=e[a];!t._impl.cluster&&a!==i&&this._annotationsOverlapExcludingSelected(s,t)&&n.push(t)}if(n.length>1){n=n.reduce(((e,t)=>(t.memberAnnotations?(e=e.concat(t.memberAnnotations),t._impl.cluster=!0,Bm(t,!0)):e.push(t),e)),[]).sort(Dm);const s=this._clusterAnnotationForMemberAnnotations(n);for(s._impl.occluded=!1,s._impl.collisionMode!==Bu.CollisionMode.None&&(s._impl.boundingBox=Nm(s),t=Math.max(t,s._impl.boundingBox.x2-s._impl.boundingBox.x1)),delete s._impl.cluster,a=0;a<n.length;++a)n[a]._impl.occluded=!0,n[a]._impl.cluster=s;for(a=0;a<e.length&&e[a]._impl.boundingBox.x1<s._impl.boundingBox.x1;)a+=1;e.splice(a,0,s),i=Math.min(i+1,a)}else++i}return e.forEach((function(e){e.memberAnnotations&&!e._impl.cluster&&(this._clusters.push(e),e.map||this._annotationsController.addItem(e))}),this),t}_collideAnnotationsAndClusters(e,t){let i=!1;const s=[];for(let t=0,o=0,n=e.length,a=this._clusters.length;t<n||o<a;){const n=e[t],a=this._clusters[o];n?n._impl.cluster||n._impl.collisionMode===Bu.CollisionMode.None?++t:a&&a._impl.boundingBox.x1<n._impl.boundingBox.x1?(a._impl.isRequired()||(i=!0),s.push(a),++o):(n._impl.isRequired()||(i=!0),s.push(n),++t):(a._impl.isRequired()||(i=!0),s.push(a),++o)}i&&this._collideAnnotationsWithMaxWidth(s,t)}_collideAnnotationsWithMaxWidth(e,t){const i=[];for(let t=0,s=e.length;t<s;++t){const o=e[t];0;const n=o._impl.boundingBox.x2;for(let a=t+1;a<s;++a){const t=e[a];if(t._impl.boundingBox.x1>n)break;o._impl.isRequired()&&t._impl.isRequired()||this._annotationsOverlap(o,t)&&i.push(Pm(o,t)<=0?[o,t]:[t,o])}}i.sort(((e,t)=>Pm(e[0],t[0]))).forEach((e=>{e[0]._impl.occluded||(e[1]._impl.occluded=!0)}))}_annotationsOverlapExcludingSelected(e,t){return!e.selected&&!t.selected&&this._annotationsOverlap(e,t)}_annotationsOverlap(e,t){if(e._impl.isLifted()||t._impl.isLifted())return!1;const i=Dm(e,t)<=0?[e,t]:[t,e];let s;for(let e=0,t=this._previousOverlaps.length;e<t&&!s;++e){const t=this._previousOverlaps[e];t[0]===i[0]&&t[1]===i[1]&&(s=t)}const o=function(e,t,i){0;let s=e._impl.boundingBox,o=t._impl.boundingBox;i&&(s=Fm(s),o=Fm(o));return Gm(s,o)}(e,t,s);return o&&this._overlaps.push(i),o}_clusterAnnotationForMemberAnnotations(e){let t;const i=function(e,t){for(let i=0,s=e.length;i<s;++i){const s=e[i],o=t.length;if(s.memberAnnotations.length===o){let e=0;for(;e<o&&t[e]===s.memberAnnotations[e];)e+=1;if(e===o)return i}}return-1}(this._previousClusters,e);if(i>=0)t=this._previousClusters[i],t._impl.resetNodeTransform();else{const i=function(e){let t=0,i=0,s=0;e.forEach((e=>{t+=e.coordinate.latitude;const o=vi.wrapLongitude(e.coordinate.longitude)/180*Math.PI;i+=Math.cos(o),s+=Math.sin(o)}));const o=e.length,n=t/o,a=0===i?s<0?-90:90:180*Math.atan(s/i)/Math.PI+(i<0?180:0);return new vi.Coordinate(n,a)}(e);t=this._annotationsController.addCluster(new Om(i,e)),this._previousClusters.push(t)}return t}_collideAnnotationLabels(e){for(const t of e){if(t._impl.collisionMode===Bu.CollisionMode.None){t._impl.labelOccluded=!1;continue}const i=t._impl.boundingBox;if(t._impl.occluded){t._impl.labelOccluded=!!i.labelBoundingBox;continue}if(!i.labelBoundingBox){t._impl.labelOccluded=!1;continue}const s=Fm(i.labelBoundingBox);let o=!1;for(const i of e){if(t===i)continue;if(t._impl.occluded||t._impl.collisionMode===Bu.CollisionMode.None||i._impl.occluded||i._impl.collisionMode===Bu.CollisionMode.None)continue;if(Gm(s,i._impl.boundingBox.iconBoundingBox?i._impl.boundingBox.iconBoundingBox:i._impl.boundingBox)){o=!0;break}if(i._impl.boundingBox.labelBoundingBox&&!i._impl.labelOccluded&&Gm(s,Fm(i._impl.boundingBox.labelBoundingBox))){o=!0;break}}t._impl.labelOccluded=o}}_needsUpdate(){if(this._zoomLevel!==this._previousZoomLevel||this._rotation!==this._previousRotation)return"region";if(this._changesSinceLastCollision)return"annotations";const e=this._annotations.length;if(this._previousAnnotations.length!==e)return"annotations";for(let t=0;t<e;++t)if(this._annotations[t]!==this._previousAnnotations[t])return"annotations";return""}};const Zm=class extends Ho{constructor(e){super(),this._element=e}get element(){return this._element}stringInfo(){return"AnnotationsControllerNode"}};const Km=class{constructor(e){!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"delegate",null),this._element=Eo.htmlElement("div",{class:"mk-style-helper"}),this.delegate=e}get element(){return this._element}sizeForElement(e){const t=e.cloneNode(!0),i=[],s=[];!function(e,t,i){if(Eo.supportsShadowDOM){if("slot"===e.localName)t.push(e),i.push(e.name);else{const s=e.getElementsByTagName("slot");0!==s.length&&Array.prototype.forEach.call(s,(e=>{t.push(e),i.push(e.name)}))}t.forEach((e=>{e.name="mk-slot-disabled"}))}}(e,i,s),this._element.appendChild(t),this.delegate&&this.delegate.styleHelperNodeDidMoveToParent&&this.delegate.styleHelperNodeDidMoveToParent(t);let o=t;Eo.supportsShadowDOM&&"slot"===e.localName&&(o=t.assignedNodes()[0]);const n=function(e){if(!e||e.nodeType!==window.Node.ELEMENT_NODE)return;const t=window.getComputedStyle(e),i=parseFloat(t.marginLeft),s=parseFloat(t.marginTop),o=parseFloat(t.marginRight),n=parseFloat(t.marginBottom),a=is.rectFromClientRect(e.getBoundingClientRect()).inset(-i,-s,-o,-n);return a}(o);return this._element.removeChild(t),function(e,t){Eo.supportsShadowDOM&&e.forEach(((e,i)=>{e.name=t[i]}))}(i,s),n&&n.size}backgroundColorForElement(e,t){this._element.appendChild(e),this.delegate&&this.delegate.styleHelperNodeDidMoveToParent&&this.delegate.styleHelperNodeDidMoveToParent(e);let i=e;if(Eo.supportsShadowDOM&&"slot"===e.localName&&(i=e.assignedNodes()[0],!i))return this._element.removeChild(e),null;const s=window.getComputedStyle(i).backgroundColor;return t&&(i.style.backgroundColor="transparent"),this._element.removeChild(e),/^transparent|initial|rgba\(.*, 0\)$/.test(s)?null:s}setAnimationForElement(e,t,i){let s=e;if(Eo.supportsShadowDOM&&"slot"===e.localName&&(s=e.assignedNodes()[0],!s))return;s.style.animation=t;const o=function(e){e.animationName===i&&(s.style.animation="",s.removeEventListener("animationend",o))};s.addEventListener("animationend",o)}};class jm extends io{toString(){return this.stringInfo()+" â"}}const Hm=class{constructor(e){this.hostNode=e,this._elementNodeMap={}}appendAssignedElement(e,t){const i=e.slot,s=new jm(e);this._elementNodeMap[i]=s,this.hostNode.addChild(s),t||this.hostNode.element.appendChild(e)}removeAssignedElement(e,t){const i=e.name,s=this._elementNodeMap[i];delete this._elementNodeMap[i],this.hostNode.removeChild(s),t||this.hostNode.element.removeChild(s.element)}getAssignedElement(e){return this._elementNodeMap[e.name]?this._elementNodeMap[e.name].element:null}};function Vm(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const qm=18,Ym=8.028,Xm=12,$m=8e3/60,Jm=5e3/60,Qm=5e3/60,eg=30/249,tg=277/249,ig=237/249,sg="mk-selection-accessory",og="mk-selection-accessory-bubble",ng="mk-selection-accessory-content",ag="mk-selection-accessory-loading",rg="mk-selection-accessory-failed",lg="mk-failed-labels",hg="mk-rtl",cg=new es(243,311),dg=new es(180,70);class ug extends pu{constructor(e,{place:t,muid:i,uiStyle:s,side:o,rtl:n}){super(),Vm(this,"_tailXAxisShift",0),Vm(this,"delegate",null),Vm(this,"_scaleAnimationParameters",[[$m,eg,tg],[Jm,tg,ig],[Qm,ig,1]]),super.init(),this.delegate=e,this._node=new po.Node(Eo.htmlElement("div",{class:`${sg} mk-ui-style-${s}`}));const a=this._node.element;this._tailScale=1,this._bubbleElement=Eo.svgElement("path"),this._svgElement=a.appendChild(Eo.svgElement("svg",{class:og},this._bubbleElement)),this._containerElement=Eo.htmlElement("div"),this._containerElementNode=new po.Node(this._containerElement),this._containerContentElement=this._containerElement.appendChild(Eo.htmlElement("div"));this.uiStyle=s,this._controller=new $i(this._containerContentElement,{get colorScheme(){return e.tint},get place(){return t||{muid:i}},placeCardSizeDidChange:(e,t)=>this._placeCardSizeDidChange(e,t),loadingDidFail:()=>this._placeCardFrameLoadingDidFail(),uiStyle:s,placeCardDidReveal:e=>this.delegate.placeCardDidReveal("full"===s?"LARGE":"MEDIUM",e),placeCardOpenInMapsClicked:e=>this.delegate.placeCardOpenInMapsClicked("full"===s?"LARGE":"MEDIUM",e)}),this.side=o,this._controller.update(),this._containerElementNode.classList.add(ng),n&&this._containerElementNode.classList.add(hg),a.appendChild(this._containerElement),this._rtl=n,this._loadingCanvasElement=Eo.htmlElement("canvas",{"aria-hidden":"true",class:ag}),this._containerElement.appendChild(this._loadingCanvasElement),this._node.wantsHardwareCompositing=!0}get node(){return this._node}get boundingRect(){const e=this._node.position;return new is(e.x,e.y,this._node.size.width,this._node.size.height)}willMoveToMap(){this._node.transform=(new Ys).scale(0)}setAnchorOffset(e){0}containsElement(e){return e!==this._svgElement&&!!this._containerElement.contains(e)}isCustomCallout(){return!1}updateInfo(e,t){const i=this.placeCardSize?this.placeCardSize.copy():"full"===this.uiStyle?cg.copy():dg.copy();return this._updateSize(i),this.updatePosition(),!0}setPositionWithSide(e,t){switch(this.side=t,t){case"top":e.y+=-12*this._tailScale;break;case"left":e.x-=this._node.size.width/2+Xm*this._tailScale,e.y+=this._node.size.height/2;break;case"right":e.x+=this._node.size.width/2+Xm*this._tailScale,e.y+=this._node.size.height/2;break;case"bottom":e.y+=this._node.size.height+Xm*this._tailScale}return this.setPosition(e)}shiftTailBy(e){if("left"===this.side||"right"===this.side)return this._tailXAxisShift=0,this._bubbleElement.setAttribute("d",pg(this._bubbleSize,this._tailScale,this.side,this._tailXAxisShift)),0;const t=Math.max(0,(this._bubbleSize.width-36)/2);return this._tailXAxisShift=e<0?Math.min(t,-e):-Math.min(t,e),this._bubbleElement.setAttribute("d",pg(this._bubbleSize,this._tailScale,this.side,this._tailXAxisShift)),this._node.position=new ts(this._node.position.x+this._tailXAxisShift,this._node.position.y),this._tailXAxisShift}animateIn(){if(!this.animates)return this.animatedIn=!0,void(this._node.transform=new Ys);this.animatedIn||(this.animatedIn=!0,this._setScaleOffsets(),this._scaleAnimationParameterIndex=0,this._scaleAnimationStartDate=Date.now(),bt.scheduleOnNextFrame(this))}animateOut(e){!e&&this.visible?(this._scaleAnimationStartDate&&this._finishAnimatingScale(),this._fadeoutAnimationStartDate=Date.now(),bt.scheduleOnNextFrame(this)):this._node.remove()}mapNodeTintWasSet(e){this.updateInfo(),this._controller.update()}performScheduledUpdate(){this._scaleAnimationStartDate&&this._animateScale(),this._fadeoutAnimationStartDate&&this._animateFadeout()}didRemoveFromParent(){this.delegate.accessoryNodeDidRemove(this)}setSize(e){const t=Xm*this._tailScale,i=e.width+20+2*t,s=e.height+20+2*t,o=-10.5-t,n=-10.5-t;this._svgElement.style.width=i+"px",this._svgElement.style.height=s+"px",this._svgElement.style.top=o+"px",this._svgElement.style.left=n+"px",this._svgElement.setAttribute("viewBox",`${n} ${o} ${i} ${s}`),super.setSize(e)}_placeCardSizeDidChange(e,t){if(0===e||0===t)return;let i;switch(this._placeCardDidLoad(),this.uiStyle){case"full":i=new es(cg.width,Math.min(600,this.delegate.getMaximumSizeForAccessory().height,t));break;case"compact":i=new es(e,t);break;default:0,i=new es}this.placeCardSize=i.copy(),this._updateSize(i),this.delegate.accessorySizeDidChange(this)}_updateLoadingCanvas(e){const t=this._loadingCanvasElement;if(!t)return;t.width=e.width*Eo.devicePixelRatio,t.height=e.height*Eo.devicePixelRatio;const i=t.getContext("2d");if(i.scale(Eo.devicePixelRatio,Eo.devicePixelRatio),this._rtl&&(i.translate(e.width,0),i.scale(-1,1)),"full"===this.uiStyle){const t=e.width-18-.2*e.width*Math.random();i.roundRect(9,12,t,20,5);const s=e.width-18-.2*e.width*Math.random();i.roundRect(9,36,s,13,5),i.fillStyle=this.delegate.tint===xs.Light?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.05)",i.fill();const o=e.width-18,n=61,a=46,r=e.height-n-12-a-12,l=n+r+12;i.beginPath(),i.roundRect(9,n,o,r,10),i.roundRect(9,l,o,a,10),i.fillStyle=this.delegate.tint===xs.Light?"#ffffff":"#242628",i.fill();const h=50,c=[1,1,1,1];c[Math.floor(4*Math.random())]+=1,c[Math.floor(4*Math.random())]+=1;let d=n+9;i.beginPath();for(const t of c){i.roundRect(21,d,h,11,5),d+=13;for(let s=0;s<t;s++)i.roundRect(21,d,e.width-42-.2*e.width*Math.random(),13,5),d+=13+(s+1===t?9:2)}i.arc(35,l+9+14,14,0,2*Math.PI),i.roundRect(58,l+9+7,e.width-42-37-.2*e.width*Math.random(),14,5),i.fillStyle=this.delegate.tint===xs.Light?"rgba(0, 0, 0, 0.03)":"rgba(255, 255, 255, 0.03)",i.fill()}else{let t=12;for(;t<=e.height-12;){const s=e.width-32-.2*e.width*Math.random();i.roundRect(16,t,s,12,5),t+=18}i.fillStyle=this.delegate.tint===xs.Light?"rgba(0, 0, 0, 0.05)":"rgba(255, 255, 255, 0.05)",i.fill()}}_placeCardDidLoad(){this._removeLoadingCanvas(),this._removeLoadingFailureLabel()}_removeLoadingCanvas(){this._loadingCanvasElement&&(this._containerElement.removeChild(this._loadingCanvasElement),this._loadingCanvasElement=null)}_placeCardFrameLoadingDidFail(){this._removeLoadingCanvas(),this._loadingFailureLabel=Eo.htmlElement("div",{class:rg}),this._containerElement.appendChild(this._loadingFailureLabel);const e=this._loadingFailureLabel.appendChild(Eo.htmlElement("div",{class:lg}));e.appendChild(Eo.htmlElement("p",Vi.get("Place.Error.Title"))),e.appendChild(Eo.htmlElement("p",Vi.get("Place.Error.Message")));const t="full"===this.uiStyle?cg.copy():dg.copy();t.height=e.offsetHeight,this._updateSize(t),this.delegate.accessorySizeDidChange(this)}_removeLoadingFailureLabel(){this._loadingFailureLabel&&(this._containerElement.removeChild(this._loadingFailureLabel),this._loadingFailureLabel=null)}_updateSize(e){this._updateLoadingCanvas(e);const t=e.width-this.node.size.width;this._tailXAxisShift=Math.max(0,this._tailXAxisShift+Math.min(0,t)),this._containerElement.style.width=e.width+"px",this._containerElement.style.height=e.height+"px",e.height+=36,e.height-=36,this.setSize(e),this._bubbleSize=new es(e.width-36,e.height-36),this._bubbleElement.setAttribute("d",pg(this._bubbleSize,this._tailScale,this.side,this._tailXAxisShift));(this._scaleXOffset||this._scaleYOffset)&&this._setScaleOffsets()}_setScaleOffsets(){const e=this._node.size,t=Xm*this._tailScale;switch(this.side){case"top":this._scaleXOffset=-this._tailXAxisShift,this._scaleYOffset=e.height/2;break;case"left":this._scaleXOffset=e.width/2+t,this._scaleYOffset=-t/2;break;case"right":this._scaleXOffset=-e.width/2-t,this._scaleYOffset=-t/2;break;case"bottom":this._scaleXOffset=-this._tailXAxisShift,this._scaleYOffset=-e.height/2}}_animateScale(){const e=this._scaleAnimationParameters[this._scaleAnimationParameterIndex],t=e[0],i=e[1],s=e[2],o=Date.now(),n=Math.min((o-this._scaleAnimationStartDate)/t,1),a=i+(s-i)*n;if(this._node.transform=(new Ys).translate(this._scaleXOffset,this._scaleYOffset).scale(a).translate(-this._scaleXOffset,-this._scaleYOffset),1===n){if(++this._scaleAnimationParameterIndex,!(this._scaleAnimationParameterIndex<this._scaleAnimationParameters.length))return void this._finishAnimatingScale();this._scaleAnimationStartDate=o}bt.scheduleOnNextFrame(this)}_finishAnimatingScale(){delete this._scaleXOffset,delete this._scaleYOffset,delete this._scaleAnimationStartDate,delete this._scaleAnimationParameterIndex}_animateFadeout(){const e=(Date.now()-this._fadeoutAnimationStartDate)/100,t=Math.max(0,1-e);0!==t?(this._node.opacity=t,bt.scheduleOnNextFrame(this)):this._node.remove()}animateTailScale(e,t){0}animateAnchorOffset(e,t){0}getCenterOffset(e){0}}function pg(e,t,i,s){const o=15*t,n=Xm*t,a=e.width/2-o,r=e.height/2-o,l=10*t,h=12*t;return"M0,18c0,-9.972 8.028,-18 18,-18"+("bottom"===i?"h"+(-s+a)+"c"+l+",0 "+h+","+-n+" "+o+","+-n+"c"+(-h+o)+",0 "+(-l+o)+","+n+" "+o+","+n+"h"+(s+a):"h"+e.width)+"c9.972,0 "+"18,"+Ym+" "+"18,"+qm+("left"===i?"v"+r+"c0,"+l+" "+n+","+h+" "+n+","+o+"c0,"+(-h+o)+" "+-n+","+(-l+o)+" "+-n+","+o+"v"+r:"v"+e.height)+"c0,9.972 "+"-8.028,"+"18 "+"-18,"+qm+("top"===i?"h"+(-s-a)+"c"+-l+",0 "+-h+","+n+" "+-o+","+n+"c"+(h-o)+",0 "+(l-o)+","+-n+" "+-o+","+-n+"h"+(s-a):"h"+-e.width)+"c"+"-9.972,0 "+"-18,"+"-8.028 "+"-18,"+-18+("right"===i?"v"+-r+"c0,"+-l+" "+-n+","+-h+" "+-n+","+-o+"c0,"+(h-o)+" "+n+","+(l-o)+" "+n+","+-o+"v"+-r:"z")}Vm(ug,"DEFAULT_FULL_SIZE",cg),Vm(ug,"DEFAULT_COMPACT_SIZE",dg),Vm(ug,"TAIL_LENGTH",Xm),Vm(ug,"TAIL_DISTANCE_TO_ANCHOR",8);const mg=ug;function gg(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const _g=10.5,fg=3.5826363,yg=3.58028186,vg=8e3/60,bg=5e3/60,wg=5e3/60,Cg=30/249,kg=277/249,Mg=237/249,Sg="white",Lg={left:10,right:10,content:{left:4,right:4}},xg={left:7.5,right:10},Ag={left:7.5,right:7.5},Eg=5.5,Tg=0,Ig="mk-callout",Og="mk-bubble",Rg="mk-title",Pg="mk-subtitle",Dg="mk-no-subtitle",zg="mk-no-accessories",Ng="mk-standard",Fg="mk-standard-content",Ug="mk-callout-accessory",Gg="mk-callout-content",Bg="mk-custom-content",Wg="mk-callout-accessory-content",Zg="mk-rtl";class Kg extends io{constructor(e){super(Eo.htmlElement("div",{class:Ig,style:"direction: ltr"})),this._callout=e}didMoveToParent(e){null===e&&this._callout.didRemoveFromParent()}}function jg(e,t,i){const s=17*t,o=13*t,n=e.width/2-s,a=10*t,r=12*t;return"M0,10.5c0,-6.9197181400000005 3.5826363,-10.5 10.5,-10.5h"+e.width+"c6.9173637,0 "+_g+","+yg+" "+_g+","+_g+"v"+e.height+"c0,6.9197181400000005 "+-fg+","+_g+" "+"-10.5,"+_g+"h"+(-i-n)+"c"+-a+",0 "+-r+","+o+" "+-s+","+o+"c"+(r-s)+",0 "+(a-s)+","+-o+" "+-s+","+-o+"h"+(i-n)+"c"+"-6.9173637,0 "+"-10.5,"+-yg+" "+"-10.5,"+"-10.5z"}function Hg(){const e=Math.random().toString(36).substr(2);return document.getElementById(e)?Hg():e}const Vg=class extends pu{constructor(e,t){super(),gg(this,"_tailShift",0),gg(this,"delegate",null),gg(this,"_scaleAnimationParameters",[[vg,Cg,kg],[bg,kg,Mg],[wg,Mg,1]]),super.init(),this.delegate=e,this._rtl=t.rtl,this._node=new Kg(this);const i=this._node.element;function s(t){return e.backgroundColorForElement(t,!0)}function o(e,t){const i=Eo.htmlElement("div",{class:Wg},e);i.style.maxWidth="186.5px",t&&(i.style.padding="0");return Eo.htmlElement("div",{class:Ug},i)}t.customElement?(this._containerElement=this._customElement=t.customElement,this.setSize(this.delegate.sizeForElement(this._customElement)),i.appendChild(t.customElement)):(this._ignoreCalloutCornerRadiusForLeftAccessory=t.ignoreCalloutCornerRadiusForLeftAccessory,this._tailScale=t.tailScale||1,this._bubbleElement=Eo.svgElement("path"),this._svgElement=i.appendChild(Eo.svgElement("svg",{class:Og},this._bubbleElement)),this._containerElement=Eo.htmlElement("div"),this._containerElementNode=new io(this._containerElement),t.leftAccessory&&(this._leftAccessoryBackgroundColor=s(t.leftAccessory),this._leftAccessory=o(t.leftAccessory,!this._rtl&&this._ignoreCalloutCornerRadiusForLeftAccessory),this._containerElement.appendChild(this._leftAccessory)),this._containerContentElement=this._containerElement.appendChild(Eo.htmlElement("div")),this._containerContentElement.className=Gg,t.rightAccessory&&(this._rightAccessoryBackgroundColor=s(t.rightAccessory),this._rightAccessory=o(t.rightAccessory,this._rtl&&this._ignoreCalloutCornerRadiusForLeftAccessory),this._containerElement.appendChild(this._rightAccessory)),(this._leftAccessoryBackgroundColor||this._rightAccessoryBackgroundColor)&&(this._calloutId=Hg(),this._linearGradientElement=Eo.svgElement("linearGradient",{id:this._calloutId}),this._svgElement.appendChild(Eo.svgElement("defs",this._linearGradientElement))),t.contentElement?this._setContentElement(t.contentElement):(this._containerElementNode.classList.add(Ng),t.rtl&&(this._containerContentElement.className+=" "+Zg)),i.appendChild(this._containerElement)),t.position&&this.setPosition(t.position),this._node.wantsHardwareCompositing=!0}get node(){return this._node}get boundingRect(){const e=this._node.position;return new is(e.x,e.y,this._node.size.width,this._node.size.height)}willMoveToMap(){this._node.transform=(new Ys).scale(0)}setAnchorOffset(e){this._anchorOffset=e?new window.DOMPoint(e.x,e.y):new window.DOMPoint}containsElement(e){if(e===this._svgElement)return!1;if(this._containerElement.contains(e))return!0;if(!Eo.supportsShadowDOM||!this.isCustomCallout())return!1;const t=this.customOrContentElement.assignedNodes()[0];return!!t&&t.contains(e)}isCustomCallout(){return!!this.customOrContentElement}get customOrContentElement(){return this._customElement||this._contentElement}get customLeftAccessory(){if(this._leftAccessory)return this._leftAccessory.firstChild.firstChild}get customRightAccessory(){if(this._rightAccessory)return this._rightAccessory.firstChild.firstChild}updateInfo(e,t){if(this.isCustomCallout())return!0;if(!e||!e.title)return!1;this._containerContentElement.innerHTML="",this._containerElement.style.width="",this._containerContentElement.classList.add(Fg),this._containerContentElement.appendChild(Eo.htmlElement("div",{class:Rg,dir:"auto"},e.title)),e.subtitle?(this._containerContentElement.appendChild(Eo.htmlElement("div",{class:Pg,dir:"auto"},e.subtitle)),this._containerElementNode.classList.remove(Dg)):(this._containerElementNode.classList.add(Dg),this._containerElementNode.classList.toggle(zg,!this._leftAccessory&&!this._rightAccessory)),this._updateAccessoryViews(),this._containerElement.className=this._containerElementNode.classList.toString();const i=this.delegate.sizeForElement(this._containerElement),s=e.map._impl.ensureVisibleFrame().size.width-2*t-this._extraWidth(this._ignoreCalloutCornerRadiusForLeftAccessory);return i.width=c(i.width,74,c(s,74,373)),0!==this._accessoryHeight&&(i.height=Math.max(this._accessoryHeight,i.height)),this._updateSize(i,!1),this.updatePosition(),!0}shiftTailBy(e){if(this._customElement)return 0;const t=Math.max(0,(this._bubbleSize.width-74-_g)/2);return this._tailShift=e<0?Math.min(t,-e):-Math.min(t,e),this._bubbleElement.setAttribute("d",jg(this._bubbleSize,this._tailScale,this._tailShift)),this._node.position=new ts(this._node.position.x+this._tailShift,this._node.position.y),this._tailShift}animateIn(){if(!this.animates||this.animates&&this._customElement&&!this.appearanceAnimation)this._node.transform=new Ys;else{if(this._appearanceAnimationName)return this._node.transform=new Ys,void this.delegate.setAnimationForElement(this._containerElement,this._appearanceAnimation,this._appearanceAnimationName);this._scaleXOffset=-this._tailShift,this._scaleYOffset=this._node.size.height/2,this._scaleAnimationParameterIndex=0,this._scaleAnimationStartDate=Date.now(),bt.scheduleOnNextFrame(this)}}animateOut(e){!e&&this.visible?(this._scaleAnimationStartDate&&this._finishAnimatingScale(),this._fadeoutAnimationStartDate=Date.now(),bt.scheduleOnNextFrame(this)):this._node.remove()}mapNodeTintWasSet(e){}performScheduledUpdate(){this._scaleAnimationStartDate&&this._animateScale(),this._fadeoutAnimationStartDate&&this._animateFadeout(),this._tailAnimation&&this._animateTail(),this._anchorOffsetAnimation&&this._animateAnchorOffset()}didRemoveFromParent(){this.delegate.accessoryNodeDidRemove(this)}setSize(e){this._svgElement&&(this._svgElement.style.width=e.width+"px",this._svgElement.style.height=e.height+"px",this._svgElement.setAttribute("viewBox","-0.5 -0.5 "+e.width+" "+e.height)),super.setSize(e)}_updateSize(e,t){const i=this._ignoreCalloutCornerRadiusForLeftAccessory,s=e.width-this.node.size.width-22;this._tailShift=Math.max(0,this._tailShift+Math.min(0,s)),this._containerElement.style.width=e.width+"px";const o=this._extraWidth(i),n=13*this._tailScale,a=22+n;e.width+=o;const r=e.height,l=(i?55:50)+n;e.height+=a,e.height-=_g,e.height=t?e.height:Math.max(e.height,l);const h=t?Tg:Eg,c=(e.height-r-n)/2;this._containerElement.style.top=r/2+Math.max(h,c)+"px";const d=Ag.left,u=Ag.right;let p;this._containerElement.style.left=d+"px",this.setSize(e),this._bubbleSize=new es(e.width-22,e.height-22-n),this._bubbleElement.setAttribute("d",jg(this._bubbleSize,this._tailScale,this._tailShift)),this._leftAccessoryBackgroundColor&&(p=100*(this._leftAccessoryWidth+d)/e.width,this._updateAccessoryViewBackground(p,this._leftAccessoryBackgroundColor,Sg)),this._rightAccessoryBackgroundColor&&(p=100-100*(this._rightAccessoryWidth+u)/e.width,this._updateAccessoryViewBackground(p,Sg,this._rightAccessoryBackgroundColor))}_extraWidth(e){return e?xg.left+xg.right:Lg.left+Lg.right-Lg.content.left}_updateAccessoryViews(){if(this._accessoryHeight=0,this._leftAccessory){const e=this.delegate.sizeForElement(this._leftAccessory.children[0]);this._leftAccessoryWidth=(!this._rtl&&this._ignoreCalloutCornerRadiusForLeftAccessory?0:_g)+e.width,this._accessoryHeight=e.height,this._leftAccessory.style.width=this._leftAccessoryWidth+"px",this._ignoreCalloutCornerRadiusForLeftAccessory&&!this._rtl&&(this._leftAccessory.style.height=this._leftAccessoryWidth+"px",this._leftAccessory.style.overflow="visible"),this._containerContentElement.style.marginLeft=this._leftAccessoryWidth+"px"}if(this._rightAccessory){const e=this.delegate.sizeForElement(this._rightAccessory.children[0]);this._rightAccessoryWidth=(this._rtl&&this._ignoreCalloutCornerRadiusForLeftAccessory?0:_g)+e.width,this._accessoryHeight=Math.max(this._accessoryHeight,e.height),this._rightAccessory.style.width=this._rightAccessoryWidth+"px",this._ignoreCalloutCornerRadiusForLeftAccessory&&this._rtl&&(this._rightAccessory.style.height=this._rightAccessoryWidth+"px",this._rightAccessory.style.overflow="visible"),this._containerContentElement.style.marginRight=this._rightAccessoryWidth+"px"}}_updateAccessoryViewBackground(e,t,i){this._linearGradientElement.appendChild(Eo.svgElement("stop",{offset:e+"%","stop-color":""+t})),this._linearGradientElement.appendChild(Eo.svgElement("stop",{offset:e+"%","stop-color":""+i})),this._bubbleElement.style.fill="url(#"+this._calloutId+")"}_setContentElement(e){this._updateAccessoryViews(),this._contentElement=e,this._containerContentElement.appendChild(Eo.htmlElement("div",e)),this._containerElementNode.classList.add(Bg),this._containerElement.className=this._containerElementNode.classList.toString();const t=this.delegate.sizeForElement(this._containerElement);t.height=Math.max(t.height,this._accessoryHeight),this._updateSize(t,!0)}_animateScale(){const e=this._scaleAnimationParameters[this._scaleAnimationParameterIndex],t=e[0],i=e[1],s=e[2],o=Date.now(),n=Math.min((o-this._scaleAnimationStartDate)/t,1),a=i+(s-i)*n;if(this._node.transform=(new Ys).translate(this._scaleXOffset,this._scaleYOffset).scale(a).translate(-this._scaleXOffset,-this._scaleYOffset),1===n){if(++this._scaleAnimationParameterIndex,!(this._scaleAnimationParameterIndex<this._scaleAnimationParameters.length))return void this._finishAnimatingScale();this._scaleAnimationStartDate=o}bt.scheduleOnNextFrame(this)}_finishAnimatingScale(){delete this._scaleXOffset,delete this._scaleYOffset,delete this._scaleAnimationStartDate,delete this._scaleAnimationParameterIndex}_animateFadeout(){const e=(Date.now()-this._fadeoutAnimationStartDate)/100,t=Math.max(0,1-e);0!==t?(this._node.opacity=t,bt.scheduleOnNextFrame(this)):this._node.remove()}animateTailScale(e,t){const i=(new Date).getTime();t=t||0===t?t:500,this._tailAnimation={timeStart:i,timeEnd:i+t,valueStart:this._tailScale,valueEnd:e},this._animateTail()}_animateTail(){if(!this._tailAnimation)return;const e=(new Date).getTime(),t=this._tailAnimation.timeStart,i=this._tailAnimation.timeEnd,s=this._tailAnimation.valueStart,o=this._tailAnimation.valueEnd,n=i<=t?1:(e-t)/(i-t),a=Eo.easeInOut(c(n,0,1)),r=Eo.lerp(a,s,o),l=13*(r-this._tailScale);this._tailScale=r,this.setSize(new es(this.node.size.width,this.node.size.height+l)),this._bubbleElement.setAttribute("d",jg(this._bubbleSize,this._tailScale,this._tailShift)),e<i?bt.scheduleOnNextFrame(this):this._tailAnimation=null}animateAnchorOffset(e,t){const i=(new Date).getTime();t=t||0===t?t:500,this._anchorOffsetAnimation={timeStart:i,timeEnd:i+t,startX:this._anchorOffset.x,startY:this._anchorOffset.y,endX:e.x,endY:e.y},this._animateAnchorOffset()}_animateAnchorOffset(){if(!this._anchorOffsetAnimation)return;const e=(new Date).getTime(),t=this._anchorOffsetAnimation.timeStart,i=this._anchorOffsetAnimation.timeEnd,s=this._anchorOffsetAnimation.startX,o=this._anchorOffsetAnimation.endX,n=this._anchorOffsetAnimation.startY,a=this._anchorOffsetAnimation.endY,r=i<=t?1:(e-t)/(i-t),l=Eo.easeInOut(c(r,0,1)),h=Eo.lerp(l,s,o),d=Eo.lerp(l,n,a);this._anchorOffset.x=h,this._anchorOffset.y=d,this.updatePosition(),e<i?bt.scheduleOnNextFrame(this):this._anchorOffsetAnimation=null}getCenterOffset(e){const t=13*this._tailScale,i=this._node.size;return new ts(0,(t-i.height-(e?13:0))/2)}},qg="mk-selection-accessory-badge",Yg="mk-selection-accessory-badge-content",Xg="mk-fade-out";const $g=class extends pu{constructor(e,{place:t={},muid:i,coordinate:s,title:o}){super(),super.init(),this.style=Mu.OpenInMaps,this.placeUrl=this._getPlaceUrl(t,i,s,o),this.delegate=e,this._node=new po.Node(Eo.htmlElement("div",{class:qg}));const n=this._node.element;this._containerElement=Eo.htmlElement("button",{role:"link",dir:"auto",type:"button",class:Yg}),this.handleLinkClickedListener=e=>this._handleLinkClicked(),this._containerElement.addEventListener("click",this.handleLinkClickedListener),this._containerElementNode=new po.Node(this._containerElement),this._handleLocaleChangedListener=e=>this._handleLocaleChanged(e),Vi.addEventListener(Vi.Events.LocaleChanged,this._handleLocaleChangedListener),this._textElement=this._containerElement.appendChild(Eo.htmlElement("span")),this._textElement.textContent=Vi.get("OpenInAppleMaps.Label"),n.appendChild(this._containerElement),this.setSize(this.delegate.sizeForElement(n)),this._node.wantsHardwareCompositing=!0,this.analyticsState={place_action_details:{businessID:t.muid||i}},this.delegate.placeCardDidReveal("SMALL",this.analyticsState)}get node(){return this._node}get boundingRect(){const e=this._node.position;return new is(e.x,e.y,this._node.size.width,this._node.size.height)}setPosition(e){e.y+=this._node.size.height,super.setPosition(e)}willMoveToMap(){}setAnchorOffset(e){this._anchorOffset=e?new window.DOMPoint(e.x,e.y):new window.DOMPoint}containsElement(e){return!!this._containerElement.contains(e)}isCustomCallout(){return!1}updateInfo(e,t){return!0}shiftTailBy(){return 0}animateIn(){}animateOut(e){!e&&this.visible||this._node.remove(),this._containerElementNode.classList.add(Xg),setTimeout((()=>this._node.remove()),500)}mapNodeTintWasSet(e){}didRemoveFromParent(){this.delegate.accessoryNodeDidRemove(this),Vi.removeEventListener(Vi.Events.LocaleChanged,this._handleLocaleChangedListener),this._containerElement.removeEventListener("click",this.handleLinkClickedListener)}_getPlaceUrl(e={},t,i,s){const o=new URLSearchParams;return(e.name||s)&&o.append("name",e.name||s),(e.muid||t)&&o.append("place-id",Cu({muid:e.muid||t})),e.formattedAddress&&o.append("address",e.formattedAddress),i=e.coordinate||i,o.append("coordinate",`${i.latitude},${i.longitude}`),`https://maps.apple.com/place?${o.toString()}`}_handleLinkClicked(){window.open(this.placeUrl,"_blank","noopener"),this.delegate.placeCardOpenInMapsClicked("SMALL",this.analyticsState)}_handleLocaleChanged(){this._textElement.textContent=Vi.get("OpenInAppleMaps.Label"),this.setSize(this.delegate.sizeForElement(this._containerElement))}animateTailScale(e,t){0}animateAnchorOffset(e,t){0}getCenterOffset(e){0}},Jg="mk-selection-accessories",Qg="mk-selected";class e_{constructor(e){this.delegate=e,this._oldCenterMode=!1,this.node=new po.Node(Eo.htmlElement("div")),this.node.classList.add(Jg),this._waitingForRegionChangeToEnd=0}get accessoryIsShown(){return!!this._accessory}getAccessoryBoundingRect(){if(this._accessory)return this._accessory.boundingRect}selectedAnnotationVisibilityDidChange(e){this._accessory?this._accessory.visible=e.visible:e.visible&&this.showAccessoryForAnnotation(e,!0)}isElementInAccessory(e){return!!this._accessory&&this._accessory.containsElement(e)}isElementInCustomCallout(e){return!!this._accessory&&this._accessory.isCustomCallout()&&this._accessory.node.element.contains(e)}showAccessoryForAnnotation(e,t){this.hideAccessory(e,t);const{showsSelectionAccessory:i,showsCallout:s,calloutDelegate:o,customCalloutElement:n,customCalloutContentElement:a}=this._canShowSelectionAccessoryForAnnotation(e);if(!i&&!s)return void e._impl.selectionAccessoryWillAppear(!1);e._impl.selectionAccessoryWillAppear(!0);let r=n;if(Eo.supportsShadowDOM&&r){const e="mk-slot-"+Math.random().toString(32).substring(2,10);r.slot=e;const t=Eo.htmlElement("slot");t.name=e,this.delegate.appendElementAssignedToSlot(r),r=t}if(s){const{ignoreCalloutCornerRadiusForLeftAccessory:t,leftAccessory:i,rightAccessory:s}=this._getCalloutPartElements(e,o);this._accessory=new Vg(this,{customElement:r,contentElement:a,ignoreCalloutCornerRadiusForLeftAccessory:t,leftAccessory:this.delegate.rtl?s:i,rightAccessory:this.delegate.rtl?i:s,rtl:this.delegate.rtl})}else if(i){const t=e._impl.selectionAccessory.style;if(t===Mu.OpenInMaps)this._accessory=new $g(this,{place:e._impl.place,muid:e._impl.muid,coordinate:e.coordinate,title:e.title});else if(t===Mu.CompactCallout||t===Mu.FullCallout){const i=t===Mu.CompactCallout;this._accessory=new mg(this,{place:e._impl.place,muid:e._impl.muid,uiStyle:i?"compact":"full",side:this._findSideForAccessorySize(i?mg.DEFAULT_COMPACT_SIZE:mg.DEFAULT_FULL_SIZE)||(this.delegate.rtl?"right":"left"),rtl:this.delegate.rtl})}else{0;const i=this._findSideForAccessorySize(mg.DEFAULT_FULL_SIZE),s=this._findSideForAccessorySize(mg.DEFAULT_COMPACT_SIZE),o=i?"full":"compact",n=i||s;n||t===Mu.Callout?this._accessory=new mg(this,{place:e._impl.place,muid:e._impl.muid,uiStyle:o,side:n||(this.delegate.rtl?"right":"left"),rtl:this.delegate.rtl}):this._accessory=new $g(this,{place:e._impl.place,muid:e._impl.muid,coordinate:e.coordinate,title:e.title})}}else 0;this._accessory.animates=!t&&(!o||"function"!=typeof o.calloutShouldAnimateForAnnotation||!!ue(o.calloutShouldAnimateForAnnotation,o,[e],!0));const l=r&&this._accessory.animates&&o&&"function"==typeof o.calloutAppearanceAnimationForAnnotation?ue(o.calloutAppearanceAnimationForAnnotation,o,[e],""):"";if(p(l,"string","[MapKit] calloutAppearanceAnimationForAnnotation() must return a string, but returned `"+l+"` instead."),this._accessory.appearanceAnimation=l,r){let t;o&&"function"==typeof o.calloutAnchorOffsetForAnnotation&&(t=ue(o.calloutAnchorOffsetForAnnotation,o,[e,this._accessory.node.size]),m(t,window.DOMPoint,"[MapKit] calloutAnchorOffsetForAnnotation() must return a DOMPoint, but returned `"+t+"` instead.")),this._accessory.setAnchorOffset(t)}if(this.updateAccessoryInfo(e),e===this.delegate.userLocationAnnotation){0;const e=this.delegate.constructor.AccuracyRingOverlay.getMode(this.delegate.map.worldSize,100);if(this._oldCenterMode=e,e){const e=this._accessory.getCenterOffset(!0);this._accessory.animateAnchorOffset(e,-1),this._accessory.animateTailScale(0,-1)}else this._accessory.animateAnchorOffset(new ts(0,0),-1),this._accessory.animateTailScale(1,-1)}this.updateAccessoryPositionWithTailShift(e,!1);const h=!t&&this._nudgeMapToShowAccessory();this._accessory.willMoveToMap(),this._accessory.node.classList.add(Qg),this.node.addChild(this._accessory.node),this._accessory.appearanceAnimation&&this.node.element.appendChild(this._accessory.node.element),h||this._accessory.animateIn()}hideAccessory(e,t){e._impl.selectionAccessoryWillDisappear(),this._accessory&&(this._accessory.node.classList.remove(Qg),this._accessory.animateOut(t),delete this._accessory)}updateCenterMode(){const e=this.delegate.selectedItem===this.delegate.userLocationAnnotation,t=this.delegate.constructor.AccuracyRingOverlay.getMode(this.delegate.map.worldSize,100),i=this._oldCenterMode!==t;if(this._oldCenterMode=t,this._accessory&&e&&i)if(this._accessory.animateTailScale(t?0:1),t){const e=this._accessory.getCenterOffset();e.y=e.y-this.delegate.userLocationAnnotation._impl._node.size.height/4,this._accessory.animateAnchorOffset(e)}else this._accessory.animateAnchorOffset(new ts(0,0))}sizeForElement(e){return this.delegate.sizeForElement(e)}backgroundColorForElement(e){return this.delegate.backgroundColorForElement(e)}setAnimationForElement(e,t,i){return this.delegate.setAnimationForElement(e,t,i)}annotationPropertyDidChange(){}accessorySizeDidChange(e){this._nudgeMapToShowAccessory()}accessoryNodeDidRemove(e){Eo.supportsShadowDOM&&(e.isCustomCallout()&&"slot"===e.customOrContentElement.localName&&this.delegate.removeElementAssignedToSlot(e.customOrContentElement),e.customLeftAccessory&&"slot"===e.customLeftAccessory.localName&&this.delegate.removeElementAssignedToSlot(e.customLeftAccessory),e.customRightAccessory&&"slot"===e.customRightAccessory.localName&&this.delegate.removeElementAssignedToSlot(e.customRightAccessory))}updateAccessoryPositionWithTailShift(e,t){if(this.delegate.selectedItem===e&&this._accessory)return this._accessory.setShown(e._impl.isShown()),this._accessory instanceof Vg?this._accessory.setPosition(e._impl.positionForCallout()):this._accessory instanceof $g?this._accessory.setPosition(e._impl.positionForSelectionAccessory("bottom",4)):this._accessory.setPositionWithSide(e._impl.positionForSelectionAccessory(this._accessory.side,mg.TAIL_DISTANCE_TO_ANCHOR),this._accessory.side),t?this.updateAccessoryTailShift(t):void 0}updateAccessoryInfo(e){this._accessory?this._accessory.updateInfo(e,12)||this.hideAccessory(e):this.showAccessoryForAnnotation(e)}updateAccessoryTailShift(e){if(!this._accessory)return!1;const t=e?this._accessory.boundingRect.pad(12):this._boundingRectForSelectedAnnotationAndAccessory().pad(12),i=this._totalMapNudgingTranslation(t,this.delegate.map.ensureVisibleFrame(),e),s=i.x,o=i.y,n=this._accessory.shiftTailBy(s);return 0!==s||0!==o?new ts(-(s+n),-o):void 0}get tint(){return this.delegate.map.tint}mapNodeTintWasSet(e){this._accessory&&this._accessory.mapNodeTintWasSet(e)}mapRegionChangeWillStart(){this._waitingForRegionChangeToStart&&(this._nudgeStarted=!0,this._waitingForRegionChangeToEnd++)}mapRegionChangeDidEnd(){if(!this._waitingForRegionChangeToEnd)return;this._waitingForRegionChangeToEnd--;0!==this._waitingForRegionChangeToEnd&&this._nudgeMapToShowAccessory()?this._waitingForRegionChangeToEnd=1:(this._waitingForRegionChangeToEnd=0,this.updateAccessoryPositionWithTailShift(this.delegate.selectedItem,!0),this._accessory&&this._accessory.animateIn())}getMaximumSizeForAccessory(){if(!this.delegate.selectedItem)return void 0;const e=this.delegate.selectedItem._impl._node.size,t=this.delegate.map.ensureVisibleFrame().size.copy();return"left"===this._accessory.side||"right"===this._accessory.side?(t.width-=e.width+50+mg.TAIL_LENGTH+mg.TAIL_DISTANCE_TO_ANCHOR,t.height-=50):(t.width-=50,t.height-=e.height+50+mg.TAIL_LENGTH+mg.TAIL_DISTANCE_TO_ANCHOR),t}placeCardDidReveal(e,t){this.delegate.placeCardDidReveal(e,t)}placeCardOpenInMapsClicked(e,t){this.delegate.placeCardOpenInMapsClicked(e,t)}_findSideForAccessorySize(e){if(!this.delegate.selectedItem)return void 0;const t=this.delegate.selectedItem,i=t._impl._node,s=new is(i.position.x,i.position.y,i.size.width,i.size.height).round(),o=this.delegate.map.ensureVisibleFrame(),n=t._impl.positionForSelectionAccessory("left",mg.TAIL_DISTANCE_TO_ANCHOR).y,a=s.minX()-o.minX(),r=o.maxX()-s.maxX();if(n+e.height/2<o.maxY()&&n-e.height/2>o.minY()){const t=e.width<a,i=e.width<r;if(t&&i)return a===r?this.delegate.rtl?"right":"left":a>r?"left":"right";if(t)return"left";if(i)return"right"}const l=s.minY()-o.minY();if(e.height<l)return"top";const h=o.maxY()-s.maxY();return e.height<h?"bottom":o.size.width-s.size.width>e.width+mg.TAIL_LENGTH+mg.TAIL_DISTANCE_TO_ANCHOR?a>=r?"left":"right":o.size.height-s.size.height>e.height+mg.TAIL_LENGTH+mg.TAIL_DISTANCE_TO_ANCHOR?l>=h?"top":"bottom":null}_canShowSelectionAccessoryForAnnotation(e){const t=e._impl.place;if(e._impl.selectionAccessory&&(t&&t.name&&t.coordinate||e.title&&e._impl.muid&&e.coordinate))return e._impl.canShowSelectionAccessory()?{showsSelectionAccessory:!0}:{showsSelectionAccessory:!1,showsCallout:!1};if(!e._impl.canShowCallout())return{showsSelectionAccessory:!1,showsCallout:!1};const i=e._impl.callout;if(i&&"function"==typeof i.calloutShouldAppearForAnnotation&&!ue(i.calloutShouldAppearForAnnotation,i,[e],!0))return{showsSelectionAccessory:!1,showsCallout:!1};let s;let o;i&&"function"==typeof i.calloutElementForAnnotation&&(s=ue(i.calloutElementForAnnotation,i,[e]),oe(s,"[MapKit] calloutElementForAnnotation() must return a DOM element, but returned `"+s+"` instead."));let n=!1;if(!s){if(n=i&&"function"==typeof i.calloutContentForAnnotation,n&&(o=ue(i.calloutContentForAnnotation,i,[e]),oe(o,"[MapKit] contentElementForAnnotation() must return a DOM element, but returned `"+o+"` instead."),Eo.supportsShadowDOM)){const e="mk-slot-"+Math.random().toString(32).substring(2,10);o.slot=e;const t=Eo.htmlElement("slot");t.name=e,this.delegate.appendElementAssignedToSlot(o),o=t}if(!n&&!e.title)return{showsSelectionAccessory:!1,showsCallout:!1}}return{showsSelectionAccessory:!1,showsCallout:!0,calloutDelegate:i,customCalloutElement:s,customCalloutContentElement:o}}_getCalloutPartElements(e,t){let i;const s=t&&"function"==typeof t.calloutLeftAccessoryForAnnotation;if(s&&(i=ue(t.calloutLeftAccessoryForAnnotation,t,[e]),oe(i,"[MapKit] calloutLeftAccessoryForAnnotation() must return a DOM element, but returned `"+i+"` instead."),Eo.supportsShadowDOM)){const e="mk-slot-"+Math.random().toString(32).substr(2,8);i.slot=e;const t=Eo.htmlElement("slot");t.name=e,this.delegate.appendElementAssignedToSlot(i),i=t}let o;const n=t&&"function"==typeof t.calloutRightAccessoryForAnnotation;if(n&&(o=ue(t.calloutRightAccessoryForAnnotation,t,[e]),oe(o,"[MapKit] calloutRightAccessoryForAnnotation() must return a DOM element, but returned `"+o+"` instead."),Eo.supportsShadowDOM)){const e="mk-slot-"+Math.random().toString(32).substring(2,10);o.slot=e;const t=Eo.htmlElement("slot");t.name=e,this.delegate.appendElementAssignedToSlot(o),o=t}const a=e._impl.ignoreCalloutCornerRadiusForLeftAccessory&&!s&&!n;return!s&&e._impl.canvasForCalloutAccessory&&(i=e._impl.canvasForCalloutAccessory()),{ignoreCalloutCornerRadiusForLeftAccessory:a,leftAccessory:i,rightAccessory:o}}_boundingRectForSelectedAnnotationAndAccessory(){const e=this.getAccessoryBoundingRect(),t=this.delegate.selectedItem._impl.position(),i=Math.min(e.minX(),t.x),s=Math.min(e.minY(),t.y),o=Math.max(e.maxX(),t.x)-i,n=Math.max(e.maxY(),t.y)-s;return new is(i,s,o,n)}_translationToFitInFrame(e,t){const i={x:0,y:0};return(e.maxX()>t.maxX()||e.minX()<t.minX()||e.maxY()>t.maxY()||e.minY()<t.minY())&&(i.x=e.minX()<t.minX()?e.minX()-t.minX():e.maxX()>t.maxX()?e.maxX()-t.maxX():0,i.y=e.minY()<t.minY()?e.minY()-t.minY():e.maxY()>t.maxY()?e.maxY()-t.maxY():0),i}_totalMapNudgingTranslation(e,t,i){const s=this._translationToFitInFrame(e,t),o=this.delegate.map.getControlBounds(),n=t.midX(),a=t.midY();let r=0,l=0;return e=t_(e,s.x,s.y),o.forEach((t=>{if(e.minX()<t.maxX()&&e.maxX()>t.minX()&&e.minY()<t.maxY()&&e.maxY()>t.minY()){if(r+=t.maxX()<n?e.minX()-t.maxX():e.maxX()-t.minX(),l+=t.maxY()<a?e.minY()-t.maxY():e.maxY()-t.minY(),i)return;0!==l&&Math.abs(r)>Math.abs(l)?r=0:l=0,e=t_(e,r,l)}}),this),s.x+=r,s.y+=l,s}_nudgeMapToShowAccessory(){if(this.delegate.map.cameraIsMoving)return this._waitingForRegionChangeToEnd++,!0;if(!this.delegate.selectedItem||!this.delegate.selectedItem._impl.isShown())return!1;const e=this.updateAccessoryPositionWithTailShift(this.delegate.selectedItem,!0);if(!e)return!1;this._waitingForRegionChangeToStart=!0,this.delegate.map.translateCameraAnimated(e,!0);const t=this._nudgeStarted;return delete this._nudgeStarted,this._waitingForRegionChangeToStart=!1,t}}function t_(e,t,i){return new is(e.origin.x-t,e.origin.y-i,e.size.width,e.size.height)}function i_(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const s_=vi.MapRect,o_="mk-annotation-container",n_="mk-annotations",a_="mk-dragging",r_="mk-selected",l_="mk-lifted",h_="mk-text-zoom";let c_=null;class d_ extends Jc{constructor(e){super(e),i_(this,"itemConstructor",Bu),i_(this,"itemName","annotation"),i_(this,"capitalizedItemName","Annotation"),i_(this,"_rtl",!1),i_(this,"_selectionDistance",Math.pow(this._selectionDistance,2)),i_(this,"_userLocationAnnotation",null),this._pendingAnnotations=[],this._mapFeatureAnnotationController=new xm(this),this._clustersController=new Wm(this),Vi.activeLocale&&(this._rtl=Vi.activeLocale.rtl),this._node=new po.Node(Eo.htmlElement("div",{class:o_})),Vi.activeLocale&&this._node.element.setAttribute("lang",Vi.localeId),this._shadowDOMSlotController=new Hm(this._node);const t=Eo.htmlElement("div",{class:n_});this._sceneGraphNode=new Zm(t),this._shadowRootNode=Eo.addShadowRootChild(this._node,Ue.shadowDOMMode,':host(.mk-annotation-container.mk-dragging) ::selection,div.mk-annotations ::selection{background:0 0}.mk-invisible{opacity:0;pointer-events:none}.mk-hidden{display:none}div.mk-annotations,div.mk-annotations>div,div.mk-selection-accessories,div.mk-style-helper{position:absolute;top:0;left:0}.mk-selected{z-index:1}.mk-lifted{z-index:2}.mk-callout,.mk-selection-accessory{position:absolute;top:0;left:0;-webkit-user-select:auto;-moz-user-select:text;-ms-user-select:text}.mk-callout:not(.mk-invisible),.mk-selection-accessory:not(.mk-invisible){pointer-events:auto}:host(.mk-annotation-container) .mk-selection-accessory,:host(.mk-annotation-container) .mk-selection-accessory-badge{font:16px sans-serif;--font-size-default:16}:host(.mk-dark-mode) .mk-callout,:host(.mk-dark-mode) .mk-selection-accessory{color:#fff}:host(.mk-annotation-container.mk-text-zoom) .mk-selection-accessory,:host(.mk-annotation-container.mk-text-zoom) .mk-selection-accessory-badge{font:initial}@supports (font:-apple-system-body) and (-webkit-touch-callout:default){:host(.mk-annotation-container.mk-text-zoom) .mk-selection-accessory,:host(.mk-annotation-container.mk-text-zoom) .mk-selection-accessory-badge{font:-apple-system-body;--font-size-default:17}}.mk-callout>*{position:absolute;top:0;left:0}svg.mk-bubble{display:block;width:100%;height:100%}svg.mk-selection-accessory-bubble{position:absolute;display:block;filter:drop-shadow(0 0 5px rgb(0 0 0 / 30%))}div.mk-callout-accessory{position:absolute;top:50%;transform:translateY(-50%);overflow:hidden}div.mk-callout-accessory-content{white-space:nowrap;position:relative;text-align:center;font-size:12px}div.mk-callout-accessory:first-child{left:0}div.mk-callout-accessory:last-child{right:0}div.mk-callout-accessory:first-child .mk-callout-accessory-content{padding-right:8px}div.mk-callout-accessory:last-child .mk-callout-accessory-content{padding-left:8px}div.mk-standard{font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Helvetica,Arial,sans-serif;box-sizing:border-box;position:relative}:host(.mk-annotation-container) .mk-standard-content{font:16px sans-serif;--font-size-default:16}:host(.mk-annotation-container.mk-text-zoom) .mk-standard-content{font:initial}@supports (font:-apple-system-body) and (-webkit-touch-callout:default){:host(.mk-annotation-container.mk-text-zoom) .mk-standard-content{font:-apple-system-body;--font-size-default:17}}div.mk-selection-accessory-content{box-sizing:border-box;position:relative;overflow:auto;color-scheme:light;top:0;left:0;border-radius:18px}div.mk-selection-accessory-content.mk-rtl{direction:rtl}.mk-ui-style-compact div.mk-selection-accessory-content{overflow:hidden}:host(.mk-dark-mode) div.mk-selection-accessory-content{color-scheme:dark}:host(.mk-panning) div.mk-selection-accessory-content{pointer-events:none}.mk-ui-style-compact div.mk-selection-accessory-content>div{width:243px}div.mk-custom-content,div.mk-standard{transform:translateY(-50%)}div.mk-standard .mk-callout-content>div{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}div.mk-standard .mk-callout-content{padding:0 4px}.mk-callout-content.mk-rtl{direction:rtl}.mk-callout-content.mk-rtl *{text-align:right}div.mk-callout-accessory:first-child+.mk-callout-content{padding-left:8px}div.mk-standard .mk-callout-content:nth-last-child(2){padding-right:8px}div.mk-standard .mk-title{font-size:calc(100% * 17 / var(--font-size-default));font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Helvetica,Arial,sans-serif;font-weight:500;color:#000;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;letter-spacing:.025em}:host(.mk-dark-mode) div.mk-standard .mk-title{color:#fff}div.mk-standard .mk-subtitle{font-size:calc(100% * 13 / var(--font-size-default));font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",Helvetica,Arial,sans-serif;color:rgb(0 0 0 / 70%);letter-spacing:.025em}:host(.mk-dark-mode) div.mk-standard .mk-subtitle{color:rgb(255 255 255 / 70%)}svg.mk-bubble path{fill:white;stroke:rgb(0 0 0 / 20%)}svg.mk-selection-accessory-bubble path{fill:rgb(239 239 239);stroke:rgb(239 239 239 / 70%);stroke-width:2px}:host(.mk-dark-mode) svg.mk-bubble path{fill:#3e3e3e;stroke:rgb(0 0 0 / 50%)}:host(.mk-dark-mode) svg.mk-selection-accessory-bubble path{fill:rgb(54 54 54);stroke:rgb(54 54 54 / 70%);stroke-width:2px}.mk-selection-accessory-loading{display:block;width:100%;height:100%}.mk-selection-accessory-failed{display:flex;height:100%;align-items:center;justify-content:center;color:#000;opacity:.55;font-family:-apple-system-font,"Helvetica Neue",Helvetica,Arial,sans-serif}:host(.mk-dark-mode) .mk-selection-accessory-failed{color:#fff}.mk-selection-accessory-failed .mk-failed-labels{padding:0 20px}.mk-ui-style-compact .mk-selection-accessory-failed .mk-failed-labels{flex-grow:1}.mk-selection-accessory-failed p{margin:0;font-size:calc(100% * 12 / var(--font-size-default));font-weight:400}.mk-ui-style-full .mk-selection-accessory-failed p{margin:2px 0;text-align:center}.mk-selection-accessory-failed p:first-child{font-size:calc(100% * 14 / var(--font-size-default));font-weight:500}.mk-ui-style-compact .mk-selection-accessory-failed p:first-child{margin-top:10px}.mk-ui-style-compact .mk-selection-accessory-failed p:last-child{margin-bottom:10px}.mk-ui-style-full .mk-selection-accessory-failed p:first-child{margin-top:60px}.mk-ui-style-full .mk-selection-accessory-failed p:last-child{margin-bottom:60px}.mk-selection-accessory-badge-content{cursor:pointer;padding:4px 8px;font-size:calc(100% * 13 / var(--font-size-default));font-family:13px -apple-system-font,HelveticaNeue-Medium,Helvetica,Arial,sans-serif;font-weight:500;border:1px solid rgb(0 0 0 / 10%);border-radius:13px;color:#007aff;background-color:rgb(255 255 255);box-shadow:0 0 5px 0 rgb(0 0 0 / 30%);animation:fade-in .5s}.mk-selection-accessory-badge-content.mk-fade-out{transition:visibility .5s,opacity .5s;opacity:0;visibility:hidden}.mk-selection-accessory-badge-content span{opacity:.8}.mk-selection-accessory-badge-content:hover span{opacity:1}.mk-selection-accessory-badge-content:active{background-color:rgb(229 229 229)}.mk-selection-accessory-badge-content:focus-visible{outline:0;background-color:rgb(204 229 255);box-shadow:0 0 5px 0 rgb(0 0 0 / 30%),0 0 0 2px rgb(0 124 255)}.mk-selection-accessory-badge-content:active:focus-visible{background-color:rgb(127 189 255)}@keyframes fade-in{from{opacity:0}to{opacity:1}}:host(.mk-dark-mode) .mk-selection-accessory-badge-content{color:#0a84ff;background-color:rgb(54 54 54)}:host(.mk-dark-mode) .mk-selection-accessory-badge-content:active{background-color:rgb(42 42 42)}:host(.mk-dark-mode) .mk-selection-accessory-badge-content:focus-visible{background-color:rgb(12 49 89)}:host(.mk-dark-mode) .mk-selection-accessory-badge-content:active:focus-visible{color:#64b1ff;background-color:rgb(3 102 207)}@supports ((backdrop-filter:blur(30px)) or (-webkit-backdrop-filter:blur(30px))){.mk-selection-accessory-badge-content{-webkit-backdrop-filter:blur(30px);backdrop-filter:blur(30px);background-color:rgb(255 255 255 / 75%)}.mk-selection-accessory-badge-content:active{background-color:rgb(229 229 229 / 60%)}.mk-selection-accessory-badge-content:focus-visible{background-color:rgb(204 229 255 / 60%)}.mk-selection-accessory-badge-content:active:focus-visible{background-color:rgb(127 189 255 / 60%)}:host(.mk-dark-mode) .mk-selection-accessory-badge-content{background-color:rgb(18 18 18 / 60%)}:host(.mk-dark-mode) .mk-selection-accessory-badge-content:active{background-color:rgb(42 42 42 / 60%)}:host(.mk-dark-mode) .mk-selection-accessory-badge-content:focus-visible{background-color:rgb(12 49 89 / 60%)}:host(.mk-dark-mode) .mk-selection-accessory-badge-content:active:focus-visible{background-color:rgb(3 102 207 / 60%)}}',Ue.nonce),this._annotationsNode=this._shadowRootNode.addChild(new po.Node(t)),this._selectionAccessoryController=new e_(this),this._shadowRootNode.addChild(this._selectionAccessoryController.node),this._styleHelper=new Km(this),this._shadowRootNode.addChild(new po.Node(this._styleHelper.element)),this._annotationDraggingMapPanningController=new lu(e),this.textZoom=e.textZoom}get sceneGraphNode(){return this._sceneGraphNode}isItemExposed(e){return e!==this._userLocationAnnotation&&!e.memberAnnotations}get map(){return this._map}get userLocationAnnotation(){return this._userLocationAnnotation}get dragging(){return!!this._draggedAnnotation}get rtl(){return this._rtl}set rtl(e){this._rtl!==e&&(this._rtl=e,this._selectedItem&&this._selectionAccessoryController.accessoryIsShown&&this._selectionAccessoryController.showAccessoryForAnnotation(this._selectedItem,!0))}get textZoom(){return this._node.classList.contains(h_)}set textZoom(e){this._node.classList.toggle(h_,e)}preAddedAnnotation(e){if(!e._impl.updatedPosition())return!1;const t=!e.map,i=Eo.supportsShadowDOM&&this._annotationsNode&&e._impl.renderedByDOMElement&&!e.element.parentNode;return i&&this._shadowDOMSlotController.appendAssignedElement(e.element,!1),t&&e._impl.setDelegate(this),t||i}resetAnnotation(e){Eo.supportsShadowDOM&&this._annotationsNode&&e._impl.renderedByDOMElement&&e.element.parentNode&&this._shadowDOMSlotController.removeAssignedElement(e._impl.elementInAnnotationDOM,!1),-1===this._items.indexOf(e)&&(e._impl.delegate=null)}addItems(e){e=super.addItems(e);if(this._shouldAnnotationBePending())return e;e.sort(((e,t)=>t.coordinate.latitude-e.coordinate.latitude));const t=this._map.camera.toMapRect(),i=t.size.width,s=t.size.height,o=t.origin.x-i,n=o+3*i,a=t.origin.y-s,r=a+3*s;let l=0;e.forEach((e=>{if(e._impl.doesAnimate()&&e.visible){e._impl.x+(e._impl.x<o?1:0)<=n&&e._impl.y>=a&&e._impl.y<=r&&(e._impl.delayRank=l,++l)}}));const h=Math.min(50*l,3e3),c=0===l?0:h/l;return e.forEach((e=>{e._impl.delayMs=e._impl.delayRank*c,delete e._impl.delayRank}),this),e}addWaitingAnnotations(e){const t="function"==typeof e;this._waitingAnnotations?(t&&(this._completionCallback=e),window.clearTimeout(this._tileLoadingTimeout),delete this._tileLoadingTimeout,this._waitingAnnotations.forEach((function(e){e.map&&this._addAnnotationWaitingForTiles(e,!1,!t)}),this),this._updateSceneGraph(),delete this._waitingAnnotations,bt.scheduleOnNextFrame((()=>this._checkCompletion()))):t&&e()}annotationsInMapRect(e){m(e,s_,"[MapKit] Map.annotationsInMapRect expects a MapRect as its argument, got `"+e+"` instead.");const t=l(e.origin.x,1),i=t+e.size.width,s=e.origin.y,o=s+e.size.height;return this._items.filter((function(e){if(!this.isItemExposed(e))return!1;const n=e._impl.x+(e._impl.x<t?1:0),a=e._impl.y;return n>=t&&n<=i&&a>=s&&a<=o}),this)}removeItem(e){return e===this._userLocationAnnotation?(console.warn("[MapKit] Map.removeAnnotation: the user location annotation cannot be removed. Set showsUserLocation to false instead."),e):super.removeItem(e)}removeUserLocationAnnotation(){this._userLocationAnnotation&&(this._userLocationAnnotation._impl.removedFromMap(),super.removeAnyItem(this._userLocationAnnotation),delete this._userLocationAnnotation)}updateUserLocationAnnotation(e,t){if(!e.coordinate)return;const i=this._userLocationAnnotation||new d_.UserLocationAnnotation(e);if(this._userLocationAnnotation||(this._userLocationAnnotation=i,this.addItem(i,0)),e.stale)return delete this._lastGeocoderRequestCoordinate,delete this._lastUserLocationAnnotationSubtitle,void(i._impl.stale=!0);if(i._impl.stale=!1,i._impl.setCoordinate(e.coordinate),c_){if(!t&&this._lastGeocoderRequestCoordinate&&this._lastGeocoderRequestCoordinate.latitude===i._impl.coordinate.latitude&&this._lastGeocoderRequestCoordinate.longitude===i._impl.coordinate.longitude)return void(this._userLocationAnnotation.subtitle=this._lastUserLocationAnnotationSubtitle)}else c_=new d_.Geocoder;this._lastGeocoderRequestCoordinate=i._impl.coordinate.copy(),u_(c_,i,this)}mapSizeDidUpdate(){if(0===this._pendingAnnotations.length)return;const e=this._map.shouldWaitForTilesAndControls();this._pendingAnnotations.forEach((function(t){t._impl.isPending&&this._addAnnotationWaitingForTiles(t,e)}),this),this._updateSceneGraph(),this._pendingAnnotations=[]}updateVisibleAnnotations(){0!==this._items.length&&(this._updateVisibleAnnotations(this._items),this._updateSceneGraph())}startDraggingAnnotation(e,t){this._map.annotationDraggingWillStart(),this._draggedAnnotation=e,this._pendingDragStart=!0,e.selected&&this._selectionAccessoryController.hideAccessory(e),this._node.classList.add(a_),this._draggedAnnotation._impl.node.classList.add(l_),this._draggedAnnotation._impl.lift(),this._updateSceneGraph()}mapNodeTintWasSet(e){this._items.forEach((e=>{e._impl.updateLayout()})),this._selectionAccessoryController.mapNodeTintWasSet(e)}mapTypeDidChange(){this._mapFeatureAnnotationController.mapTypeDidChange()}fontSizeDidChange(){this._items.forEach((e=>{e._impl.updateLayout(!1,!0)}))}devicePixelRatioDidChange(){this._items.forEach((e=>{"function"==typeof e._impl.updateGlyphImages&&e._impl.updateGlyphImages()}))}styleHelperNodeDidMoveToParent(e){if(!Eo.supportsShadowDOM)return;const t=e.assignedNodes?e:e.querySelector("slot"),i=t&&this._shadowDOMSlotController.getAssignedElement(t);t&&i&&i.parentNode&&0===t.assignedNodes().length&&(this._node.element.removeChild(i),this._node.element.appendChild(i))}getShadowDOMTargetFromEvent(e){if(this._shadowRootNode.domNode)return Eo.getShadowDOMTargetFromEvent(this._shadowRootNode.domNode,e)}performScheduledUpdate(){this.dispatchDraggingEvent()}dispatchDraggingEvent(){if(!this._draggedAnnotation||this._mapWasDestroyed)return;const e=this._draggedAnnotation._impl.dispatchDraggingEvent();this._map.dispatchEventWithAnnotation(e.type,this._draggedAnnotation,{coordinate:e.coordinate})}addedItem(e,t){for(const t of e._impl.getMuidList())this.map.setPoiFiltered(t,!0);super.addedItem(e,t),e._impl.isWaiting=!0,t&&(e._impl.delayRank=0);const i=this._shouldAnnotationBePending(e);i&&(e._impl.isPending=!0,this._pendingAnnotations.push(e)),this._updateAnnotation(e),e._impl.selected&&this._didSelectAnnotation(e),i||this._addAnnotationWaitingForTiles(e,this._map.shouldWaitForTilesAndControls())}manyItemsAdded(e){this._updateSceneGraph()}removedItem(e,t){for(const t of e._impl.getMuidList())this.map.setPoiFiltered(t,!1);delete e._impl.wasCollided,"function"==typeof e._impl.node.remove&&(Eo.supportsShadowDOM&&e._impl.node.parent&&this._shadowDOMSlotController.removeAssignedElement(e._impl.elementInAnnotationDOM,!e._impl.renderedByDOMElement),e._impl.node.remove()),super.removedItem(e),e._impl.labelRegion&&this._removeLabelRegionForAnnotation(e),t||this._updateVisibleAnnotations([e]),this._clustersController.removedAnnotation(e),e.memberAnnotations||this._updateCollisions(this._items)}manyItemsRemoved(e){this._updateVisibleAnnotations(this.items),this._updateSceneGraph()}manyItemsChanged(e){this._updateVisibleAnnotations(this.items),this._updateSceneGraph()}removedReferenceToMap(){this._userLocationAnnotation&&this._userLocationAnnotation._impl.removedFromMap()}pickableItemsCloseToPoint(e,t){const i=e.filter((function(e,i){const s=e._impl.distanceToPoint(t);return s<=this._selectionDistance&&(e._impl.distance=s,e._impl.index=i,!0)}),this).sort(((e,t)=>e._impl.distance-t._impl.distance||t._impl.index-e._impl.index));return i.forEach((e=>{delete e._impl.distance,delete e._impl.index})),i}annotationDraggingDidChange(e){this._draggedAnnotation&&!this._draggedAnnotation._impl.shouldPreventDrag&&(this._pendingDragStart&&(delete this._pendingDragStart,this._draggedAnnotation._impl.draggingDidStart(),this._map.dispatchEventWithAnnotation(Pu.Events.DragStart,this._draggedAnnotation)),bt.scheduleASAP(this),this._draggedAnnotation._impl.setDraggingTranslationForMapFrameSize(e,this._map.ensureRenderingFrame().size),this._annotationDraggingMapPanningController.update(this._draggedAnnotation,this._draggedAnnotation._impl.node))}annotationDraggingDidEnd(e){this._draggedAnnotation&&(this._annotationDraggingMapPanningController.stop(),this._draggedAnnotation._impl.dropAfterDraggingAndRevertPosition(!e),this._draggedAnnotation._impl.node.classList.remove(l_),this._node.classList.remove(a_),this._map.annotationDraggingDidEnd(),this._map.dispatchEventWithAnnotation(Pu.Events.DragEnd,this._draggedAnnotation),delete this._draggedAnnotation,this._updateSceneGraph())}annotationPropertyDidChange(e,t){switch(t){case"selected":e.selected?this._didSelectAnnotation(e):this._didDeselectAnnotation(e);break;case"coordinate":if(!e._impl.updatedPosition())return;break;case"":case"displayPriority":case"collisionMode":case"clusteringIdentifier":case"padding":break;case"calloutOffset":0,this._selectionAccessoryController.updateAccessoryPositionWithTailShift(e,!0);break;case"selectionAccessoryOffset":default:0;break;case"visible":this._selectedItem===e&&this._selectionAccessoryController.selectedAnnotationVisibilityDidChange(e),e._impl.needsColliding=!0;break;case"draggable":this._draggedAnnotation!==e||e.draggable||this._map.stopDraggingAnnotation();break;case"title":case"subtitle":this._selectedItem===e&&(this._selectionAccessoryController.updateAccessoryInfo(e),this._selectionAccessoryController.updateAccessoryTailShift())}e.map&&e.map===this._map.public&&(this._annotationsDidChangeSinceLastCollision=!0,this._updateVisibleAnnotations([e]),this._updateSceneGraph(),this._updateLabelRegionForAnnotation(e))}mapForAnnotation(e){return this._map?this._map.public:null}sizeForElement(e){if(this._map.isRooted())return this._styleHelper.sizeForElement(e)}backgroundColorForElement(e,t){return this._styleHelper.backgroundColorForElement(e,t)}setAnimationForElement(e,t,i){return this._styleHelper.setAnimationForElement(e,t,i)}selectedAnnotationDidMoveToMap(e){this._updateSceneGraph(),this._selectionAccessoryController.showAccessoryForAnnotation(e)}supportsLabelRegions(){return this._map.supportsLabelRegions()}annotationFinishedAnimating(e){this._checkCompletion()}isElementInAccessory(e){return this._selectionAccessoryController.isElementInAccessory(e)}isElementInCustomCallout(e){return this._selectionAccessoryController.isElementInCustomCallout(e)}mapPanningDuringAnnotationDrag(){this.dispatchDraggingEvent()}mapSupportForLabelRegionsChanged(){this._items.forEach((function(e){const t=e._impl;t.updateLayout(),delete t.labelRegion,this._updateLabelRegionForAnnotation(e)}),this)}containsMarkerAnnotation(){return this._items.some((e=>"string"==typeof e.glyphText))}paddingForAnnotation(e){let t=0,i=0;e.size?(t=e.size.width,i=e.size.height):console.warn("[MapKit] Computing padding for showItems() when an annotation was not yet added the DOM can cause the annotation to not be entirely visible. The `size` property of the annotation can be changed to ensure that it shows up properly.");const s={top:e._impl._anchorPoint.y,right:t-e._impl._anchorPoint.x,bottom:i-e._impl._anchorPoint.y,left:e._impl._anchorPoint.x};if(e===this.selectedItem&&this._selectionAccessoryController.accessoryIsShown){const t=this._selectionAccessoryController.getAccessoryBoundingRect(),i=e._impl.position();s.top=Math.max(s.top,i.y-t.minY()),s.right=Math.max(s.right,t.maxX()-i.x),s.bottom=Math.max(s.bottom,t.maxY()-i.y),s.left=Math.max(s.left,i.x-t.minX())}return s}appendElementAssignedToSlot(e){this._shadowDOMSlotController.appendAssignedElement(e)}removeElementAssignedToSlot(e){this._shadowDOMSlotController.removeAssignedElement(e)}mapFeatureRegionCloseToPoint(e,t){if(!t.length)return;let i,s,o=1/0;for(const n of t){const t=new vi.MapPoint(n.position[0],n.position[1]);t.x<this.map.camera.minX()&&(t.x+=1);const a=this.map.camera.transformMapPoint(t);for(const t of n.rects){const r=t.size,l=a.x+t.offset[0],h=a.y+t.offset[1];if(l<e.x&&e.x<l+r[0]&&h<e.y&&e.y<h+r[1]){i=n;break}const c=l,d=c+r[0],u=c-e.x,p=d-e.x,m=u<=0&&p>=0?0:Math.min(Math.abs(u),Math.abs(p)),g=h,_=g+r[1],f=g-e.y,y=_-e.y,v=f<=0&&y>=0?0:Math.min(Math.abs(f),Math.abs(y)),b=m*m+v*v;o>b&&(o=b,s=n)}if(i)break;if(n.circles&&n.circles.length){const t=this.map.ensureRenderingFrame().size.height;for(const a of n.circles){const r=a.x,l=t-a.y,h=a.radius,c=Math.abs(e.x-r),d=Math.abs(e.y-l),u=c*c+d*d;if(u<h*h){i=n;break}o>u&&(o=u,s=n)}}if(i)break}return i||(s&&o<this._selectionDistance?s:void 0)}getMapFeatureAnnotationForRegion(e,t){return this._mapFeatureAnnotationController.getMapFeatureAnnotationForRegion(e,t)}mapFeatureDidSelect(e){this._mapFeatureAnnotationController.mapFeatureDidSelect(e)}mapRegionChangeWillStart(){this._selectionAccessoryController.mapRegionChangeWillStart()}mapRegionChangeDidEnd(){this._selectionAccessoryController.mapRegionChangeDidEnd()}localeChanged(){this._node.setAttribute("lang",Vi.localeId),this.rtl=Vi.activeLocale.rtl}placeCardDidReveal(e,t){this._map.annotationPlaceSelectionAccessoryDidReveal(e,t)}placeCardOpenInMapsClicked(e,t){this._map.annotationPlaceSelectionAccessoryOpenInMapsClicked(e,t)}_addAnnotationToMapAsync(e){this._addAnnotationToMap(e,!1),this._updateSceneGraph()}_addAnnotationToMap(e,t){if(this._shouldAnnotationBePending())return void(e._impl.isPending=!0);Eo.supportsShadowDOM&&this._annotationsNode&&this._shadowDOMSlotController.appendAssignedElement(e.element,!e._impl.renderedByDOMElement),e._impl.willMoveToMap(e._impl.canAnimate&&!t),delete e._impl.timeout,delete e._impl.isWaiting,delete e._impl.canAnimate,delete e._impl.delayMs;const i=this._items.indexOf(e);this._annotationsNode&&this._annotationsNode.addChild(e._impl.node,i),e._impl.sceneGraphNode&&this._sceneGraphNode.addChild(e._impl.sceneGraphNode,i),this._updateAnnotation(e),e.selected&&this._selectionAccessoryController.showAccessoryForAnnotation(e),this._updateLabelRegionForAnnotation(e),e._impl.didMoveToMap()}_addAnnotationWaitingForTiles(e,t,i){if("canAnimate"in e._impl||(e._impl.canAnimate=!e._impl.isPending),delete e._impl.isPending,t&&e!==this._userLocationAnnotation){if(!this._items.some((e=>e!==this._userLocationAnnotation&&e._impl.mayBeDrawn())))return void(this._waitingAnnotations?this._waitingAnnotations.push(e):(this._waitingAnnotations=[e],this._tileLoadingTimeout=window.setTimeout((()=>this.addWaitingAnnotations(r)),3e3)))}!i&&e._impl.doesAnimate()&&e._impl.delayMs>0?e._impl.timeout=window.setTimeout((()=>this._addAnnotationToMapAsync(e)),e._impl.delayMs):this._addAnnotationToMap(e,i)}_didDeselectAnnotation(e){e._impl.node.classList.remove(r_),this.selectedItem=null,this._selectionAccessoryController.hideAccessory(e),this._map.annotationSelectionDidChange(e),this._mapFeatureAnnotationController.annotationSelectionDidChange(e)}_didSelectAnnotation(e){e._impl.node.classList.add(r_),this.selectedItem=e,this._map.annotationSelectionDidChange(e),this._mapFeatureAnnotationController.annotationSelectionDidChange(e),e._impl.visible&&this._selectionAccessoryController.showAccessoryForAnnotation(e)}_shouldAnnotationBePending(){return!this._map.isRooted()}mapWasDestroyed(){super.mapWasDestroyed(),this._annotationDraggingMapPanningController&&this._annotationDraggingMapPanningController.mapWasDestroyed(),this._clustersController.mapWasDestroyed(),this._mapWasDestroyed=!0}_updateLabelRegionForAnnotation(e){const t=e._impl;if(!t.shouldHideLabels)return;t.labelRegion||(t.labelRegion=this._map.createLabelRegion());const i=t.labelRegion;if(i){const e=t.node.size,s=e.width,o=e.height;i.x=null==t.visibleX?t.x:t.visibleX,i.y=1-t.y,i.width=s,i.height=o,i.xOffset=s/2-t._anchorPoint.x-t._anchorOffset.x,i.yOffset=t._anchorPoint.y+t._anchorOffset.y-o/2,this._map.updatedLabelRegion()}}_removeLabelRegionForAnnotation(e){this._map.unregisterLabelRegion(e._impl.labelRegion),delete e._impl.labelRegion}_updateVisibleAnnotations(e,t){t||this._deletePreviousPointForPickingItem();const i=this._userLocationAnnotation,s=this._map;if(i){0;const e=d_.AccuracyRingOverlay.getMode(s.worldSize);i._impl.isRingMode=e,this._selectionAccessoryController.updateCenterMode()}const o=s.camera.toRenderingMapRect(),n=o.size.width,a=Math.min(1.5*n,.5),r=o.midX(),l=o.size.height,h=o.minY()-l,c=h+3*l;e.forEach((function(e){if(e===this._draggedAnnotation&&this._annotationDraggingMapPanningController.panning)return;let t=NaN;const i=e._impl.y;if(n>0&&l>0&&i>=h&&i<=c){const i=e._impl.x,o=e.anchorOffset.x/s.worldSize;let n=a;for(let e=-1;e<=1;++e){const s=Math.abs(i-o+e-r);s<n&&(n=s,t=i+e)}}isNaN(t)?e._impl.setShown(!1):(e._impl.isShown()||e!==this._selectedItem||this._selectionAccessoryController.showAccessoryForAnnotation(e,!0),e._impl.setShown(!0),e._impl.setPosition(s.adjustMapItemPoint(s.camera.transformMapPoint(new ts(t,i)))),e._impl.visibleX!==t&&(e._impl.visibleX=t,this._updateLabelRegionForAnnotation(e)))}),this),this._selectionAccessoryController.updateAccessoryPositionWithTailShift(this._selectedItem,!0),t||this._updateCollisions(e)}_updateCollisions(e){let t=!1;const i=this._items.filter((e=>{const i=e.visible&&e._impl.isShown(),s=i||e._impl.needsColliding;return delete e._impl.needsColliding,s&&(e.displayPriority<Bu.DisplayPriority.Required||e.clusteringIdentifier)&&(t=!0),s&&i&&!e.memberAnnotations}),this);if(t){const e=this._map;this._clustersController.collideAnnotations(i,e.zoomLevel,e.rotation,this._annotationsDidChangeSinceLastCollision)}this._annotationsDidChangeSinceLastCollision=!1}addCluster(e){let t="function"==typeof this._map.annotationForCluster?ue(this._map._annotationForCluster,this._map.public,[e],null):e;return t&&t instanceof Bu||(console.warn("[MapKit] Expects Map.annotationForCluster to return an annotation."),t=e),t=this._clustersController.setRequiredClusterAnnotationProperties(t,e),this.addItem(t),t._impl.customCluster=t!==e,t._impl.updateLayout(!0),this._updateLabelRegionForAnnotation(t),t}willUpdateCollisions(){this._items.forEach((e=>{e._impl.wasOccluded=e._impl.occluded,e._impl.previousCluster=e._impl.cluster}))}didUpdateCollisions(){this._items.forEach((function(e){const t=e._impl;t.wasCollided||t.occluded||(t.wasCollided=!0),e.memberAnnotations&&e.memberAnnotations[0]._impl.cluster!==e&&(t.cluster=t.memberAnnotations[0]._impl.cluster),t.updateVisibility(t.occluded),t.occluded!==t.wasOccluded&&t.animateOcclusion(),delete t.previousCluster,t.shouldHideLabels&&(t.occluded||t.labelRegion?t.occluded&&t.labelRegion&&this._removeLabelRegionForAnnotation(e):this._updateLabelRegionForAnnotation(e))}),this),this._items.forEach((e=>{delete e._impl.wasOccluded})),this._updateVisibleAnnotations(this._items,!0),this._updateSceneGraph()}deselectClusterAnnotation(){this._selectedItem&&this._selectedItem.memberAnnotations&&(this._selectedItem.selected=!1)}_updateAnnotation(e){e._impl.updatedPosition()&&this._updateVisibleAnnotations([e])}_updateSceneGraph(){const e=this._selectedItem,t=this._draggedAnnotation,i=this._items.filter((i=>i._impl.isDrawn()&&i!==e&&i!==t)).map((e=>e._impl.sceneGraphNode));e&&e._impl.isDrawn()&&i.push(e._impl.sceneGraphNode),t&&t._impl.isDrawn()&&i.push(t._impl.sceneGraphNode),this._sceneGraphNode.children=i}_checkCompletion(){if(this._mapWasDestroyed)return;if(this._annotationsDidChangeSinceLastCollision=!0,this._updateVisibleAnnotations(this._items),this._updateSceneGraph(),!this._completionCallback)return;this._items.some((e=>!e._impl.isStable()))||"function"!=typeof this._completionCallback||(this._completionCallback(),delete this._completionCallback)}}d_.Annotation=Bu;const u_=wt(((e,t,i)=>{i._geocoderRequestId&&e.cancel(i._geocoderRequestId);const s=e.reverseLookup(t._impl.coordinate,((e,o)=>{s===i._geocoderRequestId&&(delete i._geocoderRequestId,e?(console.error("[MapKit] Error getting address for user location: "+e.message),t.subtitle=null):o.results.length>0?i._lastUserLocationAnnotationSubtitle=t.subtitle=o.results[0].formattedAddress:t.subtitle=null)}));i._geocoderRequestId=s}),1e3),p_=["UserLocationAnnotation","AccuracyRingOverlay","Geocoder"];function m_(){let e=!0;for(let t=0;t<p_.length;t++){const i=p_[t];!d_[i]&&W.jsModules[i]?d_[i]=W.jsModules[i]:e=!1}e&&W.removeEventListener("load",m_)}W.addEventListener("load",m_),m_();const g_=d_,__=vi.MapPoint,f_="mk-map-features-container",y_="mk-map-features";const v_=class{constructor(e){this.map=e,window.document&&(this.node=new po.Node(Eo.htmlElement("div",{class:f_})),this._shadowRootNode=Eo.addShadowRootChild(this.node,Ue.shadowDOMMode,":host(.mk-map-features-container) .mk-map-features>div{position:absolute;top:0;left:0}",Ue.nonce),this._featuresContainer=this._shadowRootNode.addChild(new po.Node(Eo.htmlElement("div",{class:y_}))))}update(e,t){this._featuresContainer.children=[];for(let i=0;i<e.length;i++){const s=e[i];let o,n;const a=new __(s.position[0],s.position[1]);a.x<t.minX()&&(a.x+=1);const r=t.transformMapPoint(a);if(s.rects&&s.rects.length){let e=1/0,t=0,i=1/0,a=0;for(const o of s.rects){const s=r.x+o.offset[0],n=s+o.size[0],l=r.y+o.offset[1],h=l+o.size[1];e>s&&(e=s),t<n&&(t=n),i>l&&(i=l),a<h&&(a=h)}o=new es(t-e,a-i),n=new ts(e,i)}else if(s.circles&&s.circles.length){let e=1/0,t=0,i=1/0,a=0;const r=this.map.ensureRenderingFrame().size.height;for(const o of s.circles){const s=o.x-o.radius,n=o.x+o.radius,r=o.y-o.radius,l=o.y+o.radius;e>s&&(e=s),t<n&&(t=n),i>r&&(i=r),a<l&&(a=l)}o=new es(t-e,a-i),n=new ts(e,r-a)}if(!o)continue;const l=new po.Node(Eo.htmlElement("div",{"aria-label":s.title}));l.position=n,l.size=o,this._featuresContainer.addChild(l)}}};const b_=class extends qo{constructor(e){super(),this._annotation=e}get position(){return this._annotation.nodePosition()}};function w_(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class C_{constructor(e){w_(this,"glyphText",""),w_(this,"useSquareBalloon",!1),this._realAnnotation=e}get glyphColor(){const e=this._realAnnotation.map;return e?Bp.DefaultGlyphColor[e._impl.currentColorScheme]:Bp.DefaultGlyphColor.light}get isAppStyle(){return!1}get isPlaceStyle(){return!1}get balloonVisible(){return!0}get fillColor(){const e=this._realAnnotation.map;return e?Bp.DefaultColor[e._impl.currentColorScheme]:Bp.DefaultColor.light}get haloColor(){return null}}const k_=class extends Ls{constructor(e){super(),w_(this,"enablesDefaultGlyphImage",!0),w_(this,"frozen",!0),w_(this,"state","default"),w_(this,"params",Op.Params.default),this._realAnnotation=e,this.annotation=new C_(e),this._renderer=new Qu(this);const t=2*this.params.balloonRadius;this.size=new es(t,this.params.height+this.params.offset),this._renderer.isFallbackGlyphTextPending&&this._renderer.addPendingNode(this),this.needsDisplay=!0}get position(){return this._realAnnotation.nodePosition()}stringInfo(){return"ImageAnnotationFallbackNode"}freeze(){}};const M_=function(e){var t;class i extends e{constructor(t,i,s){super(t,i,e.div,s)}init(t,i,s){if(this._sceneGraphNode=new b_(this),super.init(t,i,e.div,s),!this.url)throw new Error("[MapKit] No URL for image of ImageAnnotation");this._waitingForImageSize=!this._userSetSize,this._setSceneGraphNode()}get url(){return this._url}set url(e){this._pendingGlyphImage=e,Pp(e,(t=>{if(this._pendingGlyphImage!==e)return;if(delete this._pendingGlyphImage,!t)throw new Error("[MapKit] No URL for image of ImageAnnotation");const i=t.ratio,s=t.glyphImageUrl;this._ratio=i,this._url=e,this._setSceneGraphNode(),this._removeImageEventListener();(this._sceneGraphNode.image=Eo.htmlElement("img",{src:s})).complete?this.updateSize():(this._userSetSize||(this._waitingForImageSize=!0),this._addImageEventListener())})),this._url=e}centerOffsetForSelectionAccessory(){return this._sceneGraphNode instanceof b_?super.centerOffsetForSelectionAccessory():new ts(-this._sceneGraphNode.params.balloonRadius,-this._sceneGraphNode.params.balloonRadius)}positionForCallout(){if(this._sceneGraphNode instanceof b_)return super.positionForCallout();const e=this._node.size,t=new ts(-e.width/2,0),i=this.nodePosition(),s=new ts(0,1);return new ts(i.x-t.x-s.x,i.y-t.y-s.y)}calculateNodePosition(){return this._sceneGraphNode instanceof b_?super.calculateNodePosition():new ts(this._position.x-this._anchorPoint.x,this._position.y-this._anchorPoint.y)}handleEvent(e){switch(e.type){case"load":0,this._removeImageEventListener(),this._handleImageLoaded();break;case"error":0,this._removeImageEventListener(),this._handleImageError();break;default:return void super.handleEvent(e)}}resetNodeTransform(){this.sceneGraphNode.transform=new ss}updateSize(){let e;if(this._waitingForImageSize=!1,this._sceneGraphNode instanceof b_){if(this._userSetSize)e=this._node.size;else{const t=this._sceneGraphNode.image;e=new es(t.naturalWidth/this._ratio,t.naturalHeight/this._ratio),this.setSize(e)}this._sceneGraphNode.size=e}else e=this._sceneGraphNode.size,this._userSetSize&&console.warn("[MapKit] Size set on the ImageAnnotation is removed."),this.setSize(e),this._userSetSize=!1;this._setElementSize(e),super.updateSize()}willMoveToMap(){this._isMoving=this.doesAnimate()}canShowCallout(){return!this._waitingForImageSize&&super.canShowCallout()}_addImageEventListener(){this._sceneGraphNode.image.addEventListener("load",this),this._sceneGraphNode.image.addEventListener("error",this)}_removeImageEventListener(){this._sceneGraphNode.image&&(this._sceneGraphNode.image.removeEventListener("load",this),this._sceneGraphNode.image.removeEventListener("error",this))}_handleImageLoaded(){this.updateSize()}_handleImageError(){this._sceneGraphNode.image&&console.error("[MapKit] Could not load image for ImageAnnotation at URL: "+this._sceneGraphNode.image.src),this._setSceneGraphNodeToFallback(),this.updatePosition(),this.updateSize()}_setElementSize(e){this._element.style.width=e.width+"px",this._element.style.height=e.height+"px"}_setSceneGraphNode(){if(this._sceneGraphNode instanceof b_)return;const e=this._sceneGraphNode;this._sceneGraphNode=new b_(this),e.parent&&e.parent.replaceChild(this._sceneGraphNode,e)}_setSceneGraphNodeToFallback(){if(this._sceneGraphNode instanceof k_)return;this._removeImageEventListener();const e=this._sceneGraphNode;this._sceneGraphNode=new k_(this),e.parent&&e.parent.replaceChild(this._sceneGraphNode,e)}}return(t=i).prototype.renderedByDOMElement=!1,t.prototype.ConstructorOptions=Object.freeze(Object.assign({},e.prototype.ConstructorOptions,{url:"rw"})),i},S_=M_(Fu);const L_=class extends Bu{constructor(e,t){super(),Object.defineProperty(this,"_impl",{value:new S_(this,e,t)}),this._impl.init(this,e,t)}get url(){return this._impl._url}set url(e){this._impl.url=e}},x_={AnnotationsController:g_,MapFeaturesLayerController:v_,LayerItemsController:Jc,ItemCollection:md,PlaceSelectionAccessory:Su,MapFeatureType:Cm,mapkit:{MapFeatureType:Cm,Annotation:Bu,PlaceAnnotation:um,PlaceSelectionAccessory:Su,ImageAnnotation:L_,MarkerAnnotation:Kp,MapFeatureAnnotation:Lm.prototype.constructor}},A_=ce,E_=Math.pow(2,21);function T_(e){const t=e.toMapPoint(),i=E_*Jt;return{x:Math.floor(t.x*i),y:Math.floor(t.y*i),z:21}}const I_={shift:function(e,t){const i=z(Ue.locationShiftUrl);!function(e,t,i){const s={getDataToSend:function(){return e},loaderDidSucceed:function(e,t){if(t.status<200||t.status>=300)i(new Error("HTTP error:"+t.status));else try{i(null,JSON.parse(z(t.responseText)))}catch(e){return void i(e instanceof SyntaxError?new Error("Failed to parse response: "+t.responseText):new Error)}},loaderDidFail:function(e,t){i(new Error("Network error"))}},o=new A_(t,s,{method:"POST",withCredentials:Ue.withCredentials});0;o.schedule()}(JSON.stringify({pixelPoint:T_(e)}),i,(function(e,i){e?t(new Error):i&&i.shiftedPixelPoint?t(null,function(e){function t(e){return e/E_/Jt}const i=new gi(t(e.x),t(e.y));return i.toCoordinate()}(i.shiftedPixelPoint)):t(new Error)}))}},O_=I_;const R_=Object.freeze({Change:"user-location-change",Error:"user-location-error"});let P_;let D_=null;const z_=new class extends I{constructor(){super(),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"Events",R_),this._location=null,this._coordinate=null,this._stale=!1,this._watchers=0,this.errorCode=0,Ue.addEventListener(Ue.Events.Changed,this),Ue.addEventListener(Ue.Events.Error,this)}get location(){return this._location}get coordinate(){return this._coordinate}get stale(){return this._stale}get mapAccuracyRadius(){const e=z(this.location);return!this.stale&&e.accuracy>0?e.accuracy:0}get isAvailable(){return window.navigator.geolocation&&"function"==typeof window.navigator.geolocation.watchPosition&&"function"==typeof window.navigator.geolocation.getCurrentPosition}getMapRect(){const e=this.location&&this.location.accuracy||0,t=z(this.coordinate).latitude,i=z(this.coordinate).toMapPoint(),s=e*vi.mapUnitsPerMeterAtLatitude(t);return new fi(i.x-s,i.y-s,2*s,2*s)}watch(){this._watchId||(window.navigator.geolocation.watchPosition?(F_(),this._watchId=window.navigator.geolocation.watchPosition(G_,W_),P_=setTimeout((()=>{F_(),W_({code:3,message:"Timeout expired"})}),15e3)):console.warn("[MapKit] User location is unavailable."))}locate(e,t,i){window.navigator.geolocation.getCurrentPosition?N_&&this._watchId?U_(N_,e,t):window.navigator.geolocation.getCurrentPosition((i=>U_(i,e,t)),t,i):console.warn("[MapKit] User location is unavailable.")}addEventListener(e,t,i){const s=super.addEventListener(e,t,i);return s&&++this._watchers,s}removeEventListener(e,t,i){const s=super.removeEventListener(e,t,i);return s?(--this._watchers,0===this._watchers&&this._watchId&&(window.navigator.geolocation.clearWatch(this._watchId),this._watchId=void 0),s):s}handleEvent(e){switch(e.type){case Ue.Events.Changed:case Ue.Events.Error:if(D_&&(N_=D_,D_=null),!N_)return;G_(N_)}}reset(){F_(),this._watchers=0,this._watchId=void 0,N_=null}};let N_=null;function F_(){clearTimeout(P_),P_=void 0}function U_(e,t,i){if("AutoNavi"===Ue.tileProvider){const s=new pi(e.coords.latitude,e.coords.longitude);O_.shift(s,((s,o)=>{if(s)return void(i&&i({message:"Position Unavailable",code:2,POSITION_UNAVAILABLE:2,PERMISSION_DENIED:1,TIMEOUT:3}));const n={coords:{accuracy:e.coords.accuracy,altitude:e.coords.altitude,altitudeAccuracy:e.coords.altitudeAccuracy,heading:e.coords.heading,floorLevel:e.coords.floorLevel,speed:e.coords.speed,latitude:z(o).latitude,longitude:z(o).longitude,toJSON(){return JSON.stringify(this)}},timestamp:e.timestamp,toJSON(){return JSON.stringify(this)}};t&&t(n)}))}else t&&t(e)}function G_(e){F_(),N_=e,Ue.error?W_({code:4,message:"MapKit not initialized."}):Ue.ready?!z_._stale&&z_._coordinate&&e.coords.latitude===z_._coordinate.latitude&&e.coords.longitude===z_._coordinate.longitude||U_(e,B_,W_):D_=e}function B_(e){z_._stale=!1,z_._location=e.coords,z_._coordinate=new pi(e.coords.latitude,e.coords.longitude),z_.errorCode=0,z_.dispatchEvent(new Z_(z_._coordinate,e.coords.floorLevel))}function W_(e){D_=null,N_=null,z_._stale=!0,z_.errorCode=e.code,z_.dispatchEvent(new K_(e))}class Z_ extends O{constructor(e,t){super(R_.Change),this.coordinate=e,this.floorLevel=t,this.timestamp=new Date}}class K_ extends O{constructor(e){super(R_.Error),this.code=e.code,this.message=e.message}}const j_=z_;const H_=class{constructor(e){this._delegate=e,this._showsUserLocation=!1,this._tracksUserLocation=!1}get showsUserLocation(){return this._showsUserLocation}set showsUserLocation(e){!e||j_.isAvailable?(this._showsUserLocation=e,e?(j_.addEventListener(j_.Events.Change,this),j_.addEventListener(j_.Events.Error,this),j_.watch()):(j_.removeEventListener(j_.Events.Change,this),j_.removeEventListener(j_.Events.Error,this))):console.warn("[MapKit] User location is unavailable.")}get tracksUserLocation(){return this._tracksUserLocation}set tracksUserLocation(e){!e||j_.isAvailable?(this._tracksUserLocation=e,e?(j_.addEventListener(j_.Events.Change,this),j_.addEventListener(j_.Events.Error,this),j_.watch()):(j_.removeEventListener(j_.Events.Change,this),j_.removeEventListener(j_.Events.Error,this))):console.warn("[MapKit] User location is unavailable.")}get userLocation(){return j_}handleEvent(e){switch(e.type){case j_.Events.Change:this._handleUserLocationChange(e);break;case j_.Events.Error:this._handleUserLocationError(e)}}mapWasDestroyed(){delete this._delegate,j_.removeEventListener(j_.Events.Change,this),j_.removeEventListener(j_.Events.Error,this)}_handleUserLocationChange(e){j_.errorCode=0,z(this._delegate).userLocationDidChange(e)}_handleUserLocationError(e){j_.errorCode=e.code,z(this._delegate).userLocationDidError(e)}},V_=[],q_=function e(){const t=V_.length;if(t>0){for(let e=0;e<t;++e)bt.scheduleASAP(V_[e]);bt.scheduleOnNextFrame(e)}},Y_={setIsAnimated:function(e,t){const i=V_.indexOf(e);t&&i<0&&(V_.push(e),1===V_.length&&bt.scheduleASAP(q_)),!t&&i>-1&&V_.splice(i,1)},getIsAnimated:function(e){return V_.indexOf(e)>-1}},X_=new Ld({lineWidth:2,strokeColor:"white"}),$_=function(e,t){const i=j_.location,s=void 0===t?56:t,o=(i&&i.accuracy||0)<=3e4;return j_.getMapRect().size.width*e>=s&&o},J_=Eo.lerp,Q_=function(e,t,i){return c((e-t)/(i-t),0,1)},ef=function(){const e=j_.location,t=e&&e.accuracy||0;return t>3e4?0:t};class tf extends Kd{constructor(e){super(e.coordinate,ef(),{style:X_}),Y_.setIsAnimated(this,!0),this._isRingMode=!1,this._isShown=!1,this._fadeClock=0}updateIsShown(e,t,i){const s=Date.now(),o=$_(t),n=o!==this._isRingMode?s:this._fadeClock,a=s-n<1e3,r=this._impl.shown&&(o||a);r!==this._isShown&&Y_.setIsAnimated(this,r),this._impl.shown=r,this._fadeClock=n,this._isRingMode=o,this._isShown=r,this._mapRegion=e,this._worldSize=t,this._colorSchemeOrSatellite=i}performScheduledUpdate(){const e=Date.now(),t=j_.stale,i=this._mapRegion&&this._mapRegion.toMapRect(),s=i?i.size.width*this._worldSize:0,o=j_.getMapRect().size.width*this._worldSize,n=Gs[xs.Light],a=Gs[xs.Dark],r=this._colorSchemeOrSatellite===xs.Light?t?n.gray:n.blue:t?a.gray:a.blue;this.style.fillColor="rgb("+r.join(",")+")",this.style.strokeColor=this._colorSchemeOrSatellite===xs.Dark?"rgba("+n.gray3.join(",")+", 0.5)":"white";const l=Q_(o,56,940),h=(t?.2:.14)*("satellite"===this._colorSchemeOrSatellite?2:1);this.style.fillOpacity=Math.pow(1-l,2)*h;const c=e-this._fadeClock,d=Q_(c,0,1e3),u=this._isRingMode?d:1-d;this._impl.node.opacity=u;const p=Q_(o,56,s),m=J_(p,2,2.5),g=J_(p,4,5),_=e%2e3/2e3,f=Eo.easeInOut(1-Math.abs(2*_-1));this.style.lineWidth=J_(f,m,g)}updateForUserLocation(e){this.coordinate=j_.coordinate,this.radius=ef()}}Object.defineProperties(tf,{getMode:{value:$_}});const sf=tf;const of=class extends Go{constructor(e){super(e),this.opacity=null,this.opacityTime=0}draw(e){const t=this._node._annotation.stale,i=this._node._annotation.style,s=Date.now(),o=s-this.opacityTime,n=Math.min(o,500)/500,a=Eo.lerp(n,1-this.opacity,this.opacity);if(a>0){const o=i.ANIMATION_HALF_DURATION_MS,n=s%i.ANIMATION_DURATION_MS,c=Eo.easeInOut(n<o?1-n/o:(n-o)/o),d=Eo.lerp(c,i.ANIMATION_SCALE_TO,i.ANIMATION_SCALE_FROM),u=e.globalAlpha,p=i.INNER_RADIUS*d,m=i.OUTER_RADIUS-p,g=p+m/2,_=i.TOTAL_RADIUS,f=i.TOTAL_RADIUS;e.save(),e.globalAlpha=a,e.beginPath(),e.arc(_,f,g,0,2*Math.PI),e.strokeStyle="rgb("+i.OUTER_FILL.join(",")+")",e.shadowColor="rgba("+i.SHADOW_COLOR.join(",")+")",e.shadowBlur=i.SHADOW_BLUR,e.lineWidth=m,e.stroke(),e.restore(),e.globalAlpha=a,e.beginPath(),e.arc(_,f,p,0,2*Math.PI),e.fillStyle=t?"rgb("+i.STALE_FILL.join(",")+")":(r=i.ANIMATION_FILL_FROM,l=i.ANIMATION_FILL_TO,h=c,"rgb("+r.map(((e,t)=>Math.round(e+(l[t]-e)*h))).join(", ")+")"),e.fill(),e.globalAlpha=u}var r,l,h}};const nf=class extends Ls{constructor(e){super(),this._annotation=e,this._renderer=new of(this)}stringInfo(){return"UserLocationAnnotationNode< "+(this._renderer.stale?"stale ":"live ")+(1!==this._renderer.opacity?`opacity: ${this._renderer.opacity} `:"")+">"}get size(){return this._annotation.node.size}get position(){return this._annotation.nodePosition()}};class af extends Fu{constructor(e,t){super(e,t.coordinate,Fu.div),function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(this,"_collisionMode",Fu.CollisionMode.None)}init(e,t){const i=Gs.default,s={INNER_RADIUS:8,OUTER_RADIUS:11,SHADOW_BLUR:10,TOTAL_RADIUS:0,OUTER_FILL:[255,255,255],STALE_FILL:i.gray2,SHADOW_COLOR:[0,0,0,.25],ANIMATION_DURATION_MS:3e3,ANIMATION_HALF_DURATION_MS:0,ANIMATION_SCALE_FROM:1,ANIMATION_SCALE_TO:.81,ANIMATION_FILL_FROM:i.blue,ANIMATION_FILL_TO:i.blue};s.TOTAL_RADIUS=s.OUTER_RADIUS+s.SHADOW_BLUR,s.ANIMATION_HALF_DURATION_MS=s.ANIMATION_DURATION_MS/2;const o=s.TOTAL_RADIUS,n=s.SHADOW_BLUR,a=window.DOMPoint;super.init(e,t.coordinate,Fu.div),this.style=s,this.stale=!1,this._animationScheduler=Y_,this._anchorOffset=new a(0,-o),this._calloutAnchorPoint=new a(-o,-n),this._updateTitleAndSubtitleForLocale();const r=2*o;this.setSize(new es(r,r)),this._userSetSize=!0,this._sceneGraphNode=new nf(this),this.shownPropertyWasUpdated(!0)}get coordinate(){return this._coordinate}set coordinate(e){this._coordinate?console.warn("[MapKit] The `coordinate` property of the user location annotation cannot be set."):this._coordinate=e.copy()}get draggable(){return!1}set draggable(e){console.warn("[MapKit] The `draggable` property of the user location annotation cannot be set.")}get size(){return this._node.size.copy()}set size(e){console.warn("[MapKit] The `size` property of the user location annotation cannot be set.")}get node(){return this._node}handleEvent(e){e.type===Vi.Events.LocaleChanged&&this._updateTitleAndSubtitleForLocale()}set isRingMode(e){this.enabled=!e;const t=this._sceneGraphNode._renderer,i=e?0:1;i!==t.opacity&&(t.opacity=i,t.opacityTime=Date.now())}shownPropertyWasUpdated(e){Y_.setIsAnimated(this,e)}removedFromMap(){Y_.setIsAnimated(this,!1),Vi.removeEventListener(Vi.Events.LocaleChanged,this)}setCoordinate(e){Object.getOwnPropertyDescriptor(Fu.prototype,"coordinate").set.call(this,e)}performScheduledUpdate(){const e=this.map&&this.map._impl.tint,t=this.map&&this.map.mapType,i=Gs.default,s=Gs[xs.Light],o=Gs[xs.Dark],n=Gs[e]||i,a=t===Is.Satellite||t===Is.Hybrid?"satellite":e;this.style.OUTER_FILL=a===xs.Dark?s.gray3:[255,255,255],this.style.STALE_FILL=a===xs.Light?s.gray:o.gray2,this.style.ANIMATION_FILL_FROM=n.blue,this.style.ANIMATION_FILL_TO=n.blue,this.style.SHADOW_COLOR=[0,0,0,a===xs.Light?.25:.3],this._sceneGraphNode.needsDisplay=!0}_updateTitleAndSubtitleForLocale(){this.title=Vi.get("Location.Title"),this.subtitle=Vi.get("Location.Subtitle")}}af.prototype.renderedByDOMElement=!1;const rf=af;class lf extends Bu{constructor(e){super(),Object.defineProperty(this,"_impl",{value:new rf(this,e)}),this._impl.init(this,e)}set coordinate(e){this._impl.coordinate=e}get coordinate(){return this._impl.coordinate}get draggable(){return this._impl.draggable}set draggable(e){this._impl.draggable=e}get size(){return this._impl.size}set size(e){this._impl.size=e}}function hf(){throw new TypeError("[MapKit] UserLocationAnnotation may not be constructed.")}lf.prototype.constructor=hf,hf.prototype=lf.prototype;const cf=lf;const df=class{constructor(e,t){this._impl=new fm(e,t)}get getsUserLocation(){return this._impl.getsUserLocation}set getsUserLocation(e){this._impl.getsUserLocation=e}get language(){return this._impl.language}set language(e){this._impl.language=e}cancel(e){return this._impl.cancel(e)}},uf=vi.Coordinate,pf=["language","getsUserLocation"],mf=["language","region","coordinate","limitToCountries"],gf=["language"];const _f=class extends fm{constructor(e){super("Geocoder",e=_(e)),this._checkOptions(e,pf)}lookup(e,t,i){const s={};i=_(i),this._checkOptions(i,mf),u(e,"[MapKit] Missing `address` in call to `Geocoder.lookup()`."),p(e,"string","[MapKit] `address` passed to `Geocoder.lookup()` is not a string."),u(t,"[MapKit] Missing `callback` in call to `Geocoder.lookup()`."),p(t,"function","[MapKit] `callback` passed to `Geocoder.lookup()` is not a function."),s.q=e;const o=i.region,n=i.coordinate,a=i.limitToCountries;let r=this.language||Ue.language;if(o){const e=o.toBoundingRegion();s.searchRegion=[e.northLatitude,e.eastLongitude,e.southLatitude,e.westLongitude].join(",")}else n&&(s.searchLocation=[n.latitude,n.longitude].join(","));return i.language&&(r=this._bestLanguage(i.language)),r&&(s.lang=r),a&&(p(a,"string","[MapKit] `limitToCountries` is not a string."),s.limitToCountries=a),this._sendImmediatelyOrWithUserLocation("geocode",s,t,this._transform,"geocode")}reverseLookup(e,t,i){const s={};let o=this.language||Ue.language;return i=_(i),this._checkOptions(i,gf),u(e,"[MapKit] Missing `coordinate` in call to `Geocoder.reverseLookup()`."),m(e,uf,"[MapKit] `coordinate` passed to `Geocoder.reverseLookup()` is not a Coordinate."),u(t,"[MapKit] Missing `callback` in call to `Geocoder.reverseLookup()`."),p(t,"function","[MapKit] `callback` passed to `Geocoder.reverseLookup()` is not a function."),s.loc=e.latitude+","+e.longitude,i.language&&(o=this._bestLanguage(i.language)),o&&(s.lang=o),this._send("reverseGeocode",s,t,this._transform,"reverseGeocode")}_transform(e,t){const i={status:t.status,results:[]};return t.results&&(i.results=t.results.map((e=>new Si(e)))),i}};const ff=class extends df{constructor(e){super(),Object.defineProperty(this,"_impl",{value:new _f(e)})}lookup(e,t,i){return this._impl.lookup(e,t,i)}reverseLookup(e,t,i){return this._impl.reverseLookup(e,t,i)}},yf={mapkit:{}};[Wc,ru,x_,{AnnotationsController:g_,MapFeaturesLayerController:v_,OverlaysController:dd,UserLocationController:H_,LayerItemsController:Jc,ItemCollection:md,AccuracyRingOverlay:sf,UserLocationAnnotation:cf,Geocoder:ff,userLocation:j_,mapkit:{}}].forEach((e=>{Object.keys(e).forEach((t=>{"mapkit"!==t?Object.defineProperty(yf,t,Object.getOwnPropertyDescriptor(e,t)):Object.keys(e.mapkit).forEach((t=>{Object.defineProperty(yf.mapkit,t,Object.getOwnPropertyDescriptor(e.mapkit,t))}))}))}));const vf=yf,bf=Object.freeze({Country:"Country",AdministrativeArea:"AdministrativeArea",SubAdministrativeArea:"SubAdministrativeArea",Locality:"Locality",SubLocality:"SubLocality",PostalCode:"PostalCode"});function wf(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function Cf(e){return e.map((e=>{if(!d(e,bf))throw new Error("[MapKit] Unknown category `"+e+"`. Choose from mapkit.AddressCategory.");return e}))}class kf{constructor(e){if(wf(this,"_includes",null),wf(this,"_excludes",null),void 0!==(e=_(e)).includes&&void 0!==e.excludes)throw new Error("[MapKit] `includes` and `excludes` may not be specified at the same time.");if(void 0===e.includes&&void 0===e.excludes)throw new Error("[MapKit] Either `includes` or `excludes` should be specified.");void 0!==e.includes&&(this._includes=Cf(e.includes)),void 0!==e.excludes&&(this._excludes=Cf(e.excludes))}includesCategory(e){if(!d(e,bf))throw new Error("[MapKit] Unknown category `"+e+"`. Choose from mapkit.AddressCategory.");return this._includes?-1!==this._includes.indexOf(e):this._excludes?-1===this._excludes.indexOf(e):void 0}excludesCategory(e){if(!d(e,bf))throw new Error("[MapKit] Unknown category `"+e+"`. Choose from mapkit.AddressCategory.");return this._includes?-1===this._includes.indexOf(e):this._excludes?-1!==this._excludes.indexOf(e):void 0}static including(e){return g(e,"[MapKit] AddressFilter.including expected an array of categories."),new kf({includes:e})}static excluding(e){return g(e,"[MapKit] AddressFilter.excluding expected an array of categories."),new kf({excludes:e})}}const Mf=function(){throw new Error("[MapKit] `AddressFilter` may not be constructed directly. Use the mapkit.AddressFilter.including or the mapkit.AddressFilter.excluding methods.")};kf.prototype.constructor=Mf,Mf.prototype=kf.prototype,kf.exposedConstructor=Mf,Object.defineProperties(kf,{filterIncludingAllCategories:{get:function(){const e=this.excluding([]);return Object.defineProperty(this,"filterIncludingAllCategories",{value:e,configurable:!0}),e},configurable:!0},filterExcludingAllCategories:{get:function(){const e=this.including([]);return Object.defineProperty(this,"filterExcludingAllCategories",{value:e,configurable:!0}),e},configurable:!0}}),Object.defineProperties(Mf,{including:{get:function(){return kf.including},configurable:!0},excluding:{get:function(){return kf.excluding},configurable:!0},includingAllCategories:{get:function(){return kf.filterIncludingAllCategories},configurable:!0},excludingAllCategories:{get:function(){return kf.filterExcludingAllCategories},configurable:!0}});const Sf=kf,Lf=Object.freeze({Default:"Default",Required:"Required"});function xf(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Af=vi.BoundingRegion,Ef=vi.CoordinateRegion,Tf=vi.Coordinate,If=["language","getsUserLocation","coordinate","region","includeAddresses","includePointsOfInterest","includePhysicalFeatures","includeQueries","pointOfInterestFilter","addressFilter","limitToCountries","regionPriority"],Of=["language","region","coordinate","includeAddresses","includePointsOfInterest","includePhysicalFeatures","pointOfInterestFilter","addressFilter","limitToCountries","regionPriority"],Rf=Of.concat(["includeQueries"]);class Pf extends fm{constructor(e){super("Search",e=_(e)),xf(this,"_coordinate",null),xf(this,"_region",null),xf(this,"_includeAddresses",!0),xf(this,"_includePointsOfInterest",!0),xf(this,"_includePhysicalFeatures",void 0),xf(this,"_includeQueries",!0),xf(this,"_pointOfInterestFilter",null),xf(this,"_addressFilter",null),xf(this,"_limitToCountries",null),xf(this,"_regionPriority",Lf.Default),this._checkOptions(e,If),this.coordinate=e.coordinate,this.region=e.region,void 0!==e.includeAddresses&&(this.includeAddresses=e.includeAddresses),void 0!==e.includePointsOfInterest&&(this.includePointsOfInterest=e.includePointsOfInterest),void 0!==e.includePhysicalFeatures&&(this.includePhysicalFeatures=e.includePhysicalFeatures),void 0!==e.includeQueries&&(this.includeQueries=e.includeQueries),void 0!==e.pointOfInterestFilter&&(this.pointOfInterestFilter=e.pointOfInterestFilter),void 0!==e.addressFilter&&(this.addressFilter=e.addressFilter),void 0!==e.limitToCountries&&(this.limitToCountries=e.limitToCountries),void 0!==e.regionPriority&&(this.regionPriority=e.regionPriority)}get coordinate(){return this._coordinate}set coordinate(e){null!=e&&(m(e,Tf,"[MapKit] Search.coordinate expected a Coordinate value."),e=e.copy()),this._coordinate=e||null}get region(){return this._region}set region(e){null!=e&&(m(e,Ef,"[MapKit] Search.region expected a CoordinateRegion value."),e=e.copy()),this._region=e||null}get includeAddresses(){return this._includeAddresses}set includeAddresses(e){this._includeAddresses=!!e}get includePointsOfInterest(){return this._includePointsOfInterest}set includePointsOfInterest(e){this._includePointsOfInterest=!!e}get includePhysicalFeatures(){return void 0===this._includePhysicalFeatures?this._includePointsOfInterest:this._includePhysicalFeatures}set includePhysicalFeatures(e){this._includePhysicalFeatures=!!e}get includeQueries(){return this._includeQueries}set includeQueries(e){this._includeQueries=!!e}get pointOfInterestFilter(){return this._pointOfInterestFilter}set pointOfInterestFilter(e){e&&m(e,Ve,"[MapKit] Unknown value for `pointOfInterestFilter`. It must be an instance of mapkit.PointOfInterestFilter."),this._pointOfInterestFilter=e||null}get addressFilter(){return this._addressFilter}set addressFilter(e){e&&m(e,Sf,"[MapKit] Unknown value for `addressFilter`. It must be an instance of mapkit.AddressFilter."),this._addressFilter=e||null}get limitToCountries(){return this._limitToCountries}set limitToCountries(e){e&&p(e,"string","[MapKit] `limitToCountries` is not a string."),this._limitToCountries=e||null}get regionPriority(){return this._regionPriority}set regionPriority(e){if(e&&!d(e,Lf))throw new Error("[MapKit] Unknown value for `Search.regionPriority`. Choose from Search.RegionPriority.");this._regionPriority=e}search(e,t,i){return i=_(i),this._checkOptions(i,Of),this._request("search","search",this._searchTransform,e,t,i)}autocomplete(e,t,i){return i=_(i),this._checkOptions(i,Rf),this._request("autocomplete","searchAutocomplete",this._autocompleteTransform,e,t,i)}_request(e,t,i,s,o,n){if("object"==typeof o){const t=o;o=function(i,s){const o="search"===e?t.searchDidError:t.autocompleteDidError,n="search"===e?t.searchDidComplete:t.autocompleteDidComplete;i?"function"==typeof o&&o.call(t,i):"function"==typeof n&&n.call(t,s)}}const a={},r="Search."+e+"()";if(u(s,"[MapKit] Missing `query` in call to `"+r+"`."),u(o,"[MapKit] Missing `callback` in call to `"+r+"`."),p(o,"function","[MapKit] `callback` passed to `"+r+"` is not a function."),s instanceof vu)t=s._completionUrl;else{if("string"!=typeof s)throw new TypeError("[MapKit] `query` passed to `"+r+"` is neither a string nor SearchAutocompleteResult.");a.q=s}const l=n.region||this.region,h=n.coordinate||this.coordinate;let c=this.language||Ue.language;if(l){const e=l.toBoundingRegion();a.searchRegion=[e.northLatitude,e.eastLongitude,e.southLatitude,e.westLongitude].join(",")}else h&&(a.searchLocation=[h.latitude,h.longitude].join(","));if(n.language&&(c=this._bestLanguage(n.language)),c&&(a.lang=c),n.pointOfInterestFilter&&m(n.pointOfInterestFilter,Ve,"[MapKit] Unknown value for `pointOfInterestFilter`. It must be an instance of mapkit.PointOfInterestFilter."),n.addressFilter&&m(n.addressFilter,Sf,"[MapKit] Unknown value for `addressFilter`. It must be an instance of mapkit.AddressFilter."),n.limitToCountries&&p(n.limitToCountries,"string","[MapKit] `limitToCountries` is not a string."),(n.limitToCountries||this.limitToCountries)&&(a.limitToCountries=n.limitToCountries||this.limitToCountries),n.regionPriority&&!d(n.regionPriority,Lf))throw new Error("[MapKit] Unknown value for `regionPriority`. Choose from Search.RegionPriority.");a.searchRegionPriority=n.regionPriority||this.regionPriority;const g=n.pointOfInterestFilter||this.pointOfInterestFilter;let _=!0;g&&(n.includePointsOfInterest||this.includePointsOfInterest||console.warn("[MapKit] `includePointsOfInterest` is false but `pointOfInterestFilter` is set."),g._includes&&(0===g._includes.length?_=!1:a.includePoiCategories=g._includes.join(",")),g._excludes&&(a.excludePoiCategories=g._excludes.join(",")));const f=n.addressFilter||this.addressFilter;let y=!0;f&&(n.includeAddresses||this.includeAddresses||console.warn("[MapKit] `includeAddresses` is false but `addressFilter` is set."),f._includes&&(0===f._includes.length?y=!1:a.includeAddressCategories=f._includes.join(",")),f._excludes&&(a.excludeAddressCategories=f._excludes.join(",")));const v=[],b=Pf.ResultTypeFilterValueMap;if(f?y&&v.push(b.address):void 0!==n.includeAddresses?n.includeAddresses&&v.push(b.address):this.includeAddresses&&v.push(b.address),g?_&&v.push(b.poi):void 0!==n.includePointsOfInterest?n.includePointsOfInterest&&v.push(b.poi):this.includePointsOfInterest&&v.push(b.poi),void 0!==n.includePhysicalFeatures)n.includePhysicalFeatures&&v.push(b.physicalFeature);else switch(this._includePhysicalFeatures){case!0:v.push(b.physicalFeature);break;case!1:break;case void 0:g?_&&v.push(b.physicalFeature):void 0!==n.includePointsOfInterest?n.includePointsOfInterest&&v.push(b.physicalFeature):this.includePointsOfInterest&&v.push(b.physicalFeature)}if("searchAutocomplete"===t&&(void 0!==n.includeQueries?n.includeQueries&&v.push(b.query):this.includeQueries&&v.push(b.query)),0===v.length)throw new Error("[MapKit] At least one of the types needs to be included in the search/autocomplete request.");return a.resultTypeFilter=v.join(","),this._sendImmediatelyOrWithUserLocation(t,a,o,i,e)}_searchTransform(e,t){const i={places:[]};if(e.q&&(i.query=e.q),t.displayMapRegion){0;const e=new Af(t.displayMapRegion.northLat,t.displayMapRegion.eastLng,t.displayMapRegion.southLat,t.displayMapRegion.westLng);i.boundingRegion=e.toCoordinateRegion()}return t.results&&(i.places=t.results.map((e=>new Si(e)))),i}_autocompleteTransform(e,t){const i={query:e.q,results:[]};return t.results&&(i.results=t.results.map((e=>new vu(e)))),i}}xf(Pf,"ResultTypeFilterValueMap",Object.freeze({address:"Address",poi:"PointOfInterest",physicalFeature:"PhysicalFeature",query:"Query"}));const Df=Pf;class zf extends df{constructor(e){super(),Object.defineProperty(this,"_impl",{value:new Df(e)})}get coordinate(){return this._impl.coordinate}set coordinate(e){this._impl.coordinate=e}get region(){return this._impl.region}set region(e){this._impl.region=e}get regionPriority(){return this._impl.regionPriority}set regionPriority(e){this._impl.regionPriority=e}get includeAddresses(){return this._impl.includeAddresses}set includeAddresses(e){this._impl.includeAddresses=e}get includePointsOfInterest(){return this._impl.includePointsOfInterest}set includePointsOfInterest(e){this._impl.includePointsOfInterest=e}get includePhysicalFeatures(){return this._impl.includePhysicalFeatures}set includePhysicalFeatures(e){this._impl.includePhysicalFeatures=e}get includeQueries(){return this._impl.includeQueries}set includeQueries(e){this._impl.includeQueries=e}get addressFilter(){return this._impl.addressFilter}set addressFilter(e){this._impl.addressFilter=e}get pointOfInterestFilter(){return this._impl.pointOfInterestFilter}set pointOfInterestFilter(e){this._impl.pointOfInterestFilter=e}get limitToCountries(){return this._impl.limitToCountries}set limitToCountries(e){this._impl.limitToCountries=e}search(e,t,i){return this._impl.search(e,t,i)}autocomplete(e,t,i){return this._impl.autocomplete(e,t,i)}}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(zf,"RegionPriority",Lf);const Nf=zf,Ff=["language"],Uf=["language"];const Gf=class extends fm{constructor(e){super("PlaceLookup",e=_(e)),this._checkOptions(e,Ff)}getPlace(e,t,i){if(i=_(i),this._checkOptions(i,Uf),"string"!=typeof e)throw new Error("[MapKit] `id` argument is not a string.");const s=i.language?this._bestLanguage(i.language):this.language||Ue.language,o=s?{lang:s}:{};return this._send("place/"+e,o,t,this._transform,"placeLookup")}_transform(e,t){return new Si(t)}};const Bf=class extends df{constructor(e){super(),Object.defineProperty(this,"_impl",{value:new Gf(e)})}getPlace(e,t,i){return this._impl.getPlace(e,t,i)}};const Wf=["language"],Zf=["origin","destination","transportType","requestsAlternateRoutes","arrivalDate","departureDate","avoidTolls"],Kf=["origin","destinations","transportType","departureDate"];class jf extends fm{constructor(e){super("Directions",e=_(e)),this._checkOptions(e,Wf)}eta(e,t){if(u(e,"[MapKit] Missing `request` in call to `Directions.eta()`."),_(e,"[MapKit] `request` is not a valid object."),u(t,"[MapKit] Missing `callback` in call to `Directions.eta()`."),p(t,"function","[MapKit] `callback` passed to `Directions.eta()` is not a function."),this._checkOptions(e,Kf),u(e.origin,"[MapKit] Missing required property `origin` in `request` object."),u(e.destinations,"[MapKit] Missing required property `destinations` in `request` object."),!Array.isArray(e.destinations))throw new Error("[MapKit] Required property `destinations` in `request` object must be an array.");if(e.destinations.length>10)throw new Error("[MapKit] `destinations` array must be less than 10 destinations.");if(m(e.origin,pi,"[MapKit] `origin` property in `request` is not a Coordinate."),e.destinations.forEach((e=>{m(e,pi,"[MapKit] One of the values in `destinations` property in `request` is not a Coordinate.")})),"CN"===Ue.countryCode)return void setTimeout((()=>{const e=new Error("[MapKit] ETA Requests are not supported in China yet.");ue(t,null,[e])}));const i={origin:e.origin.latitude+","+e.origin.longitude,destinations:e.destinations.map((e=>e.latitude+","+e.longitude)).join("|")},s=e.transportType;if(s){for(const e in jf.Transport)s===jf.Transport[e]&&(i.transportType=jf.Transport[e]);if(!i.transportType)throw new TypeError("[MapKit] transportType must be a value of `Directions.Transport`.")}const o=e.departureDate;o&&(Hf(o,"departureDate"),i.departureDate=o.toISOString());const n=this.language||Ue.language;return n&&(i.lang=n),this._send("etas",i,t,((t,i)=>this._handleEtaResponse(e,t,i)),"etas")}route(e,t){u(e,"[MapKit] Missing `request` in call to `Directions.route()`."),_(e,"[MapKit] `request` is not a valid object."),u(t,"[MapKit] Missing `callback` in call to `Directions.route()`."),p(t,"function","[MapKit] `callback` passed to `Directions.route()` is not a function."),this._checkOptions(e,Zf);const i={},s=e.origin,o=e.destination,n=e.transportType,a=e.arrivalDate,r=e.departureDate,l=e.avoidTolls,h=n===jf.Transport.Automobile,c=n===jf.Transport.Walking;if(u(s,"[MapKit] Missing required property `origin` in `request` object."),u(o,"[MapKit] Missing required property `destination` in `request` object."),i.wps=JSON.stringify([Vf(s),Vf(o)]),n){if(!h&&!c)throw new TypeError("[MapKit] transportType must be either Directions.Transport.Automobile or Directions.Transport.Walking.");i.transport=n}a&&r?console.warn("[MapKit] `Directions.route()` should not be sent an `arrivalDate` and `departureDate` in the same request. These parameters have been dropped from the request."):"CN"===Ue.countryCode&&(a||r)?console.warn("[MapKit] `arrivalDate` and `departureDate` are not supported in China yet. These parameters have been dropped from the request."):a?(Hf(a,"arrivalDate"),i.arrivalDate=a.toISOString()):r&&(Hf(r,"departureDate"),i.departureDate=r.toISOString()),void 0!==e.requestsAlternateRoutes?i.n=e.requestsAlternateRoutes?"3":"1":i.n="1";const d=this.language||Ue.language;return d&&(i.lang=d),l&&c?console.warn("[MapKit] When `transportType` is `Directions.Transport.Walking`, the `avoidTolls` parameter has no effect. The `avoidTolls` parameter has been dropped from the request."):l&&"CN"===Ue.countryCode?console.warn("[MapKit] `avoidTolls` is not supported in China yet. This parameter has been dropped from the request."):l&&(i.avoid="tolls"),this._send("directions",i,t,((t,i)=>this._handleResponse(e,t,i)),"directions")}_handleEtaResponse(e,t,i){return{request:t,origin:e.origin.copy(),etas:i.etas.map(((t,i)=>({destination:e.destinations[i]?e.destinations[i].copy():void 0,transportType:t.transportType,distance:t.distanceMeters,expectedTravelTime:t.expectedTravelTimeSeconds,staticTravelTime:t.staticTravelTimeSeconds})))}}_handleResponse(e,t,i){const s=i.stepPaths.map((e=>e.map((e=>new pi(e.lat,e.lng))))),o=i.steps.map((e=>new Qf(e,s,i.shieldDomains))),n=i.routes.map((e=>new Yf(e,o,s)));return{request:t,origin:qf(e.origin,i.origin),destination:qf(e.destination,i.destination),routes:n}}}function Hf(e,t){if(!(e instanceof Date)||isNaN(e.getTime()))throw new TypeError("[MapKit] Expected a `Date` object for `"+t+"`, but got `"+e+"` instead.")}function Vf(e){if("string"==typeof e)return{q:e};if("object"==typeof e&&e.muid)return{muid:e.muid};const t=e.coordinate||e;if(t instanceof pi)return{loc:{lat:t.latitude,lng:t.longitude}};throw new Error("[MapKit] Location must be an address (string), Coordinate object or Place object.")}function qf(e,t){return t?new Si(t):e instanceof Si?e:e instanceof pi?e.copy():void 0}!function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(jf,"Transport",{Automobile:"AUTOMOBILE",Walking:"WALKING"});class Yf{constructor(e,t,i){this.name=e.name,this.distance=e.distanceMeters,this.expectedTravelTime=e.durationSeconds,this.transportType=e.transportType;const s=e.avoidTolls;this.hasTolls="boolean"==typeof s?!s:void 0,this._path=e.stepIndexes.map((e=>i[e])),this.steps=e.stepIndexes.map((e=>t[e]))}get path(){return console.warn("[MapKit] The `Route.path` property is deprecated and will be removed in a future release."),this._path}get polyline(){throw new Error("[MapKit] Route.polyline is available after loading the following library: overlays.")}}const Xf=function(){throw new TypeError("[MapKit] Route may not be constructed.")};function $f(e){delete Yf.prototype.polyline,Object.defineProperty(Yf.prototype,"polyline",{enumerable:!0,configurable:!0,get:function(){return this._polyline||(this._polyline=new e(this._path.reduce(((e,t)=>e.concat(t)),[]))),this._polyline}})}Yf.prototype.constructor=Xf,Xf.prototype=Yf.prototype,W.jsModules.mapkit.PolylineOverlay?$f(W.jsModules.mapkit.PolylineOverlay):W.addEventListener("load",(function e(t){t.jsModules.mapkit&&t.jsModules.mapkit.PolylineOverlay&&(W.removeEventListener("load",e),$f(W.jsModules.mapkit.PolylineOverlay))})),jf.Route=Yf;const Jf=["ON_RAMP","OFF_RAMP","HIGHWAY_OFF_RAMP_LEFT","HIGHWAY_OFF_RAMP_RIGHT","CHANGE_HIGHWAY","CHANGE_HIGHWAY_LEFT","CHANGE_HIGHWAY_RIGHT"];class Qf{constructor(e,t,i){if(this.instructions=e.instructions,this.pathIndex=e.stepPathIndex,this.distance=e.distanceMeters,this.transportType=e.transportType,this.path=t[e.stepPathIndex],!i||!i.length||!e.maneuver)return;const s=i[e.stepPathIndex%i.length],o=e.maneuver;let n,a;if(o.names&&o.names.length){const e=o.names.filter((e=>e.type&&e.shieldUrl));e.length&&(n="//"+s+e[0].shieldUrl)}o.arrowUrl&&(a="//"+s+o.arrowUrl);const r=n&&-1!==Jf.indexOf(o.type);this._imageUrl=r?n:a}}Qf.prototype.constructor=Xf,Qf.prototype;const ey=jf;class ty extends df{constructor(e){super(),Object.defineProperty(this,"_impl",{value:new ey(e)})}eta(e,t){return this._impl.eta(e,t)}route(e,t){return this._impl.route(e,t)}}ty.Transport=ey.Transport;const iy=ty;function sy(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const oy=vi.CoordinateRegion,ny=vi.Coordinate,ay=["language","getsUserLocation","center","radius","region","pointOfInterestFilter"];const ry=class extends fm{constructor(e){super("PointsOfInterestsSearch",e=_(e)),sy(this,"_center",null),sy(this,"_radius",null),sy(this,"_region",null),sy(this,"_pointOfInterestFilter",null),this._checkOptions(e,ay),void 0!==e.center&&(this.center=e.center),void 0!==e.radius&&(this.radius=e.radius),void 0!==e.region&&(this.region=e.region),e.pointOfInterestFilter&&(this.pointOfInterestFilter=e.pointOfInterestFilter)}get center(){return this._center}set center(e){null!=e&&(m(e,ny,"[MapKit] PointsOfInterestSearch.center expected a Coordinate value."),e=e.copy()),this._center=e||null}get radius(){return this._radius}set radius(e){null!=e&&p(e,"number","[MapKit] PointsOfInterestSearch.radius expected a number value."),this._radius=e||null}get region(){return this._region}set region(e){null!=e&&(m(e,oy,"[MapKit] PointsOfInterestSearch.region expected a CoordinateRegion value."),e=e.copy()),this._region=e||null}get getsUserLocation(){return!1}set getsUserLocation(e){throw new TypeError("[MapKit] getsUserLocation on PointsOfInterestSearch has not effect.")}get pointOfInterestFilter(){return this._pointOfInterestFilter}set pointOfInterestFilter(e){e&&m(e,Ve,"[MapKit] Unknown value for `pointOfInterestFilter`. It must be an instance of mapkit.PointOfInterestFilter."),this._pointOfInterestFilter=e||null}search(e,t){if(t=_(t),this._checkOptions(t,ay),"object"==typeof e){const t=e;e=function(e,i){const s=t.searchDidError,o=t.searchDidComplete;e?"function"==typeof s&&s.call(t,e):"function"==typeof o&&o.call(t,i)}}if("CN"===Ue.countryCode)return void setTimeout((()=>{const t=new Error("[MapKit] PointsOfInterestSearch is not supported in China yet.");ue(e,null,[t])}));const i={};t.pointOfInterestFilter&&m(t.pointOfInterestFilter,Ve,"[MapKit] Unknown value for `pointOfInterestFilter`. It must be an instance of mapkit.PointOfInterestFilter."),u(e,"[MapKit] Missing `callback` in call to `search`."),p(e,"function","[MapKit] `callback` passed to `search` is not a function.");const s=t.center||this.center,o=t.radius||this.radius,n=t.region||this.region;if((s||o)&&n)return void setTimeout((()=>{const t=new Error("[MapKit] Setting both `center`/`radius` and region are not allowed. Expects either a circular region defined by `center`/`radius` or a rectangular region defined by `region`.");ue(e,null,[t])}));if(!s&&!o&&!n)return void setTimeout((()=>{const t=new Error("[MapKit] No search region specified. Expects either a circular region defined by `center`/`radius` or a rectangular region defined by `region`.");ue(e,null,[t])}));if(s||o)m(s,ny,"[MapKit] `center` should be a Coordinate when specify a circular search region."),i.center=[s.latitude,s.longitude].join(","),o&&(i.radius=o.toString(10));else if(n){m(n,oy,"[MapKit] `region` should be a CoordinateRegion when specify a rectangular search region.");const e=n.toBoundingRegion();i.mapRegion=[e.northLatitude,e.eastLongitude,e.southLatitude,e.westLongitude].join(",")}else 0;if(void 0!==t.getsUserLocation)throw Error("[MapKit] getsUserLocation on PointsOfInterestSearch has not effect.");let a=this.language||Ue.language;t.language&&(a=this._bestLanguage(t.language)),a&&(i.lang=a);const r=t.pointOfInterestFilter||this.pointOfInterestFilter;if(r){if(r._includes){if(0===r._includes.length)return void setTimeout((()=>ue(e,null,[null,this._nearbyPoiTransform(void 0,{})])));i.includePoiCategories=r._includes.join(",")}r._excludes&&(i.excludePoiCategories=r._excludes.join(","))}return this._send("nearbyPoi",i,e,this._nearbyPoiTransform,"nearbyPoi")}_checkOptions(e,t){if((void 0!==e.center||void 0!==e.radius)&&void 0!==e.region)throw new Error("[MapKit] Setting both `center`/`radius` and region are not allowed. Expects either a circular region defined by `center`/`radius` or a rectangular region defined by `region`.");return super._checkOptions(e,t)}_nearbyPoiTransform(e,t){const i={places:[]};return t.results&&(i.places=t.results.map((e=>new Si(e)))),i}};class ly extends df{constructor(e){super(),Object.defineProperty(this,"_impl",{value:new ry(e)})}get center(){return this._impl.center}set center(e){this._impl.center=e}get radius(){return this._impl.radius}set radius(e){this._impl.radius=e}get region(){return this._impl.region}set region(e){this._impl.region=e}get pointOfInterestFilter(){return this._impl.pointOfInterestFilter}set pointOfInterestFilter(e){this._impl.pointOfInterestFilter=e}search(e,t){return this._impl.search(e,t)}}Object.defineProperty(ly,"MaxRadius",{enumerable:!0,value:2e3});const hy=ly,cy={userLocation:j_,mapkit:{CoordinateRegion:vi.CoordinateRegion,CoordinateSpan:vi.CoordinateSpan,Coordinate:vi.Coordinate,BoundingRegion:vi.BoundingRegion,MapPoint:vi.MapPoint,MapRect:vi.MapRect,MapSize:vi.MapSize,Geocoder:ff,Search:Nf,PlaceLookup:Bf,Directions:iy,PointsOfInterestSearch:hy,Place:Si.prototype.constructor,SearchAutocompleteResult:vu.prototype.constructor,PointOfInterestCategory:We,PointOfInterestFilter:Ve.exposedConstructor,AddressCategory:bf,AddressFilter:Sf.exposedConstructor,get filterIncludingAllCategories(){return Ve.filterIncludingAllCategories},get filterExcludingAllCategories(){return Ve.filterExcludingAllCategories}}},dy={Feature:"Feature",FeatureCollection:"FeatureCollection",GeometryCollection:"GeometryCollection",MultiPoint:"MultiPoint",MultiLineString:"MultiLineString",MultiPolygon:"MultiPolygon",Point:"Point",LineString:"LineString",Polygon:"Polygon",Position:"Position"},uy={Feature:function(e){return py(e,e.geometry&&e.geometry.type)},FeatureCollection:function(e){if(!(e instanceof Object&&e.features instanceof Array))return!1;for(const t in e.features){const i=e.features[t];if(i.geometry&&!py(i,i.geometry.type))return!1}return!0},Position:function(e){return function(e){if(!Array.isArray(e)||e.length<2)return!1;for(let t=0;t<2;++t)if("number"!=typeof e[t]||isNaN(e[t]))return!1;return!0}(e)},Point:function(e){return my(e,dy.Point)},MultiPoint:function(e){return my(e,dy.MultiPoint)},LineString:function(e){return my(e,dy.LineString)},MultiLineString:function(e){return my(e,dy.MultiLineString)},Polygon:function(e){return my(e,dy.Polygon)},MultiPolygon:function(e){return my(e,dy.MultiPolygon)},GeometryCollection:function(e){if(!(e instanceof Object&&e.geometries instanceof Array))return!1;for(const t in e.features){if(!my(e,e.geometries[t].type))return!1}return!0}};function py(e,t){return e instanceof Object&&(e.type===dy.Feature&&!!my(e.geometry,t))}function my(e,t){return e instanceof Object&&((!t||e.type===t)&&(((i=e.type)instanceof String||"string"==typeof i)&&(e.type===dy.GeometryCollection?uy.GeometryCollection(e):e.type===dy.MultiLineString||e.type===dy.MultiPolygon||e.type===dy.MultiPoint?function(e){for(let t=0;t<e.length;t+=1)if(!(e[t]instanceof Array))return!1;return!0}(e.coordinates):e.coordinates instanceof Array)));var i}const gy={isValid:function(e){return!!uy[e.type]&&uy[e.type](e)},isPosition:function(e){return uy.Position(e)}},_y={Point:Kp,LineString:tu,Polygon:au},fy={MultiPoint:dy.Point,MultiLineString:dy.LineString,MultiPolygon:dy.Polygon},yy=[dy.MultiPoint,dy.MultiLineString,dy.MultiPolygon];class vy extends Error{constructor(e){super(e)}}function by(e,t,i){const s=function(){const t=i(s.collection?s.collection.items[s.index]:e.scheduledTaskItem);s.collection?s.collection.items[s.index]=t:e.scheduledTaskItem=t};return t&&(s.collection=t,s.index=t.items.length),bt.scheduleInBackground(s,bt.Priority.Highest),s}function wy(e){if(!gy.isPosition(e))throw new vy("[MapKit] Expected a GeoJSON Position type, instead got "+e);return new pi(e[1],e[0])}function Cy(e,t,i){const s=yy.indexOf(e.type)>-1,o="GeometryCollection"===e.type;let n;if(s||o){const a=s?e.coordinates:e.geometries;if(s)switch(e.type){case dy.MultiPoint:n=t.delegate.itemForMultiPoint;break;case dy.MultiLineString:n=t.delegate.itemForMultiLineString;break;case dy.MultiPolygon:n=t.delegate.itemForMultiPolygon}o&&(n=t.delegate.itemForPoint);const r=new md([],e);return a.forEach((i=>{s&&(i={type:fy[e.type],coordinates:i}),r.items.push(Cy(i,t,r))})),t.hasCallbackOrDelegate&&by(t,i,(()=>(r._impl.items=r.items.filter((e=>!!e)),n?ue(n,t.delegate,[r,e],r):r))),r}const a=_y[e.type];if(!a)throw new vy("[MapKit] Expected a GeoJSON "+e.type+" type, instead got "+e);const r=function(e,t){switch(t){case dy.MultiPoint:case dy.LineString:return e.map((e=>wy(e)));case dy.Polygon:return e.map((e=>e.map((e=>wy(e)))));default:return wy(e)}}(e.coordinates,e.type);let l,h;switch(e.type){case dy.Point:n=t.delegate.itemForPoint,l=r;break;case dy.LineString:n=t.delegate.itemForLineString,h=t.delegate.styleForOverlay;break;case dy.Polygon:n=t.delegate.itemForPolygon,h=t.delegate.styleForOverlay}function c(){const i=new a(r,{data:e}),s=n?ue(n,t.delegate,[l||i,e],i):i;return s?(++t.itemCount,h&&(s.style=ue(h,t.delegate,[i,e],i)),s):null}return t.hasCallbackOrDelegate?by(t,i,c):c()}function ky(e,t,i){let s;switch(e.type){case dy.Feature:return s=function(e,t,i){if(null===e.geometry)return t.hasCallbackOrDelegate?by(t,i,(()=>null)):null;if(!gy.isValid(e))throw new vy("[MapKit] Expected a GeoJSON "+e.type+" type, instead got "+e);const s=Cy(e.geometry,t,i);if(!s)throw new vy("[MapKit] "+e+" is an unknown GeoJSON type");return s}(e,t,i),t.delegate.itemForFeature&&by(t,i,(i=>ue(t.delegate.itemForFeature,t.delegate,[i,e],i))),s;case dy.FeatureCollection:return s=new md([],e),e.features.forEach((e=>{const i=ky(e,t,s);i&&s.items.push(i)})),t.hasCallbackOrDelegate&&by(t,i,(()=>(s._impl.items=s.items.filter((e=>!!e)),t.delegate.itemForFeatureCollection?ue(t.delegate.itemForFeatureCollection,t.delegate,[s,e],s):s))),s;case dy.GeometryCollection:case dy.MultiPoint:case dy.MultiLineString:case dy.MultiPolygon:case dy.Point:case dy.LineString:case dy.Polygon:case dy.Position:return Cy(e,t,i);default:throw"string"==typeof e.type?new vy('[MapKit] "'+e.type+'" is an unknown GeoJSON type.'):new vy("[MapKit] importGeoJSON expects an object with a known GeoJSON `type` property.")}}const My={importGeoJSON:function(e,t){const i={delegate:{},itemCount:0,hasCallbackOrDelegate:!1};t&&(i.delegate=t,i.hasCallbackOrDelegate=!0);try{const s="[MapKit] importGeoJSON expects an Object and was passed ";if(!e)throw new vy(s+"a falsy value");if(!(e instanceof Object))throw new vy(s+e);if(Array.isArray(e))throw new vy(s+"an array");let o=ky(e,i);return i.hasCallbackOrDelegate?void bt.scheduleInBackground((()=>{let s=void 0===i.scheduledTaskItem?o:i.scheduledTaskItem;s instanceof md||(s=new md(s,e)),"function"==typeof t?ue(t,null,[null,s]):i.delegate.geoJSONDidComplete?(0===i.itemCount&&console.warn("[MapKit] No item is imported with importGeoJSON, either because GeoJSON has no geometries, or the delegate methods did not return any item."),ue(i.delegate.geoJSONDidComplete,i.delegate,[s,e])):console.warn("[MapKit] importGeoJSON was called asynchronously with a delegate object but no `geoJSONDidComplete` method was defined.")}),bt.Priority.Highest):(o instanceof md||(o=new md(o,e)),o)}catch(s){if(!(s instanceof vy))throw s;"function"==typeof i.delegate.geoJSONDidError?ue(i.delegate.geoJSONDidError,i.delegate,[s,e]):"function"==typeof t?ue(t,null,[s]):console.error(s.message)}},constants:dy,validate:gy},Sy=ce;const Ly=function(e,t){const i="function"==typeof t,s="object"==typeof t&&null!==t,o="string"==typeof e;if(o&&!i&&!s)throw new Error("[MapKit] For GeoJSON file imports, a callback must be provided as a second argument");return o?function(e,t){const i=new Sy(e,{loaderDidSucceed:function(i,s){let o;try{o=JSON.parse(s.responseText)}catch(i){return void t(new Error("[MapKit] The response of "+e+" does not appear to be valid JSON:"+s.responseText))}t(null,o)},loaderDidFail:function(i,s){t(new Error("[MapKit] Failed to load "+e))}});return i.schedule(),i.id}(e,((e,o)=>{if(!e)return My.importGeoJSON(o,t);s&&t.geoJSONDidError?ue(t.geoJSONDidError,t,[e]):i&&ue(t,null,[e])})):My.importGeoJSON(e,t)},xy={mapkit:{importGeoJSON:Ly}},Ay=Math.min(Eo.imagePixelRatio,3),Ey=(Ay>1?"_"+Ay+"x":"")+".png";let Ty;const Iy={};let Oy=[],Ry=!1;function Py(){const e={};function t(t,s){const o=St.createImageUrl("pins/pin"+(t?"-":"")+t+"-"+s+Ey),n=Eo.htmlElement("img",{src:o}),a={handleEvent:function(o){switch(n.removeEventListener("load",a),n.removeEventListener("error",a),o.type){case"load":e[t][s]=n;break;case"error":console.warn("[MapKit] Error loading pin annotation image "+o.target.src+"; pin annotations may not display correctly."),Ry=!0}--i,0===i&&(Ty=e,Oy.forEach((e=>{e.needsDisplay=!0})),Oy=void 0)}};n.crossOrigin=sa.getCorsAttribute(Ue.distUrlWithCredentials),n.addEventListener("load",a),n.addEventListener("error",a)}let i=["","floating","down1","down2","down3"].reduce(((i,s)=>(e[s]={},t(s,"base"),t(s,"head"),i+2)),1);t("","shadow")}let Dy=!1;const zy=class extends Go{constructor(e){super(e),function(){if(Dy)return;if(Dy=!0,Ue.state===Ue.States.PENDING||Ue.state===Ue.States.READY)return void Py();Ue.addEventListener(Ue.Events.Initialized,(function e(){Ue.removeEventListener(Ue.Events.Initialized,e),Py()}))}()}draw(e){if(!Ty)return void(Oy.indexOf(this._node)<0&&Oy.push(this._node));const t=this._node,i=t.size.width,s=t.size.height;if(Ry){return void function(e,t,i,s){e.strokeStyle="#ff4040",e.lineWidth=2,e.strokeRect(0,t,i,s-t),e.beginPath(),e.moveTo(0,t),e.lineTo(i,s),e.moveTo(0,s),e.lineTo(i,t),e.stroke()}(e,s-t._annotation.size.height,t._annotation.size.width,s)}const o=t._state,n=t._annotation.color;if(Iy[n]||(Iy[n]={}),!Iy[n][o]){const e=document.createElement("canvas");e.width=i*Ay,e.height=s*Ay;const t=e.getContext("2d");t.fillStyle=n,t.fillRect(0,0,e.width,e.height),t.save(),t.globalCompositeOperation="destination-in",t.drawImage(Ty[o].head,0,0),t.restore(),t.drawImage(Ty[o].base,0,0),Iy[n][o]=e}t.shadowTransform&&e.drawImage(Ty[""].shadow,t.shadowTransform.e,t.shadowTransform.f,i,s),e.drawImage(Iy[n][o],0,0,i,s)}};const Ny=class extends Ls{constructor(e){super(),this.size=new es(32,39),this._annotation=e,this._renderer=new zy(this),this.updateState()}get position(){return this._annotation.nodePosition()}stringInfo(){return"PinAnnotationNode"+(this._state?"<"+this._state+">":"")}updateState(e){e=this._annotation.floating?"floating":e||"",this._state!==e&&(this._state=e,this.needsDisplay=!0)}},Fy=[1,2,3,2,1],Uy=Math.tan(.820304748437335);const Gy=class extends zu{get isBouncing(){return this._bounceAnimationFrameIndex>=0}animateDropAfterLift(){const e=Math.max(this._dropAnimationStartP-Math.min((Date.now()-this._dropAfterLiftAnimationStartDate)/this.liftDurationMs,1),0);let t=this.liftAmount*e;this._annotation.sceneGraphNode.transform=(new ss).translate(0,-t),this._dropAnimationRevert||(t*=1.25),this._annotation.sceneGraphNode.shadowTransform=(new ss).translate(Uy*t,-t),0===e&&(delete this._annotation.floating,this._annotation.sceneGraphNode.updateState(),delete this._dropAfterLiftAnimationStartDate,delete this._dropAnimationStartP,delete this._dropAnimationRevert,this._dequeueNextAnimation()),bt.scheduleOnNextFrame(this)}animateLift(){const e=Math.min((Date.now()-this._liftAnimationStartDate)/this.liftDurationMs,1);let t=this.liftAmount*e;this._annotation.sceneGraphNode.transform=(new ss).translate(this.translation.x,this.translation.y-t),this._shadowLiftDamping&&(t=this.liftAmount*(1+.25*e)),this._annotation.sceneGraphNode.shadowTransform=(new ss).translate(Uy*t,-t),e<1?(bt.scheduleOnNextFrame(this),this._liftAnimationProgress=e):(delete this._liftAnimationStartDate,delete this._liftAnimationProgress,delete this._shadowLiftDamping,this._dequeueNextAnimation())}drop(){const e=this._annotation.position().y;this._pinVerticalTranslation=-e-4,this._shadowHorizontalTranslation=Uy*-this._pinVerticalTranslation,this._shadowVerticalTranslation=this._pinVerticalTranslation;const t=e/this._annotation.delegate.mapForAnnotation(this._annotation._public)._impl.ensureRenderingFrame().size.height;this._dropDurationMs=1e3*Math.min(.35*(t+(1-t)/2),3),this._dropAnimationStartDate=Date.now(),this._annotation.floating=!0,this._annotation.sceneGraphNode.updateState(),this._animateDrop(),this._annotation._isAnimating=!0,this._animationQueue=[this._bounce,()=>this._annotation.finishedAnimating()],bt.scheduleOnNextFrame(this)}dropAnnotationAfterDraggingAndRevertPosition(e){const t=()=>this._annotation.droppedAfterLift();this._bounceAnimationFrameIndex>=0?this._animationQueue=[t]:(this._liftAnimationStartDate?(this._dropAnimationStartP=this._liftAnimationProgress,delete this._liftAnimationStartDate,delete this._liftAnimationProgress):this._dropAnimationStartP=1,e?(this._dropAfterLift(),this._animationQueue=[this._bounce,t]):(this._annotation.draggingDidEnd(),this._shadowLiftDamping=!0,this._animationQueue=[this._dropAfterLift,this._bounce,t],super.lift(this.nominalLiftAmount)),this._dropAnimationRevert=e,bt.scheduleOnNextFrame(this))}lift(e){this.nominalLiftAmount=e,this._animationQueue=[this._liftAfterBounce],this._bounce(),bt.scheduleOnNextFrame(this)}setTranslation(e){this.translation=e,this._bounceAnimationFrameIndex>=0||this._liftAnimationStartDate||(this._annotation.sceneGraphNode.transform=(new ss).translate(e.x,e.y-this.liftAmount),this._annotation.sceneGraphNode.shadowTransform=(new ss).translate(Uy*this.liftAmount,-this.liftAmount))}performScheduledUpdate(){this._dropAnimationStartDate?this._animateDrop():this._bounceAnimationFrameIndex>=0?this._animateBounce():super.performScheduledUpdate()}_animateBounce(){this._bounceAnimationFrameIndex<Fy.length?(this._annotation.sceneGraphNode.updateState("down"+Fy[this._bounceAnimationFrameIndex]),++this._bounceAnimationFrameIndex):(delete this._bounceAnimationFrameIndex,this._dequeueNextAnimation()),bt.scheduleOnNextFrame(this)}_animateDrop(){const e=Math.min((Date.now()-this._dropAnimationStartDate)/this._dropDurationMs,1),t=1-e;this._annotation.sceneGraphNode.transform=(new ss).translate(0,t*this._pinVerticalTranslation),this._annotation.sceneGraphNode.shadowTransform=(new ss).translate(t*this._shadowHorizontalTranslation,t*this._shadowVerticalTranslation),1===e&&(delete this._pinVerticalTranslation,delete this._shadowHorizontalTranslation,delete this._shadowVerticalTranslation,delete this._dropAnimationStartDate,delete this._dropDurationMs,this._annotation.floating=!1,this._annotation.sceneGraphNode.updateState(),this._dequeueNextAnimation()),bt.scheduleOnNextFrame(this)}_bounce(){this._bounceAnimationFrameIndex=0}_dequeueNextAnimation(){this._animationQueue.length>0&&this._animationQueue.shift().call(this)}_dropAfterLift(){delete this.translation,this._dropAfterLiftAnimationStartDate=Date.now(),bt.scheduleOnNextFrame(this)}_liftAfterBounce(){super.lift(this.nominalLiftAmount),this._annotation.floating=!0,this._annotation.sceneGraphNode.updateState()}};function By(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const Wy=new es(15,36),Zy={Red:"#ff3d38",Green:"#54d669",Purple:"#c969e0"},Ky=new window.DOMPoint(8,35),jy=new window.DOMPoint(-8,0);function Hy(e){var t;class i extends e{constructor(t,i,s){super(t,i,e.div,s),By(this,"dragOffset",new ts(0,2))}init(t,i,s){this._animationController=new Gy(this),this._dragController=this._animationController,this._sceneGraphNode=new Ny(this),super.init(t,i,e.div,s),this.setSize(Wy)}get size(){return Wy.copy()}set size(e){console.warn("[MapKit] The `size` property of a pin annotation cannot be set.")}get color(){return this._color}set color(e){p(e,"string","[MapKit] Expected a string value for PinAnnotation.color, but got `"+e+"` instead"),e!==this._color&&(this._color=e,this.updateLocalizedText(),this._sceneGraphNode.needsDisplay=!0)}centerOffsetForSelectionAccessory(){return new ts(-8,-2)}get shouldPreventDrag(){return this._animationController.isBouncing}doesAnimate(){return this._animates}willMoveToMap(e){this._isMoving=e&&this.animates}didMoveToMap(){const e=this._isMoving;super.didMoveToMap(),this.delegate&&e&&this.visible&&!this._appearanceAnimation&&this._shown&&(this._isAnimating=!0,this._animationController.drop())}droppedAfterLift(){this.resetNodeTransform(),this._sceneGraphNode.updateState(),super.droppedAfterLift()}finishedAnimating(){this._sceneGraphNode.updateState(),super.finishedAnimating()}altText(){return super.altText()||(this._color===Zy.Green?Vi.get("Annotation.Pin.Green.AccessibilityLabel"):this._color===Zy.Purple?Vi.get("Annotation.Pin.Purple.AccessibilityLabel"):this._color===Zy.Red?Vi.get("Annotation.Pin.Red.AccessibilityLabel"):Vi.get("Annotation.Pin.AccessibilityLabel"))}draggingDidEnd(){super.draggingDidEnd(),super.updatePosition()}resetNodeTransform(){this.sceneGraphNode.transform=new ss}}return t=i,By(i,"Colors",Zy),t.prototype._animates=!0,t.prototype._color=Zy.Red,t.prototype._anchorPoint=Ky,t.prototype._calloutAnchorPoint=jy,t.prototype.renderedByDOMElement=!1,t.prototype.ConstructorOptions=Object.freeze(Object.assign({},e.prototype.ConstructorOptions,{color:"rw"})),i}Hy.Colors=Zy;const Vy=Hy,qy=Vy(Fu);class Yy extends Bu{constructor(e,t){super(),console.warn("[MapKit] mapkit.PinAnnotation is deprecated and will be removed in a future release. Please use the newer mapkit.MarkerAnnotation class instead."),Object.defineProperty(this,"_impl",{value:new qy(this,e,t)}),this._impl.init(this,e,t)}get size(){return this._impl.size}set size(e){this._impl.size=e}get color(){return this._impl._color}set color(e){this._impl.color=e}}Yy.Colors=Vy.Colors;const Xy={mapkit:{}};[vf,{mapkit:{PinAnnotation:Yy}},xy,cy].forEach((e=>{Object.keys(e).forEach((t=>{"mapkit"!==t?Xy[t]=e[t]:Object.keys(e.mapkit).forEach((t=>{Xy.mapkit[t]=e.mapkit[t]}))}))}));const $y=Xy;const Jy=e=>{if(!e)return null;try{return JSON.parse((t=qi(e.trim(),Yi),(new TextDecoder).decode(new Uint8Array(atob(t).split("").map((e=>e.charCodeAt(0)))))))}catch(e){if(e instanceof DOMException)return null;if(e instanceof SyntaxError)return null;throw e}var t};class Qy extends Ge{constructor(){throw super(),new TypeError("[MapKit] MapKit may not be constructed.")}init(e){Ue.init(e),Ue.addEventListener(Ue.Events.Changed,ev),Ue.addEventListener(Ue.Events.Error,ev)}get version(){return e.version}get build(){return e.build+""+Ue.buildTags}get language(){return Ue.language}set language(e){Ue.language=e}toString(){return["MapKit JS",this.version,"("+this.build+")"].join(" ")}get _tileProvider(){return Ue.tileProvider}get _countryCode(){return Ue.countryCode}set _countryCode(e){Ue._c(H).setForcedCountryCode(e)}_login(){Ue.login()}_restore(){Ue._restore()}get _environment(){return Ue.environment}}const ev=function(e){const t=new O(e.type);t.status=e.status,e.message&&(t.message=e.message),e.responseIdentifier&&(t.responseIdentifier=e.responseIdentifier),ov.dispatchEvent(t)},tv=Object.keys({importGeoJSON:["geojson"],FeatureVisibility:["map"],CoordinateRegion:["map","services"],CoordinateSpan:["map","services"],Coordinate:["map","services"],BoundingRegion:["map","services"],MapPoint:["map","services"],MapRect:["map","services"],MapSize:["map","services"],Padding:["map"],CameraZoomRange:["map"],MapFeatureType:["annotations"],Style:["overlays"],LineGradient:["overlays"],CircleOverlay:["overlays"],PolylineOverlay:["overlays"],PolygonOverlay:["overlays"],Geocoder:["services"],Search:["services"],PlaceLookup:["services"],Directions:["services"],PointsOfInterestSearch:["services"],Map:["map"],maps:["map"],Annotation:["annotations"],PinAnnotation:["annotations"],ImageAnnotation:["annotations"],MarkerAnnotation:["annotations"],MapFeatureAnnotation:["annotations"],TileOverlay:["overlays"],Place:["services"],SearchAutocompleteResult:["services"],PointOfInterestCategory:["map","services"],PointOfInterestFilter:["map","services"],filterIncludingAllCategories:["map","services"],filterExcludingAllCategories:["map","services"],AddressCategory:["services"],AddressFilter:["services"],PlaceDetail:["map"],PlaceSelectionAccessory:["annotations"]});let iv=!1;!function(e){e.loadAll=function(){this._chunkLoaded($y,(()=>this._dispatchLoadEndEvent(["all"])))}}(W),W.addEventListener(W.Events.LOAD,(e=>{const t=e.jsModules;if(t.mapkit)for(const e of Object.keys(t.mapkit)){const i=tv.indexOf(e);-1!==i&&(delete Qy.prototype[e],tv.splice(i,1)),Object.defineProperty(Qy.prototype,e,Object.getOwnPropertyDescriptor(t.mapkit,e))}if(!iv&&W.jsModules.css&&W.jsModules.utils){const e=W.jsModules.utils.htmlElement("style",W.jsModules.css);e.nonce=Ue.nonce,document.head.appendChild(e),iv=!0}}));const sv=St.findScriptAndSetBasePath();sv&&sv.nonce&&(Ue.nonce=sv.nonce,Ue.scriptBaseUrl=St.scriptBaseUrl),W.loadAll(),function(e){if(!e)return;const t=e.dataset.callback,i=e.dataset.language,s=e.dataset.libraries,o=void 0!==e.dataset.token?e.dataset.token:e.dataset.initialToken,n=e.dataset.distUrl,a=e.dataset.proxyPrefix,r=e.dataset.countryCode,l=!("false"===e.dataset.shouldLogin),h=e.dataset.teamId,c=Jy(e.dataset.options),d={_shouldLogin:l,_teamId:h,...c};for(const[t,i]of Object.entries(e.dataset))"`ha\\aHe_"===j(t)&&(d["_"+t]=i);if(e.src&&-1!==e.src.indexOf("sourcemap=1")&&(Ue.enableSourceMap=!0),Ue.setPerformanceMarkers(e.dataset.performanceMarkers),!(t||i||s||void 0!==o||n||a||r||h||c))return;i&&(d.language=i),(o||""===o&&a)&&(d.authorizationCallback=function(e){e(o)}),n&&(d._distUrl=n),a&&(d._proxyPrefixes=[a]),r&&(d.countryCode=r),Ue.init(d,!0),t&&setTimeout((()=>{"function"==typeof window[t]&&window[t]()}))}(sv),Ue.state!==Ue.States.UNINITIALIZED&&(Ue.addEventListener(Ue.Events.Changed,ev),Ue.addEventListener(Ue.Events.Error,ev));const ov=Object.create(Qy.prototype);Ue.performanceMarkers.loading&&performance.mark("mapkit-core-load");const nv=ov;window.mapkit&&window.mapkit.init&&console.warn("[MapKit] Mapkit namespace already exists; did you import MapKit more than once?"),window.mapkit=nv})();